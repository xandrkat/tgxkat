(this.webpackJsonptgxkat=this.webpackJsonptgxkat||[]).push([[3],Array(436).concat([function(e,t,a){"use strict";class n{constructor(e,t=[]){this.start=()=>{this.stopped=!1,this.id=requestAnimationFrame(this.startInternal)},this.startInternal=e=>{const t=this.startTime,a=this.duration;this.startTime=e,this.endTime=t+a,this.draw(e)},this.draw=e=>{const t=this.stopped,a=this.duration,s=this.startTime,i=this.options;if(e-s>a&&i.every(e=>e.to===e.last)&&(this.stopped=!0),t)return;const r=Math.min(e-s,a),o=0===a?1:r/a,l=n.outSine(o);i.forEach(e=>{const t=e.from,a=e.to,n=e.func;e.last=t+(a-t)*l,n(e.last)}),this.id=requestAnimationFrame(this.draw)},this.stop=()=>{this.stopped=!0,cancelAnimationFrame(this.id)},this.options=t,this.duration=e}static outSine(e){return Math.sin(e*Math.PI/2)}}t.a=n},function(e,t,a){"use strict";var n=a(0),s=a.n(n),i=a(156),r=a(5),o=a(1);a(446);class l extends s.a.Component{constructor(...e){super(...e),this.state={emoji:null,prevPropsSticker:null},this.loadStickerEmojis=e=>{const t=e.sticker.id;o.a.send({"@type":"getStickerEmojis",sticker:{"@type":"inputFileId",id:t}}).then(t=>{this.props.sticker===e&&this.setState({emoji:t.emojis.join(" ")})})}}static getDerivedStateFromProps(e,t){const a=e.sticker,n=t.prevPropsSticker;return a&&n?{prevPropsSticker:a,emoji:null}:null}componentDidUpdate(e,t,a){const n=this.props.sticker;n&&n!==e.sticker&&this.loadStickerEmojis(n)}componentDidMount(){const e=this.props.sticker;e&&this.loadStickerEmojis(e)}render(){const e=this.props.sticker,t=this.state.emoji;return e?s.a.createElement("div",{className:"sticker-preview"},s.a.createElement("div",{className:"sticker-preview-emoji"},t),s.a.createElement(i.b,{sticker:e,displaySize:r.Db,source:i.a.PREVIEW})):null}}t.a=l},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";var n=a(0),s=a.n(n),i=a(30);t.a=Object(i.a)(s.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M6.66607426,13.6501686 C7.13342047,13.4117012 7.7055954,13.5972442 7.94406273,14.0645904 C8.71613228,15.5776856 10.2710663,16.5499921 12,16.5499921 C13.7262991,16.5499921 15.2792455,15.5806677 16.0525854,14.0711462 C16.2918118,13.6041881 16.8642875,13.419575 17.3312456,13.6588014 C17.7982037,13.8980278 17.9828168,14.4705034 17.7435904,14.9374615 C16.6482438,17.0755242 14.4462205,18.4499921 12,18.4499921 C9.55003677,18.4499921 7.34521255,17.0713067 6.2516524,14.928157 C6.01318507,14.4608108 6.19872805,13.8886359 6.66607426,13.6501686 Z M8.75,8 C9.44035594,8 10,8.67157288 10,9.5 C10,10.3284271 9.44035594,11 8.75,11 C8.05964406,11 7.5,10.3284271 7.5,9.5 C7.5,8.67157288 8.05964406,8 8.75,8 Z M15.25,8 C15.9403559,8 16.5,8.67157288 16.5,9.5 C16.5,10.3284271 15.9403559,11 15.25,11 C14.5596441,11 14,10.3284271 14,9.5 C14,8.67157288 14.5596441,8 15.25,8 Z"}),"Smile")},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var n=a(6),s=a.n(n),i=a(11),r=a(0),o=a.n(r),l=a(18),c=a.n(l),d=a(61),h=a(199),p=a(430),u=a(5);var m=function(e){class t extends o.a.Component{render(){return o.a.createElement(p.a,{maxSnack:u.u},o.a.createElement(e,this.props))}}return t.displayName="WithSnackbarNotifications(".concat(Object(d.b)(e),")"),t},g=a(248),f=a(125),C=a(109),b=a(83),v=a(211),E=a(212),S=a(180),y=a(213),M=a(12),I=a(129),U=a(2),k=a(16),x=a(1);a(456);class w extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaShortcut=e=>{const t=e.event;t&&this.onKeyDown(t)},this.onKeyDown=e=>{const t=e.key,a=e.code,n=e.altKey,s=e.ctrlKey,i=e.metaKey,r=e.shiftKey,o=this.props.video;if(!o)return;let l=!1;switch(a){case"Escape":n||s||i||r||(this.handleClose(),l=!0);break;case"ArrowLeft":n||s||i||r||(this.handleSeek(o.currentTime-u.Y),l=!0);break;case"KeyJ":n||s||i||r||(this.handleSeek(o.currentTime-u.X),l=!0);break;case"ArrowRight":n||s||i||r||(this.handleSeek(o.currentTime+u.Y),l=!0);break;case"KeyL":n||s||i||r||(this.handleSeek(o.currentTime+u.X),l=!0);break;case"ArrowUp":n||s||i||r||(this.handleVolume(o.volume+u.db),l=!0);break;case"ArrowDown":n||s||i||r||(this.handleVolume(o.volume-u.db),l=!0);break;case"Space":case"KeyK":n||s||i||r||(this.handleClick(),l=!0);break;case"KeyM":n||s||i||r||(this.handleMute(),l=!0);break;case"KeyF":n||s||i||r||(this.handleFullScreen(),l=!0);break;case"KeyI":n||s||i||r||(l=!0);break;case"Digit0":case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":case"Digit6":case"Digit7":case"Digit8":case"Digit9":if(!n&&!s&&!i&&!r){const e=new Number(t.replace("Digit",""))/10;this.handleSeekProgress(e),l=!0}break;case"Home":n||s||i||r||(this.handleSeek(0),l=!0);break;case"End":n||s||i||r||(this.handleSeek(o.duration-1),l=!0);break;case"Comma":n||s||i||!r||(this.handlePlaybackRate(o.playbackRate-u.T),l=!0);break;case"Period":n||s||i||!r||(this.handlePlaybackRate(o.playbackRate+u.T),l=!0)}l&&(e.stopPropagation(),e.preventDefault())},this.handleVolume=e=>{const t=this.props.video;t&&(e=Object(M.d)(e,u.bb,u.ab),t.volume=e,this.showMediaHint("".concat(Math.round(100*t.volume),"%")))},this.handlePlaybackRate=e=>{const t=this.props.video;t&&(e=Object(M.d)(e,u.R,u.Q),t.playbackRate=e,this.showMediaHint("".concat(e,"x")))},this.handleSeekProgress=e=>{const t=this.props.video;t&&this.handleSeek(e*t.duration)},this.handleSeek=e=>{const t=this.props.video;t&&(e=Object(M.d)(e,0,t.duration||0),t.currentTime=e,this.setState({currentTime:e}))},this.onFullScreenChange=()=>{const e=(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)===document.getElementById("pip-player-wrapper");this.setState({fullscreen:e})},this.onWindowResize=()=>{if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)return;const e=document.getElementById("pip-player"),t=parseInt(e.style.left,10),a=parseInt(e.style.top,10),n=this.normalizePosition(t,a,!0),s=n.left,i=n.top;t===s&&a===i||(e.style.left=s+"px",e.style.top=i+"px")},this.handleLoadedData=e=>{e.target},this.handleLoadedMetadata=e=>{const t=e.target;if(!t)return;const a=this.state.currentTime,n=t.duration,s=t.volume,i=t.buffered;this.setState({duration:n,volume:s,waiting:!0,buffered:i},()=>{a&&(t.currentTime=a)})},this.handleCanPlay=e=>{const t=e.target;this.setState({waiting:!1},()=>{if(!t)return;this.state.play?t.play():t.pause()})},this.handlePlay=e=>{const t=this.props.onPlay;this.setState({play:!0,hidden:!0}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerPlay"}),t&&t(e)},this.handlePause=e=>{const t=this.props.onPause;this.setState({play:!1,hidden:!1}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerPause"}),t&&t(e)},this.handleEnded=e=>{const t=this.props.onEnded;x.a.clientUpdate({"@type":"clientUpdateMediaViewerEnded"}),t&&t(e);const a=this.props.video;this.setCurrentTime({currentTime:0,duration:a.duration})},this.handleTimeUpdate=e=>{const t=e.target;if(!t)return;const a=this.props.fileId,n=t.currentTime,s=t.duration,i=t.volume,r=t.buffered;this.setState({duration:s,currentTime:n,volume:i,buffered:r}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerTimeUpdate",fileId:a,currentTime:n,duration:s,volume:i,buffered:r}),this.setCurrentTime({currentTime:n,duration:s})},this.handleVolumeChange=e=>{const t=this.props.onVolumeChange,a=e.target;if(!a)return;const n=a.volume;this.setState({volume:n}),x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:n}),t&&t(e)},this.handleProgress=e=>{const t=e.target;if(!t)return;const a=this.props.fileId,n=t.buffered;this.setState({buffered:n}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerProgress",fileId:a,buffered:n})},this.handleWaiting=()=>{this.setState({waiting:!0})},this.handleClick=()=>{this.startStopPlayer()},this.startStopPlayer=()=>{const e=this.props.video;if(!e)return;this.state.waiting?this.setState({play:!this.state.play,hidden:!1}):e.paused?e.play():e.pause()},this.handlePlayerMouseDown=e=>{const t=document.getElementById("pip-player-wrapper");t&&t.focus(),this.mouseDownRoot=!0,e.preventDefault(),1===e.nativeEvent.which&&(this.offsetX=e.nativeEvent.offsetX,this.offsetY=e.nativeEvent.offsetY,document.onmousemove=this.handleMouseMove,document.onmouseup=this.handleMouseUp,this.setState({windowDragging:!0}))},this.handleMouseUp=e=>{e.preventDefault(),document.onmousemove=null,document.onmouseup=null,this.setState({windowDragging:!1})},this.handleMouseMove=e=>{e.preventDefault();const t=this.normalizePosition(e.clientX-this.offsetX,e.clientY-this.offsetY,!1),a=t.left,n=t.top,s=document.getElementById("pip-player");s.style.left=a+"px",s.style.top=n+"px"},this.handleMouseDown=e=>{e.stopPropagation();const t=this.props.video;t&&this.setState({dragging:!0,draggingTime:t.currentTime})},this.handleChange=(e,t)=>{const a=this.props.video;a&&this.setState({draggingTime:t*a.duration})},this.handleChangeCommitted=()=>{const e=this.state,t=e.dragging,a=e.draggingTime;t&&this.setState({dragging:!1,currentTime:a,draggingTime:0},()=>{const e=this.props.video;e&&Number.isFinite(a)&&(e.currentTime=a)})},this.handlePanelEnter=()=>{this.panelEnter=!0},this.handlePanelLeave=()=>{this.panelEnter=!1},this.handleMouseOver=e=>{this.mouseDownRoot=!1;this.state.hidden&&this.setState({hidden:!1}),clearTimeout(this.mouseOverTimeout),this.mouseOverTimeout=setTimeout(()=>{this.panelEnter||this.state.play&&this.state.duration&&this.setState({hidden:!0})},1e3)},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdatePictureInPicture",videoInfo:null})},this.handleVolumeSliderChange=(e,t)=>{t!==this.state.volume&&this.setState({volume:t},()=>{const e=this.props.video;e&&(e.volume=t)})},this.handleVolumeSliderChangeCommitted=e=>{this.props.video&&document.activeElement.blur()},this.handleMute=()=>{const e=this.props.video;e&&(0===e.volume?e.volume=this.prevVolume||.5:(this.prevVolume=e.volume,e.volume=0))},this.handleFullScreen=e=>{e&&e.stopPropagation();const t=document.getElementById("pip-player-wrapper");if(!t)return;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?this.exitFullscreen():this.requestFullscreen(t)},this.getCurrentTime=()=>{const e=this.props.fileId,t=U.a.get(e);if(!t)return;const a=t.remote;if(!a)return;const n=a.unique_id;return n?k.b.getCurrentTime(n):void 0},this.setCurrentTime=e=>{const t=this.props.fileId,a=U.a.get(t);if(!a)return;const n=a.remote;if(!n)return;const s=n.unique_id;s&&(e?k.b.setCurrentTime(s,e):k.b.clearCurrentTime(s))},this.handlePanelDoubleClick=e=>{e.preventDefault(),e.stopPropagation()},this.handleClickRoot=e=>{e.stopPropagation();this.mouseDownRoot&&this.startStopPlayer()},this.handleDoubleClick=e=>{e.stopPropagation();this.mouseDownRoot&&this.handleFullScreen(e)},this.handleFocus=()=>{I.b.add(this.keyboardHandler)},this.handleBlur=()=>{I.b.remove(this.keyboardHandler)},this.keyboardHandler=new I.a(this.onKeyDown),this.state={}}static getDerivedStateFromProps(e,t){const a=e.video,n=e.duration,s=e.currentTime,i=e.volume,r=e.play,o=e.buffered,l=e.waiting;return t.prevVideo!==a?{prevVideo:a,duration:n,currentTime:s,volume:i,play:r,buffered:o,waiting:l,dragging:!1,hidden:!1,fullscreen:!1}:null}componentDidMount(){const e=this.props.video;this.connectPlayer(e),window.addEventListener("resize",this.onWindowResize),document.addEventListener("fullscreenchange",this.onFullScreenChange),k.b.on("clientUpdateMediaShortcut",this.onClientUpdateMediaShortcut)}componentWillUnmount(){const e=this.props.video;this.disconnectPlayer(e),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("fullscreenchange",this.onFullScreenChange),k.b.off("clientUpdateMediaShortcut",this.onClientUpdateMediaShortcut),I.b.remove(this.keyboardHandler)}showMediaHint(e){const t=this.props.fileId;x.a.clientUpdate({"@type":"clientUpdateMediaHint",fileId:t,text:e})}componentDidUpdate(e,t,a){const n=this.props.video;e.video!==n&&(this.disconnectPlayer(e.video),this.connectPlayer(n))}connectPlayer(e){if(!e)return;const t=document.getElementById("pip-player"),a=this.normalizePosition(k.b.pipParams.left,k.b.pipParams.top,!1),n=a.left,s=a.top;t.style.left=n+"px",t.style.top=s+"px";document.getElementById("pip-player-wrapper").focus();const i=document.getElementById("pip-player-container");i&&(e.onloadedmetadata=this.handleLoadedMetadata,e.onloadeddata=this.handleLoadedData,e.oncanplay=this.handleCanPlay,e.onplay=this.handlePlay,e.onpause=this.handlePause,e.onended=this.handleEnded,e.ontimeupdate=this.handleTimeUpdate,e.onvolumechange=this.handleVolumeChange,e.onprogress=this.handleProgress,e.onwaiting=this.handleWaiting,i.innerHTML="",i.appendChild(e))}disconnectPlayer(e){e&&(e.onloadedmetadata=null,e.onloadeddata=null,e.oncanplay=null,e.onplay=null,e.onpause=null,e.onended=null,e.ontimeupdate=null,e.onvolumechange=null,e.onprogress=null,e.onwaiting=null)}normalizePosition(e,t,a=!0){const n=document.getElementById("pip-player"),s=n?n.clientWidth:300,i=n?n.clientHeight:300,r=document.documentElement.clientWidth,o=document.documentElement.clientHeight;return a&&this.glueLeft?e=0:a&&this.glueRight?e=r-s:(e=(e=e<u.M?0:e)>r-s-u.M?r-s:e,e=Object(M.d)(e,0,r-s)),a&&this.glueTop?t=0:a&&this.glueBottom?t=o-i:(t=(t=t<u.M?0:t)>o-i-u.M?o-i:t,t=Object(M.d)(t,0,o-i)),this.glueLeft=0===e,this.glueRight=e===r-s,this.glueTop=0===t,this.glueBottom=t===o-i,k.b.pipParams={left:e,top:t},{left:e,top:t}}requestFullscreen(e){const t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen;t&&t.call(e)}exitFullscreen(){const e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen;e&&e.call(document)}render(){const e=this.props.fileId,t=this.state,a=t.windowDragging,n=t.dragging,s=t.draggingTime,i=t.currentTime,r=t.duration,l=t.play,d=t.waiting,h=t.buffered,p=t.hidden,u=t.volume,m=t.fullscreen,I=n?s:i,U=r>0?I/r:0,k=S.a.getBufferedTime(I,h),x=r>0?k/r:0,w=Object(M.g)(Math.floor(I)||0),O=Object(M.g)(Math.floor(r)||0),L=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;return o.a.createElement("div",{id:"pip-player",className:c()("pip-player",{"pip-player-dragging":a,"pip-player-fullscreen":m}),onMouseDown:this.handlePlayerMouseDown,onMouseMove:this.handleMouseOver,onClick:this.handleClickRoot,onDoubleClick:this.handleDoubleClick},o.a.createElement("div",{id:"pip-player-wrapper",className:c()({"pip-player-wrapper-hidden":p}),onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0},o.a.createElement("div",{id:"pip-player-container"}),o.a.createElement(E.a,{fileId:e}),o.a.createElement("button",{onMouseDown:e=>e.stopPropagation(),className:c()("player-button","player-button-close",{"player-panel-hidden":p}),onClick:this.handleClose},o.a.createElement(f.a,null)),o.a.createElement("div",{className:c()("player-panel",{"player-panel-hidden":p}),onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onDoubleClick:this.handlePanelDoubleClick,onMouseEnter:this.handlePanelEnter,onMouseLeave:this.handlePanelLeave},o.a.createElement("div",{className:"player-slider"},o.a.createElement("span",{className:"player-slider-buffer-track",style:{width:100*x+"%"}}),o.a.createElement(g.a,{value:U,min:0,max:1,step:.001,classes:{root:"player-slider-root",rail:"player-slider-rail",track:"player-slider-track",thumb:"player-slider-thumb",active:"player-slider-active"},onChange:this.handleChange,onChangeCommitted:this.handleChangeCommitted,onMouseDown:this.handleMouseDown})),o.a.createElement("div",{className:"player-controls"},o.a.createElement("button",{className:"player-button",onClick:this.handleClick},l?o.a.createElement(C.a,null):o.a.createElement(b.a,null)),o.a.createElement("div",{className:"player-time"},"".concat(w," / ").concat(O)),o.a.createElement("div",{className:"player-volume"},o.a.createElement(g.a,{value:u,min:0,max:1,step:.001,classes:{root:"player-volume-root",rail:"player-volume-rail",track:"player-volume-track",thumb:"player-volume-thumb",active:"player-volume-active"},onChange:this.handleVolumeSliderChange,onChangeCommitted:this.handleVolumeSliderChangeCommitted})),o.a.createElement("button",{className:"player-button",onClick:this.handleMute},S.a.getVolumeIcon(u)),o.a.createElement("button",{className:"player-button",disabled:!L,onClick:this.handleFullScreen},o.a.createElement(v.a,null)))),o.a.createElement(y.a,{waiting:d})))}}var O=w,L=a(36),_=a(172),N=a(407),j=a(369),P=a(422),T=a(406),R=a(403),D=a(249),F=a(23);a(457);class A extends o.a.Component{render(){const e=this.props,t=e.chatId,a=e.selected,n=e.onSelect,s=e.t,i=Object(F.u)(t,!0,s);return o.a.createElement("div",{className:c()("forward-target-chat",{"forward-target-chat-selected":a}),onClick:n},o.a.createElement("div",{className:"forward-target-chat-tile"},o.a.createElement("div",{className:"forward-target-chat-tile-wrapper"},o.a.createElement(D.a,{chatId:t})),a&&o.a.createElement("div",{className:"forward-target-chat-selection"}),o.a.createElement("div",{className:c()("forward-target-chat-mark",a?"forward-target-chat-mark-selected":"forward-target-chat-mark-unselected")}),o.a.createElement("div",{className:"forward-target-chat-mark-icon"})),o.a.createElement("div",{className:"forward-target-chat-title"},i))}}var B=Object(_.a)()(A);function H(e){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.clipboard){e.next=5;break}return e.next=4,navigator.clipboard.writeText(t);case 4:return e.abrupt("return",!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("[clipboard] unable to copy with clipboard.writeText",e.t0);case 10:return e.abrupt("return",z(t));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function z(e){let t,a;try{if(t=document.createElement("textarea"),t.contentEditable=!0,t.readOnly=!0,t.value=e,t.style.all="unset",t.style.position="fixed",t.style.top=0,t.style.clip="rect(0, 0, 0, 0)",t.style.whiteSpace="pre",t.style.webkitUserSelect="text",t.style.MozUserSelect="text",t.style.msUserSelect="text",t.style.userSelect="text",document.body.appendChild(t),t.focus(),t.select(),a=document.execCommand("copy"),!a)throw new Error;return!0}catch(n){console.error("[clipboard] unable to copy with document.execCommand",a)}finally{t&&document.body.removeChild(t)}return!1}var W=a(10),G=a(76);function Z(e,t,...a){return e(t,{postProcess:"sprintf",sprintf:a})}let q=null;function K(e){if(!e)return!1;const t=e.value;return!!t&&"ru"===t.value}function Y(e){if(!e)return null;if(!e.length)return null;const t=G.a.get("language_pack_id"),a=G.a.get("suggested_language_pack_id");if(!(K(t)||K(a)))return null;q=q||new Map([["q","\u0439"],["w","\u0446"],["e","\u0443"],["r","\u043a"],["t","\u0435"],["y","\u043d"],["u","\u0433"],["i","\u0448"],["o","\u0449"],["p","\u0437"],["[","\u0445"],["]","\u044a"],["a","\u0444"],["s","\u044b"],["d","\u0432"],["f","\u0430"],["g","\u043f"],["h","\u0440"],["j","\u043e"],["k","\u043b"],["l","\u0434"],[";","\u0436"],["'","\u044d"],["\\","\u0451"],["z","\u044f"],["x","\u0447"],["c","\u0441"],["v","\u043c"],["b","\u0438"],["n","\u0442"],["m","\u044c"],[",","\u0431"],[".","\u044e"]]);let n="";for(let s=0;s<e.length;s++){if(!q.has(e[s]))return null;n+=q.get(e[s])}return""===n?null:n}let J=null;function X(e){if(!e)return null;if(!e.length)return null;J=J||new Map([["\u0439","q"],["\u0446","w"],["\u0443","e"],["\u043a","r"],["\u0435","t"],["\u043d","y"],["\u0433","u"],["\u0448","i"],["\u0449","o"],["\u0437","p"],["\u0445","["],["\u044a","]"],["\u0444","a"],["\u044b","s"],["\u0432","d"],["\u0430","f"],["\u043f","g"],["\u0440","h"],["\u043e","j"],["\u043b","k"],["\u0434","l"],["\u0436",";"],["\u044d","'"],["\u0451","\\"],["\u044f","z"],["\u0447","x"],["\u0441","c"],["\u043c","v"],["\u0438","b"],["\u0442","n"],["\u044c","m"],["\u0431",","],["\u044e","."]]);let t="";for(let a=0;a<e.length;a++){if(!J.has(e[a]))return null;t+=J.get(e[a])}return""===t?null:t}var Q=a(27),$=a(73),ee=a(17),te=a(19),ae=(a(458),a(13));class ne extends o.a.Component{constructor(e){var t;super(e),t=this,this.loadContent=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.getPublicMessageLink(),a=[],n=x.a.send({"@type":"getChats",offset_order:"9223372036854775807",offset_chat_id:0,limit:100}),a.push(n),i=x.a.send({"@type":"createPrivateChat",user_id:te.a.getMyId(),force:!0}),a.push(i),e.next=8,Promise.all(a.map(e=>e.catch(e=>null)));case 8:r=e.sent,o=Object(L.a)(r,2),l=o[0],c=o[1],t.setState({chatIds:l.chat_ids,savedMessages:c}),d=U.a.getStore(),Object(W.x)(d,l.chat_ids);case 15:case"end":return e.stop()}}),e)}))),this.getPublicMessageLink=Object(i.a)(s.a.mark((function e(){var a,n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageIds,n){e.next=3;break}return e.abrupt("return");case 3:if(i){e.next=5;break}return e.abrupt("return");case 5:if(!(i.length>1)){e.next=7;break}return e.abrupt("return");case 7:if(Object(F.ib)(n)){e.next=9;break}return e.abrupt("return");case 9:if(Object(F.C)(n)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,x.a.send({"@type":"getMessageLink",chat_id:n,message_id:i[0],for_album:!1,for_comment:!1});case 13:r=e.sent,t.setState({publicMessageLink:r});case 15:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(Q.g)(null)},this.handleCopyLink=()=>{const e=this.props.t,t=this.state.publicMessageLink;t&&t.link&&(H(t.link),this.handleScheduledAction(e("LinkCopied")))},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(f.a,null))]})},this.getForwardPhotoSize=(e,t)=>{if(1!==t.length)return null;const a=ee.a.get(e,t[0]);if(!a)return null;const n=a.can_be_forwarded,s=a.content;if(!n&&"messageChatChangePhoto"===s["@type"]){const e=s.photo;if(!e)return null;const t=e.sizes;if(t&&t.length)return t[t.length-1]}return null},this.handleSend=()=>{this.handleClose(),Object(Q.b)();const e=this.props,a=e.chatId,n=e.messageIds,r=e.inputMessageContent;if(!a&&!n&&!r)return;const o=this.getInnerText(this.messageRef.current);this.targetChats.forEach(function(){var e=Object(i.a)(s.a.mark((function e(i){var l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.next=3,ae.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(a));case 3:return o&&("caption"in r?r.caption={"@type":"formattedText",text:o,entities:null}:x.a.send({"@type":"sendMessage",chat_id:i,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:o,entities:null},disable_web_page_preview:!1,clear_draft:!1}})),x.a.send({"@type":"sendMessage",chat_id:i,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:r}),e.abrupt("return");case 6:if(!(l=t.getForwardPhotoSize(a,n))){e.next=13;break}return c=l.width,d=l.height,h=l.photo,e.next=11,ae.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(a));case 11:return x.a.send({"@type":"sendMessage",chat_id:i,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessagePhoto",photo:{"@type":"inputFileId",id:h.id},thumbnail:null,added_sticker_file_ids:[],width:c,height:d,caption:{"@type":"formattedText",text:o,entities:null},ttl:0}}),e.abrupt("return");case 13:if(!o){e.next=17;break}return e.next=16,ae.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(a));case 16:x.a.send({"@type":"sendMessage",chat_id:i,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:o,entities:null},disable_web_page_preview:!1,clear_draft:!1}});case 17:x.a.send({"@type":"forwardMessages",chat_id:i,from_chat_id:a,message_ids:n,disable_notifications:!1,from_background:!1,as_album:!1});case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.handleChangeSelection=e=>{this.targetChats.has(e)?this.targetChats.delete(e):this.targetChats.set(e,e),this.forceUpdate()},this.getInnerText=e=>{const t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null);return e.innerText},this.handleSearchKeyDown=e=>{13===e.keyCode&&e.preventDefault()},this.handleSearchKeyUp=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h,p,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state,n=a.chatIds,i=a.savedMessages,r=t.searchRef.current){e.next=4;break}return e.abrupt("return");case 4:if("<br>"!==(o=r.innerHTML)&&"<div><br></div>"!==o||(r.innerHTML=null),l=t.getInnerText(r).trim()){e.next=10;break}return t.setState({searchText:null,searchResults:[],globalSearchResults:[]}),e.abrupt("return");case 10:return c=X(l),d=Y(l),h=i?[i.id].concat(n.filter(e=>e!==i.id&&Object(F.f)(e))):n,p=h.filter(e=>t.hasSearchText(e,l)||c&&t.hasSearchText(e,c)||d&&t.hasSearchText(e,d)),t.setState({searchText:l,searchResults:p}),e.next=17,x.a.send({"@type":"searchChatsOnServer",query:l,limit:100});case 17:if(u=e.sent,t.state.searchText===l){e.next=20;break}return e.abrupt("return");case 20:t.setState({globalSearchResults:u.chat_ids});case 21:case"end":return e.stop()}}),e)}))),this.handleSearchPaste=e=>{const t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleMessageKeyUp=()=>{const e=this.messageRef.current;if(!e)return;const t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null)},this.handleMessagePaste=e=>{const t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.hasSearchText=(e,t)=>{const a=this.props.t,n=this.state.savedMessages;if(n&&e===n.id){if(-1!==(Object(F.x)(e,!0,a)||"").toLocaleLowerCase().indexOf(t.toLowerCase()))return!0}if(-1!==(Object(F.x)(e,!1,a)||"").toLocaleLowerCase().indexOf(t.toLowerCase()))return!0;return-1!==(Object(F.C)(e)||"").toLocaleLowerCase().indexOf(t.toLowerCase())},this.setSearchFocus=()=>{setTimeout(()=>{if(this.searchRef.current){this.searchRef.current.focus()}},100)},this.state={chatIds:[],savedMessages:null},this.searchRef=o.a.createRef(),this.messageRef=o.a.createRef(),this.targetChats=new Map}componentDidMount(){this.loadContent(),this.setSearchFocus()}render(){const e=this.props.t,t=this.state,a=t.chatIds,n=t.searchText,s=t.searchResults,i=t.globalSearchResults,r=t.savedMessages,l=t.publicMessageLink,c=(r?[r.id].concat(a.filter(e=>e!==r.id&&Object(F.f)(e))):a).map(e=>o.a.createElement(B,{key:e,chatId:e,selected:this.targetChats.has(e),onSelect:()=>this.handleChangeSelection(e)})),d=new Map((s||[]).map(e=>[e,e])),h=(i||[]).filter(e=>e!==r.id&&Object(F.f)(e)&&!d.has(e)),p=(s||[]).concat(h).map(e=>o.a.createElement(B,{key:e,chatId:e,selected:this.targetChats.has(e),onSelect:()=>this.handleChangeSelection(e)}));return o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"forward-dialog-title","aria-describedby":"forward-dialog-description",className:"forward-dialog"},o.a.createElement(R.a,{id:"forward-dialog-title"},e("ShareSendTo")),o.a.createElement("div",{ref:this.searchRef,id:"forward-dialog-search",className:"scrollbars-hidden",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("Search"),onKeyDown:this.handleSearchKeyDown,onKeyUp:this.handleSearchKeyUp,onPaste:this.handleSearchPaste}),o.a.createElement("div",{className:"forward-dialog-content"},o.a.createElement("div",{className:"forward-dialog-list"},c),n&&o.a.createElement("div",{className:"forward-dialog-search-list"},p)),this.targetChats.size>0&&o.a.createElement("div",{ref:this.messageRef,id:"forward-dialog-message",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("ShareComment"),onKeyUp:this.handleMessageKeyUp,onPaste:this.handleMessagePaste}),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleClose,color:"primary"},e("Cancel")),this.targetChats.size>0&&o.a.createElement(N.a,{onClick:this.handleSend,color:"primary",autoFocus:!0},e("Send")),!this.targetChats.size&&l&&o.a.createElement(N.a,{onClick:this.handleCopyLink,color:"primary"},e("CopyLink"))))}}var se=Object(d.a)(Object(_.a)(),p.b)(ne),ie=a(477),re=a.n(ie),oe=a(217),le=a.n(oe),ce=a(476),de=a.n(ce),he=a(30),pe=Object(he.a)(o.a.createElement("path",{d:"M12.1715729,2 C12.9672223,2 13.7302841,2.31607052 14.2928932,2.87867966 L21.1213203,9.70710678 C21.6839295,10.2697159 22,11.0327777 22,11.8284271 L22,19 C22,20.6568542 20.6568542,22 19,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,5 C2,3.34314575 3.34314575,2 5,2 L12.1715729,2 Z M11,4 L5,4 C4.44771525,4 4,4.44771525 4,5 L4,19 C4,19.5522847 4.44771525,20 5,20 L19,20 C19.5522847,20 20,19.5522847 20,19 L20,13 L14,13 C12.4023191,13 11.0963391,11.75108 11.0050927,10.1762728 L11,10 L11,4 Z M19.586,11 L13,4.414 L13,10 C13,10.5128358 13.3860402,10.9355072 13.8833789,10.9932723 L14,11 L19.586,11 Z"}),"Document2"),ue=a(374),me=a(409),ge=a(655),fe=a(656),Ce=Object(he.a)(o.a.createElement("path",{d:"M19,2 C20.6568542,2 22,3.34314575 22,5 L22,19 C22,20.6568542 20.6568542,22 19,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,5 C2,3.34314575 3.34314575,2 5,2 L19,2 Z M8.95903938,14.4653367 L8.89694708,14.4202095 C8.68789701,14.291568 8.42133316,14.3352159 8.26303498,14.5116789 L8.2090719,14.5840012 L4.88033327,19.9929138 L4.93969424,19.9982115 L4.93969424,19.9982115 L12.446,20 L9.05890452,14.5810435 C9.0316623,14.5374559 8.99794603,14.4984621 8.95903938,14.4653367 L8.89694708,14.4202095 L8.95903938,14.4653367 Z M15.6580762,12.1926572 C15.4476303,12.0663122 15.1815603,12.1128758 15.0252035,12.2910614 L14.9720355,12.3639701 L12.551,16.396 L14.803,20 L19,20 C19.5410622,20 19.9817615,19.5702952 19.9994483,19.0335352 L15.8247114,12.3563345 C15.7828678,12.2893847 15.7257647,12.2332952 15.6580762,12.1926572 Z M19,4 L5,4 C4.44771525,4 4,4.44771525 4,5 L4,17.606 L6.50573804,13.5358344 C7.19919591,12.4089238 8.64230264,12.0252274 9.79631538,12.6320827 L9.94511393,12.7168756 C10.2187146,12.885239 10.4567799,13.1044297 10.6467737,13.3619985 L10.7549011,13.5210456 L11.361,14.492 L13.2573282,11.3345145 C13.9384069,10.2000794 15.3772263,9.80060652 16.5378139,10.3947912 L16.6875318,10.4779499 C16.9695672,10.6472749 17.2148477,10.8702509 17.409849,11.1335934 L17.5207081,11.2963367 L20,15.264 L20,5 C20,4.44771525 19.5522847,4 19,4 Z"}),"SharedMedia"),be=a(152),ve=a(176),Ee=Object(he.a)(o.a.createElement("path",{d:"M23,12L20.56,9.22L20.9,5.54L17.29,4.72L15.4,1.54L12,3L8.6,1.54L6.71,4.72L3.1,5.53L3.44,9.21L1,12L3.44,14.78L3.1,18.47L6.71,19.29L8.6,22.47L12,21L15.4,22.46L17.29,19.28L20.9,18.46L20.56,14.78L23,12M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"}),"Verified"),Se=a(9);a(459);class ye extends o.a.Component{constructor(...e){super(...e),this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdateChatTitle=e=>{const t=this.props.chatId;e.chat_id===t&&this.forceUpdate()}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.t;return e.chatId!==n||e.t!==s}componentDidMount(){Se.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.on("updateChatTitle",this.onUpdateChatTitle)}componentWillUnmount(){Se.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.off("updateChatTitle",this.onUpdateChatTitle)}render(){const e=this.props,t=e.t,a=e.chatId,n=e.showSavedMessages,s=Object(F.cb)(a),i=Object(F.x)(a,n,t);return o.a.createElement("div",{className:"dialog-title"},o.a.createElement("span",{className:"dialog-title-span"},i),s&&o.a.createElement(Ee,{className:"dialog-title-icon"}))}}ye.defaultProps={showSavedMessages:!0};var Me=Object(_.a)()(ye),Ie=a(71),Ue=a(43);a(460);class ke extends o.a.Component{constructor(e){super(e),this.onUpdateUserStatus=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;if(!a.type)return;let n=!1;switch(a.type["@type"]){case"chatTypeBasicGroup":{const t=Ie.a.getFullInfo(a.type.basic_group_id);if(t&&t.members){t.members.find(t=>t.user_id===e.user_id)&&(n=!0)}break}case"chatTypePrivate":case"chatTypeSecret":a.type.user_id===e.user_id&&(n=!0)}n&&this.updateSubtitle(t)},this.updateSubtitle=e=>{this.setState({subtitle:Object(F.w)(e),isAccent:Object(F.T)(e)})},this.onUpdateUserFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;const n=a.type;n&&(!n||"chatTypePrivate"!==n["@type"]&&"chatTypeSecret"!==n["@type"]||n.user_id!==e.user_id||this.updateSubtitle(t))},this.onUpdateBasicGroupFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;const n=a.type;n&&n&&"chatTypeBasicGroup"===n["@type"]&&n.basic_group_id===e.basic_group_id&&this.updateSubtitle(t)},this.onUpdateSupergroupFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;const n=a.type;n&&n&&"chatTypeSupergroup"===n["@type"]&&n.supergroup_id===e.supergroup_id&&this.updateSubtitle(t)},this.onUpdateBasicGroup=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;const n=a.type;n&&n&&"chatTypeBasicGroup"===n["@type"]&&n.basic_group_id===e.basic_group.id&&this.updateSubtitle(t)},this.onUpdateSupergroup=e=>{const t=this.props.chatId,a=Se.a.get(t);if(!a)return;const n=a.type;n&&n&&"chatTypeSupergroup"===n["@type"]&&n.supergroup_id===e.supergroup.id&&this.updateSubtitle(t)};const t=this.props.chatId;this.state={prevChatId:t,subtitle:Object(F.w)(t),isAccent:Object(F.T)(t)}}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){const t=e.chatId;return{prevChatId:t,subtitle:Object(F.w)(t),isAccent:Object(F.T)(t)}}return null}shouldComponentUpdate(e,t){const a=this.props.chatId,n=this.state,s=n.subtitle,i=n.isAccent;return e.chatId!==a||(t.subtitle!==s||t.isAccent!==i)}componentDidMount(){te.a.on("updateUserStatus",this.onUpdateUserStatus),Ie.a.on("updateBasicGroup",this.onUpdateBasicGroup),Ue.a.on("updateSupergroup",this.onUpdateSupergroup),te.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}componentWillUnmount(){te.a.off("updateUserStatus",this.onUpdateUserStatus),Ie.a.off("updateBasicGroup",this.onUpdateBasicGroup),Ue.a.off("updateSupergroup",this.onUpdateSupergroup),te.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}render(){const e=this.props.subtitle,t=this.state,a=t.subtitle,n=t.isAccent;return o.a.createElement("div",{className:c()("dialog-status",{"dialog-status-accent":n})},e?e+", ":null,a)}}var xe=ke;a(461);class we extends o.a.Component{constructor(e){super(e),this.handleClick=()=>{const e=this.props,t=e.chatId,a=e.onSelect;a&&a(t)};const t=this.props.chatId;this.state={chat:Se.a.get(t)}}shouldComponentUpdate(e,t){return e.chatId!==this.props.chatId}render(){const e=this.props,t=e.chatId,a=e.subtitle,n=e.onTileSelect,s=e.showStatus,i=e.showSavedMessages,r=e.big,l=e.showTitle,d=Object(F.gb)(t);return o.a.createElement("div",{className:c()("chat",{"chat-big":r}),onClick:this.handleClick},o.a.createElement("div",{className:"chat-wrapper"},o.a.createElement(D.a,{big:r,chatId:t,onSelect:n,showSavedMessages:i}),l&&o.a.createElement("div",{className:"chat-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},o.a.createElement(Me,{chatId:t,showSavedMessages:i})),s&&(!d||!i)&&o.a.createElement("div",{className:"tile-second-row"},o.a.createElement(xe,{chatId:t,subtitle:a})))))}}we.defaultProps={showSavedMessages:!0,showStatus:!0,showTitle:!0};var Oe=we,Le=Object(he.a)(o.a.createElement("path",{d:"M4.29289322,11.2928932 L11.2928932,4.29289322 C11.6834175,3.90236893 12.3165825,3.90236893 12.7071068,4.29289322 C13.0675907,4.65337718 13.0953203,5.22060824 12.7902954,5.61289944 L12.7071068,5.70710678 L7.414,11 L19,11 C19.5128358,11 19.9355072,11.3860402 19.9932723,11.8833789 L20,12 C20,12.5128358 19.6139598,12.9355072 19.1166211,12.9932723 L19,13 L7.414,13 L12.7071068,18.2928932 C13.0675907,18.6533772 13.0953203,19.2206082 12.7902954,19.6128994 L12.7071068,19.7071068 C12.3466228,20.0675907 11.7793918,20.0953203 11.3871006,19.7902954 L11.2928932,19.7071068 L4.29289322,12.7071068 C3.93240926,12.3466228 3.90467972,11.7793918 4.20970461,11.3871006 L4.29289322,11.2928932 L11.2928932,4.29289322 L4.29289322,11.2928932 Z"}),"Back");a(462);class _e extends o.a.Component{constructor(e){super(e)}render(){const e=this.props,t=e.chatId,a=e.t,n=e.backButton,s=e.onClick,i=e.onClose;let r=a("ChatInfo");return Object(F.hb)(t)?r=a("Info"):Object(F.V)(t)&&(r=a("ChannelInfo")),o.a.createElement("div",{className:"header-master"},n&&o.a.createElement(j.a,{className:"header-left-button",onClick:i},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:s},o.a.createElement("span",{className:"header-status-content"},r)),!n&&o.a.createElement(j.a,{className:"header-right-button",onClick:i},o.a.createElement(f.a,null)))}}var Ne=Object(_.a)()(_e),je=a(421),Pe=a(155),Te=a(111);class Re extends o.a.Component{constructor(e){super(e),this.onUpdateChatNotificationSettings=e=>{const t=e.chat_id,a=this.props.chatId;t&&t===a&&this.setState({isMuted:Object(F.Y)(a)})},this.onUpdateScopeNotificationSettings=e=>{const t=this.props.chatId,a=Se.a.get(t);switch(e.scope["@type"]){case"notificationSettingsScopeGroupChats":"chatTypeBasicGroup"!==a.type["@type"]&&"chatTypeSupergroup"!==a.type["@type"]||this.setState({isMuted:Object(F.Y)(t)});break;case"notificationSettingsScopePrivateChats":"chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||this.setState({isMuted:Object(F.Y)(t)})}},this.handleSetChatNotifications=()=>{this.setState({isMuted:!this.state.isMuted}),this.debouncedSetChatNotificationSettings()},this.setChatNotificationSettings=()=>{const e=this.props.chatId,t=this.state.isMuted;Object(Pe.k)(e,t)};const t=e.chatId;this.state={prevChatId:t,isMuted:Object(F.Y)(t)},this.debouncedSetChatNotificationSettings=Object(M.e)(this.setChatNotificationSettings,u.D)}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){const t=e.chatId;return{prevChatId:t,isMuted:Object(F.Y)(t)}}return null}componentDidMount(){Se.a.on("updateChatNotificationSettings",this.onUpdateChatNotificationSettings),Te.a.on("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}componentWillUnmount(){Se.a.off("updateChatNotificationSettings",this.onUpdateChatNotificationSettings),Te.a.off("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}}var De=Re;a(463);var Fe=Object(_.a)()(class extends De{render(){const e=this.props.t,t=this.state.isMuted;return o.a.createElement(me.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleSetChatNotifications},o.a.createElement(ge.a,null,o.a.createElement(je.a,{className:"notifications-checkbox",edge:"start",checked:!t,color:"primary",tabIndex:-1,disableRipple:!0,onChange:this.handleSetChatNotifications})),o.a.createElement(fe.a,{primary:o.a.createElement(be.a,{variant:"inherit",noWrap:!0},e("Notifications")),secondary:e(t?"NotificationsOff":"NotificationsOn")}))}}),Ae=a(436);a(464);class Be extends o.a.Component{constructor(e){super(e),this.onUpdateMessageContent=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.onUpdateDeleteMessages=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.onUpdateNewMessage=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.message.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.hasObserver=()=>"ResizeObserver"in window,this.onWindowResize=()=>{this.setSelection(!0)},this.setMediaState=(e,t)=>{const a=this.props.chatId,n=e&&(e.supergroupMembers&&e.supergroupMembers.members||e.fullInfo&&e.fullInfo.members)||[],s=e?e.photoAndVideo:[],i=e?e.document:[],r=e?e.audio:[],o=e?e.url:[],l=e?e.voiceNote:[],c=e?e.groupsInCommon:[],d=n.length>0,h=s.length>0,p=i.length>0,u=r.length>0,m=o.length>0,g=l.length>0,f=c.length>0;(-1===t||0===t&&!d||1===t&&!h||2===t&&!p||3===t&&!u||4===t&&!m||5===t&&!g||6===t&&!f)&&(d?t=0:h?t=1:p?t=2:u?t=3:m?t=4:g?t=5:f&&(t=6),x.a.clientUpdate({"@type":"clientUpdateMediaTab",chatId:a,index:t})),this.setState({selectedIndex:t,members:n,photoAndVideo:s,document:i,audio:r,url:o,voiceNote:l,groupsInCommon:c},()=>{this.hasObserver()||this.setSelection()})},this.onClientUpdateChatMedia=e=>{const t=this.props.chatId,a=this.state.selectedIndex,n=e.chatId,s=e.media;n===t&&this.setMediaState(s,a)},this.onClientUpdateMediaTab=e=>{const t=e.chatId,a=e.index;t===this.props.chatId&&this.setState({selectedIndex:a},()=>{this.hasObserver()||this.setSelection()})},this.setSelection=(e=!0)=>{const t=this.state,a=t.selectedIndex;t.isSmallWidth;if(-1===a)return;const n=this.filtersRef.current;let s=null,i=0;const r=this.filterRef.get("members");0===a&&r&&(s=r.firstChild,i=s.offsetLeft);const o=this.filterRef.get("photoAndVideo");1===a&&o&&(s=o.firstChild,i=s.offsetLeft);const l=this.filterRef.get("document");2===a&&l&&(s=l.firstChild,i=s.offsetLeft);const c=this.filterRef.get("audio");3===a&&c&&(s=c.firstChild,i=s.offsetLeft);const d=this.filterRef.get("url");4===a&&d&&(s=d.firstChild,i=s.offsetLeft);const h=this.filterRef.get("voiceNote");5===a&&h&&(s=h.firstChild,i=s.offsetLeft);const p=this.filterRef.get("groupsInCommon");if(6===a&&p&&(s=p.firstChild,i=s.offsetLeft),!s)return;const u=this.filterSelectionRef.current;if(u){const t=e?"transition: left 0.25s ease, width 0.25s ease":null;u.style.cssText="left: ".concat(i-3,"px; width: ").concat(s.scrollWidth+6,"px; ").concat(t)}if(s&&e){const e=this.animator;e&&e.stop(),this.animator=new Ae.a(250,[{from:n.scrollLeft,to:Object(M.d)(i-n.offsetWidth/2+s.offsetWidth/2,0,n.scrollWidth-n.offsetWidth),func:e=>n.scrollLeft=e}]),setTimeout(()=>{this.animator&&this.animator.start()},0)}},this.handleFilterClick=(e,t)=>{if(e&&0!==e.button)return;const a=this.props,n=a.chatId,s=a.onClick;s&&s(e),x.a.clientUpdate({"@type":"clientUpdateMediaTab",chatId:n,index:t})},this.filterRef=new Map,this.filtersRef=o.a.createRef(),this.filterSelectionRef=o.a.createRef(),this.state={},this.onWindowResize=Object(M.C)(this.onWindowResize,250)}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){const t=ee.a.getMedia(e.chatId),a=t&&(t.supergroupMembers&&t.supergroupMembers.members||t.fullInfo&&t.fullInfo.members)||[],n=t?t.photoAndVideo:[],s=t?t.document:[],i=t?t.audio:[],r=t?t.url:[],o=t?t.voiceNote:[],l=t?t.groupsInCommon:[];let c=-1;return a.length>0?c=0:n.length>0?c=1:s.length>0?c=2:i.length>0?c=3:r.length>0?c=4:o.length>0?c=5:l.length>0&&(c=6),{prevChatId:e.chatId,selectedIndex:c,members:a,photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l,isSmallWidth:!1}}return null}componentDidMount(){this.observeResize(),this.setSelection(),ee.a.on("clientUpdateMediaTab",this.onClientUpdateMediaTab),ee.a.on("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.on("updateNewMessage",this.onUpdateNewMessage),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateMessageContent",this.onUpdateMessageContent)}componentDidUpdate(e,t,a){this.unobserveResize(),this.observeResize()}componentWillUnmount(){this.unobserveResize(),ee.a.off("clientUpdateMediaTab",this.onClientUpdateMediaTab),ee.a.off("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.off("updateNewMessage",this.onUpdateNewMessage),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateMessageContent",this.onUpdateMessageContent)}observeResize(){if(!this.hasObserver())return;const e=this.filtersRef.current;if(!e)return;const t=new ResizeObserver(this.onWindowResize);t.observe(e),this.resizeObserver={observer:t,filters:e}}unobserveResize(){if(!this.hasObserver())return;if(!this.resizeObserver)return;const e=this.resizeObserver,t=e.observer,a=e.filters;t&&a&&t.unobserve(a)}render(){const e=this.props.t,t=this.state,a=t.selectedIndex,n=t.members,s=t.photoAndVideo,i=t.document,r=t.audio,l=t.url,d=t.voiceNote,h=t.groupsInCommon,p=(n.length>0?1:0)+(s.length>0?1:0)+(i.length>0?1:0)+(r.length>0?1:0)+(l.length>0?1:0)+(d.length>0?1:0)+(h.length>0?1:0);return n.length>0||s.length>0||i.length>0||r.length>0||l.length>0||d.length>0||h.length>0?(this.filterRef=new Map,o.a.createElement("div",{className:c()("tabs","shared-media-tabs")},o.a.createElement("div",{className:"tabs-bottom-border"}),o.a.createElement("div",{ref:this.filtersRef,className:c()("filters",{"shared-media-tabs-container":p>1})},n.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("members",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":0===a}),onMouseDown:e=>this.handleFilterClick(e,0)},o.a.createElement("span",null,e("GroupMembers"))),s.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("photoAndVideo",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":1===a}),onMouseDown:e=>this.handleFilterClick(e,1)},o.a.createElement("span",null,e("SharedMediaTab2"))),i.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("document",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":2===a}),onMouseDown:e=>this.handleFilterClick(e,2)},o.a.createElement("span",null,e("SharedFilesTab2"))),r.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("audio",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":3===a}),onMouseDown:e=>this.handleFilterClick(e,3)},o.a.createElement("span",null,e("SharedMusicTab2"))),l.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("url",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":4===a}),onMouseDown:e=>this.handleFilterClick(e,4)},o.a.createElement("span",null,e("SharedLinksTab2"))),d.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("voiceNote",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":5===a}),onMouseDown:e=>this.handleFilterClick(e,5)},o.a.createElement("span",null,e("SharedVoiceTab2"))),h.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("groupsInCommon",e),className:c()("filter",{"shared-media-tab":p>1},{"item-selected":6===a}),onMouseDown:e=>this.handleFilterClick(e,6)},o.a.createElement("span",null,e("SharedGroupsTab2"))),o.a.createElement("div",{ref:this.filterSelectionRef,className:"filter-selection"})))):null}}var He=Object(_.a)()(Be),Ve=a(22),ze=a(373),We=a(657),Ge=a(371),Ze=a(466),qe=a.n(Ze),Ke=Object(he.a)(o.a.createElement("path",{d:"M18,6.5 C18.5522847,6.5 19,6.94771525 19,7.5 L19,18 C19,19.6568542 17.6568542,21 16,21 L8,21 C6.34314575,21 5,19.6568542 5,18 L5,7.5 C5,6.94771525 5.44771525,6.5 6,6.5 L18,6.5 Z M17,8.5 L7,8.5 L7,18 C7,18.5522847 7.44771525,19 8,19 L16,19 C16.5522847,19 17,18.5522847 17,18 L17,8.5 Z M10,2 L14,2 C14.2210137,2 14.434484,2.07316447 14.6080295,2.20608063 L14.7071068,2.29289322 L15.415,3 L19,3 C19.5128358,3 19.9355072,3.38604019 19.9932723,3.88337887 L20,4 C20,4.51283584 19.6139598,4.93550716 19.1166211,4.99327227 L19,5 L5,5 C4.44771525,5 4,4.55228475 4,4 C4,3.48716416 4.38604019,3.06449284 4.88337887,3.00672773 L5,3 L8.584,3 L9.29289322,2.29289322 C9.44917353,2.1366129 9.65185492,2.03740171 9.86855602,2.00867243 L10,2 L14,2 L10,2 Z"}),"Delete"),Ye=Object(he.a)(o.a.createElement("path",{d:"M11.8025478,4.79529691 C11.8025478,3.93005081 12.5039683,3.22863025 13.3692144,3.22863025 C13.7633775,3.22863025 14.1430567,3.37720768 14.4325315,3.64473128 L22.2284036,10.8494344 C22.8638434,11.4366882 22.9029059,12.4278772 22.2883553,13.0917108 L22.2284036,13.1505656 L14.4325315,20.3552687 C13.7970916,20.9425225 12.8059026,20.90346 12.2186488,20.2680201 C11.9511252,19.9785454 11.8025478,19.5988662 11.8025478,19.2047031 L11.8025478,16.4249931 C8.21922017,16.6092505 5.79479016,17.8111183 4.43312712,19.9909578 L4.29164834,20.2262356 C3.95336498,20.8131459 3.20334729,21.0146979 2.61643694,20.6764146 C2.24185558,20.4605134 2.00860424,20.0633528 2.00249611,19.6310483 C1.8981509,12.2459874 5.13388305,8.13673748 11.4825227,7.6491321 L11.8025478,7.62777147 L11.8025478,4.79529691 Z M13.8025478,5.78581808 L13.8025478,8.6 C13.8025478,9.15228475 13.3548325,9.6 12.8025478,9.6 C7.49232524,9.6 4.65375859,12.0566924 4.1006582,17.2535243 C6.09650127,15.345115 9.01935671,14.4 12.8025478,14.4 C13.3548325,14.4 13.8025478,14.8477153 13.8025478,15.4 L13.8025478,18.2142808 L20.5271714,12.0005066 L13.8025478,5.78581808 Z"}),"Share");a(465);class Je extends o.a.Component{constructor(...e){super(...e),this.handleOpenMessage=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(Q.k)(a,n)},this.handleForward=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(Q.h)(a,[n])},this.handleDelete=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(Q.e)(a,[n])}}render(){const e=this.props,t=e.t,a=e.chatId,n=e.messageId,s=e.open,i=e.onClose,r=e.anchorPosition,l=e.showOpenMessage,c=ee.a.get(a,n);if(!c)return null;const d=c.can_be_forwarded,h=c.can_be_deleted_only_for_self,p=c.can_be_deleted_for_all_users;return o.a.createElement(Ge.a,{open:s,onClose:i,anchorReference:"anchorPosition",anchorPosition:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation()},o.a.createElement(ze.a,null,l&&o.a.createElement(We.a,{onClick:this.handleOpenMessage},o.a.createElement(ge.a,null,o.a.createElement(qe.a,null)),o.a.createElement(fe.a,{primary:t("GoToMessage")})),d&&o.a.createElement(We.a,{onClick:this.handleForward},o.a.createElement(ge.a,null,o.a.createElement(Ye,null)),o.a.createElement(fe.a,{primary:t("Forward")})),(h||p)&&o.a.createElement(We.a,{color:"secondary",onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:t("Delete")}))))}}var Xe=Object(_.a)()(Je),Qe=a(38);a(467);class $e extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={},this.onClientUpdatePhotoBlob=e=>{const t=this.state,a=t.photoSize,n=t.thumbSize,s=e.fileId;(a&&a.photo&&a.photo.id===s||n&&n.photo&&n.photo.id===s)&&this.forceUpdate()},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}static getDerivedStateFromProps(e,t){const a=e.photo,n=e.size,s=e.thumbnailSize;return a!==t.prevPhoto?{prevPhoto:a,contextMenu:!1,left:0,top:0,photoSize:Object(M.p)(a.sizes,n),thumbSize:Object(M.p)(a.sizes,s),minithumbnail:a.minithumbnail}:null}shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId,r=n.photo,o=n.showOpenMessage,l=this.state,c=l.contextMenu,d=l.left,h=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.photo||(o!==e.showOpenMessage||(c!==t.contextMenu||(d!==t.left||h!==t.top)))))}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.openMedia,s=e.showOpenMessage,i=e.style,r=this.state,l=r.minithumbnail,c=r.thumbSize,d=r.photoSize,h=r.contextMenu,p=r.left,u=r.top;if(!d)return null;const m=l?"data:image/jpeg;base64, "+l.data:null,g=Object(W.m)(c?c.photo:null),f=Object(W.m)(d.photo);m||Object(Qe.l)(c);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-photo",style:i,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"shared-photo-content",style:{backgroundImage:"url(".concat(g||m,")"),backgroundSize:"cover"}},f!==g&&o.a.createElement("div",{className:"shared-photo-main-content",style:{backgroundImage:"url(".concat(f,")")}}))),o.a.createElement(Xe,{chatId:t,messageId:a,anchorPosition:{top:u,left:p},open:h,showOpenMessage:s,onClose:this.handleCloseContextMenu}))}}$e.defaultProps={size:u.K,thumbnailSize:u.L};var et=$e,tt=a(33);a(468);class at extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId,r=n.showOpenMessage,o=this.state,l=o.contextMenu,c=o.left,d=o.top;return s!==e.chatId||(i!==e.messageId||(r!==e.showOpenMessage||(l!==t.contextMenu||(c!==t.left||d!==t.top))))}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.showOpenMessage,s=e.i18n,i=this.state,r=i.contextMenu,l=i.left,c=i.top,d=ee.a.get(t,a);if(!d)return null;const h=d.date,p=new Date(1e3*h).toLocaleDateString([s.language],{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",hour12:!1});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-document",onContextMenu:this.handleOpenContextMenu},Object(Qe.e)(d,()=>Object(tt.U)(t,a,!0),{date:p})),o.a.createElement(Xe,{chatId:t,messageId:a,anchorPosition:{top:c,left:l},open:r,showOpenMessage:n,onClose:this.handleCloseContextMenu}))}}var nt=Object(_.a)()(at),st=a(86);a(469);class it extends o.a.Component{constructor(...e){super(...e),this.onClientUpdatePhotoBlob=e=>{const t=this.props.thumbnail;if(!t)return;const a=t.file||t.photo;a&&e.fileId===a.id&&this.forceUpdate()}}componentDidMount(){U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}componentWillUnmount(){U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.thumbnail,s=e.minithumbnail,i=e.title,r=s?"data:image/jpeg;base64, "+s.data:null,l=Object(W.m)(n?n.file||n.photo:null),d=!l&&r||Object(Qe.l)(n,u.Gb),h=Object(tt.F)(t,a),p=Boolean(l||r),m="tile_color_".concat(Math.abs(i.charCodeAt(0))%7+1);return o.a.createElement("div",{className:c()("shared-link-tile",{[m]:!p})},p?o.a.createElement("img",{className:c()("shared-link-tile-photo",{"shared-link-tile-photo-round":h},{"media-blurred":l&&d},{"media-mini-blurred":!l&&r&&d}),draggable:!1,src:l||r,alt:""}):o.a.createElement("span",null,i))}}var rt=it,ot=a(209);a(470);class lt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId,r=n.webPage,o=n.caption,l=n.showOpenMessage,c=this.state,d=c.contextMenu,h=c.left,p=c.top;return s!==e.chatId||(i!==e.messageId||(r!==e.webPage||(o!==e.caption||(l!==e.showOpenMessage||(d!==t.contextMenu||(h!==t.left||p!==t.top))))))}static isValidEntity(e){if(!e)return!1;const t=e.type;return!!t&&("textEntityTypeUrl"===t["@type"]||"textEntityTypeTextUrl"===t["@type"]||"textEntityTypeEmailAddress"===t["@type"])}getTitleFromUrl(e){try{e=e.startsWith("http")?e:"http://"+e;const t=decodeURI(e),a=new URL(t).hostname.split("."),n=a.length>=2?a[a.length-2]:new URL(t).hostname;return ot.a.ToUnicode(n)}catch(t){console.error("url: "+e+"\n"+t)}return null}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.webPage,s=e.showOpenMessage,i=this.state,r=i.contextMenu,l=i.left,c=i.top,d=ee.a.get(t,a);if(!d)return null;let h=null,p=null,m=null,g=n||{title:"",description:{"@type":"formattedText",text:"",entities:[]},photo:null,animation:null,audio:null,document:null,sticker:null,video:null,video_note:null,url:""},f=(g.display_url,g.description),C=g.photo,b=g.title,v=g.url,E=g.animation,S=g.audio,y=g.document,I=g.sticker,U=g.video,k=g.video_note;E?(p=E.minithumbnail,h=E.thumbnail):S?(p=S.album_cover_minithumbnail,h=S.album_cover_thumbnail):y?(p=y.minithumbnail,h=y.thumbnail):I?(p=I.minithumbnail,h=I.thumbnail):U?(p=U.minithumbnail,h=U.thumbnail):k&&(p=k.minithumbnail,h=k.thumbnail),h||p||!C||(p=C.minithumbnail,h=Object(M.l)(C.sizes,u.K));let x=d.content,w=x.text,O=x.caption;if(w=w||O,w){const e=w.entities;if(e&&e.length>0){const t=40,a=e.filter(lt.isValidEntity),s=a.length>1||w.text.length>t,i=1===e.length&&0===e[0].offset&&e[0].length===w.text.length,r=a.filter(e=>{let t=Object(tt.X)(w.text,e.offset,e.offset+e.length).trim();return t=t.replace(/\u200B/g,""),t.length>0}),l=r.map((e,t)=>{const a=Object(tt.X)(w.text,e.offset,e.offset+e.length);v=a;let n=!1;switch(e.type["@type"]){case"textEntityTypeTextUrl":{const t=e.type.url;t&&(v=t);break}case"textEntityTypeUrl":break;case"textEntityTypeEmailAddress":n=!0}return b=b||this.getTitleFromUrl(v)||" ",o.a.createElement(st.a,{key:t,className:"shared-link-url",url:v,mail:n},a)});if(s){let e=(r.length>0&&r[0].offset>0?w.text.substring(0,r[0].offset):w.text)||f.text||"";e=e.trim(),m=o.a.createElement(o.a.Fragment,null,e&&!i&&o.a.createElement("div",{className:"web-page-description"},e),o.a.createElement("div",null,l))}else{let e=f.text||"";e=e.trim(),m=o.a.createElement(o.a.Fragment,null,e&&o.a.createElement("div",{className:"web-page-description"},e),o.a.createElement("div",{className:"shared-link-text"},Object(tt.o)(w,e=>e,{isValidEntity:lt.isValidEntity})))}n&&(b=b||this.getTitleFromUrl(v))}}return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-link",onContextMenu:this.handleOpenContextMenu},o.a.createElement(rt,{chatId:t,messageId:a,minithumbnail:p,thumbnail:h,title:Object(M.h)(this.getTitleFromUrl(v))}),o.a.createElement("div",{className:"shared-link-content"},b&&o.a.createElement("div",{className:"web-page-title"},b),m)),o.a.createElement(Xe,{chatId:t,messageId:a,anchorPosition:{top:c,left:l},open:r,showOpenMessage:s,onClose:this.handleCloseContextMenu}))}}var ct=lt,dt=a(138),ht=a(120),pt=a(32),ut=a(210);a(471);class mt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId,r=n.voiceNote,o=n.showOpenMessage,l=this.state,c=l.contextMenu,d=l.left,h=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.voiceNote||(o!==e.showOpenMessage||(c!==t.contextMenu||(d!==t.left||h!==t.top)))))}render(){const e=this.props,t=e.chatId,a=e.i18n,n=e.messageId,s=e.voiceNote,i=e.openMedia,r=e.showOpenMessage,l=this.state,c=l.contextMenu,d=l.left,h=l.top,p=ee.a.get(t,n);if(!p)return null;if(!s)return null;const u=p.date,m=p.sender,g=new Date(1e3*u).toLocaleDateString([a.language],{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",hour12:!1}),f=s.duration,C=s.voice;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-voice-note",onContextMenu:this.handleOpenContextMenu},o.a.createElement(ut.a,{chatId:t,messageId:n,file:C,openMedia:i}),o.a.createElement("div",{className:"voice-note-content"},o.a.createElement("div",{className:"document-title"},o.a.createElement(pt.a,{sender:m,messageId:n})),o.a.createElement("div",{className:"voice-note-meta"},o.a.createElement(dt.a,{chatId:t,messageId:n,duration:f,file:C,date:g}),o.a.createElement(ht.a,{chatId:t,messageId:n,icon:"\xa0\u2022"})))),o.a.createElement(Xe,{chatId:t,messageId:n,anchorPosition:{top:h,left:d},open:c,showOpenMessage:r,onClose:this.handleCloseContextMenu}))}}var gt=Object(_.a)()(mt);a(472);class ft extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.onClientUpdateVideoThumbnailBlob=e=>{const t=this.props.video.thumbnail,a=e.fileId;if(!t)return;const n=t.file;n&&n.id===a&&this.forceUpdate()},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}componentDidMount(){U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateVideoThumbnailBlob)}componentWillUnmount(){U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateVideoThumbnailBlob)}shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId,r=n.video,o=n.showOpenMessage,l=this.state,c=l.contextMenu,d=l.left,h=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.video||(o!==e.showOpenMessage||(c!==t.contextMenu||(d!==t.left||h!==t.top)))))}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.openMedia,s=e.style,i=e.showOpenMessage,r=this.props.video,l=r.minithumbnail,d=r.thumbnail,h=r.duration,p=this.state,u=p.contextMenu,m=p.left,g=p.top,f=l?"data:image/jpeg;base64, "+l.data:null,C=Object(W.m)(d?d.file:null),b=C?Object(Qe.l)(d):Boolean(f);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-photo",style:s,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"shared-video-wrapper"},o.a.createElement("div",{className:c()("shared-video-content",{"media-blurred":b,"media-mini-blurred":!C&&b}),style:{backgroundImage:"url(".concat(C||f,")")}}),o.a.createElement("div",{className:"shared-video-meta"},Object(M.g)(h)))),o.a.createElement(Xe,{chatId:t,messageId:a,anchorPosition:{top:g,left:m},open:u,showOpenMessage:i,onClose:this.handleCloseContextMenu}))}}ft.defaultProps={size:u.K,thumbnailSize:u.L};var Ct=ft;a(473);class bt extends o.a.Component{constructor(e){var t;super(e),t=this,this.onUpdateMessageContent=e=>{const t=e.chat_id,a=e.message_id,n=this.props.chatId;if(n!==t)return;const s=this.state,i=s.items,r=s.selectedIndex;if(!i.some(e=>e.id===a))return;const o=ee.a.getMedia(n);this.setMediaState(o,r)},this.onWindowResize=e=>{const t=this.state,a=t.items,n=t.scrollTop,s=this.listRef.current;if(!s)return;const i=s.offsetTop,r=s.offsetParent.offsetHeight,o=this.getRenderIds(a,r,n-i);this.setState(Object(Ve.a)({},o))},this.onUpdateMessageSend=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.message.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.onUpdateNewMessage=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.message.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.onUpdateDeleteMessages=e=>{const t=this.props.chatId,a=this.state.selectedIndex;if(t!==e.chat_id)return;const n=ee.a.getMedia(t);this.setMediaState(n,a)},this.setMediaState=(e,t)=>{const a=this.state.scrollTop,n=e&&(e.supergroupMembers&&e.supergroupMembers.members||e.fullInfo.members)||[],s=e?e.photoAndVideo:[],i=e?e.document:[],r=e?e.audio:[],o=e?e.url:[],l=e?e.voiceNote:[],c=e?e.groupsInCommon:[],d=n.length>0,h=s.length>0,p=i.length>0,m=r.length>0,g=o.length>0,f=l.length>0,C=c.length>0;(-1===t||0===t&&!d||1===t&&!h||2===t&&!p||3===t&&!m||4===t&&!g||5===t&&!f||6===t&&!C)&&(d?t=0:h?t=1:p?t=2:m?t=3:g?t=4:f?t=5:C&&(t=6));const b=bt.getSource(t,e).filter(e=>bt.isValidContent(t,e.content)).slice(0,u.Ab),v=this.listRef.current;if(!v)return;const E=v.offsetTop,S=v.offsetParent.offsetHeight;this.setState({selectedIndex:t,renderIds:this.getRenderIds(b,S,a-E),rowHeight:bt.getRowHeight(t),items:b,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:bt.getFilter(t)},members:n,photoAndVideo:s,document:i,audio:r,url:o,voiceNote:l,groupsInCommon:c})},this.onClientUpdateMediaTab=e=>{const t=this.props.chatId,a=e.chatId,n=e.index;if(a!==t)return;const s=ee.a.getMedia(t),i=s&&(s.supergroupMembers&&s.supergroupMembers.members||s.fullInfo.members)||[],r=s?s.photoAndVideo:[],o=s?s.document:[],l=s?s.audio:[],c=s?s.url:[],d=s?s.voiceNote:[],h=s?s.groupsInCommon:[];let p=[];0===n?p=i:1===n?p=r:2===n?p=o:3===n?p=l:4===n?p=c:5===n?p=d:6===n&&(p=h),p=p.filter(e=>bt.isValidContent(n,e.content)),this.setState({selectedIndex:n,renderIds:new Map,rowHeight:bt.getRowHeight(n),items:p.slice(0,u.Ab),members:i,photoAndVideo:r,document:o,audio:l,url:c,voiceNote:d,groupsInCommon:h,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:bt.getFilter(n)}})},this.onClientUpdateChatMedia=e=>{const t=this.props.chatId,a=this.state.selectedIndex,n=e.chatId;if(n!==t)return;const s=ee.a.getMedia(n);this.setMediaState(s,a)},this.handleScroll=(e,t)=>{const a=this.state.params;a&&!a.completed&&this.onLoadNext(a)},this.handleVirtScroll=(e,t)=>{this.listRef.current&&this.setScrollPosition(t.scrollTop)},this.isVisibleItem=(e,t,a)=>{const n=this.state.rowHeight;return e*n>a-5*n&&(e+1)*n<a+t+5*n},this.setScrollPosition=e=>{const t=this.state,a=t.items,n=t.scrollTop,s=t.rowHeight,i=this.listRef.current;if(!i)return;const r=i.offsetTop,o=i.offsetParent.offsetHeight;if(Math.abs(e-n)>=s){const t=this.getRenderIds(a,o,e-r);this.setState(Object(Ve.a)({scrollTop:e},t))}},this.onLoadNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h,p,m,g,f,C,b,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=t.state,o=r.items,l=r.selectedIndex,c=a.completed,d=a.filter,h=a.loading,p=a.messages,0!==l){e.next=5;break}return e.abrupt("return");case 5:if(6!==l){e.next=7;break}return e.abrupt("return");case 7:if(d){e.next=9;break}return e.abrupt("return");case 9:if(!h){e.next=11;break}return e.abrupt("return");case 11:if(!c){e.next=13;break}return e.abrupt("return");case 13:return m=o.length>0?o[o.length-1].id:0,p&&(m=p.length>0?p[p.length-1].id:0),a.loading=!0,a.requestId=new Date,e.next=19,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:m,offset:0,limit:u.Ab,filter:d}).finally(()=>{a.loading=!1});case 19:if(g=e.sent,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:m,offset:0,limit:2*u.Ab,filter:d}),(f=t.state.params)&&f.requestId===a.requestId){e.next=24;break}return e.abrupt("return");case 24:C=g.messages,a.messages=C,a.completed=0===C.length||0===C.total_count,a.items=o.concat(C.filter(e=>bt.isValidMessage(l,e))),b=n&&C.length>0&&C.length<u.Ab,ee.a.setItems(g.messages),v=U.a.getStore(),Object(W.B)(v,g.messages),t.setState({items:a.items}),a.completed?t.onLoadMigratedNext(a,!0):b&&t.onLoadNext(a,!1);case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleOpen=e=>{const t=this.props.popup;switch(e["@type"]){case"message":{const t=e.chat_id,a=e.id;Object(tt.U)(t,a,!1);break}case"chat":{const a=e.id;Object(Q.k)(a),t&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0});break}case"chatMember":{const a=e.user_id;Object(Q.m)(a,!0),t&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})}}},this.listRef=o.a.createRef(),this.state={scrollTop:0}}static getItemHeight(e){if(e)switch(e["@type"]){case"message":switch(e.content["@type"]){case"messagePhoto":case"messageVideo":return;case"messageDocument":return 78;case"messageAudio":return 94;case"messageVoiceNote":return 74;default:return}case"chat":case"user":return 74;default:return}}static getRowHeight(e){switch(e){case 0:return 74;case 1:return;case 2:return 78;case 3:return 94;case 4:return;case 5:case 6:return 74}}static isValidMessage(e,t){return!!t&&bt.isValidContent(e,t.content)}static isValidContent(e,t){switch(e){case 0:return!0;case 1:return bt.isValidPhotoAndVideoContent(t);case 2:return bt.isValidDocumentContent(t);case 3:return bt.isValidAudioContent(t);case 4:return bt.isValidUrlContent(t);case 5:return bt.isValidVoiceNoteContent(t);case 6:return!0}return!1}static isValidPhotoAndVideoContent(e){return e&&("messagePhoto"===e["@type"]||"messageVideo"===e["@type"])}static isValidAudioContent(e){return e&&"messageAudio"===e["@type"]}static isValidDocumentContent(e){return e&&("messageDocument"===e["@type"]||"messageAudio"===e["@type"])}static isValidUrlContent(e){if(!e)return!1;const t=e.web_page,a=e.text,n=e.caption;if(t)return!0;if(!a&&!n)return!1;const s=(a||n).entities;return!!s&&s.find(e=>"textEntityTypeUrl"===e.type["@type"]||"textEntityTypeTextUrl"===e.type["@type"]||"textEntityTypeEmailAddress"===e.type["@type"])}static isValidVoiceNoteContent(e){return e&&"messageVoiceNote"===e["@type"]}static getFilter(e){switch(e){case 0:return null;case 1:return{"@type":"searchMessagesFilterPhotoAndVideo"};case 2:return{"@type":"searchMessagesFilterDocument"};case 3:return{"@type":"searchMessagesFilterAudio"};case 4:return{"@type":"searchMessagesFilterUrl"};case 5:return{"@type":"searchMessagesFilterVoiceNote"};case 6:return null}return null}static getSource(e,t){if(!t)return[];switch(e){case 0:return t.supergroupMembers&&t.supergroupMembers.members||t.fullInfo.members||[];case 1:return t.photoAndVideo||[];case 2:return t.document||[];case 3:return t.audio||[];case 4:return t.url||[];case 5:return t.voiceNote||[];case 6:return t.groupsInCommon||[]}return[]}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){const t=ee.a.getMedia(e.chatId),a=t&&(t.supergroupMembers&&t.supergroupMembers.members||t.fullInfo.members)||[],n=t?t.photoAndVideo:[],s=t?t.document:[],i=t?t.audio:[],r=t?t.url:[],o=t?t.voiceNote:[],l=t?t.groupsInCommon:[];let c=-1;a.length>0?c=0:n.length>0?c=1:s.length>0?c=2:i.length>0?c=3:r.length>0?c=4:o.length>0?c=5:l.length>0&&(c=6);const d=bt.getSource(c,t).filter(e=>bt.isValidContent(c,e.content));return{prevChatId:e.chatId,selectedIndex:c,renderIds:new Map,rowHeight:bt.getRowHeight(c),items:d.slice(0,u.Ab),members:a,photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l,isSmallWidth:!1,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:bt.getFilter(c)}}}return null}componentDidMount(){window.addEventListener("resize",this.onWindowResize),ee.a.on("clientUpdateMediaTab",this.onClientUpdateMediaTab),ee.a.on("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.on("updateNewMessage",this.onUpdateNewMessage),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateMessageContent",this.onUpdateMessageContent),ee.a.on("updateMessageSendSucceeded",this.onUpdateMessageSend),ee.a.on("updateMessageSendFailed",this.onUpdateMessageSend)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),ee.a.off("clientUpdateMediaTab",this.onClientUpdateMediaTab),ee.a.off("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.off("updateNewMessage",this.onUpdateNewMessage),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateMessageContent",this.onUpdateMessageContent),ee.a.off("updateMessageSendSucceeded",this.onUpdateMessageSend),ee.a.off("updateMessageSendFailed",this.onUpdateMessageSend)}componentDidUpdate(e,t,a){if(e.items!==this.props.chatId||t.selectedIndex!==this.state.selectedIndex){const e=this.state.items,t=U.a.getStore();switch(this.state.selectedIndex){case 0:Object(W.K)(t,e.map(e=>e.user_id));break;case 1:case 2:case 3:case 4:case 5:Object(W.B)(t,e);break;case 6:Object(W.x)(t,e)}}}getRenderIds(e,t,a){const n=new Map,s=[];return e.forEach((e,i)=>{this.isVisibleItem(i,t,a)&&(n.set(i,i),s.push(i))}),{renderIds:n,renderIdsList:s}}onLoadMigratedNext(e,t){}render(){const e=this.state,t=e.selectedIndex,a=e.items,n=void 0===a?[]:a,s=e.renderIds,i=e.members,r=e.photoAndVideo,l=e.document,d=e.audio,h=e.url,p=e.voiceNote,u=e.groupsInCommon;if(!(i&&i.length>0||r&&r.length>0||l&&l.length>0||d&&d.length>0||h&&h.length>0||p&&p.length>0||u&&u.length>0))return o.a.createElement("div",{ref:this.listRef});if(2===t||3===t||5===t){let e=0;const a=n.map((a,n)=>{const i=a.chat_id,r=a.id,l=bt.getItemHeight(a);return l?(e+=l,(!s.size||s.has(n))&&o.a.createElement("div",{key:"chat_id=".concat(i,"_message_id=").concat(r),className:"shared-media-virt-item",style:{top:e-l}},bt.getItemTemplate(t,a,()=>this.handleOpen(a)))):null});return o.a.createElement("div",{ref:this.listRef,className:"shared-media-virt-content",style:{height:e}},a)}return o.a.createElement("div",{ref:this.listRef,className:c()("shared-media-content",{"shared-photos-list":1===t})},n.map(e=>bt.getItemTemplate(t,e,()=>this.handleOpen(e))))}}bt.getItemTemplate=(e,t,a)=>{switch(e){case 0:{const e=t.user_id;return o.a.createElement(me.a,{button:!0,key:"user_id=".concat(e),className:"groups-in-common-item"},o.a.createElement(ve.a,{userId:e,onSelect:a}))}case 1:{const e=t.chat_id,n=t.id,s=t.content;return"messageVideo"===s["@type"]?o.a.createElement(Ct,{key:"chat_id=".concat(e,"_message_id=").concat(n),chatId:e,messageId:n,video:s.video,openMedia:a,showOpenMessage:-1!==e}):o.a.createElement(et,{key:"chat_id=".concat(e,"_message_id=").concat(n),chatId:e,messageId:n,photo:s.photo,openMedia:a,showOpenMessage:-1!==e})}case 2:{const e=t.chat_id,a=t.id;return o.a.createElement(nt,{key:"chat_id=".concat(e,"_message_id=").concat(a),chatId:e,messageId:a,showOpenMessage:-1!==e})}case 3:{const e=t.chat_id,a=t.id;t.content;return o.a.createElement(nt,{key:"chat_id=".concat(e,"_message_id=").concat(a),chatId:e,messageId:a,showOpenMessage:-1!==e})}case 4:{const e=t.chat_id,n=t.id,s=t.content;return o.a.createElement(ct,{key:"chat_id=".concat(e,"_message_id=").concat(n),chatId:e,messageId:n,webPage:s.web_page,caption:s.caption,openMedia:a,showOpenMessage:-1!==e})}case 5:{const e=t.chat_id,n=t.id,s=t.content;return o.a.createElement(gt,{key:"chat_id=".concat(e,"_message_id=").concat(n),chatId:e,messageId:n,voiceNote:s.voice_note,openMedia:a,showOpenMessage:-1!==e})}case 6:{const e=t.id;return o.a.createElement(me.a,{button:!0,key:"chat_id=".concat(e),className:"groups-in-common-item"},o.a.createElement(Oe,{chatId:e,onSelect:a}))}}return null};var vt=bt,Et=a(25),St=a(87);a(474),a(475);class yt extends o.a.Component{constructor(e){super(e),this.onUpdateBasicGroupFullInfo=e=>{const t=Se.a.get(this.props.chatId);t&&t.type&&"chatTypeBasicGroup"===t.type["@type"]&&t.type.basic_group_id===e.basic_group_id&&this.forceUpdate()},this.onUpdateSupergroupFullInfo=e=>{const t=Se.a.get(this.props.chatId);t&&t.type&&"chatTypeSupergroup"===t.type["@type"]&&t.type.supergroup_id===e.supergroup_id&&this.forceUpdate()},this.onUpdateUserFullInfo=e=>{const t=Se.a.get(this.props.chatId);t&&(!t.type||"chatTypePrivate"!==t.type["@type"]&&"chatTypeSecret"!==t.type["@type"]||t.type.user_id!==e.user_id||this.forceUpdate())},this.onUpdateUserStatus=e=>{this.members.has(e.user_id)&&this.forceUpdate()},this.loadContent=()=>{this.loadChatContents()},this.loadChatContents=()=>{const e=this.props,t=e.chatId,a=e.popup,n=U.a.getStore();Object(W.x)(n,[t]);const s=Object(F.E)(t).map(e=>e.user_id);Object(W.K)(n,s),a&&Object(F.n)(t)},this.handleUsernameHint=()=>{const e=this.props,t=e.t,a=e.chatId,n=Object(F.C)(a);if(!n)return;const s=G.a.get("t_me_url");H((s?s.value:"https://telegram.org/")+n),this.handleScheduledAction(t("LinkCopied"))},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>{n(s)}},o.a.createElement(f.a,null))]})},this.handlePhoneHint=()=>{const e=this.props,t=e.t,a=e.chatId,n=Object(F.s)(a);n&&(H(Object(St.a)(n)),this.handleScheduledAction(t("PhoneCopied")))},this.handleHeaderClick=()=>{this.listRef.current.scrollTop=0},this.handleOpenViewer=()=>{const e=this.props,t=e.chatId,a=e.popup,n=Se.a.get(t);n&&n.photo&&(Object(Q.v)({chatId:t}),a&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0}))},this.handleOpenChat=()=>{const e=this.props,t=e.chatId,a=e.popup;Object(Q.k)(t,null,!1),a&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})},this.handleOpenUser=e=>{Object(Q.m)(e,!0)},this.getContentHeight=()=>this.listRef?this.listRef.current.clientHeight:0,this.handleTabClick=e=>{const t=this.listRef.current;if(!t)return;const a=this.dividerRef.current;a&&a.offsetTop!==t.scrollTop&&(t.scrollTop<a.offsetTop?t.scrollTo({top:a.offsetTop,behavior:"smooth"}):(t.scrollTop=a.offsetTop+70,setTimeout(()=>{t.scrollTo({top:a.offsetTop,behavior:"smooth"})},0)))},this.handleScroll=e=>{if(!this.listRef)return;if(!this.mediaRef)return;const t=this.listRef.current;if(!t)return;const a=this.mediaRef.current;a&&(t.scrollTop+t.offsetHeight>=t.scrollHeight-u.yb&&a.handleScroll(e),a.handleVirtScroll(e,t))},this.listRef=o.a.createRef(),this.dividerRef=o.a.createRef(),this.mediaRef=o.a.createRef();const t=this.props.chatId;this.members=new Map,this.state={prevChatId:t}}static getDerivedStateFromProps(e,t){return e.chatId!==t.prevChatId?{prevChatId:e.chatId}:null}getSnapshotBeforeUpdate(e,t){this.props.chatId;const a=this.listRef.current;return{scrollTop:a.scrollTop,scrollHeight:a.scrollHeight,offsetHeight:a.offsetHeight}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.theme,i=a.counters,r=a.migratedCounters;return e.chatId!==n||(e.counters!==i||(e.migratedCounters!==r||e.theme!==s))}componentDidUpdate(e,t,a){const n=this.props.chatId;e.chatId!==n&&this.loadContent();const s=this.listRef.current,i=a.scrollTop;a.scrollHeight,a.offsetHeight;e.chatId===n?s.scrollTop=i:s.scrollTop=0}componentDidMount(){this.loadContent(),te.a.on("updateUserStatus",this.onUpdateUserStatus),te.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}componentWillUnmount(){te.a.off("updateUserStatus",this.onUpdateUserStatus),te.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}render(){const e=this.props,t=e.backButton,a=e.className,n=e.chatId,s=e.onClose,i=e.popup,r=e.t;let l=this.props,d=l.counters,h=l.migratedCounters;d=d||[0,0,0,0,0,0],h=h||[0,0,0,0,0,0];const p=d.map((e,t)=>e+h[t]),u=Object(L.a)(p,6),m=(u[0],u[1],u[2],u[3],u[4],u[5],Se.a.get(n));if(!m)return o.a.createElement("div",{className:"chat-details"},o.a.createElement(Ne,{onClose:s}),o.a.createElement("div",{ref:this.listRef,className:c()("chat-details-list","scrollbars-hidden")}));let g=0;if(Object(F.hb)(n)){const e=te.a.getFullInfo(m.type.user_id);g=e?e.group_in_common_count:g}const f=Object(F.C)(n),C=Object(F.s)(n);let b=Object(F.k)(n);Object(F.fb)(n);const v=Object(F.gb)(n),E=Object(F.E)(n),S=[];this.members=new Map,E.forEach(e=>{const t=te.a.get(e.user_id);t&&(this.members.set(t.id,t.id),S.push(t))});S.sort((e,t)=>Object(Et.g)(t)-Object(Et.g)(e)).map(e=>o.a.createElement(me.a,{button:!0,className:"list-item",key:e.id},o.a.createElement(ve.a,{userId:e.id,onSelect:this.handleOpenUser})));const y=m.photo;if(Object(F.fb)(n)||Object(F.V)(n)){const e=Object(tt.B)(b,[]),t=e.text,a=e.entities;a.length>0&&(b=Object(tt.o)({"@type":"formattedText",text:t,entities:a}))}let M=r("SendMessage");Object(F.V)(n)?M=r("OpenChannel"):Object(F.fb)(n)&&(M=r("OpenGroup"));let I="";if(f)if(Object(F.hb)(n))I=f;else{I=G.a.get("t_me_url").value.toLowerCase().replace("https://","").replace("http://","")+f}const U=o.a.createElement(o.a.Fragment,null,o.a.createElement(Ne,{chatId:n,backButton:t,onClose:s,onClick:this.handleHeaderClick}),o.a.createElement("div",{ref:this.listRef,className:c()("chat-details-list","scrollbars-hidden"),onScroll:this.handleScroll},o.a.createElement("div",{className:"chat-details-info"},o.a.createElement(Oe,{chatId:n,big:!0,showStatus:!0,showSavedMessages:!i,onTileSelect:y?this.handleOpenViewer:null}),!v&&o.a.createElement(ue.a,{className:"chat-details-items"},b&&o.a.createElement(me.a,{className:"list-item-rounded",alignItems:"flex-start"},o.a.createElement(ge.a,null,o.a.createElement(de.a,{className:"chat-details-info-icon"})),o.a.createElement(fe.a,{primary:b,secondary:Object(F.hb)(n)?r("Bio"):r("DescriptionPlaceholder"),style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}})),f&&o.a.createElement(me.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleUsernameHint},o.a.createElement(ge.a,null,o.a.createElement(re.a,null)),o.a.createElement(fe.a,{primary:o.a.createElement(be.a,{variant:"inherit",noWrap:!0},I),secondary:Object(F.hb)(n)?r("Username"):r("InviteLink")})),C&&o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handlePhoneHint},o.a.createElement(ge.a,null,o.a.createElement(le.a,null)),o.a.createElement(fe.a,{primary:o.a.createElement(be.a,{variant:"inherit",noWrap:!0},Object(St.a)(C)),secondary:r("Phone")}))),o.a.createElement(Fe,{chatId:n}),i&&o.a.createElement(me.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleOpenChat},o.a.createElement(fe.a,{primary:o.a.createElement(be.a,{color:"primary",variant:"inherit",noWrap:!0},M.toUpperCase()),style:{paddingLeft:40}})))),o.a.createElement("div",{ref:this.dividerRef}),o.a.createElement(He,{chatId:n,onClick:this.handleTabClick}),o.a.createElement(vt,{ref:this.mediaRef,chatId:n,popup:i})));return i?o.a.createElement(o.a.Fragment,null,U):o.a.createElement("div",{className:c()("chat-details",a)},U)}}var Mt=Object(d.a)(Object(d.d)(),Object(_.a)(),p.b,Object(d.c)())(yt);a(478);class It extends o.a.Component{render(){const e=this.props.onClose;return o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:e},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},"Groups in common")))}}var Ut=It;a(479);class kt extends o.a.Component{constructor(e){super(e),this.handleSelect=e=>{const t=this.props.popup;Object(Q.k)(e),t&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})},this.state={chatIds:[]}}componentDidMount(){const e=this.props.chatId,t=Object(F.B)(e);t&&x.a.send({"@type":"getGroupsInCommon",user_id:t,offset_chat_id:0,limit:100}).then(e=>{const t=U.a.getStore();Object(W.x)(t,e.chat_ids),this.setState({chatIds:e.chat_ids})})}render(){const e=this.props,t=e.minHeight,a=e.onClose,n=e.popup,s=this.state.chatIds.map(e=>o.a.createElement(me.a,{button:!0,key:e},o.a.createElement(Oe,{chatId:e,onSelect:this.handleSelect}))),i=o.a.createElement(o.a.Fragment,null,o.a.createElement(Ut,{onClose:a}),o.a.createElement("div",{className:"groups-in-common-list",style:{minHeight:t}},s));return n?o.a.createElement(o.a.Fragment,null,i):o.a.createElement("div",{className:"groups-in-common"},i)}}kt.defaultProps={popup:!1,minHeight:0};var xt=kt,wt=a(14),Ot=a.n(wt),Lt=Object(he.a)(o.a.createElement("path",{d:"M9.5,3 C13.0898509,3 16,5.91014913 16,9.5 C16,10.9337106 15.5358211,12.2590065 14.7495478,13.3338028 L19.7071068,18.2928932 C20.0976311,18.6834175 20.0976311,19.3165825 19.7071068,19.7071068 C19.3466228,20.0675907 18.7793918,20.0953203 18.3871006,19.7902954 L18.2928932,19.7071068 L13.3338028,14.7495478 C12.2590065,15.5358211 10.9337106,16 9.5,16 C5.91014913,16 3,13.0898509 3,9.5 C3,5.91014913 5.91014913,3 9.5,3 Z M9.5,5 C7.01471863,5 5,7.01471863 5,9.5 C5,11.9852814 7.01471863,14 9.5,14 C11.9852814,14 14,11.9852814 14,9.5 C14,7.01471863 11.9852814,5 9.5,5 Z"}),"Search"),_t=a(666);a(480);class Nt extends o.a.Component{constructor(e){super(e),this.handleSearch=()=>{if(this.searchInputRef.current){if(this.searchInputRef.current.innerText){this.searchInputRef.current.innerText="";const e=this.props.onSearch;if(!e)return;return void e("")}}const e=this.props.onCloseSearch,t=this.state.openSearch;this.setState({openSearch:!t}),e&&e()},this.handleKeyDown=e=>{13===e.keyCode&&e.preventDefault()},this.handleKeyUp=()=>{const e=this.searchInputRef.current;if(!e)return;const t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null);const a=e.innerText,n=this.props.onSearch;n&&n(a)},this.handlePaste=e=>{const t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.searchInputRef=o.a.createRef(),this.state={openSearch:!1}}componentDidUpdate(e,t,a){const n=this.state.openSearch;n&&n!==e.openSearch&&setTimeout(()=>{this.searchInputRef.current&&this.searchInputRef.current.focus()},u.b)}render(){const e=this.props,t=e.t,a=e.title,n=e.onClick,s=e.onClose,i=e.onSearch,r=this.state.openSearch;return o.a.createElement("div",{className:"header-master"},r?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-search-input grow"},o.a.createElement("div",{id:"header-search-inputbox",ref:this.searchInputRef,placeholder:t("Search"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste}))):o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{className:"header-left-button",onClick:s},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:n},o.a.createElement("span",{className:"header-status-content"},a))),Boolean(i)&&o.a.createElement(j.a,{className:"header-right-button",onMouseDown:this.handleSearch},o.a.createElement(_t.a,{open:r,icon:o.a.createElement(Lt,null),openIcon:o.a.createElement(f.a,null)})))}}var jt=Object(_.a)()(Nt);a(481);class Pt extends o.a.Component{getListClassName(){return null}getSearchListClassName(){return null}constructor(e){var t;if(new.target===Pt)throw new TypeError("Cannot construct SharedMediaBase instances directly");super(e),t=this,this.onUpdateMessageContent=e=>{const t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.chat_id,l=e.message_id,c=(e.old_content,e.new_content),d=ee.a.get(o,l);if(o===a){if(!i.length)return;if(!Object(M.c)(l,i[0].id,i[i.length-1].id,!0))return;const e=i.findIndex(e=>e.id===l);this.isValidContent(c)?-1===e?this.setState({items:Object(M.r)(i,d,tt.T)}):this.setState({items:[...i.slice(0,e),d,...i.slice(e+1)]}):-1===e||this.setState({items:i.filter(e=>e.id!==l)})}else if(o===n){if(!r.length)return;if(!Object(M.c)(l,r[0].id,r[r.length-1].id,!0))return;const e=r.findIndex(e=>e.id===l);this.isValidContent(c)?-1===e?this.setState({migratedItems:Object(M.r)(r,d,tt.T)}):this.setState({migratedItems:[...r.slice(0,e),d,...r.slice(e+1)]}):-1===e||this.setState({migratedItems:r.filter(e=>e.id!==l)})}},this.onUpdateNewMessage=e=>{const t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.message,l=o.chat_id;if(l!==a)return;if(!this.isValidMessage(o))return;const c=U.a.getStore();Object(W.B)(c,[o]),l===a?this.setState({items:[o].concat(i)}):l===n&&this.setState({migratedItems:[o].concat(r)})},this.onUpdateDeleteMessages=e=>{const t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.chat_id,l=e.message_ids,c=new Map(l.map(e=>[e,e])),d=()=>{this.state.items.length+this.state.migratedItems.length<u.Ab&&this.onLoadNext(this.params)};o===a?this.setState({items:i.filter(e=>!c.has(e.id))},d):o===n&&this.setState({migratedItems:r.filter(e=>!c.has(e.id))},d)},this.loadContent=()=>{this.params={loading:!1,completed:!1,migrateCompleted:!1,items:[],migratedItems:[],filter:this.getSearchFilter()},this.onLoadNext(this.params)},this.onLoadNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h,p,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=a.completed,o=a.filter,l=a.items,!a.loading){e.next=4;break}return e.abrupt("return");case 4:if(!r){e.next=6;break}return e.abrupt("return");case 6:return c=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=10,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:c,offset:0,limit:u.Ab,filter:o}).finally(()=>{a.loading=!1});case 10:d=e.sent,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:c,offset:0,limit:2*u.Ab,filter:o}),h=d.messages,a.completed=0===h.length||0===h.total_count,a.items=l.concat(h.filter(t.isValidMessage)),p=n&&h.length>0&&h.length<u.Ab,ee.a.setItems(d.messages),m=U.a.getStore(),Object(W.B)(m,d.messages),t.setState({items:a.items}),a.completed?t.onLoadMigratedNext(a,!0):p&&t.onLoadNext(a,!1);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onLoadMigratedNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h,p,m,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.migratedChatId,r=a.filter,o=a.loading,l=a.migrateCompleted,c=a.migratedItems,i){e.next=4;break}return e.abrupt("return");case 4:if(!o){e.next=6;break}return e.abrupt("return");case 6:if(!l){e.next=8;break}return e.abrupt("return");case 8:return d=c.length>0?c[c.length-1].id:0,a.loading=!0,e.next=12,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:d,offset:0,limit:u.Ab,filter:r}).finally(()=>{a.loading=!1});case 12:if(h=e.sent,p=h.messages,a.migratedItems=c.concat(p.filter(t.isValidMessage)),a.migrateCompleted=0===p.length||0===p.total_count,m=n&&p.length>0&&p.length<u.Ab,!a.migrateCompleted){e.next=19;break}return e.abrupt("return");case 19:ee.a.setItems(p),g=U.a.getStore(),Object(W.B)(g,p),t.setState({migratedItems:a.migratedItems}),m&&t.onLoadMigratedNext(a,!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleScroll=()=>{if(!this.listRef)return;const e=this.listRef.current;if(!e)return;const t=this.params;e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&(t&&!t.completed?this.onLoadNext(t):this.onLoadMigratedNext(t))},this.handleHeaderClick=()=>{const e=this.listRef.current;e&&(e.scrollTop=0)},this.handleSearchScroll=()=>{if(!this.searchListRef)return;const e=this.searchListRef.current;if(!e)return;const t=this.searchParams;t&&e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&(t.completed?this.onSearchMigratedNext(t):this.onSearchNext(t))},this.onSearchNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h,p,m,g,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=a.completed,o=a.filter,l=a.items,c=a.loading,d=a.query,!r){e.next=4;break}return e.abrupt("return");case 4:if(!c){e.next=6;break}return e.abrupt("return");case 6:return h=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=10,x.a.send({"@type":"searchChatMessages",chat_id:i,query:d,sender_user_id:0,from_message_id:h,offset:0,limit:u.Ab,filter:o}).finally(()=>{a.loading=!1});case 10:if(p=e.sent,m=p.messages,a.items=l.concat(m.filter(t.isValidMessage)),a.completed=0===m.length||0===m.total_count,g=n&&m.length>0&&m.length<u.Ab,t.searchParams===a){e.next=17;break}return e.abrupt("return");case 17:ee.a.setItems(m),f=U.a.getStore(),Object(W.B)(f,m),t.setState({searchItems:a.items,searchMigratedItems:a.migratedItems}),a.completed?t.onSearchMigratedNext(a,!0):g&&t.onSearchNext(a,!1);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onSearchMigratedNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h,p,m,g,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.migratedChatId,r=a.filter,o=a.loading,l=a.migratedItems,c=a.migrateCompleted,d=a.query,i){e.next=4;break}return e.abrupt("return");case 4:if(!o){e.next=6;break}return e.abrupt("return");case 6:if(!c){e.next=8;break}return e.abrupt("return");case 8:return h=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=12,x.a.send({"@type":"searchChatMessages",chat_id:i,query:d,sender_user_id:0,from_message_id:h,offset:0,limit:u.Ab,filter:r}).finally(()=>{a.loading=!1});case 12:if(p=e.sent,m=p.messages,a.migratedItems=l.concat(m.filter(t.isValidMessage)),a.migrateCompleted=0===m.length||0===m.total_count,g=n&&m.length>0&&m.length<u.Ab,t.searchParams===a){e.next=19;break}return e.abrupt("return");case 19:ee.a.setItems(m),f=U.a.getStore(),Object(W.B)(f,m),t.setState({searchItems:a.items,searchMigratedItems:a.migratedItems}),g&&t.onSearchMigratedNext(a,!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a?a.trim():""){e.next=4;break}return t.handleCloseSearch(),e.abrupt("return");case 4:t.searchParams={query:n,completed:!1,migrateCompleted:!1,items:[],migratedItems:[],filter:t.getSearchFilter()},t.onSearchNext(t.searchParams,!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseSearch=()=>{this.searchParams=null,this.setState({searchItems:[],searchMigratedItems:[]})},this.isValidMessage=e=>!!e&&this.isValidContent(e.content),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.state={items:[],migratedItems:[],searchItems:[],searchMigratedItems:[]}}hasSearch(){return!0}isValidContent(e){throw new Error("Virtual method isValidContent is not implemented")}getItemTemplate(e){const t=this.props.migratedChatId,a=e.chat_id,n=e.id;return o.a.createElement(nt,{key:"chat_id=".concat(a,"_message_id=").concat(n),chatId:a,messageId:n,showOpenMessage:a!==t})}getSearchFilter(){throw new Error("Virtual method getSearchFilter is not implemented")}getHeader(){throw new Error("Virtual method getHeader is not implemented")}componentDidMount(){this.loadContent(),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateMessageContent",this.onUpdateMessageContent),ee.a.on("updateNewMessage",this.onUpdateNewMessage)}componentWillUnmount(){ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateMessageContent",this.onUpdateMessageContent),ee.a.off("updateNewMessage",this.onUpdateNewMessage)}render(){const e=this.props,t=e.minHeight,a=e.onClose,n=e.popup,s=this.state,i=s.items,r=s.migratedItems,l=s.searchItems,d=s.searchMigratedItems,h=this.searchParams,p=i.concat(r).map(e=>this.getItemTemplate(e)),u=l.concat(d).map(e=>this.getItemTemplate(e));return o.a.createElement(o.a.Fragment,null,o.a.createElement(jt,{title:this.getHeader(),onClick:this.handleHeaderClick,onClose:a,onSearch:this.hasSearch()?this.handleSearch:null,onCloseSearch:this.handleCloseSearch}),o.a.createElement("div",{ref:this.listRef,className:c()("shared-media-list",this.getListClassName()),onScroll:this.handleScroll,style:{minHeight:n?t:null}},p),Boolean(h)&&o.a.createElement("div",{ref:this.searchListRef,className:c()("shared-media-search-list",this.getSearchListClassName()),onScroll:this.handleSearchScroll},u))}}var Tt=Pt;a(482);class Rt extends Tt{isValidContent(e){return e&&"messageAudio"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterAudio"}}getHeader(){return(0,this.props.t)("AudioTitle")}}Rt.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Rt.defaultProps={popup:!1,minHeight:0};var Dt=Object(_.a)()(Rt);a(483);class Ft extends Tt{isValidContent(e){return e&&"messageDocument"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterDocument"}}getHeader(){return(0,this.props.t)("DocumentsTitle")}}Ft.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Ft.defaultProps={popup:!1,minHeight:0};var At=Object(_.a)()(Ft);a(484);class Bt extends Tt{isValidContent(e){if(!e)return!1;const t=e.web_page,a=e.text;if(t)return!0;if(!a)return!1;const n=a.entities;return!!n&&n.find(e=>"textEntityTypeUrl"===e.type["@type"]||"textEntityTypeTextUrl"===e.type["@type"]||"textEntityTypeEmailAddress"===e.type["@type"])}getSearchFilter(){return{"@type":"searchMessagesFilterUrl"}}getHeader(){return(0,this.props.t)("LinksTitle")}getItemTemplate(e){const t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(ct,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,webPage:n.web_page,openMedia:()=>Object(tt.U)(a,s,!1),showOpenMessage:a!==t})}}Bt.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Bt.defaultProps={popup:!1,minHeight:0};var Ht=Object(_.a)()(Bt),Vt=a(664),zt=a(658);a(485);class Wt extends o.a.Component{constructor(e){super(e)}render(){const e=this.props.close;return o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:e},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},"Shared Media")))}}var Gt=Wt;a(486);class Zt extends o.a.Component{constructor(...e){super(...e),this.state={value:0},this.handleChange=(e,t)=>{this.setState({value:t})}}render(){const e=this.props,t=e.onClose,a=e.popup,n=this.state.value,s=o.a.createElement(o.a.Fragment,null,o.a.createElement(Gt,{close:t}),o.a.createElement(Vt.a,{value:n,onChange:this.handleChange,indicatorColor:"primary",textColor:"primary",scrollable:!0,scrollButtons:"off",fullWidth:!0},o.a.createElement(zt.a,{label:"Media",style:{minWidth:"40px"}}),o.a.createElement(zt.a,{label:"Docs",style:{minWidth:"40px"}}),o.a.createElement(zt.a,{label:"Links",style:{minWidth:"40px"}}),o.a.createElement(zt.a,{label:"Audio",style:{minWidth:"40px"}})));return a?o.a.createElement(o.a.Fragment,null,s):o.a.createElement("div",{className:"shared-media"},s)}}Zt.defaultProps={popup:!1,minHeight:0};var qt=Zt;a(487);class Kt extends Tt{getListClassName(){return"shared-photos-list"}getSearchListClassName(){return"shared-photos-search-list"}isValidContent(e){return e&&"messagePhoto"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterPhoto"}}getHeader(){return(0,this.props.t)("PhotosTitle")}getItemTemplate(e){const t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(et,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,photo:n.photo,openMedia:()=>Object(tt.U)(a,s,!1),showOpenMessage:a!==t})}}Kt.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Kt.defaultProps={popup:!1,minHeight:0};var Yt=Object(_.a)()(Kt);a(488);class Jt extends Tt{getListClassName(){return"shared-photos-list"}getSearchListClassName(){return"shared-photos-search-list"}isValidContent(e){return e&&"messageVideo"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterVideo"}}getHeader(){return(0,this.props.t)("VideosTitle")}getItemTemplate(e){const t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(Ct,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,video:n.video,openMedia:()=>Object(tt.U)(a,s,!1),showOpenMessage:a!==t})}}Jt.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Jt.defaultProps={popup:!1,minHeight:0};var Xt=Object(_.a)()(Jt);a(489);class Qt extends Tt{isValidContent(e){return e&&"messageVoiceNote"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterVoiceNote"}}getHeader(){return(0,this.props.t)("VoiceTitle")}hasSearch(){return!1}getItemTemplate(e){const t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(gt,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,voiceNote:n.voice_note,openMedia:()=>Object(tt.U)(a,s,!1),showOpenMessage:a!==t})}}Qt.propTypes={chatId:Ot.a.number.isRequired,migratedChatId:Ot.a.number,onClose:Ot.a.func.isRequired,popup:Ot.a.bool,minHeight:Ot.a.number},Qt.defaultProps={popup:!1,minHeight:0};var $t=Object(_.a)()(Qt);a(490);class ea extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePageWidth=e=>{if(!e.isSmallWidth)return;this.props.popup||this.handleCloseChatDetails()},this.onClientUpdateChatId=e=>{const t=this.props.popup,a=this.state.chatId;t||a!==e.nextChatId&&(this.sharedAudios=null,this.sharedDocuments=null,this.sharedLinks=null,this.sharedPhotos=null,this.sharedVideos=null,this.sharedVoiceNotes=null,this.setState({chatId:e.nextChatId,migratedChatId:0,userChatId:null,openGroupInCommon:!1,openSharedAudios:!1,openSharedDocuments:!1,openSharedLinks:!1,openSharedMedia:!1,openSharedPhotos:!1,openSharedVideos:!1,openSharedVoiceNotes:!1,counters:Se.a.getCounters(e.nextChatId),migratedCounters:null}),e.nextChatId||this.handleCloseChatDetails())},this.loadContent=e=>{this.loadChatCounters(e),this.loadMigratedCounters(e);const t=Object(F.L)(e);t&&Object(W.C)(e,[t])},this.loadChatCounters=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pe.d)(a);case 2:if(n=e.sent,Se.a.setCounters(a,n),a===t.state.chatId){e.next=6;break}return e.abrupt("return");case 6:t.setState({counters:n});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadMigratedCounters=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(F.ib)(a)){e.next=2;break}return e.abrupt("return");case 2:if(n=Ue.a.getFullInfo(Object(F.M)(a))){e.next=5;break}return e.abrupt("return");case 5:if(i=n.upgraded_from_basic_group_id){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,x.a.send({"@type":"createBasicGroupChat",basic_group_id:i,force:!0});case 10:if(r=e.sent){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,Object(Pe.d)(r.id);case 15:if(o=e.sent,Se.a.setCounters(r.id,o),t.state.chatId===a){e.next=19;break}return e.abrupt("return");case 19:t.setState({migratedChatId:r.id,migratedCounters:Se.a.getCounters(r.id)});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleOpenSharedMedia=()=>{this.setState({openSharedMedia:!0})},this.handleCloseSharedMedia=()=>{this.setState({openSharedMedia:!1})},this.handleOpenGroupInCommon=()=>{this.setState({openGroupInCommon:!0})},this.handleCloseGroupsInCommon=()=>{this.setState({openGroupInCommon:!1})},this.handleCloseChatDetails=()=>{const e=this.props.popup;this.state.userChatId?this.setState({userChatId:null}):e?x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0}):Object(Pe.b)(!1)},this.handleOpenSharedDocuments=()=>{this.setState({openSharedDocuments:!0})},this.handleCloseSharedDocuments=()=>{this.setState({openSharedDocuments:!1})},this.handleOpenSharedAudios=()=>{this.setState({openSharedAudios:!0})},this.handleCloseSharedAudios=()=>{this.setState({openSharedAudios:!1})},this.handleOpenSharedVoiceNotes=()=>{this.setState({openSharedVoiceNotes:!0})},this.handleCloseSharedVoiceNotes=()=>{this.setState({openSharedVoiceNotes:!1})},this.handleOpenSharedLinks=()=>{this.setState({openSharedLinks:!0})},this.handleCloseSharedLinks=()=>{this.setState({openSharedLinks:!1})},this.handleOpenSharedPhotos=()=>{this.setState({openSharedPhotos:!0})},this.handleCloseSharedPhotos=()=>{this.setState({openSharedPhotos:!1})},this.handleOpenSharedVideos=()=>{this.setState({openSharedVideos:!0})},this.handleCloseSharedVideos=()=>{this.setState({openSharedVideos:!1})},this.detailsRef=o.a.createRef();const a=e.popup,n=ae.a.chatId,r=ae.a.dialogChatId;this.state={chatId:a?r:n,migratedChatId:0,userChatId:null,openGroupInCommon:!1,openSharedAudios:!1,openSharedDocuments:!1,openSharedLinks:!1,openSharedMedia:!1,openSharedPhotos:!1,openSharedVideos:!1,openSharedVoiceNotes:!1,counters:null,migratedCounters:null}}componentDidMount(){this.loadContent(this.state.chatId),ae.a.on("clientUpdateChatId",this.onClientUpdateChatId),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentDidUpdate(e,t,a){const n=this.state.chatId;n!==t.chatId&&this.loadContent(n)}render(){const e=this.props,t=e.className,a=e.popup,n=this.state,s=n.chatId,i=n.counters,r=n.migratedChatId,l=n.migratedCounters,d=n.userChatId,h=n.openSharedAudios,p=n.openSharedDocuments,u=n.openSharedLinks,m=n.openSharedMedia,g=n.openSharedPhotos,f=n.openSharedVideos,C=n.openSharedVoiceNotes,b=n.openGroupInCommon,v=s||d,E=this.detailsRef&&this.detailsRef.current?this.detailsRef.current.getContentHeight():0;let S=null;return m?S=o.a.createElement(qt,{chatId:v,popup:a,minHeight:E,onClose:this.handleCloseSharedMedia}):h?(this.sharedAudios=this.sharedAudios||o.a.createElement(Dt,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedAudios}),S=this.sharedAudios):p?(this.sharedDocuments=this.sharedDocuments||o.a.createElement(At,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedDocuments}),S=this.sharedDocuments):u?(this.sharedLinks=this.sharedLinks||o.a.createElement(Ht,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedLinks}),S=this.sharedLinks):g?(this.sharedPhotos=this.sharedPhotos||o.a.createElement(Yt,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedPhotos}),S=this.sharedPhotos):f?(this.sharedVideos=this.sharedVideos||o.a.createElement(Xt,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedVideos}),S=this.sharedVideos):C?(this.sharedVoiceNotes=this.sharedVoiceNotes||o.a.createElement($t,{chatId:v,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedVoiceNotes}),S=this.sharedVoiceNotes):S=b?o.a.createElement(xt,{chatId:v,popup:a,minHeight:E,onClose:this.handleCloseGroupsInCommon}):o.a.createElement(Mt,{ref:this.detailsRef,chatId:v,popup:a,backButton:d===s,counters:i,migratedCounters:l,onOpenGroupInCommon:this.handleOpenGroupInCommon,onOpenSharedAudios:this.handleOpenSharedAudios,onOpenSharedDocuments:this.handleOpenSharedDocuments,onOpenSharedMedia:this.handleOpenSharedMedia,onOpenSharedLinks:this.handleOpenSharedLinks,onOpenSharedPhotos:this.handleOpenSharedPhotos,onOpenSharedVideos:this.handleOpenSharedVideos,onOpenSharedVoiceNotes:this.handleOpenSharedVoiceNotes,onClose:this.handleCloseChatDetails}),a?o.a.createElement(o.a.Fragment,null,S):o.a.createElement("div",{className:c()("chat-info",{"right-column":!a},t)},S)}}ea.defaultProps={className:null,classes:null,popup:!1};var ta=ea,aa=a(451);a(491);class na extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdateUser=e=>{const t=this.props.chatId,a=e.user,n=Se.a.get(t);if(!n)return;if(Object(F.hb)(t))return;const s=n.last_message;if(!s)return;s.sender.user_id===a.id&&this.forceUpdate()},this.onUpdate=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.t;return e.chatId!==n||e.t!==s}componentDidMount(){Se.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.on("updateChatDraftMessage",this.onUpdate),Se.a.on("updateChatLastMessage",this.onUpdate),Se.a.on("updateChatReadInbox",this.onUpdate),Se.a.on("updateUserChatAction",this.onUpdate),te.a.on("updateUser",this.onUpdateUser)}componentWillUnmount(){Se.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.off("updateChatDraftMessage",this.onUpdate),Se.a.off("updateChatLastMessage",this.onUpdate),Se.a.off("updateChatReadInbox",this.onUpdate),Se.a.off("updateUserChatAction",this.onUpdate)}render(){const e=this.props,t=e.chatId,a=e.t;if(this.clearHistory)return o.a.createElement("div",{className:"dialog-content"},"\xa0");const n=Se.a.get(t);if(!n)return o.a.createElement("div",{className:"dialog-content"},"\xa0");let s=null;const i=Object(F.A)(t);if(i&&(s=o.a.createElement("span",{className:"dialog-content-accent"},i)),!s){const e=Object(F.l)(t);if(Object(F.kb)(t)){const t=e.text||"\xa0";s=o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"dialog-content-draft"},a("Draft")+": "),t)}}if(!s){const e=Object(F.F)(n,a)||"\xa0",t=Object(F.H)(n,a);s=o.a.createElement(o.a.Fragment,null,t&&o.a.createElement("span",{className:"dialog-content-accent"},t,": "),e)}return o.a.createElement("div",{className:"dialog-content"},s)}}var sa=Object(_.a)()(na),ia=Object(he.a)(o.a.createElement("g",{strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.a.createElement("line",{x1:"10.5",y1:"13.5",x2:"7",y2:"17",id:"Path-51",strokeWidth:"1.66",strokeLinecap:"round"}),o.a.createElement("path",{d:"M15.2734195,6.29329584 L17.7068554,8.72673178 C18.0977149,9.11759123 18.0977149,9.7512996 17.7068554,10.142159 C17.6489915,10.200023 17.5842494,10.2505721 17.5140791,10.2926743 L15.0747102,11.7562956 C15.5465193,13.1717229 15.0755189,14.5863414 13.661709,16.0001513 L8,10.3384422 C9.41380985,8.92463237 10.8284284,8.45363199 12.2438557,8.92544107 L13.707477,6.48607217 C13.991869,6.01208547 14.6066564,5.85838861 15.0806431,6.14278063 C15.1508135,6.18488284 15.2155555,6.2354319 15.2734195,6.29329584 Z",strokeWidth:"1.66",strokeLinecap:"round",strokeLinejoin:"round"})),"Pin");a(492);class ra extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdate=e=>{const t=this.props.chatId;e.chat_id===t&&this.forceUpdate()},this.onUpdateScopeNotificationSettings=e=>{const t=this.props.chatId,a=Se.a.get(t);if(a)switch(e.scope["@type"]){case"notificationSettingsScopeGroupChats":"chatTypeBasicGroup"!==a.type["@type"]&&"chatTypeSupergroup"!==a.type["@type"]||this.forceUpdate();break;case"notificationSettingsScopePrivateChats":"chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||this.forceUpdate()}}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.chatList;return e.chatId!==n||e.chatList!==s}componentDidMount(){Se.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.on("updateChatDraftMessage",this.onUpdate),Se.a.on("updateChatIsMarkedAsUnread",this.onUpdate),Se.a.on("updateChatPosition",this.onUpdate),Se.a.on("updateChatNotificationSettings",this.onUpdate),Se.a.on("updateChatReadInbox",this.onUpdate),Se.a.on("updateChatLastMessage",this.onUpdate),Se.a.on("updateChatReadOutbox",this.onUpdate),Se.a.on("updateChatUnreadMentionCount",this.onUpdate),Se.a.on("updateMessageMentionRead",this.onUpdate),Te.a.on("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}componentWillUnmount(){Se.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.off("updateChatDraftMessage",this.onUpdate),Se.a.off("updateChatIsMarkedAsUnread",this.onUpdate),Se.a.off("updateChatPosition",this.onUpdate),Se.a.off("updateChatNotificationSettings",this.onUpdate),Se.a.off("updateChatReadInbox",this.onUpdate),Se.a.off("updateChatLastMessage",this.onUpdate),Se.a.off("updateChatReadOutbox",this.onUpdate),Se.a.off("updateChatUnreadMentionCount",this.onUpdate),Se.a.off("updateMessageMentionRead",this.onUpdate),Te.a.off("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}render(){if(this.clearHistory)return null;const e=this.props,t=e.chatId,a=e.chatList,n=Se.a.get(t);if(!n)return null;const s=n.unread_count,i=Object(F.Z)(t,a),r=Object(F.mb)(t),l=Object(F.lb)(t),d=Object(F.Y)(t);return o.a.createElement(o.a.Fragment,null,r&&o.a.createElement("div",{className:"dialog-badge"},o.a.createElement("div",{className:"dialog-badge-mention"},"@")),l&&o.a.createElement("div",{className:c()({"dialog-badge-muted":d},"dialog-badge")},o.a.createElement("span",{className:"dialog-badge-text"},s>0?s:"")),i&&!l&&!r&&o.a.createElement("div",{className:"dialog-badge-pinned"},o.a.createElement(ia,{className:"dialog-badge-pinned-icon"})))}}var oa=ra,la=Object(he.a)(o.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.a.createElement("g",{transform:"translate(-3.000000, 0.000000)",fill:"#E53935",fillRule:"nonzero"},o.a.createElement("path",{d:"M10,0.4 C13.6450793,0.4 16.6,3.35492065 16.6,7 C16.6,10.6450793 13.6450793,13.6 10,13.6 C6.35492065,13.6 3.4,10.6450793 3.4,7 C3.4,3.35492065 6.35492065,0.4 10,0.4 Z M10,9.25 C9.58578644,9.25 9.25,9.58578644 9.25,10 C9.25,10.4142136 9.58578644,10.75 10,10.75 C10.4142136,10.75 10.75,10.4142136 10.75,10 C10.75,9.58578644 10.4142136,9.25 10,9.25 Z M10,2.85 C9.64101491,2.85 9.35,3.14101491 9.35,3.5 L9.35,7.5 C9.35,7.85898509 9.64101491,8.15 10,8.15 C10.3589851,8.15 10.65,7.85898509 10.65,7.5 L10.65,3.5 C10.65,3.14101491 10.3589851,2.85 10,2.85 Z"}))),"Error"),ca=Object(he.a)(o.a.createElement("g",{strokeWidth:"1",fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"},o.a.createElement("g",{transform:"translate(-3.000000, 0.000000)"},o.a.createElement("circle",{strokeWidth:"1.2",cx:"10",cy:"7",r:"6"}),o.a.createElement("line",{x1:"10",y1:"3.5",x2:"10",y2:"7",strokeWidth:"1.3"}),o.a.createElement("line",{x1:"12",y1:"9",x2:"10",y2:"7",strokeWidth:"1.3"}))),"Pending"),da=Object(he.a)(o.a.createElement("path",{transform:"translate(-4.000000, -2.000000)",d:"M7.96833846,10.0490996 L14.5108251,2.571972 C14.7472185,2.30180819 15.1578642,2.27443181 15.428028,2.51082515 C15.6711754,2.72357915 15.717665,3.07747757 15.5522007,3.34307913 L15.4891749,3.428028 L8.48917485,11.428028 C8.2663359,11.6827011 7.89144111,11.7199091 7.62486888,11.5309823 L7.54038059,11.4596194 L4.54038059,8.45961941 C4.2865398,8.20577862 4.2865398,7.79422138 4.54038059,7.54038059 C4.7688373,7.31192388 5.12504434,7.28907821 5.37905111,7.47184358 L5.45961941,7.54038059 L7.96833846,10.0490996 L14.5108251,2.571972 L7.96833846,10.0490996 Z"}),"Sent"),ha=Object(he.a)(o.a.createElement("path",{transform:"translate(-1.000000, -2.000000)",d:"M4.96833846,10.0490996 L11.5108251,2.571972 C11.7472185,2.30180819 12.1578642,2.27443181 12.428028,2.51082515 C12.6711754,2.72357915 12.717665,3.07747757 12.5522007,3.34307913 L12.4891749,3.428028 L5.48917485,11.428028 C5.2663359,11.6827011 4.89144111,11.7199091 4.62486888,11.5309823 L4.54038059,11.4596194 L1.54038059,8.45961941 C1.2865398,8.20577862 1.2865398,7.79422138 1.54038059,7.54038059 C1.7688373,7.31192388 2.12504434,7.28907821 2.37905111,7.47184358 L2.45961941,7.54038059 L4.96833846,10.0490996 L11.5108251,2.571972 L4.96833846,10.0490996 Z M9.96833846,10.0490996 L16.5108251,2.571972 C16.7472185,2.30180819 17.1578642,2.27443181 17.428028,2.51082515 C17.6711754,2.72357915 17.717665,3.07747757 17.5522007,3.34307913 L17.4891749,3.428028 L10.4891749,11.428028 C10.2663359,11.6827011 9.89144111,11.7199091 9.62486888,11.5309823 L9.54038059,11.4596194 L8.54038059,10.4596194 C8.2865398,10.2057786 8.2865398,9.79422138 8.54038059,9.54038059 C8.7688373,9.31192388 9.12504434,9.28907821 9.37905111,9.47184358 L9.45961941,9.54038059 L9.96833846,10.0490996 L16.5108251,2.571972 L9.96833846,10.0490996 Z"}),"Succeeded");a(493);class pa extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateMessageSend=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=e.old_message_id,i=e.message;if(n!==s)return;if(!i)return;const r=i.chat_id,o=i.id,l=i.sending_state;a===r&&(this.newMessageId=o,this.setState({sendingState:l}))},this.onUpdateChatReadOutbox=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=e.chat_id,i=e.last_read_outbox_message_id,r=this.newMessageId;a===s&&(r&&r<=i||n<=i)&&this.setState({sendingState:null,unread:!1})}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.messageId,s=ee.a.get(a,n),i=s?s.sending_state:null;return a!==t.prevChatId||n!==t.prevMessageId?{prevChatId:a,prevMessageId:n,sendingState:i,unread:Object(tt.P)(a,n)}:null}componentDidMount(){Se.a.on("updateChatReadOutbox",this.onUpdateChatReadOutbox),ee.a.on("updateMessageSendFailed",this.onUpdateMessageSend),ee.a.on("updateMessageSendSucceeded",this.onUpdateMessageSend)}componentWillUnmount(){Se.a.off("updateChatReadOutbox",this.onUpdateChatReadOutbox),ee.a.off("updateMessageSendFailed",this.onUpdateMessageSend),ee.a.off("updateMessageSendSucceeded",this.onUpdateMessageSend)}render(){const e=this.state,t=e.sendingState;return e.unread?t?"messageSendingStateFailed"===t["@type"]?o.a.createElement(la,{className:"status",viewBox:"0 0 14 14",style:{width:16,height:12,transform:"translate(0, 1px)"}}):o.a.createElement(ca,{className:"status",viewBox:"0 0 14 14",style:{width:16,height:12,transform:"translate(0, 1px)",stroke:"currentColor"}}):o.a.createElement(da,{className:"status",viewBox:"0 0 12 10",style:{width:16,height:9}}):o.a.createElement(ha,{className:"status",viewBox:"0 0 17 10",style:{width:16,height:9}})}}var ua=pa;a(494);class ma extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdate=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.t;return e.chatId!==n||e.t!==s}componentDidMount(){Se.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.on("updateChatDraftMessage",this.onUpdate),Se.a.on("updateChatLastMessage",this.onUpdate),Se.a.on("updateChatReadInbox",this.onUpdate),Se.a.on("updateChatUnreadMentionCount",this.onUpdate),Se.a.on("updateMessageMentionRead",this.onUpdate)}componentWillUnmount(){Se.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.off("updateChatDraftMessage",this.onUpdate),Se.a.off("updateChatLastMessage",this.onUpdate),Se.a.off("updateChatReadInbox",this.onUpdate),Se.a.off("updateChatUnreadMentionCount",this.onUpdate),Se.a.off("updateMessageMentionRead",this.onUpdate)}render(){if(this.clearHistory)return null;const e=this.props.chatId,t=Se.a.get(e);if(!t)return null;const a=Object(F.gb)(e),n=t.last_message;if(!n)return null;const s=Object(F.G)(t);if(!s)return null;const i=n.id,r=n.is_outgoing;return o.a.createElement("div",{className:"dialog-meta"},r&&!a&&o.a.createElement(o.a.Fragment,null,o.a.createElement(ua,{chatId:e,messageId:i}),o.a.createElement("span",null," ")),s)}}var ga=Object(_.a)()(ma),fa=Object(he.a)(o.a.createElement("path",{d:"M16.5,1 C17.7590292,1 18.9445825,1.59277663 19.7,2.6 L19.7,2.6 L21.2,4.6 C21.7192885,5.29238468 22,6.13451915 22,7 L22,7 L22,8 C22,8.11615513 21.980196,8.22768478 21.9437804,8.33139667 C21.9809544,8.54881122 22,8.77218145 22,9 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,9 C2,8.77218145 2.01904557,8.54881122 2.05563136,8.33139468 C2.01980398,8.22768478 2,8.11615513 2,8 L2,8 L2,7 C2,6.13451915 2.28071149,5.29238468 2.8,4.6 L2.8,4.6 L4.3,2.6 C5.05541753,1.59277663 6.24097079,1 7.5,1 L7.5,1 Z M18,7 L6,7 C4.8954305,7 4,7.8954305 4,9 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,9 C20,7.8954305 19.1045695,7 18,7 Z M8.29289322,11.2928932 C8.68341751,10.9023689 9.31658249,10.9023689 9.70710678,11.2928932 L9.70710678,11.2928932 L12,13.5857864 L14.2928932,11.2928932 C14.6834175,10.9023689 15.3165825,10.9023689 15.7071068,11.2928932 C16.0976311,11.6834175 16.0976311,12.3165825 15.7071068,12.7071068 L15.7071068,12.7071068 L12.7071068,15.7071068 C12.3165825,16.0976311 11.6834175,16.0976311 11.2928932,15.7071068 L11.2928932,15.7071068 L8.29289322,12.7071068 C7.90236893,12.3165825 7.90236893,11.6834175 8.29289322,11.2928932 Z M16.5,3 L7.5,3 C6.87048539,3 6.27770876,3.29638831 5.9,3.8 L5.9,3.8 L4.88040369,5.15879948 C5.23567546,5.05542416 5.61136523,5 6,5 L18,5 C18.3882729,5 18.7636249,5.055321 19.1186039,5.15851085 L18.1,3.8 C17.7222912,3.29638831 17.1295146,3 16.5,3 L16.5,3 Z"}),"Archive"),Ca=Object(he.a)(o.a.createElement("path",{d:"M16.5,1 C17.7590292,1 18.9445825,1.59277663 19.7,2.6 L19.7,2.6 L21.2,4.6 C21.7192885,5.29238468 22,6.13451915 22,7 L22,7 L22,8 C22,8.11615513 21.980196,8.22768478 21.9437804,8.33139667 C21.9809544,8.54881122 22,8.77218145 22,9 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,9 C2,8.77218145 2.01904557,8.54881122 2.05563136,8.33139468 C2.01980398,8.22768478 2,8.11615513 2,8 L2,8 L2,7 C2,6.13451915 2.28071149,5.29238468 2.8,4.6 L2.8,4.6 L4.3,2.6 C5.05541753,1.59277663 6.24097079,1 7.5,1 L7.5,1 Z M18,7 L6,7 C4.8954305,7 4,7.8954305 4,9 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,9 C20,7.8954305 19.1045695,7 18,7 Z M12.7071068,10.7928932 L15.7071068,13.7928932 C16.0976311,14.1834175 16.0976311,14.8165825 15.7071068,15.2071068 C15.3165825,15.5976311 14.6834175,15.5976311 14.2928932,15.2071068 L12,12.9142136 L9.70710678,15.2071068 C9.31658249,15.5976311 8.68341751,15.5976311 8.29289322,15.2071068 C7.90236893,14.8165825 7.90236893,14.1834175 8.29289322,13.7928932 L11.2928932,10.7928932 C11.6834175,10.4023689 12.3165825,10.4023689 12.7071068,10.7928932 Z M16.5,3 L7.5,3 C6.87048539,3 6.27770876,3.29638831 5.9,3.8 L5.9,3.8 L4.88040369,5.15879948 C5.23567546,5.05542416 5.61136523,5 6,5 L18,5 C18.3882729,5 18.7636249,5.055321 19.1186039,5.15851085 L18.1,3.8 C17.7222912,3.29638831 17.1295146,3 16.5,3 L16.5,3 Z"}),"Unarchive"),ba=Object(he.a)(o.a.createElement("path",{d:"M18.1483713,2 L18.2928313,2.00686658 C19.0534832,2.07955132 19.6483713,2.72030388 19.6483713,3.5 C19.6483713,3.93788733 19.4570272,4.35391161 19.1245584,4.6388849 L16.9591265,6.49496934 L16.5350978,11.1592857 L19.5076921,14.5034542 C20.0580691,15.1226284 20.002298,16.070737 19.3831238,16.621114 C19.1085471,16.8651821 18.7539493,17 18.3865781,17 L12.9994219,17 L13,22 C13,22.5128358 12.6139598,22.9355072 12.1166211,22.9932723 L12,23 C11.4477153,23 11,22.5522847 11,22 L11,22 L10.9994219,17 L5.61342192,17 C4.7849948,17 4.11342192,16.3284271 4.11342192,15.5 C4.11342192,15.1326288 4.24823977,14.7780309 4.49230794,14.5034542 L7.46490224,11.1592857 L7.04087348,6.49496934 L4.87544164,4.6388849 C4.24645288,4.09975168 4.17361057,3.1528017 4.7127438,2.52381294 C4.9977171,2.19134409 5.41374137,2 5.8516287,2 L18.1483713,2 Z M16.7967426,4 L7.20325741,4 L8.34245623,4.97645613 C8.73788815,5.31539777 8.98550756,5.79522213 9.0326599,6.31389784 L9.45668865,10.9782142 C9.50671685,11.5285243 9.32683472,12.0750103 8.95972088,12.4880133 L6.72684384,15 L17.2731562,15 L15.0402791,12.4880133 C14.6731653,12.0750103 14.4932831,11.5285243 14.5433113,10.9782142 L14.9673401,6.31389784 C15.0144924,5.79522213 15.2621119,5.31539777 15.6575438,4.97645613 L16.7967426,4 Z"}),"Pin2"),va=Object(he.a)(o.a.createElement("g",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(4.000000, 3.000000)"},o.a.createElement("path",{d:"M4.13956059,4.53516651 L12,13 L1.61342192,13 C1.33727955,13 1.11342192,12.7761424 1.11342192,12.5 C1.11342192,12.3775429 1.15836121,12.2593436 1.23971726,12.1678181 L4.21231156,8.8236495 C4.39586848,8.61714796 4.48580955,8.343905 4.46079545,8.06874991 C4.3180244,6.4982684 4.21094612,5.32040727 4.13956059,4.53516651 Z M14.1483713,1.77635684e-15 C14.4245137,1.77635684e-15 14.6483713,0.223857625 14.6483713,0.5 C14.6483713,0.645962444 14.5845899,0.784637202 14.473767,0.879628301 L12.3083351,2.73571273 C12.1106192,2.90518356 11.9868095,3.14509573 11.9632333,3.40443359 C11.817534,5.00712639 11.7082595,6.209146 11.6354098,7.0104924 L5,1.77635684e-15 L14.1483713,1.77635684e-15 Z M8,13 L8,19 M0,0 L16.5,17"})),"PinOff"),Ea=Object(he.a)(o.a.createElement("path",{d:"M13,20 C13.5522847,20 14,20.4477153 14,21 C14,21.5522847 13.5522847,22 13,22 L13,22 L11,22 C10.4477153,22 10,21.5522847 10,21 C10,20.4477153 10.4477153,20 11,20 L11,20 Z M3.30352462,2.28241931 C3.6998335,1.89776658 4.33292796,1.90721575 4.71758069,2.30352462 L4.71758069,2.30352462 L21.2175807,19.3035246 C21.6022334,19.6998335 21.5927842,20.332928 21.1964754,20.7175807 C20.8001665,21.1022334 20.167072,21.0927842 19.7824193,20.6964754 L19.7824193,20.6964754 L18.127874,18.9919007 C18.1241295,18.9923786 18.1203785,18.9928359 18.1166211,18.9932723 L18,19 L4,19 C3.23933773,19 2.77101468,18.1926118 3.11084891,17.5416503 L3.16794971,17.4452998 L5,14.6972244 L5,9 C5,7.98873702 5.21529462,7.00715088 5.62359521,6.10821117 L3.28241931,3.69647538 C2.89776658,3.3001665 2.90721575,2.66707204 3.30352462,2.28241931 Z M7.00817933,8.71121787 L7,9 L7,14.6972244 C7,15.0356672 6.91413188,15.3676193 6.75167088,15.6624466 L6.66410059,15.8066248 L5.86851709,17 L16.1953186,16.9999993 L7.16961011,7.7028948 C7.08210009,8.02986218 7.02771758,8.36725335 7.00817933,8.71121787 Z M12,2 C15.7854517,2 18.8690987,5.00478338 18.995941,8.75935025 L19,9 L19,12 C19,12.5522847 18.5522847,13 18,13 C17.4871642,13 17.0644928,12.6139598 17.0067277,12.1166211 L17,12 L17,9 C17,6.23857625 14.7614237,4 12,4 C11.3902636,4 10.7970241,4.10872043 10.239851,4.31831953 C9.72293204,4.51277572 9.14624852,4.25136798 8.95179232,3.734449 C8.75733613,3.21753002 9.01874387,2.6408465 9.53566285,2.4463903 C10.3171048,2.15242503 11.1488212,2 12,2 Z"}),"Mute"),Sa=Object(he.a)(o.a.createElement("path",{d:"M13,20 C13.5522847,20 14,20.4477153 14,21 C14,21.5522847 13.5522847,22 13,22 L13,22 L11,22 C10.4477153,22 10,21.5522847 10,21 C10,20.4477153 10.4477153,20 11,20 L11,20 Z M12,2 C15.8659932,2 19,5.13400675 19,9 L19,14.6972244 L20.8320503,17.4452998 C21.2750868,18.1098545 20.7986954,19 20,19 L4,19 C3.20130462,19 2.72491322,18.1098545 3.16794971,17.4452998 L5,14.6972244 L5,9 C5,5.13400675 8.13400675,2 12,2 Z M12,4 C9.23857625,4 7,6.23857625 7,9 L7,14.6972244 C7,15.0920743 6.88312395,15.4780897 6.66410059,15.8066248 L5.86851709,17 L18.1314829,17 L17.3358994,15.8066248 C17.1168761,15.4780897 17,15.0920743 17,14.6972244 L17,9 C17,6.23857625 14.7614237,4 12,4 Z"}),"Unmute"),ya=Object(he.a)(o.a.createElement("path",{d:"M12,12 C15.9072418,12 18.715318,13.0364023 20.3351717,15.1788288 C20.7665758,15.7493929 21,16.4451545 21,17.1604559 L21,18.2857143 C21,19.7847729 19.7847729,21 18.2857143,21 L5.71428571,21 C4.21522711,21 3,19.7847729 3,18.2857143 L3,17.160494 C3,16.445199 3.23340019,15.7494497 3.66478123,15.178891 C5.28463457,13.0364199 8.09272555,12 12,12 Z M12,14 C8.66170181,14 6.44476079,14.8182362 5.26012276,16.3850773 C5.09133017,16.6083279 5,16.8805766 5,17.160494 L5,18.2857143 C5,18.6802034 5.31979661,19 5.71428571,19 L18.2857143,19 C18.6802034,19 19,18.6802034 19,18.2857143 L19,17.1604559 C19,16.8805572 18.9086617,16.6083073 18.7398491,16.38504 C17.5552048,14.8182236 15.3382718,14 12,14 Z M12,2 C14.209139,2 16,3.790861 16,6 C16,8.209139 14.209139,10 12,10 C9.790861,10 8,8.209139 8,6 C8,3.790861 9.790861,2 12,2 Z M12,4 C10.8954305,4 10,4.8954305 10,6 C10,7.1045695 10.8954305,8 12,8 C13.1045695,8 14,7.1045695 14,6 C14,4.8954305 13.1045695,4 12,4 Z"}),"User"),Ma=Object(he.a)(o.a.createElement("path",{d:"M8,13 C11.3229116,13 13.7530244,13.8337117 15.2223821,15.5699359 C15.724477,16.1632234 16,16.915291 16,17.6925226 L16,18.5 C16,19.8807119 14.8807119,21 13.5,21 L2.5,21 C1.11928813,21 0,19.8807119 0,18.5 L0,17.6925204 C0,16.9152876 0.275524605,16.1632192 0.777621166,15.569932 C2.24697824,13.8337108 4.67709024,13 8,13 Z M17.9515112,14.0335753 L18.0683205,14.0347288 C20.2213596,14.1802785 21.8813904,14.7876525 23.0130897,15.8958397 C23.5916808,16.4623828 23.9388003,17.2206225 23.9926356,18.0235027 L24,18.2434663 L24,18.75 C24,19.940864 23.0748384,20.9156449 21.9040488,20.9948092 L21.75,21 L19,21 C18.4477153,21 18,20.5522847 18,20 C18,19.4871642 18.3860402,19.0644928 18.8833789,19.0067277 L19,19 L21.75,19 C21.8683467,19 21.9674868,18.9177666 21.9933973,18.8073227 L22,18.75 L22,18.2434663 C22,17.8977921 21.8608093,17.5666871 21.6138154,17.3248364 C20.8641159,16.5907126 19.6490875,16.1461566 17.9334244,16.0301743 C17.3823973,15.9929238 16.9658991,15.5160306 17.0031496,14.9650035 C17.0377394,14.4533355 17.4514089,14.0576643 17.9515112,14.0335753 L17.9515112,14.0335753 Z M8,15 C5.21130036,15 3.33538166,15.6435809 2.30428673,16.861943 C2.10781409,17.0940989 2,17.3883868 2,17.6925212 L2,18.5 C2,18.7761424 2.22385763,19 2.5,19 L13.5,19 C13.7761424,19 14,18.7761424 14,18.5 L14,17.6925226 C14,17.3883883 13.8921864,17.0941004 13.6957148,16.8619448 C12.6646202,15.6435815 10.788701,15 8,15 Z M17,5 C18.9329966,5 20.5,6.56700338 20.5,8.5 C20.5,10.4329966 18.9329966,12 17,12 C15.0670034,12 13.5,10.4329966 13.5,8.5 C13.5,6.56700338 15.0670034,5 17,5 Z M8,3 C10.209139,3 12,4.790861 12,7 C12,9.209139 10.209139,11 8,11 C5.790861,11 4,9.209139 4,7 C4,4.790861 5.790861,3 8,3 Z M17,7 C16.1715729,7 15.5,7.67157288 15.5,8.5 C15.5,9.32842712 16.1715729,10 17,10 C17.8284271,10 18.5,9.32842712 18.5,8.5 C18.5,7.67157288 17.8284271,7 17,7 Z M8,5 C6.8954305,5 6,5.8954305 6,7 C6,8.1045695 6.8954305,9 8,9 C9.1045695,9 10,8.1045695 10,7 C10,5.8954305 9.1045695,5 8,5 Z"}),"Group"),Ia=Object(he.a)(o.a.createElement("path",{d:"M7.41421356,19 L3.87781746,22.5363961 C3.44824074,22.9659728 2.75175926,22.9659728 2.32218254,22.5363961 C2.11589252,22.3301061 2,22.0503168 2,21.7585786 L2,6 C2,3.790861 3.790861,2 6,2 L18,2 C20.209139,2 22,3.790861 22,6 L22,15 C22,17.209139 20.209139,19 18,19 L7.41421356,19 Z M4,19.5857864 L6.20502525,17.3807612 C6.44882255,17.1369639 6.77948263,17 7.12426407,17 L18,17 C19.1045695,17 20,16.1045695 20,15 L20,6 C20,4.8954305 19.1045695,4 18,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,19.5857864 Z"}),"Message"),Ua=Object(he.a)(o.a.createElement("path",{d:"M6,2 L18,2 C20.1421954,2 21.8910789,3.68396847 21.9951047,5.80035966 L22,6 L22,10 C22,10.5522847 21.5522847,11 21,11 C20.4871642,11 20.0644928,10.6139598 20.0067277,10.1166211 L20,10 L20,6 C20,4.9456382 19.1841222,4.08183488 18.1492623,4.00548574 L18,4 L6,4 C4.9456382,4 4.08183488,4.81587779 4.00548574,5.85073766 L4,6 L4,19.5857864 L6.20502525,17.3807612 C6.41399436,17.1717921 6.68678103,17.0413128 6.97757724,17.0082977 L7.12426407,17 L13,17 C13.5522847,17 14,17.4477153 14,18 C14,18.5128358 13.6139598,18.9355072 13.1166211,18.9932723 L13,19 L7.41421356,19 L3.87781746,22.5363961 C3.44824074,22.9659728 2.75175926,22.9659728 2.32218254,22.5363961 C2.14536253,22.3595761 2.034957,22.1287566 2.00702113,21.8826983 L2,21.7585786 L2,6 C2,3.85780461 3.68396847,2.10892112 5.80035966,2.00489531 L6,2 L18,2 L6,2 Z M19,12 C21.209139,12 23,13.790861 23,16 C23,18.209139 21.209139,20 19,20 C16.790861,20 15,18.209139 15,16 C15,13.790861 16.790861,12 19,12 Z M19,14 C17.8954305,14 17,14.8954305 17,16 C17,17.1045695 17.8954305,18 19,18 C20.1045695,18 21,17.1045695 21,16 C21,14.8954305 20.1045695,14 19,14 Z"}),"Unread"),ka=a(175);a(495);class xa extends r.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateChatId=e=>{const t=this.props.chatId;t!==e.previousChatId&&t!==e.nextChatId||this.forceUpdate()},this.handleSelect=e=>{0===e.button&&Object(Q.k)(this.props.chatId)},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,d,h,p,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),n=t.props,i=n.chatId,r=n.chatList,!t.state.contextMenu){e.next=7;break}t.setState({contextMenu:!1}),e.next=23;break;case 7:return o=new Date,xa.contextMenuId=o,l=a.clientX,c=a.clientY,d=Object(F.Z)(i,r),e.next=14,t.canPinChats(i);case 14:if(e.t0=e.sent,e.t0){e.next=17;break}e.t0=d;case 17:if(h=e.t0,p=Object(F.a)(i),u=!Object(F.gb)(i),xa.contextMenuId===o){e.next=22;break}return e.abrupt("return");case 22:t.setState({contextMenu:!0,canTogglePin:h,canToggleArchive:p,canMute:u,left:l,top:c});case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleMute=e=>{this.handleCloseContextMenu(e);const t=this.props.chatId;Object(Pe.k)(t,!Object(F.Y)(t))},this.canPinChats=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.props.chatList,i=Object(F.W)(a)?G.a.get("pinned_archived_chat_count_max"):G.a.get("pinned_chat_count_max")){e.next=4;break}return e.abrupt("return",!1);case 4:return r=Object(F.ab)(a),e.next=7,x.a.send({"@type":"getChats",chat_list:n,offset_order:"9223372036854775807",offset_chat_id:0,limit:i.value+10});case 7:return o=e.sent,l=o.chat_ids.reduce((e,t)=>{if(Object(F.ab)(t)!==r)return e;const a=Se.a.get(t);return e+(a&&Object(F.Z)(a.id,n)?1:0)},0),e.abrupt("return",l<i.value);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handlePin=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleCloseContextMenu(a),n=t.props,i=n.chatId,r=n.chatList,(o=Object(F.Z)(i,r))||t.canPinChats(i)){e.next=5;break}return e.abrupt("return");case 5:Object(Pe.j)(i,r,!o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleArchive=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleCloseContextMenu(a),n=t.props.chatId,Object(F.a)(n)){e.next=4;break}return e.abrupt("return");case 4:Object(Pe.a)(n,{"@type":Object(F.W)(n)?"chatListMain":"chatListArchive"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleViewInfo=e=>{this.handleCloseContextMenu(e);const t=this.props.chatId;Object(Q.k)(t,null,!0)},this.handleRead=e=>{this.handleCloseContextMenu(e);const t=this.props.chatId;if(Object(F.bb)(t)){const e=Se.a.get(t);if(!e)return;const a=e.is_marked_as_unread,n=e.last_message;e.unread_count>0&&n?Object(ka.l)(t,[n.id],!0):a&&Object(Pe.i)(t,!1)}else Object(Pe.i)(t,!0)},this.handleDeleteChat=e=>{this.handleCloseContextMenu(e);const t=this.props.chatId;Object(Pe.e)(t)},this.dialog=o.a.createRef();const a=Se.a.get(this.props.chatId);this.state={chat:a,contextMenu:!1,left:0,top:0}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.t,i=a.hidden,r=a.isLastPinned,o=a.chatList,l=a.style,c=this.state.contextMenu;return e.chatId!==n||(e.t!==s||(e.hidden!==i||(e.isLastPinned!==r||(t.contextMenu!==c||(t.chatList!==o||!(!e.style||!l||l.top===e.style.top))))))}componentDidMount(){ae.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){const e=this.props,t=e.chatId,a=e.chatList,n=e.showSavedMessages,s=e.hidden,i=e.t,r=(e.isLastPinned,e.style),l=this.state,d=l.contextMenu,h=l.left,p=l.top,u=l.canToggleArchive,m=l.canTogglePin,g=l.canMute,f=Object(F.c)(t),C=Object(F.D)(t,i),b=Object(F.Z)(t,a),v=ae.a.getChatId()===t,E=Object(F.Y)(t),S=Object(F.bb)(t),y=Object(F.W)(t);return o.a.createElement(me.a,{button:!0,className:c()("dialog",{"item-selected":v},{"dialog-hidden":s}),onMouseDown:this.handleSelect,onContextMenu:this.handleContextMenu,style:r},o.a.createElement("div",{className:"dialog-wrapper"},o.a.createElement(D.a,{chatId:t,dialog:!0,showSavedMessages:n,showOnline:!0}),o.a.createElement("div",{className:"dialog-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},o.a.createElement(Me,{chatId:t}),o.a.createElement(ga,{chatId:t})),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement(sa,{chatId:t}),o.a.createElement(oa,{chatId:t,chatList:a})))),o.a.createElement(Ge.a,{open:d,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:p,left:h},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},u&&o.a.createElement(We.a,{onClick:this.handleArchive},y?o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(Ca,null)),o.a.createElement(fe.a,{primary:i("Unarchive")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(fa,null)),o.a.createElement(fe.a,{primary:i("Archive")}))),m&&o.a.createElement(We.a,{onClick:this.handlePin},b?o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(va,null)),o.a.createElement(fe.a,{primary:i("UnpinFromTop")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(ba,null)),o.a.createElement(fe.a,{primary:i("PinToTop")}))),o.a.createElement(We.a,{onClick:this.handleViewInfo},o.a.createElement(ge.a,null,Object(F.hb)(t)?o.a.createElement(ya,null):o.a.createElement(Ma,null)),o.a.createElement(fe.a,{primary:Object(F.N)(t,i)})),g&&o.a.createElement(We.a,{onClick:this.handleMute},E?o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(Sa,null)),o.a.createElement(fe.a,{primary:i("ChatsUnmute")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(Ea,null)),o.a.createElement(fe.a,{primary:i("ChatsMute")}))),o.a.createElement(We.a,{onClick:this.handleRead},S?o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(Ia,null)),o.a.createElement(fe.a,{primary:i("MarkAsRead")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(Ua,null)),o.a.createElement(fe.a,{primary:i("MarkAsUnread")}))),f&&C&&o.a.createElement(We.a,{onClick:this.handleDeleteChat},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:C})))))}}xa.defaultProps={hidden:!1,showSavedMessages:!0};var wa=Object(_.a)()(xa);a(496);class Oa extends o.a.Component{render(){const e=this.props,t=e.chatId,a=e.index,n=e.showTitle;let s=null;n&&(s=Object(F.x)(t,!0));const i="".concat(50+10*Math.sin(a),"%"),r="".concat(70+10*Math.cos(a),"%");return o.a.createElement("div",{className:"dialog-placeholder"},o.a.createElement("div",{className:"dialog-placeholder-wrapper"},o.a.createElement("div",{className:"dialog-placeholder-tile"}),o.a.createElement("div",{className:"dialog-placeholder-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},n?s:o.a.createElement("div",{className:"dialog-placeholder-title",style:{width:i}})),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement("div",{className:"dialog-placeholder-content",style:{width:r}})))))}}var La=Oa;a(497);const _a=e=>({height:e,position:"relative"}),Na=(e,t)=>({height:t,left:0,right:0,top:t*e,position:"absolute"});class ja extends o.a.Component{constructor(e){super(e),this.setViewportHeight=()=>{const e=this.props.source,t=this.state.scrollTop,a=this.listRef.current;if(!a)return;const n=parseFloat(window.getComputedStyle(a,null).getPropertyValue("height")),s=this.getRenderIds(e,n,t);this.setState(Object(Ve.a)({viewportHeight:n},s))},this.setScrollPosition=e=>{const t=this.props,a=t.source,n=t.rowHeight,s=t.onScroll,i=this.state,r=i.viewportHeight,o=i.scrollTop;if(Math.abs(e.target.scrollTop-o)>=n){const t=this.getRenderIds(a,r,e.target.scrollTop);this.setState(Object(Ve.a)({scrollTop:e.target.scrollTop},t))}s&&s(e)},this.isVisibleItem=(e,t,a)=>{const n=this.props,s=n.overScanCount,i=n.rowHeight;return e*i>a-s*i&&(e+1)*i<a+t+s*i},this.listRef=o.a.createRef(),this.state={scrollTop:0,renderIds:new Map,renderIdsList:[],viewportHeight:0}}componentDidUpdate(e,t,a){e.source!==this.props.source&&this.setViewportHeight()}shouldComponentUpdate(e,t,a){return!0}componentDidMount(){window.addEventListener("resize",this.setViewportHeight,!0);const e=this.listRef.current;e&&(e.addEventListener("scroll",this.setScrollPosition,!0),this.setViewportHeight())}getRenderIds(e,t,a){const n=new Map,s=[];return e.forEach((e,i)=>{this.isVisibleItem(i,t,a)&&(n.set(i,i),s.push(i))}),{renderIds:n,renderIdsList:s}}componentWillUnmount(){window.removeEventListener("resize",this.setViewportHeight);const e=this.listRef.current;e&&e.removeEventListener("scroll",this.setScrollPosition)}getListRenderIds(){return this.state.renderIds}getListRef(){return this.listRef}render(){const e=this.props,t=e.className,a=e.source,n=e.renderItem,s=e.rowHeight,i=this.state.renderIds,r=(a||[]).map((e,t)=>i.has(t)&&n({index:t,style:Na(t,s)}));return o.a.createElement("div",{ref:this.listRef,className:c()("vlist",t)},o.a.createElement("div",{style:_a((a||[]).length*s)},r))}}ja.defaultProps={source:[],rowHeight:72,overScanCount:5};var Pa=ja;function Ta(e){if(e.nodeType===Node.TEXT_NODE)return e;for(let t=e.childNodes.length-1;t>=0;t--){const a=Ta(e.childNodes[t]);if(a)return a}return null}function Ra(e){if(!e)return;const t=Ta(e);if(t){const e=document.createRange();e.setStart(t,t.length),e.collapse(!0);const a=window.getSelection();a.removeAllRanges(),a.addRange(e)}e.focus()}function Da(e,t="smooth"){e&&(e.scrollTop=Math.min(e.scrollTop,50),setTimeout(()=>{e.scrollTo({top:0,behavior:t})},1))}a(498);var Fa=a(177),Aa=a(240),Ba=Object(he.a)(o.a.createElement("path",{d:"M18.5,1.6784749 C19.8807119,1.6784749 21,2.79776303 21,4.1784749 L21,19.8215251 C21,20.4013736 20.7984395,20.9631907 20.4298256,21.4107932 C19.552097,22.4766065 17.9765451,22.6290792 16.9107319,21.7513507 L12,17.7064749 L12,19.5 C12,21.0976809 10.75108,22.4036609 9.17627279,22.4949073 L9,22.5 C7.34314575,22.5 6,21.1568542 6,19.5 L6,19.5 L5.99981203,16.8999437 C3.71766536,16.4366008 2,14.4188915 2,12 C2,9.23857625 4.23857625,7 7,7 L11.1412346,7 L16.9107319,2.24864931 C17.3583344,1.88003543 17.9201515,1.6784749 18.5,1.6784749 Z M8,19.5 C8,20.0522847 8.44771525,20.5 9,20.5 C9.55228475,20.5 10,20.0522847 10,19.5 L10,19.5 L10,16.9994749 L8,16.9994749 Z M18.5,3.6784749 C18.3840303,3.6784749 18.2716669,3.71878701 18.1821464,3.79250978 L12.4126491,8.54386047 C12.054567,8.83875158 11.6051134,9 11.1412346,9 L7,9 C5.34314575,9 4,10.3431458 4,12 C4,13.6568542 5.34314575,15 7,15 L11.1412346,15 C11.6051134,15 12.054567,15.1612484 12.4126491,15.4561395 L18.1821464,20.2074902 C18.395309,20.3830359 18.7104194,20.3525414 18.8859651,20.1393787 C18.9596879,20.0498582 19,19.9374948 19,19.8215251 L19,4.1784749 C19,3.90233253 18.7761424,3.6784749 18.5,3.6784749 Z"}),"Channel"),Ha=Object(he.a)(o.a.createElement("path",{d:"M4,16 L20,16 C20.5522847,16 21,16.4477153 21,17 C21,17.5128358 20.6139598,17.9355072 20.1166211,17.9932723 L20,18 L4,18 C3.44771525,18 3,17.5522847 3,17 C3,16.4871642 3.38604019,16.0644928 3.88337887,16.0067277 L4,16 L20,16 L4,16 Z M4,11 L20,11 C20.5522847,11 21,11.4477153 21,12 C21,12.5128358 20.6139598,12.9355072 20.1166211,12.9932723 L20,13 L4,13 C3.44771525,13 3,12.5522847 3,12 C3,11.4871642 3.38604019,11.0644928 3.88337887,11.0067277 L4,11 Z M4,6 L20,6 C20.5522847,6 21,6.44771525 21,7 C21,7.51283584 20.6139598,7.93550716 20.1166211,7.99327227 L20,8 L4,8 C3.44771525,8 3,7.55228475 3,7 C3,6.48716416 3.38604019,6.06449284 3.88337887,6.00672773 L4,6 Z"}),"Menu"),Va=Object(he.a)(o.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M11.9779053,15.294165 C12.6523978,15.294165 13.1985107,15.8124506 13.1985107,16.4732666 C13.1985107,17.1238794 12.6418359,17.6523682 11.9779053,17.6523682 C11.3175981,17.6523682 10.7572998,17.1168932 10.7572998,16.4732666 C10.7572998,15.8194152 11.3070616,15.294165 11.9779053,15.294165 Z M12.3306885,6.9 C14.2795758,6.9 15.719873,7.96860761 15.719873,9.65625 C15.719873,10.6709643 15.2884676,11.3128276 14.2962576,12.0165438 L13.7962596,12.3573922 C13.1714716,12.7953495 12.9391113,13.1198405 12.9391113,13.5887451 L12.9391113,13.7132568 C12.9391113,14.2033083 12.5618823,14.5499512 11.9986572,14.5499512 C11.4068652,14.5499512 11.0789551,14.2281702 11.0789551,13.630249 L11.0789551,13.4953613 C11.0789551,12.5573197 11.487326,11.9745882 12.4189711,11.3276124 L12.7619755,11.0871498 C13.5110635,10.5470305 13.7248291,10.2540011 13.7248291,9.73925781 C13.7248291,8.99900037 13.149745,8.51113281 12.2580566,8.51113281 C11.6278214,8.51113281 11.1498312,8.8062186 10.7980484,9.38963394 L10.5277106,9.73161327 L10.5277106,9.73161327 L10.4428973,9.8298462 C10.2452762,10.0412654 10.0433297,10.1297852 9.70556641,10.1297852 C9.27040611,10.1297852 8.9,9.79174463 8.9,9.31384277 C8.9,9.13743147 8.92867764,8.96536563 8.98734042,8.76592778 C9.31829759,7.6784971 10.623966,6.9 12.3306885,6.9 Z"}),"Help"),za=a(219),Wa=Object(he.a)(o.a.createElement("path",{d:"M13.4542714,1 C14.5034049,1 15.447759,1.80035641 15.6254934,2.83409123 L15.8863908,4.35151652 C16.4016786,4.58533298 16.8892685,4.86975342 17.3418997,5.20083722 L18.729489,4.68523838 C19.7215225,4.31661974 20.8874905,4.74674629 21.4093705,5.66596818 L22.3631385,7.34590292 C22.8807104,8.25753682 22.6641696,9.47960173 21.8668015,10.158283 L20.7203437,11.1340925 C20.7523279,11.4263818 20.768775,11.713662 20.768775,12 C20.768775,12.2863013 20.7523321,12.5735444 20.7203561,12.8657949 L21.8666717,13.8411466 C22.6665193,14.5217032 22.8803536,15.7423983 22.3631806,16.6535107 L21.4094127,18.3337799 C20.8871999,19.2537711 19.7186485,19.6823124 18.729489,19.3147616 L17.3418997,18.7991628 C16.8892685,19.1302466 16.4016786,19.414667 15.8863908,19.6484835 L15.6254934,21.1659088 C15.4482371,22.1968626 14.500959,23 13.4542714,23 L11.5464067,23 C10.4973482,23 9.55294448,22.1997516 9.37499917,21.1661206 L9.11371177,19.6483803 C8.59870239,19.4145642 8.11116816,19.1301583 7.65836517,18.7991106 L6.27103566,19.3147347 C5.27906015,19.683419 4.11313098,19.25315 3.59116388,18.3339086 L2.63706709,16.6536394 C2.11936149,15.741903 2.33579039,14.5197379 3.13332831,13.8411466 L4.27990265,12.8655748 C4.24777315,12.5724368 4.23122501,12.2856623 4.23122501,12 C4.23122501,11.7143012 4.24777739,11.4274899 4.27991498,11.1343127 L3.1331985,10.158283 C2.33341387,9.47754488 2.11971252,8.25678535 2.6371093,7.34577419 L3.59120609,5.66583945 C4.11357343,4.74607633 5.28204594,4.31769072 6.27103566,4.68526527 L7.65836517,5.20088944 C8.02060756,4.93605128 8.40507795,4.70106385 8.80806121,4.49794854 L9.11371177,4.35161967 L9.37499917,2.83387942 C9.55246572,1.80302941 10.4997942,1 11.5464067,1 L13.4542714,1 Z M13.4542714,3 L11.5464067,3 C11.4759721,3 11.3587093,3.09940116 11.3460046,3.17319893 L10.9911423,5.23448734 C10.9307198,5.5854636 10.6881938,5.87781899 10.3544182,6.00203275 C9.66471384,6.25870451 9.03276419,6.62813555 8.48454956,7.09507573 C8.20871593,7.3300162 7.82737524,7.39737412 7.48774669,7.2711455 L5.57427032,6.55997006 C5.50662795,6.53482964 5.36908018,6.58525743 5.33030218,6.65353615 L4.37620539,8.3334709 C4.33235155,8.41068695 4.36153792,8.57741281 4.42951339,8.63527025 L5.99467372,9.96745916 C6.26327177,10.1960769 6.39156502,10.5492878 6.3322987,10.8969923 C6.26535074,11.2897637 6.23122501,11.6509097 6.23122501,12 C6.23122501,12.3490903 6.26535074,12.7102363 6.3322987,13.1030077 C6.39157523,13.4507721 6.26322722,13.80404 5.99454391,14.0326513 L4.42938358,15.3643802 C4.36263141,15.4211768 4.33280785,15.5895892 4.3762476,15.6660914 L5.33034439,17.3463606 C5.36962791,17.4155432 5.5053715,17.4656373 5.57427032,17.4400299 L7.48774669,16.7288545 C7.82737524,16.6026259 8.20871593,16.6699838 8.48454956,16.9049243 C9.03276419,17.3718644 9.66471384,17.7412955 10.3544182,17.9979673 C10.6881938,18.122181 10.9307198,18.4145364 10.9911423,18.7655127 L11.3460046,20.8268011 C11.3591616,20.9032262 11.473368,21 11.5464067,21 L13.4542714,21 C13.5246311,21 13.6417446,20.9007069 13.6544151,20.8270129 L14.0088212,18.7657245 C14.0691981,18.4145617 14.3118672,18.1220527 14.6458423,17.9978703 C15.3359969,17.7412494 15.9677081,17.3719578 16.5150513,16.9052644 C16.7908836,16.6700754 17.1723926,16.6025695 17.512181,16.7288276 L19.4261097,17.4400031 C19.4938321,17.4651673 19.631347,17.4147366 19.6700861,17.3464893 L20.623854,15.6662201 C20.6677382,15.5889085 20.6385289,15.422164 20.5706164,15.3643802 L19.0054561,14.0326513 C18.7363402,13.803672 18.6080436,13.4496677 18.6679701,13.1014383 C18.7347206,12.7135552 18.768775,12.3516302 18.768775,12 C18.768775,11.6483698 18.7347206,11.2864448 18.6679701,10.8985617 C18.6080539,10.5503923 18.7362957,10.196445 19.0053263,9.96745916 L20.5704866,8.63527025 C20.6374086,8.57830946 20.6672761,8.40975011 20.6238962,8.33334216 L19.6701283,6.65340742 C19.6309511,6.58440211 19.4952014,6.53432393 19.4261097,6.55999695 L17.512181,7.27117239 C17.1723926,7.39743055 16.7908836,7.32992456 16.5150513,7.09473562 C15.9677081,6.62804223 15.3359969,6.25875055 14.6458423,6.00212967 C14.3118672,5.87794735 14.0691981,5.58543825 14.0088212,5.23427554 L13.6544151,3.17298713 C13.6412929,3.0966658 13.5272352,3 13.4542714,3 Z M12.5,10 C13.6045695,10 14.5,10.8954305 14.5,12 C14.5,13.1045695 13.6045695,14 12.5,14 C11.3954305,14 10.5,13.1045695 10.5,12 C10.5,10.8954305 11.3954305,10 12.5,10 Z"}),"Settings"),Ga=a(29);var Za=new class{load(e){return Object(i.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=localStorage.getItem(e)){t.next=3;break}return t.abrupt("return",null);case 3:return t.prev=3,t.abrupt("return",JSON.parse(a));case 7:return t.prev=7,t.t0=t.catch(3),t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[3,7]])})))()}save(e,t){return Object(i.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:localStorage.setItem(e,JSON.stringify(t));case 1:case"end":return a.stop()}}),a)})))()}remove(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:localStorage.removeItem(e);case 1:case"end":return t.stop()}}),t)})))()}clear(){return Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.clear();case 1:case"end":return e.stop()}}),e)})))()}};class qa extends Ga.a{constructor(){super(),this.reset=()=>{this.filters=null,this.chatIds=[],this.archiveChatIds=[],this.meChat=null,this.cacheContacts&&(this.contacts=null),this.cache=null},this.onUpdate=e=>{switch(e["@type"]){case"updateAuthorizationState":{const t=e.authorization_state;if(!t)break;switch(t["@type"]){case"authorizationStateClosed":this.reset(),this.clear();break;case"authorizationStateLoggingOut":case"authorizationStateWaitCode":case"authorizationStateWaitPhoneNumber":case"authorizationStateWaitPassword":case"authorizationStateWaitRegistration":Za.remove("cache"),Za.remove("files"),this.cacheContacts&&Za.remove("contacts")}break}}},this.onClientUpdate=e=>{switch(e["@type"]){case"clientUpdateDialogsReady":this.clearDataUrls()}},this.addTdLibListener=()=>{x.a.on("update",this.onUpdate),x.a.on("clientUpdate",this.onClientUpdate)},this.removeTdLibListener=()=>{x.a.off("update",this.onUpdate),x.a.off("clientUpdate",this.onClientUpdate)},this.cacheContacts=!1,this.reset(),this.addTdLibListener(),this.saveInternal=Object(M.e)(this.saveInternal,2e3)}load(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o,l,c,d,h,p;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=[]).push(Za.load("cache").catch(e=>null)),a.push(Za.load("files").catch(e=>null)),a.push(Za.load("filters").catch(e=>null)),e.cacheContacts&&a.push(Za.load("contacts").catch(e=>null)),t.next=7,Promise.all(a);case 7:if(n=t.sent,i=Object(L.a)(n,4),r=i[0],o=i[1],l=i[2],c=i[3],d=!1,!r||!r.chats){t.next=24;break}h=0;case 16:if(!(h<r.chats.length)){t.next=24;break}if(!(p=r.chats[h].last_message)||!p.sender_user_id){t.next=21;break}return d=!0,t.abrupt("break",24);case 21:h++,t.next=16;break;case 24:return d&&(r=null),e.cache=r,e.cache&&(e.cache.files=o||[]),e.cacheContacts&&c&&((c||[]).forEach(e=>{te.a.set(e)}),e.contacts={"@type":"users",user_ids:c.map(e=>e.id),total_count:c.length}),e.filters=l,e.cache&&e.parseCache(e.cache),t.abrupt("return",e.cache);case 31:case"end":return t.stop()}}),t)})))()}parseCache(e){if(!e)return;const t=e.meChat,a=e.chats,n=e.archiveChats,s=e.users,i=e.basicGroups,r=e.supergroups,o=e.files,l=e.options;(o||[]).filter(e=>Boolean(e)).forEach(({id:e,url:t})=>{U.a.setDataUrl(e,t)}),(s||[]).forEach(e=>{te.a.set(e)}),(i||[]).forEach(e=>{Ie.a.set(e)}),(r||[]).forEach(e=>{Ue.a.set(e)}),(a||[]).concat(n||[]).concat([t]).forEach(e=>{e&&(delete e.OutputTypingManager,Se.a.set(e),e.photo&&(e.photo.small&&U.a.set(e.photo.small),e.photo.big&&U.a.set(e.photo.big)),e.position&&Se.a.updateChatChatLists(e.id),e.last_message&&ee.a.set(e.last_message))}),(l||[]).forEach(([e,t])=>{G.a.set(e,t)})}getCache(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l,c,d,h,p;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new Map,r=new Map,o=new Map,l=new Map,c=a.meChat,d=e.map(e=>Se.a.get(e)),h=new Map(d.map(e=>[e.id,e])),p=t.map(e=>Se.a.get(e)),d.concat(p).concat([c]).forEach(e=>{const t=e.photo,a=e.type,n=e.last_message;if(t&&t.small){const e=t.small.id;if(e){const t=U.a.getBlob(e);t&&i.set(e,t)}}switch(a["@type"]){case"chatTypeBasicGroup":{const e=Ie.a.get(a.basic_group_id);e&&o.set(e.id,e)}case"chatTypePrivate":case"chatTypeSecret":{const e=te.a.get(a.user_id);e&&r.set(e.id,e)}case"chatTypeSupergroup":{const e=Ue.a.get(a.supergroup_id);e&&l.set(e.id,e)}}if(n){const e=n.sender;switch(e["@type"]){case"messageSenderUser":{const t=te.a.get(e.user_id);t&&r.set(t.id,t);break}case"messageSenderChat":{const t=Se.a.get(e.chat_id);t&&h.set(t.id,t);break}}}}),n.abrupt("return",{date:new Date,meChat:c,chats:[...h.values()],archiveChats:p,users:[...r.values()],basicGroups:[...o.values()],supergroups:[...l.values()],files:[...i.entries()],options:[...G.a.items.entries()]});case 10:case"end":return n.stop()}}),n)})))()}save(e,t,a){var n=this;return Object(i.a)(s.a.mark((function i(){return s.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(n.chatIds=t,n.archiveChatIds=a,s.t0=n.meChat,s.t0){s.next=7;break}return s.next=6,x.a.send({"@type":"createPrivateChat",user_id:te.a.getMyId(),force:!1});case 6:s.t0=s.sent;case 7:if(n.meChat=s.t0,!n.cacheContacts){s.next=15;break}if(s.t1=n.contacts,s.t1){s.next=14;break}return s.next=13,x.a.send({"@type":"getContacts"});case 13:s.t1=s.sent;case 14:n.contacts=s.t1;case 15:n.filters=e,n.saveInternal();case 17:case"end":return s.stop()}}),i)})))()}saveInternal(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCache(e.chatIds,e.archiveChatIds);case 2:return a=t.sent,n=a.files,a.files=[],t.next=7,Za.save("cache",a);case 7:return i=[],n.forEach(e=>{const t=Object(L.a)(e,2),a=t[0],n=t[1];i.push(new Promise((e,t)=>{const s=new FileReader;s.readAsDataURL(n),s.onload=t=>{e({id:a,url:t.target.result})},s.onerror=t=>{e(null)}}))}),t.next=11,Promise.all(i);case 11:return r=t.sent,t.next=14,Za.save("files",r);case 14:if(!e.cacheContacts){t.next=18;break}return o=e.contacts.user_ids.map(e=>te.a.get(e)),t.next=18,Za.save("contacts",o);case 18:if(!e.filters){t.next=21;break}return t.next=21,Za.save("filters",e.filters);case 21:case"end":return t.stop()}}),t)})))()}clear(){const e=[];e.push(Za.remove("cache").catch(e=>null)),e.push(Za.remove("files").catch(e=>null)),e.push(Za.remove("filters").catch(e=>null)),e.push(Za.remove("contacts").catch(e=>null)),e.push(Za.remove("register").catch(e=>null)),Promise.all(e)}clearDataUrls(){if(this.cache){this.cache.files.forEach(({id:e,url:t})=>{U.a.deleteDataUrl(e)})}}}const Ka=new qa;window.cache=Ka;var Ya=Ka;a(499);class Ja extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePageWidth=e=>{const t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.handleMenuOpen=e=>{const t=this.state.authorizationState;Object(M.t)(t)&&this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleCheckUpdates=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.handleMenuClose();case 1:case"end":return e.stop()}}),e)}))),this.handleNewChannel=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateNewChannel",open:!0})},this.handleNewGroup=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!0})},this.handleContacts=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateContacts",open:!0})},this.handleArchived=e=>{this.handleMenuClose(),Object(Q.j)()},this.handleSaved=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleMenuClose(),n=Ya.cache?Ya.cache.meChat:null){e.next=6;break}return e.next=5,x.a.send({"@type":"createPrivateChat",user_id:te.a.getMyId(),force:!1});case 5:n=e.sent;case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:Object(Q.k)(n.id);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSettings=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleMenuClose(),n=Ya.cache?Ya.cache.meChat:null){e.next=6;break}return e.next=5,x.a.send({"@type":"createPrivateChat",user_id:te.a.getMyId(),force:!1});case 5:n=e.sent;case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:x.a.clientUpdate({"@type":"clientUpdateSettings",open:!0,chatId:n.id});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleHelp=function(){var e=Object(i.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.handleMenuClose();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSearch=()=>{this.handleMenuClose(),Object(Q.q)(0)},this.state={authorizationState:ae.a.getAuthorizationState(),anchorEl:null,isSmallWidth:ae.a.isSmallWidth}}componentDidMount(){ae.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){ae.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}render(){const e=this.props,t=e.t,a=e.timeout,n=e.popup,s=e.showClose,i=e.onClose,r=this.state,l=r.anchorEl,c=r.authorizationState,d=r.isSmallWidth,h=!s&&Object(M.t)(c)?o.a.createElement(Aa.a,{id:"main-menu",anchorEl:l,open:Boolean(l),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"left"}},o.a.createElement(We.a,{onClick:this.handleNewChannel},o.a.createElement(ge.a,null,o.a.createElement(Ba,null)),o.a.createElement(fe.a,{primary:t("NewChannel")})),o.a.createElement(We.a,{onClick:this.handleNewGroup},o.a.createElement(ge.a,null,o.a.createElement(Ma,null)),o.a.createElement(fe.a,{primary:t("NewGroup")})),d&&o.a.createElement(We.a,{onClick:this.handleSearch},o.a.createElement(ge.a,null,o.a.createElement(Lt,null)),o.a.createElement(fe.a,{primary:t("Search")})),o.a.createElement(We.a,{onClick:this.handleContacts},o.a.createElement(ge.a,null,o.a.createElement(ya,null)),o.a.createElement(fe.a,{primary:t("Contacts")})),o.a.createElement(We.a,{onClick:this.handleArchived},o.a.createElement(ge.a,null,o.a.createElement(fa,null)),o.a.createElement(fe.a,{primary:t("Archived")})),o.a.createElement(We.a,{onClick:this.handleSaved},o.a.createElement(ge.a,null,o.a.createElement(za.a,null)),o.a.createElement(fe.a,{primary:t("Saved")})),o.a.createElement(We.a,{onClick:this.handleSettings},o.a.createElement(ge.a,null,o.a.createElement(Wa,null)),o.a.createElement(fe.a,{primary:t("Settings")})),o.a.createElement(We.a,{onClick:this.handleHelp},o.a.createElement(ge.a,null,o.a.createElement(Va,null)),o.a.createElement(fe.a,{primary:t("SettingsHelp")}))):null,p=n?o.a.createElement(f.a,null):o.a.createElement(Le,null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{"aria-owns":l?"simple-menu":null,"aria-haspopup":"true",className:"header-left-button main-menu-button","aria-label":"Menu",onClick:s?i:this.handleMenuOpen},a?o.a.createElement(_t.a,{open:s,openIcon:o.a.createElement(Le,null),icon:o.a.createElement(Ha,null)}):o.a.createElement(o.a.Fragment,null,s?p:o.a.createElement(Ha,null))),h)}}var Xa=Object(_.a)()(Ja);a(500);class Qa extends o.a.Component{constructor(...e){super(...e),this.handleKeyDown=e=>{if(13===e.keyCode)e.preventDefault();else if(27===e.keyCode){const t=this.props,a=t.onChange,n=t.onClose,s=e.target;if(!s)return;if(s.innerText)return e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),s.innerText=null,void(a&&a(s.innerText));n&&n(e)}else if(8===e.keyCode){const t=this.props.onBackspace,a=e.target;if(!a)return;if(a.innerText)return;t&&(e.stopPropagation(),t())}},this.handleKeyUp=e=>{const t=e.target;if(!t)return;const a=t.innerHTML;"<br>"!==a&&"<div><br></div>"!==a||(t.innerHTML=null)},this.handlePaste=e=>{const t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleInput=e=>{const t=this.props.onChange,a=e.target;a&&t&&t(a.innerText)}}render(){const e=this.props,t=e.inputRef,a=e.t,n=e.onFocus,s=e.hint,i=e.showIcon;return o.a.createElement("div",{className:"search-input"},o.a.createElement("div",{id:"search-inputbox",ref:t,placeholder:s||a("Search"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,onInput:this.handleInput,onFocus:n}),i&&o.a.createElement(Lt,{className:"search-input-icon"}))}}Qa.defaultProps={showIcon:!0};var $a=Object(_.a)()(Qa);a(441);class en extends o.a.Component{constructor(e){super(e),this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.handleSearch=()=>{const e=this.props,t=e.onSearch,a=e.openSearch,n=this.state.authorizationState;Object(M.t)(n)&&t(!a)},this.handleSearchTextChange=()=>{const e=this.props.onSearchTextChange,t=this.searchInputRef.current;if(!t)return;const a=t.innerHTML;"<br>"!==a&&"<div><br></div>"!==a||(t.innerHTML=null);e(t.innerText)},this.handleCloseSearch=()=>{this.handleSearch()},this.handleFocus=()=>{this.handleSearch()},this.searchInputRef=o.a.createRef(),this.state={authorizationState:ae.a.getAuthorizationState(),open:!1}}setInitQuery(e){const t=this.props.onSearchTextChange,a=this.searchInputRef.current;if(a){if(a.innerText=e,a.childNodes.length>0){const e=document.createRange();e.setStart(a.childNodes[0],a.childNodes[0].length),e.collapse(!0);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}a.focus(),t(e)}}componentDidUpdate(e,t,a){const n=this.props.openSearch;if(n!==e.openSearch)if(n)this.focusInput();else{const e=this.searchInputRef.current;e&&(e.innerText=null)}}focusInput(){const e=this.searchInputRef.current;e&&e.focus()}componentDidMount(){this.props.popup&&this.focusInput(),ae.a.on("updateAuthorizationState",this.onUpdateAuthorizationState)}componentWillUnmount(){ae.a.off("updateAuthorizationState",this.onUpdateAuthorizationState)}render(){const e=this.props,t=e.openSearch,a=e.timeout,n=e.popup;let s=null,i=!1;return t?(i=!0,s=o.a.createElement($a,{inputRef:this.searchInputRef,onChange:this.handleSearchTextChange,onClose:this.handleCloseSearch})):s=o.a.createElement($a,{inputRef:this.searchInputRef,onFocus:this.handleFocus}),o.a.createElement("div",{className:"header-master"},o.a.createElement(Xa,{timeout:a,showClose:i,popup:n,onClose:this.handleCloseSearch}),s)}}var tn=en,an=a(4);a(501);class nn extends o.a.Component{constructor(e){super(e),this.hasObserver=()=>"ResizeObserver"in window,this.onClientUpdateLanguageChange=e=>{this.hasObserver()||this.setSelection(!1)},this.onClientUpdateCacheLoaded=e=>{if(this.state.filters)return;const t=Ya.filters;t&&this.setState({filters:t},()=>{this.hasObserver()||this.setSelection(!1)})},this.onWindowResize=()=>{this.setSelection(!0)},this.onClientUpdatePageWidth=e=>{const t=ae.a.isSmallWidth;this.setState({isSmallWidth:t},()=>{this.hasObserver()||this.setSelection(!1)})},this.setSelection=(e=!0)=>{const t=this.state,a=t.chatList,n=t.filters,s=(t.isSmallWidth,this.filtersRef.current);let i=null,r=9;if("chatListMain"===a["@type"]){const e=this.filterRef.get("chatListMain");e&&(i=e.firstChild,r=i.offsetLeft)}else if("chatListFilter"===a["@type"])for(let l=0;l<n.length;l++){const e=this.filterRef.get("chatListFilter_id="+n[l].id);if(n[l].id===a.chat_filter_id){i=e.firstChild,r=i.offsetLeft;break}}if(!i)return;const o=this.filterSelectionRef.current;if(o){const t=e?"transition: left 0.25s ease, width 0.25s ease":null;o.style.cssText="left: ".concat(r-3,"px; width: ").concat(i.scrollWidth+6,"px; ").concat(t)}if(i&&e){const e=this.animator;e&&e.stop(),this.animator=new Ae.a(250,[{from:s.scrollLeft,to:Object(M.d)(r-s.offsetWidth/2+i.offsetWidth/2,0,s.scrollWidth-s.offsetWidth),func:e=>s.scrollLeft=e}]),setTimeout(()=>{this.animator&&this.animator.start()},0)}},this.onUpdateChatFilters=e=>{const t=this.state.chatList,a=Fa.a.filters;this.setState({filters:a},()=>{"chatListFilter"===t["@type"]&&-1===a.findIndex(e=>e.id===t.chat_filter_id)?this.handleMainClick():this.hasObserver()||this.setSelection()})},this.onClientUpdateChatList=e=>{const t=Fa.a.chatList;this.setState({chatList:t},()=>{this.hasObserver()||this.setSelection()})},this.handleMainClick=e=>{e&&0!==e.button||Object(Pe.f)({"@type":"chatListMain"})},this.handleFilterClick=(e,t)=>{e&&0!==e.button||Object(Pe.f)({"@type":"chatListFilter",chat_filter_id:t})},this.handleWheel=e=>{e.deltaY&&(e.currentTarget.scrollLeft+=e.deltaY,e.stopPropagation())},this.filterRef=new Map,this.filtersRef=o.a.createRef(),this.filterSelectionRef=o.a.createRef();const t=ae.a.isSmallWidth,a=Fa.a.filters,n=Fa.a.chatList;this.state={isSmallWidth:t,filters:a,chatList:n},this.onWindowResize=Object(M.C)(this.onWindowResize,250)}componentDidMount(){this.observeResize(),ae.a.on("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),Fa.a.on("clientUpdateChatList",this.onClientUpdateChatList),Fa.a.on("updateChatFilters",this.onUpdateChatFilters),an.a.on("clientUpdateLanguageChange",this.onClientUpdateLanguageChange),this.setSelection()}componentDidUpdate(e,t,a){this.unobserveResize(),this.observeResize()}componentWillUnmount(){this.unobserveResize(),ae.a.off("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),Fa.a.off("clientUpdateChatList",this.onClientUpdateChatList),Fa.a.off("updateChatFilters",this.onUpdateChatFilters),an.a.off("clientUpdateLanguageChange",this.onClientUpdateLanguageChange)}observeResize(){if(!this.hasObserver())return;const e=this.filtersRef.current;if(!e)return;const t=new ResizeObserver(this.onWindowResize);t.observe(e),this.resizeObserver={observer:t,filters:e}}unobserveResize(){if(!this.hasObserver())return;if(!this.resizeObserver)return;const e=this.resizeObserver,t=e.observer,a=e.filters;t&&a&&t.unobserve(a)}render(){const e=this.props.t,t=this.state,a=t.filters,n=t.chatList,s=t.isSmallWidth;return a&&a.length?(this.filterRef=new Map,o.a.createElement("div",{className:"tabs"},o.a.createElement("div",{className:"tabs-bottom-border"}),o.a.createElement("div",{ref:this.filtersRef,className:"filters",onWheel:this.handleWheel},o.a.createElement("div",{ref:e=>this.filterRef.set("chatListMain",e),className:c()("filter",{"item-selected":"chatListMain"===n["@type"]}),onMouseDown:this.handleMainClick,title:s?e("FilterAllChats"):null},o.a.createElement("span",null,s?Object(M.h)(e("FilterAllChats")):e("FilterAllChats"))),a.map(e=>o.a.createElement("div",{key:e.id,ref:t=>this.filterRef.set("chatListFilter_id="+e.id,t),className:c()("filter",{"item-selected":n.chat_filter_id===e.id}),onMouseDown:t=>this.handleFilterClick(t,e.id),title:s?e.title:null},o.a.createElement("span",null,s?Object(M.h)(e.title):e.title))),o.a.createElement("div",{ref:this.filterSelectionRef,className:"filter-selection"})))):null}}var sn=Object(_.a)()(nn);class rn extends o.a.Component{shouldComponentUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.chatList,r=n.style,o=n.hidden;return e.chatId!==s||(e.chatList!==i||(e.hidden!==o||e.style.top!==r.top))}render(){const e=this.props,t=e.chatId,a=e.chatList,n=e.hidden,s=e.style;return o.a.createElement("div",{className:"dialog-list-item",style:s},o.a.createElement(wa,{chatId:t,chatList:a,hidden:n}))}}class on extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateChatList=e=>{const t=e.chatList;Object(F.i)(this.state.chatList,t)?this.scrollToTop():this.setState({chatList:t,params:{loading:!1,completed:!1}},()=>{this.loadFirstSlice()})},this.onUpdateSupergroup=e=>{},this.onClientUpdateLeaveChat=e=>{const t=e.inProgress,a=e.chatId;t?this.hiddenChats.set(a,a):this.hiddenChats.delete(a),this.forceUpdate()},this.onUpdateAuthorizationState=e=>{const t=e.authorization_state;this.setState({authorizationState:t},()=>this.loadFirstSlice())},this.onFastUpdatingComplete=e=>{this.onLoadNext(!0)},this.loadFirstSlice=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.authorizationState,Object(M.t)(a)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,U.a.initDB(()=>t.onLoadNext(!0));case 5:case"end":return e.stop()}}),e)}))),this.saveCache=()=>{const e=this.props,t=e.onSaveCache,a=e.type,n=this.state.chatList;"chatListMain"===a&&"chatListMain"===n["@type"]&&t&&t()},this.onUpdateChatPosition=e=>{const t=this.state.chatList,a=e.position;Object(F.i)(t,a.list)&&this.onUpdateChatOrder(e)},this.onUpdateChatOrder=e=>{const t=this.state,a=t.chats,n=t.chatList,s=t.params;if(!a)return;const i=s.loading;if(i&&!a.length)return;const r=e.chat_id,o=Se.a.get(r);if(!o)return;if(!Object(F.P)(r,n))return;const l=Object(F.r)(r,n),c=a.findIndex(e=>e===r);if(-1===c&&"0"===l)return;const d=[];for(let p=0;p<a.length;p++){const e=Se.a.get(a[p]),t=Object(F.r)(a[p],n);e&&"0"!==t&&d.push(e.id)}const h=[];"0"===l?r!==ae.a.getChatId()||o.last_message||(x.a.setChatId(0),Object(Pe.b)(!1)):-1===c&&(i?(console.error("[vl] skip ".concat(e["@type"]),{id:r,title:Se.a.get(r).title,chat:Se.a.get(r)}),window._m.set(r,r)):h.push(r)),this.reorderChats(d,h,()=>{this.loadChatContents(h),this.saveCache()})},this.handleScroll=()=>{const e=this.listRef.current;if(!e)return;const t=e.getListRef().current;t&&(t.scrollTop<=u.xb?this.onLoadPrev():t.scrollTop+t.offsetHeight>=t.scrollHeight-t.offsetHeight&&this.onLoadNext())},this.renderItem=({index:e,style:t},a)=>{const n=this.state.chatList,s=a[e];return o.a.createElement(rn,{key:s,chatId:s,chatList:n,hidden:this.hiddenChats.has(s),style:t})},window._m=new Map,this.hiddenChats=new Map,this.listRef=o.a.createRef();const a=ae.a.authorizationState;this.state={authorizationState:a,chats:null,fistSliceLoaded:!1,chatList:"chatListMain"===e.type?{"@type":"chatListMain"}:{"@type":"chatListArchive"},params:{loading:!1,completed:!1}}}shouldComponentUpdate(e,t){const a=this.props,n=a.theme,s=a.open,i=a.showArchive,r=a.archiveTitle,o=a.items,l=a.cacheItems,c=this.state,d=c.chats;c.chatList;return e.theme!==n||(e.open!==s||(e.items!==o||(e.cacheItems!==l||(e.showArchive!==i||(e.archiveTitle!==r||t.chats!==d)))))}getSnapshotBeforeUpdate(e,t){const a=this.listRef.current;return a?{scrollTop:a.scrollTop}:{scrollTop:0}}componentDidUpdate(e,t,a){}componentDidMount(){this.loadFirstSlice(),ae.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),Se.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.on("clientUpdateLeaveChat",this.onClientUpdateLeaveChat),Se.a.on("updateChatDraftMessage",this.onUpdateChatOrder),Se.a.on("updateChatLastMessage",this.onUpdateChatOrder),Se.a.on("updateChatPosition",this.onUpdateChatPosition),Fa.a.on("clientUpdateChatList",this.onClientUpdateChatList),Ue.a.on("updateSupegroup",this.onUpdateSupergroup)}componentWillUnmount(){ae.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),Se.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Se.a.off("clientUpdateLeaveChat",this.onClientUpdateLeaveChat),Se.a.off("updateChatDraftMessage",this.onUpdateChatOrder),Se.a.off("updateChatLastMessage",this.onUpdateChatOrder),Se.a.off("updateChatPosition",this.onUpdateChatPosition),Fa.a.off("clientUpdateChatList",this.onClientUpdateChatList),Ue.a.off("updateSupegroup",this.onUpdateSupergroup)}reorderChats(e,t=[],a){const n=this.state.chatList,s=e.concat(t).sort((e,t)=>Object(M.z)(Object(F.r)(t,n),Object(F.r)(e,n)));on.isDifferentOrder(this.state.chats,s)?this.setState({chats:s},a):a&&a()}static isDifferentOrder(e,t){if(e.length===t.length){for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!0;return!1}return!0}onLoadPrev(){}onLoadNext(e=!1,t=u.f){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l,c,d,h,p,m;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=a.props.type,r=a.state,o=r.chats,l=r.chatList,!(c=r.params).loading){n.next=4;break}return n.abrupt("return");case 4:if(!c.completed){n.next=6;break}return n.abrupt("return");case 6:return d="9223372036854775807",h=0,p=null,!e&&o&&o.length>0&&(p=Se.a.get(o[o.length-1]))&&(d=Object(F.r)(p.id,l),h=p.id),"chatListMain"===i&&console.log("[vl] GETCHATS start",i,d,h,p),c.loading=!0,n.next=14,x.a.send({"@type":"getChats",chat_list:l,offset_chat_id:h,offset_order:d,limit:u.f}).finally(()=>{c.loading=!1,e&&x.a.clientUpdate({"@type":"clientUpdateDialogsReady",list:l})});case 14:if(m=n.sent,"chatListMain"===i&&console.log("[vl] GETCHATS stop",e,i,m),c===a.state.params){n.next=18;break}return n.abrupt("return");case 18:m.chat_ids.length>0&&m.chat_ids[0]===h&&m.chat_ids.shift(),c.completed=!m.chat_ids.length,e?a.replaceChats(m.chat_ids,()=>{a.loadChatContents(m.chat_ids),a.saveCache(),m.chat_ids.length<u.f&&a.onLoadNext(!1,u.f-m.chat_ids.length);const e=a.listRef.current.getListRef().current;e&&(e.scrollTop=0)}):a.appendChats(m.chat_ids,()=>{a.loadChatContents(m.chat_ids),m.chat_ids.length&&m.chat_ids.length<t&&a.onLoadNext(!1,t-m.chat_ids.length)});case 21:case"end":return n.stop()}}),n)})))()}loadChatContents(e){const t=U.a.getStore();Object(W.x)(t,e)}appendChats(e,t){if(0===e.length)return void(t&&t());const a=(this.state.chats||[]).concat(e);this.setState({chats:a},t)}replaceChats(e,t){this.setState({chats:e},t)}scrollToTop(){Da(this.listRef.current.getListRef().current)}render(){const e=this.props,t=e.open,a=e.cacheItems,n=(e.showArchive,e.archiveTitle,this.state),s=n.chats,i=n.chatList;if(!t)return null;this.source=[];let r=null;if(s){let e=0;s.forEach(t=>{Object(F.Z)(t,i)&&(e=t)}),this.source=s}else if(a){let e=0;a.forEach(t=>{Object(F.Z)(t,i)&&(e=t)}),this.source=a.map(e=>e.id)}else"chatListMain"===i["@type"]&&(r=Array.from(Array(10)).map((e,t)=>o.a.createElement(La,{key:t,index:t})));window._chats=s,window._c=new Map((s||[]).map(e=>[e,e]));const l=[];return window._m.forEach((e,t)=>{window._c.has(t)||l.push(t)}),console.log("[vl] render",(s||[]).length,window._c.size,window._m.size,l.length),o.a.createElement(Pa,{ref:this.listRef,className:"dialogs-list",source:this.source,rowHeight:76,overScanCount:20,renderItem:e=>this.renderItem(e,this.source),onScroll:this.handleScroll})}}var ln=on;class cn extends o.a.Component{constructor(...e){super(...e),this.handleClick=()=>{const e=this.props.innerListRef;if(!e)return;const t=e.current;t&&t.scrollToTop()}}render(){const e=this.props,t=e.t,a=e.innerListRef,n=e.items,s=e.cacheItems,i=e.onClose;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button main-menu-button",onClick:i},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:this.handleClick},o.a.createElement("span",{className:"header-status-content"},t("ArchivedChats")))),o.a.createElement("div",{className:"dialogs-content"},o.a.createElement(ln,{type:"chatListArchive",ref:a,cacheItems:s,open:!0,items:n})))}}var dn=Object(_.a)()(cn);a(502);class hn extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,top:0,left:0},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleDelete=e=>{this.handleCloseContextMenu();(0,this.props.onDelete)()}}render(){const e=this.props,t=e.chatId,a=e.onSelect,n=e.showSavedMessages,s=e.t,i=this.state,r=i.contextMenu,l=i.top,c=i.left,d=Object(F.u)(t,n,s);return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{button:!0,className:"top-chat",onClick:a,onContextMenu:this.handleContextMenu},o.a.createElement(D.a,{dialog:!0,chatId:t,showSavedMessages:n,showOnline:!0}),o.a.createElement("div",{className:"top-chat-title"},d)),o.a.createElement(Ge.a,{open:r,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:l,left:c},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:s("Delete")})))))}}hn.defaultProps={showSavedMessages:!0};var pn=Object(_.a)()(hn);a(503);class un extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,top:0,left:0},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleDelete=e=>{this.handleCloseContextMenu();(0,this.props.onDelete)()}}render(){const e=this.props,t=e.t,a=e.chatId,n=e.onClick,s=this.state,i=s.contextMenu,r=s.top,l=s.left;return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{button:!0,className:"recently-found-chat",onClick:n,onContextMenu:this.handleContextMenu},o.a.createElement(Oe,{chatId:a})),o.a.createElement(Ge.a,{open:i,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:r,left:l},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:t("Delete")})))))}}var mn=Object(_.a)()(un);a(504);class gn extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatId=e=>{const t=e.nextChatId,a=e.previousChatId;this.setState({nextChatId:t,previousChatId:a})},this.state={nextChatId:ae.a.getChatId(),previousChatId:null}}shouldComponentUpdate(e,t){const a=this.props.chatId;return t.nextChatId===a||t.previousChatId===a}componentDidMount(){ae.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){const e=this.props,t=e.chatId,a=e.onClick,n=this.state.nextChatId,s=Object(F.C)(t);return o.a.createElement(me.a,{button:!0,className:c()("found-public-chat",{"item-selected":t===n}),onClick:a},o.a.createElement("div",{className:"found-public-chat-wrapper"},o.a.createElement(Oe,{chatId:t,subtitle:s?"@"+s:null})))}}var fn=gn,Cn=a(95);a(505);class bn extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatId=e=>{this.setState(Object(Ve.a)({},e))},this.state={nextChatId:ae.a.getChatId(),nextMessageId:ae.a.getMessageId()}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId;return t.nextChatId===n&&t.nextMessageId===s||t.previousChatId===n&&t.previousMessageId===s}componentDidMount(){ae.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.chatSearch,s=e.onClick,i=e.t,r=this.state.nextChatId,l=this.state.nextMessageId,d=ee.a.get(t,a),h=d.sender,p=Object(F.I)(d),u=Object(F.K)(d,i),m=Object(F.J)(d,i),g=Object(tt.j)(d,i)||"\xa0",f=t===r&&a===l,C=h.user_id&&n?o.a.createElement(Cn.a,{userId:h.user_id,dialog:!0}):o.a.createElement(D.a,{chatId:t,dialog:!0});return o.a.createElement(me.a,{button:!0,className:c()("found-message",{"item-selected":f}),onClick:s},o.a.createElement("div",{className:"dialog-wrapper"},C,o.a.createElement("div",{className:"dialog-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},n&&m?o.a.createElement("div",{className:"dialog-title"},m):o.a.createElement(Me,{chatId:t}),o.a.createElement("div",{className:"dialog-meta"},p)),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement("div",{className:"dialog-content"},o.a.createElement(o.a.Fragment,null,!n&&u&&o.a.createElement("span",{className:"dialog-content-accent"},u,": "),g))))))}}var vn=Object(_.a)()(bn);a(506);var En=function({command:e,multiline:t,onClick:a,children:n}){return o.a.createElement("div",{className:"section-header"},o.a.createElement("div",{className:c()("section-header-title",{"section-header-title-multiline":t})},n),Boolean(e)&&o.a.createElement("a",{onClick:a},e))};a(507);class Sn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleKeyDown=e=>{if(!($.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation(),e.target.blur(),this.handleClose()}},this.concatSearchResults=e=>{const t=[],a=new Map;for(let n=0;n<e.length;n++){let s=e[n]&&e[n].chat_ids;if(s)for(let e=0;e<s.length;e++)a.has(s[e])||(a.set(s[e],s[e]),t.push(s[e]))}return t.sort((e,t)=>Object(M.z)(Object(F.r)(t),Object(F.r)(e))),t},this.searchText=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,d,h,p,m,g,f,C,b,v,E,S,y,M,I,k,w,O,L,_,N,j,P,T,R,D,F;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.sessionId=new Date,t.text=a,n=t.sessionId,i=null,r=t.props.chatId,o=t.state.savedMessages,r){e.next=43;break}return l=[],c=x.a.send({"@type":"searchChats",query:a,limit:100}),l.push(c),(d=X(a))&&d!==a&&(h=x.a.send({"@type":"searchChats",query:d,limit:100}),l.push(h)),(p=Y(a))&&p!==a&&(m=x.a.send({"@type":"searchChats",query:p,limit:100}),l.push(m)),e.next=16,Promise.all(l.map(e=>e.catch(e=>null)));case 16:if(g=e.sent,f=t.concatSearchResults(g),n===t.sessionId){e.next=20;break}return e.abrupt("return");case 20:if(o&&(C=t.props.t,b=a.toUpperCase(),((v=["SAVED MESSAGES",C("SavedMessages").toUpperCase()]).some(e=>e.includes(b))||d&&v.some(e=>e.includes(d.toUpperCase())))&&f.splice(0,0,o.id)),t.setState({top:null,recentlyFound:null,local:f}),i=U.a.getStore(),Object(W.x)(i,f),!((E=(E=a.trim()).startsWith("@")?E.substr(1):E).length>=u.Kb)){e.next=42;break}return S=[],y=x.a.send({"@type":"searchPublicChats",query:E}),S.push(y),d&&(M=(M=d.trim()).startsWith("@")?M.substr(1):M).length>=u.Kb&&M!==E&&(I=x.a.send({"@type":"searchPublicChats",query:M}),S.push(I)),e.next=33,Promise.all(S.map(e=>e.catch(e=>null)));case 33:if(k=e.sent,w=t.concatSearchResults(k),n===t.sessionId){e.next=37;break}return e.abrupt("return");case 37:t.setState({global:w}),i=U.a.getStore(),Object(W.x)(i,w),e.next=43;break;case 42:t.setState({global:null});case 43:if(O=[],!r){e.next=50;break}return e.next=47,x.a.send({"@type":"searchChatMessages",chat_id:r,query:a,sender_user_id:0,from_message_id:0,offset:0,limit:50,filter:null});case 47:O=e.sent,e.next=53;break;case 50:return e.next=52,x.a.send({"@type":"searchMessages",chat_list:{"@type":"chatListMain"},query:a,offset_date:0,offset_chat_id:0,offset_message_id:0,limit:50});case 52:O=e.sent;case 53:if(ee.a.setItems(O.messages),L=null,r){e.next=67;break}return e.prev=56,e.next=59,x.a.send({"@type":"getMessageLinkInfo",url:a});case 59:_=e.sent,ee.a.setItems([_.message]),L=_,e.next=67;break;case 64:e.prev=64,e.t0=e.catch(56),console.log("[se] searchText="+a+" messageLinkInfo error",e.t0);case 67:if(n===t.sessionId){e.next=69;break}return e.abrupt("return");case 69:for(t.setState({messages:O,linkMessage:L}),N=new Map,j=new Map,P=0;P<O.messages.length;P++)N.set(O.messages[P].chat_id,O.messages[P].chat_id),O.messages[P].sender.user_id&&j.set(O.messages[P].sender.user_id,O.messages[P].sender.user_id);L&&(R=(T=L).chat_id,D=T.message,N.set(R,R),D&&(F=D.sender)&&F.user_id&&j.set(F.user_id,F.user_id)),i=U.a.getStore(),Object(W.x)(i,[...N.keys()]),Object(W.K)(i,[...j.keys()]);case 77:case"end":return e.stop()}}),e,null,[[56,64]])})));return function(t){return e.apply(this,arguments)}}(),this.loadContent=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.props.chatId){e.next=4;break}return t.setState({top:null,recentlyFound:null,local:null,global:null,messages:null,linkMessage:null}),e.abrupt("return");case 4:return a=x.a.send({"@type":"getTopChats",category:{"@type":"topChatCategoryUsers"},limit:30}).catch(()=>({"@type":"chats",chat_ids:[]})),n=x.a.send({"@type":"searchChats",query:"",limit:100}).catch(()=>({"@type":"chats",chat_ids:[]})),i=x.a.send({"@type":"createPrivateChat",user_id:te.a.getMyId(),force:!0}).catch(e=>{}),e.next=9,Promise.all([a,n,i]);case 9:r=e.sent,o=Object(L.a)(r,3),l=o[0],c=o[1],d=o[2],t.setState({top:l,recentlyFound:c,savedMessages:d,local:null,global:null,messages:null,linkMessage:null}),h=U.a.getStore(),Object(W.x)(h,l.chat_ids),Object(W.x)(h,c.chat_ids);case 18:case"end":return e.stop()}}),e)}))),this.handleClearRecentlyFound=e=>{e.stopPropagation(),x.a.send({"@type":"clearRecentlyFoundChats"}),this.setState({recentlyFound:null})},this.handleSelectMessage=(e,t,a,n)=>{const s=this.props.onSelectMessage;a&&x.a.send({"@type":"addRecentlyFoundChat",chat_id:e}),s(e,t,n)},this.handleScroll=()=>{const e=this.listRef.current;e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&this.onLoadPrevious()},this.getOffset=e=>{const t=e?e.messages.length:0;return{offset_date:t>0?e.messages[t-1].date:0,offset_chat_id:t>0?e.messages[t-1].chat_id:0,offset_message_id:t>0?e.messages[t-1].id:0}},this.concatMessages=(e,t)=>t&&t.messages.length?e&&e.messages.length?{total_count:t.total_count,messages:e.messages.concat(t.messages)}:t:e,this.onLoadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading){e.next=2;break}return e.abrupt("return");case 2:if(a=t.props.chatId,n=t.sessionId,i=t.state.messages,r=t.getOffset(i),t.loading=!0,o=[],!a){e.next=14;break}return e.next=11,x.a.send({"@type":"searchChatMessages",chat_id:a,query:t.text,sender_user_id:0,from_message_id:r.offset_message_id,limit:50,filter:null});case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,x.a.send(Object(Ve.a)(Object(Ve.a)({"@type":"searchMessages",chat_list:{"@type":"chatListMain"},query:t.text},r),{},{limit:50}));case 16:o=e.sent;case 17:if(t.loading=!1,Object(tt.f)(o,i?i.messages:[]),ee.a.setItems(o.messages),n===t.sessionId){e.next=22;break}return e.abrupt("return");case 22:for(t.setState({messages:t.concatMessages(i,o)}),l=new Map,c=new Map,d=0;d<o.messages.length;d++)l.set(o.messages[d].chat_id,o.messages[d].chat_id),o.messages[d].sender.user_id&&c.set(o.messages[d].sender.user_id,o.messages[d].sender.user_id);h=U.a.getStore(),Object(W.x)(h,[...l.keys()]),Object(W.K)(h,[...c.keys()]);case 29:case"end":return e.stop()}}),e)}))),this.handleTopChatsScroll=e=>{e.stopPropagation()},this.handleClose=()=>{(0,this.props.onClose)()},this.handleDeleteRecentlyFoundChat=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"removeRecentlyFoundChat",chat_id:a});case 4:if(n=t.state.recentlyFound){e.next=7;break}return e.abrupt("return");case 7:t.setState({recentlyFound:Object(Ve.a)(Object(Ve.a)({},n),{},{chat_ids:n.chat_ids.filter(e=>e!==a)})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleDeleteTopChat=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"removeTopChat",chat_id:a,category:{"@type":"topChatCategoryUsers"}});case 4:if(n=t.state.top){e.next=7;break}return e.abrupt("return");case 7:t.setState({top:Object(Ve.a)(Object(Ve.a)({},n),{},{chat_ids:n.chat_ids.filter(e=>e!==a)})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.keyboardHandler=new I.a(this.handleKeyDown),this.listRef=o.a.createRef(),this.state={}}componentDidMount(){const e=this.props.text;this.searchOrLoadContent(e),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}componentDidUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.text;(e.text!==i||e.chatId!==s)&&this.searchOrLoadContent(i)}searchOrLoadContent(e){const t=e?e.trim():"";t?this.searchText(t):this.loadContent()}render(){const e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.top,i=n.recentlyFound,r=n.local,l=n.global,c=n.messages,d=n.linkMessage,h=Se.a.get(t),p=s&&s.chat_ids?s.chat_ids.map(e=>o.a.createElement(pn,{key:e,chatId:e,onSelect:()=>this.handleSelectMessage(e,null,!1,!1),onDelete:()=>this.handleDeleteTopChat(e)})):[],u=i&&i.chat_ids?i.chat_ids.map(e=>o.a.createElement(mn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!1),onDelete:()=>this.handleDeleteRecentlyFoundChat(e)})):[],m=r?r.map(e=>o.a.createElement(mn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!1)})):[],g=new Map,C=l?l.map(e=>(g.set(e,e),o.a.createElement(fn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!0)}))):[],b=d&&d.chat_id&&!d.message&&!g.has(d.chat_id)?o.a.createElement(fn,{key:d.chat_id,chatId:d.chat_id,onClick:()=>this.handleSelectMessage(d.chat_id,null,!0,!0)}):null,v=new Map,E=c&&c.messages?c.messages.map(e=>{const a="".concat(e.chat_id,"_").concat(e.id);return v.set(a,a),o.a.createElement(vn,{key:a,chatId:e.chat_id,messageId:e.id,chatSearch:Boolean(t),onClick:()=>this.handleSelectMessage(e.chat_id,e.id,!1,!0)})}):[],S=d&&d.message&&!v.has("".concat(d.message.chat_id,"_").concat(d.message.id))?o.a.createElement(vn,{key:"".concat(d.message.chat_id,"_").concat(d.message.id),chatId:d.message.chat_id,messageId:d.message.id,chatSearch:!1,onClick:()=>this.handleSelectMessage(d.message.chat_id,d.message.id,!1,!0)}):null;let y=c?c.total_count:0;d&&d.message&&!v.has("".concat(d.message.chat_id,"_").concat(d.message.id))&&y++;let M=a("NoMessages");return y&&(M=1===y?"Found 1 message":"Found ".concat(y," messages")),o.a.createElement("div",{ref:this.listRef,className:"search",onScroll:this.handleScroll},h&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,a("SearchMessagesIn")),o.a.createElement("div",{className:"search-chat-wrapper"},o.a.createElement("div",{className:"search-chat-control"},o.a.createElement(Oe,{chatId:t,showStatus:!1})),o.a.createElement(j.a,{className:"header-right-button","aria-label":"Search",onMouseDown:this.handleClose},o.a.createElement(f.a,null)))),o.a.createElement("div",{className:"sidebar-page-section-divider"})),p.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,a("ChatHints")),o.a.createElement("div",{className:"search-top-chats-list",onScroll:this.handleTopChatsScroll},o.a.createElement("div",{className:"search-top-chats-placeholder"}),p,o.a.createElement("div",{className:"search-top-chats-placeholder"}))),o.a.createElement("div",{className:"sidebar-page-section-divider"})),u.length>0&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,{command:a("ClearButton"),onClick:this.handleClearRecentlyFound},a("Recent")),u),m.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,a("ChatsAndContacts")),m),o.a.createElement("div",{className:"sidebar-page-section-divider"})),C.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,a("GlobalSearch")),b,C),o.a.createElement("div",{className:"sidebar-page-section-divider"})),(c||d&&d.message)&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,M),S,E))}}var yn=Object(_.a)()(Sn),Mn=a(654);a(508);class In extends o.a.Component{constructor(e){super(e),this.handleKeyDown=e=>{if(!($.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":const t=this.props.onClose;t&&(e.preventDefault(),e.stopPropagation(),e.target.blur(),t())}},this.keyboardHandler=new I.a(this.handleKeyDown)}componentDidUpdate(e,t,a){const n=this.props.open;e.open!==n&&(n?I.b.add(this.keyboardHandler):I.b.remove(this.keyboardHandler))}render(){const e=this.props,t=e.children,a=e.open,n=e.timeout,s=e.onClose;return o.a.createElement(Mn.a,{direction:"right",in:a,timeout:n,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement("div",{className:"sidebar-page"},s?o.a.cloneElement(t,{onClose:s}):t))}}var Un=In,kn=Object(he.a)(o.a.createElement("path",{d:"M9.37867966,2 C9.97541676,2 10.5501571,2.2133476 11.0009229,2.59780217 L11.1464466,2.73223305 L13.267767,4.85355339 C13.3427815,4.92856794 13.4391777,4.97728504 13.542631,4.9937713 L13.6213203,5 L19,5 C21.1421954,5 22.8910789,6.68396847 22.9951047,8.80035966 L23,9 L23,18 C23,20.1421954 21.3160315,21.8910789 19.1996403,21.9951047 L19,22 L5,22 C2.85780461,22 1.10892112,20.3160315 1.00489531,18.1996403 L1,18 L1,6 C1,3.85780461 2.68396847,2.10892112 4.80035966,2.00489531 L5,2 L9.37867966,2 Z M9.37867966,4 L5,4 C3.9456382,4 3.08183488,4.81587779 3.00548574,5.85073766 L3,6 L3,18 C3,19.0543618 3.81587779,19.9181651 4.85073766,19.9945143 L5,20 L19,20 C20.0543618,20 20.9181651,19.1841222 20.9945143,18.1492623 L21,18 L21,9 C21,7.9456382 20.1841222,7.08183488 19.1492623,7.00548574 L19,7 L13.6213203,7 C13.0245832,7 12.4498429,6.7866524 11.9990771,6.40219783 L11.8535534,6.26776695 L9.73223305,4.14644661 C9.6572185,4.07143206 9.56082233,4.02271496 9.45736903,4.0062287 L9.37867966,4 Z M19,10 C19.5522847,10 20,10.4477153 20,11 C20,11.5128358 19.6139598,11.9355072 19.1166211,11.9932723 L19,12 L5,12 C4.44771525,12 4,11.5522847 4,11 C4,10.4871642 4.38604019,10.0644928 4.88337887,10.0067277 L5,10 L19,10 Z"}),"Folder"),xn=Object(he.a)(o.a.createElement("path",{d:"M7.70710678,20.7071068 C7.5195704,20.8946432 7.26521649,21 7,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,17 C3,16.7347835 3.10535684,16.4804296 3.29289322,16.2928932 L16.5857864,3 C17.3257272,2.26005924 18.5012114,2.22111499 19.2869988,2.88316725 L19.4142136,3 L21,4.58578644 C21.7399408,5.3257272 21.778885,6.50121136 21.1168328,7.28699879 L21,7.41421356 L7.70710678,20.7071068 Z M5,17.4142136 L5,19 L6.58578644,19 L16.5857864,9 L15,7.41421356 L5,17.4142136 Z M18,4.41421356 L16.414,5.99921356 L18,7.58521356 L19.5857864,6 L18,4.41421356 Z"}),"Edit"),wn=Object(he.a)(o.a.createElement("path",{d:"M11,2 C13.209139,2 15,3.790861 15,6 C15,6.55228475 14.5522847,7 14,7 C13.4477153,7 13,6.55228475 13,6 L13,6 L12.9945143,5.85073766 C12.9181651,4.81587779 12.0543618,4 11,4 L11,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L6,20 L11,20 C12.1045695,20 13,19.1045695 13,18 L13,18 L13.0067277,17.8833789 C13.0644928,17.3860402 13.4871642,17 14,17 C14.5522847,17 15,17.4477153 15,18 C15,20.209139 13.209139,22 11,22 L11,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,18 L2,6 C2,3.790861 3.790861,2 6,2 L6,2 Z M18.7071068,7.29289322 L22.7071068,11.2928932 C22.7355731,11.3213595 22.7623312,11.3515341 22.787214,11.3832499 L22.7071068,11.2928932 C22.7425008,11.3282873 22.774687,11.3656744 22.8036654,11.4046934 C22.8215099,11.4288693 22.8382813,11.453725 22.8539326,11.4793398 C22.8613931,11.4913869 22.8685012,11.5036056 22.8753288,11.5159379 C22.8862061,11.5357061 22.8966234,11.5561086 22.9063462,11.5769009 C22.914321,11.5939015 22.9218036,11.6112044 22.9287745,11.628664 C22.9366843,11.6484208 22.9438775,11.6682023 22.9504533,11.6882636 C22.9552713,11.7031487 22.9599023,11.7185367 22.9641549,11.734007 C22.9701664,11.7555635 22.9753602,11.7772539 22.9798348,11.7992059 C22.9832978,11.8166247 22.9863719,11.834051 22.9889822,11.8515331 C22.9962388,11.8996379 23,11.9493797 23,12 L22.9962979,11.9137692 C22.9978436,11.9317345 22.9989053,11.9497336 22.9994829,11.9677454 L23,12 C23,12.0112225 22.9998151,12.0224019 22.9994483,12.0335352 C22.9988772,12.050591 22.997855,12.0679231 22.996384,12.0852242 C22.994564,12.1070574 22.9920941,12.1281144 22.9889807,12.1489612 C22.9863719,12.165949 22.9832978,12.1833753 22.9797599,12.2007258 C22.9753602,12.2227461 22.9701664,12.2444365 22.964279,12.2658396 C22.9599023,12.2814633 22.9552713,12.2968513 22.9502619,12.3121425 C22.9438775,12.3317977 22.9366843,12.3515792 22.928896,12.3710585 C22.9218036,12.3887956 22.914321,12.4060985 22.9063266,12.4232215 C22.8966234,12.4438914 22.8862061,12.4642939 22.8751242,12.484277 C22.8685012,12.4963944 22.8613931,12.5086131 22.8540045,12.5207088 C22.8382813,12.546275 22.8215099,12.5711307 22.8036865,12.5951593 C22.7982466,12.602603 22.7927155,12.6098424 22.7870723,12.6170223 C22.7849289,12.6196628 22.7826279,12.6225624 22.7803112,12.625449 L22.7071068,12.7071068 L22.7071068,12.7071068 L18.7071068,16.7071068 C18.3165825,17.0976311 17.6834175,17.0976311 17.2928932,16.7071068 C16.9023689,16.3165825 16.9023689,15.6834175 17.2928932,15.2928932 L19.585,13 L13,13 C12.4871642,13 12.0644928,12.6139598 12.0067277,12.1166211 L12,12 C12,11.4477153 12.4477153,11 13,11 L13,11 L19.585,11 L17.2928932,8.70710678 C16.9023689,8.31658249 16.9023689,7.68341751 17.2928932,7.29289322 C17.6834175,6.90236893 18.3165825,6.90236893 18.7071068,7.29289322 Z"}),"LogOut"),On=Object(he.a)(o.a.createElement("path",{d:"M12,16 C13.1045695,16 14,16.8954305 14,18 C14,19.1045695 13.1045695,20 12,20 C10.8954305,20 10,19.1045695 10,18 C10,16.8954305 10.8954305,16 12,16 Z M12,10 C13.1045695,10 14,10.8954305 14,12 C14,13.1045695 13.1045695,14 12,14 C10.8954305,14 10,13.1045695 10,12 C10,10.8954305 10.8954305,10 12,10 Z M12,4 C13.1045695,4 14,4.8954305 14,6 C14,7.1045695 13.1045695,8 12,8 C10.8954305,8 10,7.1045695 10,6 C10,4.8954305 10.8954305,4 12,4 Z"}),"More"),Ln=a(404),_n=a(405);class Nn extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null,open:!1},this.handleMenuOpen=e=>{this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleLogOut=()=>{this.handleMenuClose(),this.setState({open:!0})},this.handleDone=()=>{this.handleClose(),x.a.logOut()},this.handleClose=()=>{this.setState({open:!1})}}render(){const e=this.props.t,t=this.state,a=t.anchorEl,n=t.open;return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{"aria-owns":a?"simple-menu":null,"aria-haspopup":"true",className:"header-right-button","aria-label":"Menu",onClick:this.handleMenuOpen},o.a.createElement(On,null)),o.a.createElement(Aa.a,{id:"main-menu",anchorEl:a,open:Boolean(a),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(We.a,{onClick:this.handleLogOut},o.a.createElement(ge.a,null,o.a.createElement(wn,null)),o.a.createElement(fe.a,{primary:e("LogOut")}))),o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:n,onClose:this.handleClose,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},e("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,{style:{whiteSpace:"pre-wrap"}},e("AreYouSureLogout"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleClose,color:"primary"},e("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},e("Ok")))))}}var jn=Object(_.a)()(Nn),Pn=Object(he.a)(o.a.createElement("path",{d:"M12,1 C14.6887547,1 16.8818181,3.12230671 16.9953805,5.78311038 L17,6 L17,8 C18.6568542,8 20,9.34314575 20,11 L20,19 C20,20.6568542 18.6568542,22 17,22 L7,22 C5.34314575,22 4,20.6568542 4,19 L4,11 C4,9.34314575 5.34314575,8 7,8 L7,6 C7,3.23857625 9.23857625,1 12,1 Z M17,10 L7,10 C6.44771525,10 6,10.4477153 6,11 L6,19 C6,19.5522847 6.44771525,20 7,20 L17,20 C17.5522847,20 18,19.5522847 18,19 L18,11 C18,10.4477153 17.5522847,10 17,10 Z M12,13.5 C12.8284271,13.5 13.5,14.1715729 13.5,15 C13.5,15.8284271 12.8284271,16.5 12,16.5 C11.1715729,16.5 10.5,15.8284271 10.5,15 C10.5,14.1715729 11.1715729,13.5 12,13.5 Z M12.1762728,3.00509269 L12,3 C10.4023191,3 9.09633912,4.24891996 9.00509269,5.82372721 L9,6 L9,8 L15,8 L15,6 C15,4.40231912 13.75108,3.09633912 12.1762728,3.00509269 L12,3 L12.1762728,3.00509269 Z"}),"Data"),Tn=Object(he.a)(o.a.createElement("path",{d:"M12.4100787,14.6155108 L10.33,12.56 L10.33,12.56 L10.36,12.53 C12.1,10.59 13.34,8.36 14.07,6 L16,6 C16.5522847,6 17,5.55228475 17,5 C17,4.44771525 16.5522847,4 16,4 L10,4 L10,4 L10,3 C10,2.44771525 9.55228475,2 9,2 C8.44771525,2 8,2.44771525 8,3 L8,4 L8,4 L1.995,4 C1.44547667,4 1,4.44547667 1,4.995 C1,5.54452333 1.44547667,5.99 1.995,5.99 L12.17,5.99 L12.17,5.99 C11.5,7.92 10.44,9.75 9,11.35 C8.29025814,10.5639418 7.67370319,9.7196418 7.15033516,8.83487918 C7.09974701,8.74935905 7.03930045,8.64304956 6.96899548,8.51595071 C6.79288115,8.1975972 6.45776707,8 6.09394677,8 L5.69,8 C5.34408921,8 5.06367311,8.2804161 5.06367311,8.62632689 C5.06367311,8.72554854 5.08724633,8.82335055 5.13246346,8.91167013 C5.1653189,8.97586688 5.19575217,9.03408878 5.22376326,9.08633583 C5.88285067,10.3156835 6.70136504,11.4828779 7.67,12.56 L3.29489879,16.8749328 C2.90279535,17.2616439 2.89842396,17.8929978 3.28513501,18.2851012 C3.28675102,18.2867397 3.28837269,18.2883727 3.29,18.29 L3.29289322,18.2928932 C3.68341751,18.6834175 4.31658249,18.6834175 4.70710678,18.2928932 L9,14 L9,14 L11.3403247,16.3403247 C11.6133932,16.6133932 12.0561246,16.6133932 12.3291931,16.3403247 C12.4001325,16.2693853 12.4549762,16.1840114 12.49,16.09 L12.6442671,15.6759147 C12.7816472,15.3071575 12.6899849,14.8921111 12.4100787,14.6155108 Z M17.8069995,10 L17.1930005,10 C16.7761559,10 16.4030352,10.2585728 16.2566713,10.6488766 L12.3511234,21.0636708 C12.2167367,21.4220355 12.3983067,21.8214894 12.7566713,21.9558761 C12.8344793,21.9850541 12.916901,22 13,22 L13.3059169,22 C13.7232965,22 14.0967782,21.7407727 14.2427584,21.3497542 L15.12,19 L15.12,19 L19.87,19 L20.7561047,21.3524905 C20.9028501,21.74208 21.2756099,22 21.6919201,22 L22,22 C22.3827336,22 22.6930005,21.6897331 22.6930005,21.3069995 C22.6930005,21.2239005 22.6780546,21.1414789 22.6488766,21.0636708 L18.7433287,10.6488766 C18.5969648,10.2585728 18.2238441,10 17.8069995,10 Z M17.5,12.67 L19.12,17 L15.88,17 L17.5,12.67 Z"}),"Language"),Rn=a(112);a(509);class Dn extends o.a.Component{constructor(...e){super(...e),this.handleOpenViewer=()=>{const e=this.props.chatId,t=Se.a.get(e);t&&t.photo&&Object(Q.v)({chatId:e})}}render(){const e=this.props,t=e.chatId,a=e.popup,n=e.t,s=e.onClose,i=e.onEditProfile,r=e.onGeneral,l=e.onNotifications,c=e.onPrivacySecurity,d=e.onLanguage,h=e.onFilters,p=Se.a.get(t);if(!p)return null;const u=p.photo;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:s},a?o.a.createElement(f.a,null):o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},n("Settings"))),o.a.createElement(jn,null)),o.a.createElement("div",{className:"sidebar-page-content settings-main-content"},o.a.createElement("div",{className:"chat-details-info"},o.a.createElement(Oe,{chatId:t,big:!0,showStatus:!0,showSavedMessages:!1,onTileSelect:u?this.handleOpenViewer:null})),o.a.createElement(me.a,{className:"settings-list-item",button:!0,onClick:i},o.a.createElement(ge.a,null,o.a.createElement(xn,null)),o.a.createElement(fe.a,{primary:n("EditProfile")})),o.a.createElement(me.a,{className:"settings-list-item",button:!0,onClick:r},o.a.createElement(ge.a,null,o.a.createElement(Wa,null)),o.a.createElement(fe.a,{primary:n("GeneralSettings")})),o.a.createElement(me.a,{className:"settings-list-item",button:!0,onClick:l},o.a.createElement(ge.a,null,o.a.createElement(Sa,null)),o.a.createElement(fe.a,{primary:n("Notifications")})),o.a.createElement(me.a,{className:"settings-list-item",button:!0,onClick:c},o.a.createElement(ge.a,null,o.a.createElement(Pn,null)),o.a.createElement(fe.a,{primary:n("PrivacySettings")})),o.a.createElement(me.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:h},o.a.createElement(ge.a,null,o.a.createElement(kn,null)),o.a.createElement(fe.a,{primary:n("Filters")})),o.a.createElement(me.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:d},o.a.createElement(ge.a,null,o.a.createElement(Tn,null)),o.a.createElement(fe.a,{primary:n("Language")})),o.a.createElement("div",{className:"settings-main-footer"},Rn.version)))}}var Fn=Object(_.a)()(Dn),An=a(419),Bn=a(439),Hn=a(510),Vn=Object(he.a)(o.a.createElement("path",{d:"M19.8833789,16.0067277 L20,16 C20.5128358,16 20.9355072,16.3860402 20.9932723,16.8833789 L21,17 L21,19 L23,19 C23.5128358,19 23.9355072,19.3860402 23.9932723,19.8833789 L24,20 C24,20.5128358 23.6139598,20.9355072 23.1166211,20.9932723 L23,21 L21,21 L21,23 C21,23.5128358 20.6139598,23.9355072 20.1166211,23.9932723 L20,24 C19.4871642,24 19.0644928,23.6139598 19.0067277,23.1166211 L19,23 L19,21 L17,21 C16.4871642,21 16.0644928,20.6139598 16.0067277,20.1166211 L16,20 C16,19.4871642 16.3860402,19.0644928 16.8833789,19.0067277 L17,19 L19,19 L19,17 C19,16.4871642 19.3860402,16.0644928 19.8833789,16.0067277 L20,16 L19.8833789,16.0067277 Z M8.41421356,2 L13.5857864,2 C14.0572824,2 14.5116128,2.16648982 14.8701798,2.46691315 L15,2.58578644 L16.4142136,4 L18,4 C19.5976809,4 20.9036609,5.24891996 20.9949073,6.82372721 L21,7 L21,12 C21,12.5522847 20.5522847,13 20,13 C19.4871642,13 19.0644928,12.6139598 19.0067277,12.1166211 L19,12 L19,7 C19,6.48716416 18.6139598,6.06449284 18.1166211,6.00672773 L18,6 L16.4142136,6 C15.9427176,6 15.4883872,5.83351018 15.1298202,5.53308685 L15,5.41421356 L13.5857864,4 L8.41421356,4 L7,5.41421356 C6.66660199,5.74761157 6.22761579,5.95114561 5.76163928,5.99225938 L5.58578644,6 L4,6 C3.48716416,6 3.06449284,6.38604019 3.00672773,6.88337887 L3,7 L3,18 C3,18.5128358 3.38604019,18.9355072 3.88337887,18.9932723 L4,19 L13,19 C13.5522847,19 14,19.4477153 14,20 C14,20.5128358 13.6139598,20.9355072 13.1166211,20.9932723 L13,21 L4,21 C2.40231912,21 1.09633912,19.75108 1.00509269,18.1762728 L1,18 L1,7 C1,5.40231912 2.24891996,4.09633912 3.82372721,4.00509269 L4,4 L5.58578644,4 L7,2.58578644 C7.33339801,2.25238843 7.77238421,2.04885439 8.23836072,2.00774062 L8.41421356,2 L13.5857864,2 L8.41421356,2 Z M11,7 C13.7614237,7 16,9.23857625 16,12 C16,14.7614237 13.7614237,17 11,17 C8.23857625,17 6,14.7614237 6,12 C6,9.23857625 8.23857625,7 11,7 Z M11,9 C9.34314575,9 8,10.3431458 8,12 C8,13.6568542 9.34314575,15 11,15 C12.6568542,15 14,13.6568542 14,12 C14,10.3431458 12.6568542,9 11,9 Z"}),"AddImage"),zn=a(207);a(512),a(513);class Wn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleCancel=()=>{this.setState({open:!1})},this.handleDone=()=>{const e=this.cropperRef.current;e&&(e.getCroppedCanvas().toBlob(e=>{const t=URL.createObjectURL(e);this.setState({blob:e,blobURL:t});const a=this.props.onChoose;a&&a(e,t)},"image/jpeg"),this.handleCancel())},this.handleAttach=()=>{this.attachPhotoRef.current.click()},this.handleAttachComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachPhotoRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=14;break}if(n=Array.from(a),i=Object(Bn.a)(n),r=i[0],i.slice(1),r){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,Object(M.A)(r);case 9:o=e.sent,l=Object(L.a)(o,2),c=l[0],d=l[1],t.setState({open:!0,file:r,fileURL:URL.createObjectURL(r),width:c,height:d});case 14:t.attachPhotoRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.attachPhotoRef=o.a.createRef(),this.cropperRef=o.a.createRef();const a=this.props.defaultURL;this.state={blobURL:a,open:!1}}render(){const e=this.props.t,t=this.state,a=t.open,n=t.width,s=t.height,i=t.fileURL,r=t.blobURL,l=Object(M.i)({width:n,height:s},400,!0),c=l.width,d=l.height;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"new-chat-photo"},r?o.a.createElement("img",{className:"new-chat-photo-image-button",alt:"",src:r,onClick:this.handleAttach}):o.a.createElement("div",{className:"new-chat-photo-image-button new-chat-photo-button",onClick:this.handleAttach},o.a.createElement(Vn,{className:"new-chat-photo-icon"}))),o.a.createElement("input",{ref:this.attachPhotoRef,className:"inputbox-attach-button",type:"file",multiple:!1,accept:"image/*",onChange:this.handleAttachComplete}),a&&o.a.createElement(P.a,{transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"dialog-title"},o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:this.handleCancel},o.a.createElement(f.a,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},e("DragToReposition")))),o.a.createElement(Ln.a,null,o.a.createElement(Hn.a,{ref:this.cropperRef,src:i,style:{height:d,width:c,margin:"0 46px 62px"},aspectRatio:1,viewMode:3,guides:!1})),o.a.createElement("div",{className:"new-chat-photo-done-button ",onClick:this.handleDone},o.a.createElement(zn.a,null))))}}var Gn=Object(_.a)()(Wn);a(514);class Zn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleUsernameChange=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.username,(i=t.usernameRef.current.value).startsWith("@")&&i.length>1&&(i=i.substr(1)),n!==i&&""!==i){e.next=8;break}t.setState({usernameCheck:null}),e.next=14;break;case 8:return e.next=10,x.a.send({"@type":"checkChatUsername",chat_id:a,username:i});case 10:r=e.sent,(o=t.usernameRef.current.value).startsWith("@")&&o.length>1&&(o=o.substr(1)),o===i&&t.setState({usernameCheck:r});case 14:case"end":return e.stop()}}),e)}))),this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props.chatId,e.next=3,x.a.send({"@type":"setProfilePhoto",photo:{"@type":"inputFileBlob",name:"profile_photo.jpg",data:a}});case 3:i=U.a.getStore(),Object(W.w)(i,n,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.firstNameRef=o.a.createRef(),this.lastNameRef=o.a.createRef(),this.bioRef=o.a.createRef(),this.usernameRef=o.a.createRef();const a=te.a.get(te.a.getMyId()),n=te.a.getFullInfo(te.a.getMyId());this.state={firstName:a?a.first_name:"",lastName:a?a.last_name:"",bio:n?n.bio:"",username:a?a.username:"",usernameCheck:null}}componentWillUnmount(){this.setName(),this.setBio(),this.setUsername()}setUsername(){const e=this.state,t=e.username,a=e.usernameCheck;let n=this.usernameRef.current.value;n.startsWith("@")&&n.length>1&&(n=n.substr(1)),t!==n&&a&&"checkChatUsernameResultOk"===a["@type"]&&x.a.send({"@type":"setUsername",username:n})}setName(){const e=this.state,t=e.firstName,a=e.lastName,n=this.firstNameRef.current.value,s=this.lastNameRef.current.value;n===t&&s===a||x.a.send({"@type":"setName",first_name:n,last_name:s})}setBio(){const e=this.state.bio,t=this.bioRef.current.value;t!==e&&x.a.send({"@type":"setBio",bio:t})}render(){let e=this.props,t=e.chatId,a=e.t,n=e.onClose;const s=this.state,i=s.firstName,r=s.lastName,l=s.bio,c=s.username,d=s.usernameCheck;let h=!1,p=a("Username");if(d)switch(d["@type"]){case"checkChatUsernameResultOk":h=!1,p="Username is available";break;case"checkChatUsernameResultPublicChatsTooMuch":case"checkChatUsernameResultPublicGroupsUnavailable":case"checkChatUsernameResultUsernameInvalid":h=!0,p="Invalid username";break;case"checkChatUsernameResultUsernameOccupied":h=!0,p="Username is already taken"}const u=Se.a.get(t);if(!u)return null;const m=u.photo,g=Object(W.m)(m?m.small:null),f=[],C=Object(tt.x)(a("UsernameHelp"),f),b=Object(tt.o)({"@type":"formattedText",text:C,entities:f});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:n},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("EditProfile")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement(Gn,{defaultURL:g,onChoose:this.handleChoosePhoto}),o.a.createElement("div",{className:"edit-profile-name"},o.a.createElement(An.a,{inputRef:this.firstNameRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("FirstName"),defaultValue:i}),o.a.createElement(An.a,{inputRef:this.lastNameRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("LastName"),defaultValue:r}),o.a.createElement(An.a,{inputRef:this.bioRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("Bio"),defaultValue:l}),o.a.createElement("div",{className:"edit-profile-hint"},a("BioAbout"))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"edit-profile-username"},o.a.createElement(An.a,{inputRef:this.usernameRef,error:h,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:p,defaultValue:c,onChange:this.handleUsernameChange}),o.a.createElement("div",{className:"edit-profile-hint"},b))))}}var qn=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(Zn),Kn=Object(he.a)(o.a.createElement("path",{fill:"currentColor",fillRule:"nonzero",d:"M11.8833789,4.00672773 L12,4 C12.5128358,4 12.9355072,4.38604019 12.9932723,4.88337887 L13,5 L13,11 L19,11 C19.5128358,11 19.9355072,11.3860402 19.9932723,11.8833789 L20,12 C20,12.5128358 19.6139598,12.9355072 19.1166211,12.9932723 L19,13 L13,13 L13,19 C13,19.5128358 12.6139598,19.9355072 12.1166211,19.9932723 L12,20 C11.4871642,20 11.0644928,19.6139598 11.0067277,19.1166211 L11,19 L11,13 L5,13 C4.48716416,13 4.06449284,12.6139598 4.00672773,12.1166211 L4,12 C4,11.4871642 4.38604019,11.0644928 4.88337887,11.0067277 L5,11 L11,11 L11,5 C11,4.48716416 11.3860402,4.06449284 11.8833789,4.00672773 L12,4 L11.8833789,4.00672773 Z"}),"Add"),Yn=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M18,18 C23.8608627,18 28.072977,19.5546034 30.5027576,22.7682432 C31.1498637,23.6240893 31.5,24.6677318 31.5,25.7406839 L31.5,27.4285714 C31.5,29.6771593 29.6771593,31.5 27.4285714,31.5 L8.57142857,31.5 C6.32284066,31.5 4.5,29.6771593 4.5,27.4285714 L4.5,25.740741 C4.5,24.6677985 4.85010028,23.6241745 5.49717185,22.7683365 C7.92695186,19.5546298 12.1390883,18 18,18 Z M18,21 C12.9925527,21 9.66714119,22.2273543 7.89018414,24.5776159 C7.63699525,24.9124919 7.5,25.3208649 7.5,25.740741 L7.5,27.4285714 C7.5,28.0203051 7.97969491,28.5 8.57142857,28.5 L27.4285714,28.5 C28.0203051,28.5 28.5,28.0203051 28.5,27.4285714 L28.5,25.7406839 C28.5,25.3208358 28.3629925,24.9124609 28.1097736,24.5775601 C26.3328071,22.2273354 23.0074077,21 18,21 Z M18,3 C21.3137085,3 24,5.6862915 24,9 C24,12.3137085 21.3137085,15 18,15 C14.6862915,15 12,12.3137085 12,9 C12,5.6862915 14.6862915,3 18,3 Z M18,6 C16.3431458,6 15,7.34314575 15,9 C15,10.6568542 16.3431458,12 18,12 C19.6568542,12 21,10.6568542 21,9 C21,7.34314575 19.6568542,6 18,6 Z"}),"NewPrivate"),Jn=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M9,13 C12.3229116,13 14.7530244,13.8337117 16.2223821,15.5699359 C16.6742675,16.1038947 16.9426297,16.7664653 16.9917833,17.4602417 L17,17.6925226 L17,18.5 C17,19.8254834 15.9684641,20.9100387 14.6643757,20.9946823 L14.5,21 L3.5,21 C2.1745166,21 1.08996133,19.9684641 1.00531768,18.6643757 L1,18.5 L1,17.6925204 C1,16.9152876 1.2755246,16.1632192 1.77762117,15.569932 C3.24697824,13.8337108 5.67709024,13 9,13 Z M9,15 C6.21130036,15 4.33538166,15.6435809 3.30428673,16.861943 C3.14055953,17.0554062 3.03840077,17.2920167 3.00889582,17.5415166 L3,17.6925212 L3,18.5 C3,18.7454599 3.17687516,18.9496084 3.41012437,18.9919443 L3.5,19 L14.5,19 C14.7454599,19 14.9496084,18.8231248 14.9919443,18.5898756 L15,18.5 L15,17.6925226 C15,17.3883883 14.8921864,17.0941004 14.6957148,16.8619448 C13.6646202,15.6435815 11.788701,15 9,15 Z M19,14 C19.5522847,14 20,14.4477153 20,15 C20,15.5522847 19.5522847,16 19,16 C18.4477153,16 18,15.5522847 18,15 C18,14.4477153 18.4477153,14 19,14 Z M19,3 C21.209139,3 23,4.790861 23,7 C23,8.80747736 21.8011592,10.3349504 20.1552529,10.8306439 L20,10.873 L20,11.5 C20,12.0128358 19.6139598,12.4355072 19.1166211,12.4932723 L19,12.5 C18.4871642,12.5 18.0644928,12.1139598 18.0067277,11.6166211 L18,11.5 L18,10 C18,9.48716416 18.3860402,9.06449284 18.8833789,9.00672773 L19,9 C20.1045695,9 21,8.1045695 21,7 C21,5.8954305 20.1045695,5 19,5 C17.8954305,5 17,5.8954305 17,7 C17,7.55228475 16.5522847,8 16,8 C15.4477153,8 15,7.55228475 15,7 C15,4.790861 16.790861,3 19,3 Z M9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 Z M9,5 C7.8954305,5 7,5.8954305 7,7 C7,8.1045695 7.8954305,9 9,9 C10.1045695,9 11,8.1045695 11,7 C11,5.8954305 10.1045695,5 9,5 Z"}),"NonContacts"),Xn=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M12,19.5 C16.9843673,19.5 20.6295366,20.7505675 22.8335731,23.3549038 C23.5867154,24.2448351 24,25.3729365 24,26.538784 L24,27.75 C24,29.8210678 22.3210678,31.5 20.25,31.5 L3.75,31.5 C1.67893219,31.5 0,29.8210678 0,27.75 L0,26.5387806 C0,25.3729314 0.413286907,24.2448288 1.16643175,23.354898 C3.37046736,20.7505662 7.01563535,19.5 12,19.5 Z M26.9272668,21.0503629 L27.1024807,21.0520931 C30.3320395,21.2704178 32.8220855,22.1814787 34.5196345,23.8437596 C35.3875212,24.6935741 35.9082005,25.8309338 35.9889534,27.0352541 L36,27.3651995 L36,28.125 C36,29.911296 34.6122576,31.3734674 32.8560732,31.4922138 L32.625,31.5 L28.5,31.5 C27.6715729,31.5 27,30.8284271 27,30 C27,29.2307462 27.5790603,28.5967393 28.3250683,28.5100916 L28.5,28.5 L32.625,28.5 C32.8025201,28.5 32.9512302,28.3766499 32.990096,28.2109841 L33,28.125 L33,27.3651995 C33,26.8466882 32.7912139,26.3500306 32.4207231,25.9872546 C31.2961739,24.8860689 29.4736312,24.2192349 26.9001365,24.0452615 C26.0735959,23.9893857 25.4488487,23.2740458 25.5047245,22.4475052 C25.5566091,21.6800032 26.1771133,21.0864965 26.9272668,21.0503629 L26.9272668,21.0503629 Z M12,22.5 C7.81695054,22.5 5.00307249,23.4653713 3.4564301,25.2929144 C3.16172113,25.6411484 3,26.0825803 3,26.5387817 L3,27.75 C3,28.1642136 3.33578644,28.5 3.75,28.5 L20.25,28.5 C20.6642136,28.5 21,28.1642136 21,27.75 L21,26.538784 C21,26.0825825 20.8382796,25.6411507 20.5435722,25.2929172 C18.9969303,23.4653723 16.1830516,22.5 12,22.5 Z M25.5,7.5 C28.3994949,7.5 30.75,9.85050506 30.75,12.75 C30.75,15.6494949 28.3994949,18 25.5,18 C22.6005051,18 20.25,15.6494949 20.25,12.75 C20.25,9.85050506 22.6005051,7.5 25.5,7.5 Z M12,4.5 C15.3137085,4.5 18,7.1862915 18,10.5 C18,13.8137085 15.3137085,16.5 12,16.5 C8.6862915,16.5 6,13.8137085 6,10.5 C6,7.1862915 8.6862915,4.5 12,4.5 Z M25.5,10.5 C24.2573593,10.5 23.25,11.5073593 23.25,12.75 C23.25,13.9926407 24.2573593,15 25.5,15 C26.7426407,15 27.75,13.9926407 27.75,12.75 C27.75,11.5073593 26.7426407,10.5 25.5,10.5 Z M12,7.5 C10.3431458,7.5 9,8.84314575 9,10.5 C9,12.1568542 10.3431458,13.5 12,13.5 C13.6568542,13.5 15,12.1568542 15,10.5 C15,8.84314575 13.6568542,7.5 12,7.5 Z"}),"NewGroup"),Qn=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M27.75,2.51771235 C29.8210678,2.51771235 31.5,4.19664454 31.5,6.26771235 L31.5,29.7322876 C31.5,30.6020604 31.1976592,31.444786 30.6447384,32.1161898 C29.3281456,33.7149097 26.9648177,33.9436189 25.3660978,32.627026 L18,26.5597124 L18,29.25 C18,31.6465213 16.1266201,33.6054913 13.7644092,33.742361 L13.5,33.75 C11.1034787,33.75 9.14450868,31.8766201 9.00763904,29.5144092 L9,29.25 L8.99971804,25.3499156 C5.57649804,24.6549011 3,21.6283372 3,18 C3,13.8578644 6.35786438,10.5 10.5,10.5 L16.7118519,10.5 L25.3660978,3.37297397 C26.0375017,2.82005314 26.8802273,2.51771235 27.75,2.51771235 Z M12,25.4992124 L12,29.25 C12,30.0784271 12.6715729,30.75 13.5,30.75 C14.2692538,30.75 14.9032607,30.1709397 14.9899084,29.4249317 L15,29.25 L15,25.4992124 L12,25.4992124 L12,29.25 L12,25.4992124 Z M27.75,5.51771235 C27.5760455,5.51771235 27.4075003,5.57818051 27.2732196,5.68876467 L18.6189737,12.8157907 C18.0818506,13.2581274 17.4076701,13.5 16.7118519,13.5 L10.5,13.5 C8.01471863,13.5 6,15.5147186 6,18 C6,20.4852814 8.01471863,22.5 10.5,22.5 L16.7118519,22.5 C17.4076701,22.5 18.0818506,22.7418726 18.6189737,23.1842093 L27.2732196,30.3112353 C27.5929635,30.5745539 28.0656291,30.5288121 28.3289477,30.2090681 C28.4395318,30.0747873 28.5,29.9062422 28.5,29.7322876 L28.5,6.26771235 C28.5,5.85349879 28.1642136,5.51771235 27.75,5.51771235 Z"}),"NewChannel"),$n=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M17,3 C19.1421954,3 20.8910789,4.68396847 20.9951047,6.80035966 L21,7 L21,10.5 C21,11.0522847 20.5522847,11.5 20,11.5 C19.4871642,11.5 19.0644928,11.1139598 19.0067277,10.6166211 L19,10.5 L19,7 C19,5.9456382 18.1841222,5.08183488 17.1492623,5.00548574 L17,5 L7,5 C5.9456382,5 5.08183488,5.81587779 5.00548574,6.85073766 L5,7 L5,19.585 L7.20502525,17.3807612 C7.41399436,17.1717921 7.68678103,17.0413128 7.97757724,17.0082977 L8.12426407,17 L12.5,17 C13.0522847,17 13.5,17.4477153 13.5,18 C13.5,18.5128358 13.1139598,18.9355072 12.6166211,18.9932723 L12.5,19 L8.413,19 L4.87781746,22.5363961 C4.47892479,22.9352888 3.84989486,22.9637811 3.41812544,22.6218731 L3.32218254,22.5363961 C3.14536253,22.3595761 3.034957,22.1287566 3.00702113,21.8826983 L3,21.7585786 L3,7 C3,4.85780461 4.68396847,3.10892112 6.80035966,3.00489531 L7,3 L17,3 Z M22.7071068,12.2928932 C23.0675907,12.6533772 23.0953203,13.2206082 22.7902954,13.6128994 L22.7071068,13.7071068 L17.7071068,18.7071068 C17.3466228,19.0675907 16.7793918,19.0953203 16.3871006,18.7902954 L16.2928932,18.7071068 L13.7928932,16.2071068 C13.4023689,15.8165825 13.4023689,15.1834175 13.7928932,14.7928932 C14.1533772,14.4324093 14.7206082,14.4046797 15.1128994,14.7097046 L15.2071068,14.7928932 L17,16.585 L21.2928932,12.2928932 C21.6834175,11.9023689 22.3165825,11.9023689 22.7071068,12.2928932 Z"}),"ReadChats"),es=Object(he.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M12,1 C12.5128358,1 12.9355072,1.38604019 12.9932723,1.88337887 L13,2 L13,3 L13.5,3 C16.7383969,3 19.3775718,5.56557489 19.4958615,8.77506174 L19.5,9 L19.5,11 L20,11 L20.1762728,11.0050927 C21.6927538,11.0929596 22.9070404,12.3072462 22.9949073,13.8237272 L23,14 L23,17 L22.9932723,17.1166211 C22.9355072,17.6139598 22.5128358,18 22,18 C21.4871642,18 21.0644928,17.6139598 21.0067277,17.1166211 L21,17 L21,14 L20.9932723,13.8833789 C20.9399506,13.424297 20.575703,13.0600494 20.1166211,13.0067277 L20,13 L19.5,13 L19.5,18 C19.5,20.1421954 17.8160315,21.8910789 15.6996403,21.9951047 L15.5,22 L8.5,22 C6.35780461,22 4.60892112,20.3160315 4.50489531,18.1996403 L4.5,18 L4.5,13 L4,13 C3.48716416,13 3.06449284,13.3860402 3.00672773,13.8833789 L3,14 L3,17 C3,17.5522847 2.55228475,18 2,18 C1.48716416,18 1.06449284,17.6139598 1.00672773,17.1166211 L1,17 L1,14 C1,12.4023191 2.24891996,11.0963391 3.82372721,11.0050927 L4,11 L4.5,11 L4.5,9 C4.5,5.76160306 7.06557489,3.12242824 10.2750617,3.00413847 L10.5,3 L11,3 L11,2 C11,1.44771525 11.4477153,1 12,1 Z M16.6762728,12.9949073 L16.5,13 L7.5,13 C7.14939781,13 6.81284272,12.9398572 6.5,12.8293257 L6.5,18 C6.5,19.0543618 7.31587779,19.9181651 8.35073766,19.9945143 L8.5,20 L15.5,20 C16.5543618,20 17.4181651,19.1841222 17.4945143,18.1492623 L17.5,18 L17.5009007,12.8289758 C17.2406443,12.9210572 16.9638938,12.9782422 16.6762728,12.9949073 Z M13.5,5 L10.5,5 C8.35780461,5 6.60892112,6.68396847 6.50489531,8.80035966 L6.5,9 L6.5,10 C6.5,10.5128358 6.88604019,10.9355072 7.38337887,10.9932723 L7.5,11 L16.5,11 C17.0128358,11 17.4355072,10.6139598 17.4932723,10.1166211 L17.5,10 L17.5,9 C17.5,6.85780461 15.8160315,5.10892112 13.6996403,5.00489531 L13.5,5 Z M9.5,7.5 C10.0522847,7.5 10.5,7.94771525 10.5,8.5 C10.5,9.05228475 10.0522847,9.5 9.5,9.5 C8.94771525,9.5 8.5,9.05228475 8.5,8.5 C8.5,7.94771525 8.94771525,7.5 9.5,7.5 Z M14.5,7.5 C15.0522847,7.5 15.5,7.94771525 15.5,8.5 C15.5,9.05228475 15.0522847,9.5 14.5,9.5 C13.9477153,9.5 13.5,9.05228475 13.5,8.5 C13.5,7.94771525 13.9477153,7.5 14.5,7.5 Z"}),"Bots"),ts=a(521),as=a.n(ts),ns=Object(he.a)(o.a.createElement("path",{d:"M4.70710678,12.2928932 C4.31658249,11.9023689 3.68341751,11.9023689 3.29289322,12.2928932 C2.90236893,12.6834175 2.90236893,13.3165825 3.29289322,13.7071068 L8.29289322,18.7071068 C8.68341751,19.0976311 9.31658249,19.0976311 9.70710678,18.7071068 L20.7071068,7.70710678 C21.0976311,7.31658249 21.0976311,6.68341751 20.7071068,6.29289322 C20.3165825,5.90236893 19.6834175,5.90236893 19.2928932,6.29289322 L9,16.5857864 L4.70710678,12.2928932 Z"}),"Done"),ss=a(53),is=a(420);a(515);class rs extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0,checked:!1},this.handleOpenContextMenu=e=>{this.props.onDelete&&(e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY}))},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleDelete=()=>{this.handleCloseContextMenu();const e=this.props,t=e.chatId,a=e.onDelete;a&&a(t)}}render(){const e=this.props,t=e.chatId,a=e.t,n=e.type,s=e.checked,i=e.onClick,r=this.state,l=r.contextMenu,c=r.left,d=r.top,h=Object(F.x)(t,!0,a);return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:i,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"filter-chat-tile"},o.a.createElement(D.a,{chatId:t,small:!0,showSavedMessages:!0})),o.a.createElement("div",{className:"filter-chat-content"},o.a.createElement("div",{className:"filter-chat-title"},h),n&&o.a.createElement("div",{className:"filter-chat-subtitle"},Object(F.y)(t,a))),void 0!==s&&o.a.createElement(is.a,{className:"filter-chat-checkbox",color:"primary",checked:s})),o.a.createElement(Ge.a,{open:l,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:d,left:c},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:a("Delete")})))))}}var os=Object(_.a)()(rs);a(516);class ls extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=e=>{this.props.onDelete&&(e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY}))},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleDelete=()=>{this.handleCloseContextMenu();const e=this.props.onDelete;e&&e()}}render(){const e=this.props,t=e.t,a=e.className,n=e.icon,s=e.text,i=e.checked,r=e.onClick,l=this.state,d=l.contextMenu,h=l.left,p=l.top;return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{className:c()(a,"settings-list-item2","filter-chat-text"),role:void 0,button:!0,onMouseDown:r,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"filter-chat-tile"},n),o.a.createElement("div",{className:"filter-chat-content"},s),void 0!==i&&o.a.createElement(is.a,{className:"filter-chat-checkbox",color:"primary",checked:i})),o.a.createElement(Ge.a,{open:d,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:p,left:h},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:t("Delete")})))))}}var cs=Object(_.a)()(ls);a(517);class ds extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){const e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){const t=this.divRef.current;t&&(t.style.cssText=e)}render(){const e=this.props,t=e.icon,a=e.text,n=e.selected,s=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":n}),onClick:s},o.a.createElement("div",{className:"chip-icon"},t),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(f.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},a))}}var hs=ds;a(518);class ps extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){const e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){const t=this.divRef.current;t&&(t.style.cssText=e)}render(){const e=this.props,t=e.chatId,a=e.selected,n=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":a}),onClick:n},o.a.createElement(D.a,{chatId:t,small:!0}),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(f.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},Object(F.u)(t)))}}var us=ps;a(519);class ms extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleChatChange=(e,t)=>{const a=this.props.mode;if(t){const e=this.searchInputRef.current;e.focus(),e.innerText="",this.handleSearch("")}this.handleChange("include"===a?"included_chat_ids":"excluded_chat_ids",e)},this.handleBackspace=()=>{const e=this.props,t=e.filter,a=e.mode,n=this.state.focusedItem;if(!t)return;if(n){switch(n){case"include_contacts":case"include_non_contacts":case"include_bots":case"include_groups":case"include_channels":case"exclude_muted":case"exclude_read":case"exclude_archived":this.handleChange(n),this.setState({focusedItem:null});break;default:this.handleChatChange(n),this.setState({focusedItem:null})}return}if("include"===a){const e=t.include_contacts,a=t.include_non_contacts,n=t.include_bots,s=t.include_groups,i=t.include_channels,r=t.included_chat_ids;if(r.length>0){const e=r[r.length-1];if(!e)return;this.setState({focusedItem:e})}else n?this.setState({focusedItem:"include_bots"}):i?this.setState({focusedItem:"include_channels"}):s?this.setState({focusedItem:"include_groups"}):a?this.setState({focusedItem:"include_non_contacts"}):e&&this.setState({focusedItem:"include_contacts"})}else{const e=t.exclude_muted,a=t.exclude_read,n=t.exclude_archived,s=t.excluded_chat_ids;if(s.length>0){const e=s[s.length-1];if(!e)return;this.setState({focusedItem:e})}else n?this.setState({focusedItem:"exclude_archived"}):a?this.setState({focusedItem:"exclude_read"}):e&&this.setState({focusedItem:"exclude_muted"})}},this.handleChange=(e,t)=>{(0,this.props.onChange)(e,t),this.setState({focusedItem:null})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null,focusedItem:null}),e.abrupt("return");case 4:return(i=[]).push(x.a.send({"@type":"searchChats",query:n,limit:100})),e.next=8,Promise.all(i);case 8:r=e.sent,o=Object(L.a)(r,1),l=o[0],c=U.a.getStore(),Object(W.x)(c,l.chat_ids),t.setState({searchItems:l,focusedItem:null});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.searchInputRef=o.a.createRef(),this.wrapPanelRef=o.a.createRef(),this.itemsRef=new Map,this.state={focusedItem:null,searchItems:null,error:!1}}getSnapshotBeforeUpdate(e,t){const a=this.props,n=a.filter,s=a.mode,i=e.filter;if(e.filter===n)return null;const r="include"===s,o=r?e.filter.included_chat_ids:e.filter.excluded_chat_ids,l=r?n.included_chat_ids:n.excluded_chat_ids,c=o.length>l.length||i.include_contacts&&!n.include_contacts||i.include_non_contacts&&!n.include_non_contacts||i.include_groups&&!n.include_groups||i.include_channels&&!n.include_channels||i.include_bots&&!n.include_bots||i.exclude_read&&!n.exclude_read||i.exclude_muted&&!n.exclude_muted||i.exclude_archived&&!n.exclude_archived,d=this.wrapPanelRef.current,h=d.scrollHeight,p=d.offsetHeight,u=d.style.cssText,m=d.scrollTop;c&&(d.style.cssText=null);const g=new Map;var f,C=Object(ss.a)(this.itemsRef.keys());try{for(C.s();!(f=C.n()).done;){let e=f.value;const t=this.itemsRef.get(e);if(t){const a=t.getOffset();g.set(e,a)}}}catch(b){C.e(b)}finally{C.f()}return{items:g,panel:{isDeleting:c,prevHeight:h,prevOffsetHeight:p,prevScrollTop:m,prevCSSText:u}}}componentDidUpdate(e,t,a){e.filter!==this.props.filter&&this.animatePanel(a.panel)}animatePanel(e){if(!e)return;const t=e.isDeleting,a=e.prevHeight,n=e.prevOffsetHeight,s=e.prevScrollTop,i=e.prevCSSText,r=this.wrapPanelRef.current,o=r.scrollHeight,l=(r.offsetHeight,o<a);o>a?a<123?(r.style.cssText="max-height: ".concat(Math.min(a,123),"px;"),requestAnimationFrame(()=>{r.style.cssText="max-height: ".concat(Math.min(o,123),"px;"),setTimeout(()=>{this.searchInputRef.current.scrollIntoView({behavior:"auto"})},250)})):(r.style.cssText="max-height: ".concat(123,"px;"),this.searchInputRef.current.scrollIntoView({behavior:"smooth"})):l?o<123?(r.style.cssText="min-height: ".concat(Math.min(n,123),"px;"),requestAnimationFrame(()=>{r.style.cssText="min-height: ".concat(Math.min(o,123),"px;")})):(r.style.cssText="max-height: ".concat(123,"px;"),r.scrollTop=s):t?(r.style.cssText=i,r.scrollTop=s):this.searchInputRef.current.scrollIntoView({behavior:"smooth"})}animateItems(e){if(!e)return;const t=new Map;var a,n=Object(ss.a)(this.itemsRef.keys());try{for(n.s();!(a=n.n()).done;){let n=a.value;const s=this.itemsRef.get(n);if(s){const a=s.getOffset(),i=e.has(n)?e.get(n):null;if(i){i.left<a.left&&t.set(s,{prevOffset:i,currentOffset:a});const e="transform: translate(".concat(i.left-a.left,"px, ").concat(i.top-a.top,"px)");s.setStyleCSSText(e)}}}}catch(s){n.e(s)}finally{n.f()}requestAnimationFrame(()=>{var e,a=Object(ss.a)(this.itemsRef.keys());try{for(a.s();!(e=a.n()).done;){let a=e.value;const n=this.itemsRef.get(a);if(n){let e="transition: transform 0.25s ease";if(t.has(n)){const a=t.get(n),s=a.prevOffset,i=a.currentOffset;e="transform: translate(".concat(s.left-i.left-s.width,"px, ").concat(s.top-i.top,"px);")+"transition: transform 0.1s ease;"}n.setStyleCSSText(e)}}}catch(s){a.e(s)}finally{a.f()}t.size&&setTimeout(()=>{var e,a=Object(ss.a)(t.keys());try{for(a.s();!(e=a.n()).done;){let a=e.value;const n=t.get(a).currentOffset,s="transform: translate(".concat(n.width,"px, 0);")+"transition: transform 0s ease;";a.setStyleCSSText(s)}}catch(s){a.e(s)}finally{a.f()}requestAnimationFrame(()=>{var e,a=Object(ss.a)(t.keys());try{for(a.s();!(e=a.n()).done;){let t=e.value;const a="transition: transform 0.15s ease";t.setStyleCSSText(a)}}catch(s){a.e(s)}finally{a.f()}})},100)})}render(){const e=this.props,t=e.t,a=e.filter,n=e.chats,s=e.limit,i=e.mode,r=e.onClose,l=(e.onChange,e.onScroll),c=this.state,d=c.focusedItem,h=c.searchItems,p=a.include_contacts,u=a.include_non_contacts,m=a.include_bots,g=a.include_groups,f=a.include_channels,C=a.included_chat_ids,b=a.exclude_muted,v=a.exclude_read,E=a.exclude_archived,S=a.excluded_chat_ids,y="include"===i,M=y?C:S;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:r},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("include"===i?"FilterInclude":"FilterExclude")))),o.a.createElement("div",{ref:this.wrapPanelRef,className:"animated-wrap-panel"},y&&o.a.createElement(o.a.Fragment,null,p&&o.a.createElement(hs,{onClick:()=>this.handleChange("include_contacts"),ref:e=>{this.itemsRef.set("include_contacts",e)},selected:"include_contacts"===d,icon:o.a.createElement(Yn,{viewBox:"0 0 36 36"}),text:t("FilterContacts")}),u&&o.a.createElement(hs,{onClick:()=>this.handleChange("include_non_contacts"),ref:e=>{this.itemsRef.set("include_non_contacts",e)},selected:"include_non_contacts"===d,icon:o.a.createElement(Jn,null),text:t("FilterNonContacts")}),g&&o.a.createElement(hs,{onClick:()=>this.handleChange("include_groups"),ref:e=>{this.itemsRef.set("include_groups",e)},selected:"include_groups"===d,icon:o.a.createElement(Xn,{viewBox:"0 0 36 36"}),text:t("FilterGroups")}),f&&o.a.createElement(hs,{onClick:()=>this.handleChange("include_channels"),ref:e=>{this.itemsRef.set("include_channels",e)},selected:"include_channels"===d,icon:o.a.createElement(Qn,{viewBox:"0 0 36 36"}),text:t("FilterChannels")}),m&&o.a.createElement(hs,{onClick:()=>this.handleChange("include_bots"),ref:e=>{this.itemsRef.set("include_bots",e)},selected:"include_bots"===d,icon:o.a.createElement(es,null),text:t("FilterBots")})),!y&&o.a.createElement(o.a.Fragment,null,b&&o.a.createElement(hs,{onClick:()=>this.handleChange("exclude_muted"),ref:e=>{this.itemsRef.set("exclude_muted",e)},selected:"exclude_muted"===d,icon:o.a.createElement(Xn,{viewBox:"0 0 36 36"}),text:t("FilterMuted")}),v&&o.a.createElement(hs,{onClick:()=>this.handleChange("exclude_read"),ref:e=>{this.itemsRef.set("exclude_read",e)},selected:"exclude_read"===d,icon:o.a.createElement(Qn,{viewBox:"0 0 36 36"}),text:t("FilterRead")}),E&&o.a.createElement(hs,{onClick:()=>this.handleChange("exclude_archived"),ref:e=>{this.itemsRef.set("exclude_archived",e)},selected:"exclude_archived"===d,icon:o.a.createElement(es,null),text:t("FilterArchived")})),M.map(e=>o.a.createElement(us,{selected:d===e,ref:t=>{this.itemsRef.set(e,t)},key:e,chatId:e,onClick:()=>this.handleChatChange(e)})),o.a.createElement($a,{inputRef:this.searchInputRef,hint:t("Search"),onClose:this.handleSearchClose,onChange:this.handleSearch,onBackspace:this.handleBackspace})),o.a.createElement("div",{className:"sidebar-page-top-divider",style:{zIndex:1}}),o.a.createElement("div",{ref:this.scrollRef,className:"sidebar-page-content",style:{marginTop:-3,position:"relative",height:"100%"},onScroll:l},o.a.createElement(En,null,t("FilterChatTypes")),y&&o.a.createElement(o.a.Fragment,null,o.a.createElement(cs,{onClick:()=>this.handleChange("include_contacts"),checked:p,icon:o.a.createElement(Yn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterContacts")}),o.a.createElement(cs,{onClick:()=>this.handleChange("include_non_contacts"),checked:u,icon:o.a.createElement(Jn,{className:"filter-text-subtle-icon"}),text:t("FilterNonContacts")}),o.a.createElement(cs,{onClick:()=>this.handleChange("include_groups"),checked:g,icon:o.a.createElement(Xn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterGroups")}),o.a.createElement(cs,{onClick:()=>this.handleChange("include_channels"),checked:f,icon:o.a.createElement(Qn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterChannels")}),o.a.createElement(cs,{onClick:()=>this.handleChange("include_bots"),checked:m,icon:o.a.createElement(es,{className:"filter-text-subtle-icon"}),text:t("FilterBots")})),!y&&o.a.createElement(o.a.Fragment,null,o.a.createElement(cs,{onClick:()=>this.handleChange("exclude_muted"),checked:b,icon:o.a.createElement(Ea,{className:"filter-text-subtle-icon"}),text:t("FilterMuted")}),o.a.createElement(cs,{onClick:()=>this.handleChange("exclude_read"),checked:v,icon:o.a.createElement($n,{className:"filter-text-subtle-icon"}),text:t("FilterRead")}),o.a.createElement(cs,{onClick:()=>this.handleChange("exclude_archived"),checked:E,icon:o.a.createElement(fa,{className:"filter-text-subtle-icon"}),text:t("FilterArchived")})),n&&n.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider",style:{margin:"8px -8px"}}),o.a.createElement(En,null,t("FilterChats")),(n||[]).slice(0,s).map(e=>o.a.createElement(os,{type:!0,onClick:()=>this.handleChatChange(e),key:e,chatId:e,checked:"include"===i?C.includes(e):S.includes(e)}))),h&&o.a.createElement("div",{className:"edit-filter-chats-search"},h.chat_ids.map(e=>o.a.createElement(os,{type:!0,onClick:()=>this.handleChatChange(e,!0),key:e,chatId:e,checked:"include"===i?C.includes(e):S.includes(e)})))))}}var gs=Object(_.a)()(ms);a(520);const fs=o.a.lazy(()=>a.e(0).then(a.bind(null,389)));class Cs extends o.a.Component{constructor(e){var t;super(e),t=this,this.loadAnimationData=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.closeData){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,a=[fetch("data/Folders_2.json")],e.next=7,Promise.all(a);case 7:return n=e.sent,e.next=10,Promise.all(n.map(e=>e.text()));case 10:i=e.sent,r=Object(L.a)(i,1),o=r[0],t.setState({data:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[3,16]])}))),this.handleDone=()=>{const e=this.props.onDone,t=this.state.editFilter,a=this.titleRef.current.value.trim();if(!a)return this.titleRef.current.focus(),void this.setState({error:!0});this.setState({error:!1}),t.title=a,function(e){if(!e)return!1;const t=e.include_contacts,a=e.include_non_contacts,n=e.include_bots,s=e.include_groups,i=e.include_channels,r=e.included_chat_ids;return!!e.title&&(t||a||n||s||i||r.length>0)}(t)?e&&e(t):this.handleScheduledAction("Please choose at least one chat for this folder.")},this.handleAnimationClick=()=>{const e=this.lottieRef.current;e&&e.isPaused&&e.play()},this.handleDeleteIncludeContacts=()=>{const e=this.props.t,t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{include_contacts:!1});this.setState({editFilter:a});this.titleRef.current.value===e("FilterContacts")&&this.setState({title:""})},this.handleDeleteIncludeNonContacts=()=>{const e=this.props.t,t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{include_non_contacts:!1});this.setState({editFilter:a});this.titleRef.current.value===e("FilterNonContacts")&&this.setState({title:""})},this.handleDeleteIncludeGroups=()=>{const e=this.props.t,t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{include_groups:!1});this.setState({editFilter:a});this.titleRef.current.value===e("FilterGroups")&&this.setState({title:""})},this.handleDeleteIncludeChannels=()=>{const e=this.props.t,t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{include_channels:!1});this.setState({editFilter:a});this.titleRef.current.value===e("FilterChannels")&&this.setState({title:""})},this.handleDeleteIncludeBots=()=>{const e=this.props.t,t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{include_bots:!1});this.setState({editFilter:a});this.titleRef.current.value===e("FilterBots")&&this.setState({title:""})},this.handleDeleteIncludedChat=e=>{const t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{included_chat_ids:t.included_chat_ids.filter(t=>t!==e)});this.setState({editFilter:a})},this.handleDeleteExcludeMuted=()=>{const e=this.state.editFilter;if(!e)return;const t=Object(Ve.a)(Object(Ve.a)({},e),{},{exclude_muted:!1});this.setState({editFilter:t})},this.handleDeleteExcludeRead=()=>{const e=this.state.editFilter;if(!e)return;const t=Object(Ve.a)(Object(Ve.a)({},e),{},{exclude_read:!1});this.setState({editFilter:t})},this.handleDeleteExcludeArchived=()=>{const e=this.state.editFilter;if(!e)return;const t=Object(Ve.a)(Object(Ve.a)({},e),{},{exclude_archived:!1});this.setState({editFilter:t})},this.handleDeleteExcludedChat=e=>{const t=this.state.editFilter;if(!t)return;const a=Object(Ve.a)(Object(Ve.a)({},t),{},{excluded_chat_ids:t.excluded_chat_ids.filter(t=>t!==e)});this.setState({editFilter:a})},this.handleOpenFilterChats=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:0,limit:1e3});case 2:n=e.sent,t.setState({openFilterChats:!0,mode:a,chats:n.chat_ids,limit:u.f});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseFilterChats=()=>{this.setDefaultFilterTitle(),this.setState({openFilterChats:!1,mode:null})},this.handleChange=(e,t)=>{const a=this.state.editFilter;if(!a)return;let n=null;switch(e){case"include_contacts":n=Object(Ve.a)(Object(Ve.a)({},a),{},{include_contacts:!a.include_contacts});break;case"include_non_contacts":n=Object(Ve.a)(Object(Ve.a)({},a),{},{include_non_contacts:!a.include_non_contacts});break;case"include_bots":n=Object(Ve.a)(Object(Ve.a)({},a),{},{include_bots:!a.include_bots});break;case"include_groups":n=Object(Ve.a)(Object(Ve.a)({},a),{},{include_groups:!a.include_groups});break;case"include_channels":n=Object(Ve.a)(Object(Ve.a)({},a),{},{include_channels:!a.include_channels});break;case"included_chat_ids":{let e,s;a.included_chat_ids.includes(t)?(e=a.included_chat_ids.filter(e=>e!==t),s=a.excluded_chat_ids):(e=[...a.included_chat_ids,t],s=a.excluded_chat_ids.filter(e=>e!==t)),n=Object(Ve.a)(Object(Ve.a)({},a),{},{included_chat_ids:e,excluded_chat_ids:s});break}case"exclude_muted":n=Object(Ve.a)(Object(Ve.a)({},a),{},{exclude_muted:!a.exclude_muted});break;case"exclude_read":n=Object(Ve.a)(Object(Ve.a)({},a),{},{exclude_read:!a.exclude_read});break;case"exclude_archived":n=Object(Ve.a)(Object(Ve.a)({},a),{},{exclude_archived:!a.exclude_archived});break;case"excluded_chat_ids":{let e,s;a.excluded_chat_ids.includes(t)?(s=a.excluded_chat_ids.filter(e=>e!==t),e=a.included_chat_ids):(s=[...a.excluded_chat_ids,t],e=a.included_chat_ids.filter(e=>e!==t)),n=Object(Ve.a)(Object(Ve.a)({},a),{},{included_chat_ids:e,excluded_chat_ids:s});break}}n&&this.setState({editFilter:n})},this.handleTitleChange=()=>{const e=this.titleRef.current.value.substr(0,u.j);this.setState({title:e})},this.handleScroll=e=>{const t=e.target;t.scrollTop+t.offsetHeight>=t.scrollHeight&&this.setState({limit:this.state.limit+u.f})},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(f.a,null))]})},this.titleRef=o.a.createRef(),this.lottieRef=o.a.createRef(),this.state={prevFilterId:-1,data:null,openFilterChats:!1,mode:null,title:"",error:!1,shook:!1,chats:[],limit:0}}static getDerivedStateFromProps(e,t){const a=e.filter,n=e.filterId,s=t.prevFilterId;return a&&s!==n?{prevFilterId:n,editFilter:Object(Ve.a)({},a),title:a.title}:null}componentDidMount(){this.loadAnimationData()}setDefaultFilterTitle(){const e=this.props.t,t=this.state.editFilter;if(!this.titleRef.current.value){const a=t.include_contacts,n=t.include_non_contacts,s=t.include_bots,i=t.include_groups,r=t.include_channels,o=t.included_chat_ids;t.exclude_muted,t.exclude_read,t.exclude_archived,t.excluded_chat_ids;o.length||(!a||n||s||i||r?a||!n||s||i||r?!a||!n||s||i||r?a||n||!s||i||r?a||n||s||!i||r?a||n||s||i||!r||this.setState({title:e("FilterChannels")}):this.setState({title:e("FilterGroups")}):this.setState({title:e("FilterBots")}):this.setState({title:e("ChatHints")}):this.setState({title:e("FilterNonContacts")}):this.setState({title:e("FilterContacts")}))}}render(){const e=this.props,t=e.t,a=e.filter,n=e.id,s=e.onClose;if(!a)return null;const i=this.state,r=i.editFilter,l=i.data,c=i.openFilterChats,d=i.mode,h=i.chats,p=i.limit,u=i.title,m=i.error,g=(i.shook,r.include_contacts),f=r.include_non_contacts,C=r.include_bots,b=r.include_groups,v=r.include_channels,E=r.included_chat_ids,S=r.exclude_muted,y=r.exclude_read,M=r.exclude_archived,I=r.excluded_chat_ids;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:s},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t(n>=0?"FilterEdit":"CreateNewFilter"))),o.a.createElement(j.a,{className:"header-right-button",color:"primary",onClick:this.handleDone},o.a.createElement(ns,null))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"filters-create-animation"},l&&o.a.createElement(o.a.Suspense,{fallback:null},o.a.createElement(fs,{ref:this.lottieRef,options:{width:80,height:80,autoplay:!0,loop:!1,fileId:"createFilter",stringData:l},onClick:this.handleAnimationClick}))),o.a.createElement("div",{className:"create-filter-title"},o.a.createElement(An.a,{inputRef:this.titleRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:t("FilterNameHint"),value:u,error:m,onChange:this.handleTitleChange})),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("FilterInclude")),o.a.createElement(cs,{className:"create-filter-add-chats",icon:o.a.createElement(Kn,null),text:t("FilterAddChats"),onClick:()=>this.handleOpenFilterChats("include")}),g&&o.a.createElement(cs,{onDelete:this.handleDeleteIncludeContacts,icon:o.a.createElement(Yn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterContacts")}),f&&o.a.createElement(cs,{onDelete:this.handleDeleteIncludeNonContacts,icon:o.a.createElement(Jn,{className:"filter-text-subtle-icon"}),text:t("FilterNonContacts")}),b&&o.a.createElement(cs,{onDelete:this.handleDeleteIncludeGroups,icon:o.a.createElement(Xn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterGroups")}),v&&o.a.createElement(cs,{onDelete:this.handleDeleteIncludeChannels,icon:o.a.createElement(Qn,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterChannels")}),C&&o.a.createElement(cs,{onDelete:this.handleDeleteIncludeBots,icon:o.a.createElement(es,{className:"filter-text-subtle-icon"}),text:t("FilterBots")}),E.map(e=>o.a.createElement(os,{key:e,chatId:e,onDelete:this.handleDeleteIncludedChat}))),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("FilterExclude")),o.a.createElement(cs,{className:"create-filter-remove-chats",icon:o.a.createElement(as.a,null),text:t("FilterRemoveChats"),onClick:()=>this.handleOpenFilterChats("exclude")}),S&&o.a.createElement(cs,{onDelete:this.handleDeleteExcludeMuted,icon:o.a.createElement(Ea,{className:"filter-text-subtle-icon"}),text:t("FilterMuted")}),y&&o.a.createElement(cs,{onDelete:this.handleDeleteExcludeRead,icon:o.a.createElement($n,{className:"filter-text-subtle-icon"}),text:t("FilterRead")}),M&&o.a.createElement(cs,{onDelete:this.handleDeleteExcludeArchived,icon:o.a.createElement(fa,{className:"filter-text-subtle-icon"}),text:t("FilterArchived")}),I.map(e=>o.a.createElement(os,{key:e,chatId:e,onDelete:this.handleDeleteExcludedChat})))),o.a.createElement(Un,{open:c,onClose:this.handleCloseFilterChats},o.a.createElement(gs,{filter:r,mode:d,chats:h,limit:p,onChange:this.handleChange,onScroll:this.handleScroll})))}}var bs=Object(d.a)(Object(_.a)(),p.b)(Cs);a(522);class vs extends o.a.Component{constructor(...e){super(...e),this.state={dialog:!1,contextMenu:!1,left:0,top:0},this.handleDelete=()=>{this.handleCloseContextMenu(),this.handleOpenDialog()},this.handleOpenDialog=()=>{this.setState({dialog:!0})},this.handleCloseDialog=()=>{this.setState({dialog:!1})},this.handleDeleteCancel=()=>{this.handleCloseDialog()},this.handleDeleteConfirm=()=>{const e=this.props.info;e&&(this.handleCloseDialog(),x.a.send({"@type":"deleteChatFilter",chat_filter_id:e.id}))},this.handleOpenContextMenu=e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY})},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})}}render(){const e=this.props,t=e.t,a=e.info,n=e.onEdit,s=e.chats;if(!a)return null;const i=this.state,r=i.dialog,l=i.contextMenu,c=i.top,d=i.left,h=a.title,p=function(e,t,a){if(!a)return" ";let n=0;for(let s=0;s<a.chat_ids.length;s++)"0"!==Object(F.r)(a.chat_ids[s],{"@type":"chatListFilter",chat_filter_id:t})&&n++;return n?1===n?"1 chat":"".concat(n," chats"):e("FilterNoChats")}(t,a.id,s);return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement(fe.a,{className:"settings-list-item-text2",primary:h,secondary:p})),o.a.createElement(Ge.a,{open:l,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:c,left:d},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:t("Delete")})))),o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:r,onClose:this.handleCancel,"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},t("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,t("FilterDeleteAlert"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleDeleteCancel,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDeleteConfirm,color:"primary"},t("Ok")))))}}var Es=Object(_.a)()(vs);a(523);class Ss extends o.a.Component{constructor(...e){super(...e),this.handleAdd=()=>{const e=this.props.filter;if(!e)return;const t=e.filter;x.a.send({"@type":"createChatFilter",filter:t})}}render(){const e=this.props,t=e.t,a=e.filter;if(!a)return null;const n=a.filter,s=a.description;return o.a.createElement(me.a,{className:"settings-list-item2",role:void 0,button:!0},o.a.createElement(fe.a,{className:"settings-list-item-text",primary:n.title,secondary:s}),o.a.createElement(N.a,{className:"recommended-filter-add",variant:"contained",disableElevation:!0,color:"primary",onClick:this.handleAdd},t("Add")))}}var ys=Object(_.a)()(Ss);a(524);const Ms=o.a.lazy(()=>a.e(0).then(a.bind(null,389)));class Is extends o.a.Component{constructor(e){var t;super(e),t=this,this.onUpdateChatFilters=e=>{setTimeout(()=>{this.loadData()},100)},this.loadAnimationData=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.closeData){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,a=[fetch("data/Folders_1.json"),fetch("data/Folders_2.json")],e.next=7,Promise.all(a);case 7:return n=e.sent,e.next=10,Promise.all(n.map(e=>e.text()));case 10:i=e.sent,r=Object(L.a)(i,1),o=r[0],t.setState({data:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[3,16]])}))),this.handleCreateFilter=()=>{const e=this.props.t;if(Fa.a.filters.length>=u.i)return void this.handleScheduledAction(e("FilterCreateError"));this.setState({openFilter:!0,filterId:-1,filter:{"@type":"chatFiler",title:"",icon_name:"",pinned_chat_ids:[],included_chat_ids:[],excluded_chat_ids:[],exclude_muted:!1,exclude_read:!1,exclude_archived:!1,include_contacts:!1,include_non_contacts:!1,include_bots:!1,include_groups:!1,include_channels:!1}})},this.handleCloseFilter=()=>{this.setState({openFilter:!1,filterId:-1,filter:null})},this.handleEditFilter=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"getChatFilter",chat_filter_id:a.id});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.setState({openFilter:!0,filterId:a.id,filter:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleDone=e=>{const t=this.state.filterId;this.handleCloseFilter(),e&&(-1!==t?x.a.send({"@type":"editChatFilter",chat_filter_id:t,filter:e}):x.a.send({"@type":"createChatFilter",filter:e}))},this.handleAnimationClick=()=>{const e=this.lottieRef.current;e&&e.isPaused&&e.play()},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(f.a,null))]})},this.lottieRef=o.a.createRef(),this.state={openFilter:!1,filterId:-1,filter:null,editFilter:null,recommendedFilters:null,chats:null,filtersMap:new Map}}componentDidMount(){this.loadAnimationData(),this.loadData(),Fa.a.on("updateChatFilters",this.onUpdateChatFilters)}componentWillUnmount(){Fa.a.off("updateChatFilters",this.onUpdateChatFilters)}loadData(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o,l,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_chat_id:0,offset_order:"9223372036854775807",limit:1e3});case 2:for(a=t.sent,n=Fa.a.filters,i=[],r=0;n&&r<n.length;r++)i.push(x.a.send({"@type":"getChatFilter",chat_filter_id:n[r].id}).catch(e=>null));return t.next=8,Promise.all(i);case 8:for(o=t.sent,l=new Map,r=0;n&&r<n.length;r++)l.set(n[r].id,o[r]);return t.next=13,x.a.send({"@type":"getRecommendedChatFilters"});case 13:c=t.sent,e.setState({chats:a,filtersMap:l,recommendedFilters:c});case 15:case"end":return t.stop()}}),t)})))()}render(){const e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.recommendedFilters,i=n.openFilter,r=n.filter,l=n.filterId,c=n.data,d=n.chats,h=n.filtersMap,p=Fa.a.filters,m=p&&p.length>0,g=s&&s.chat_filters.length>0&&(!p||p.length<u.i);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:a},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("FilterAvailableTitle")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section filters-create"},o.a.createElement("div",{className:"filters-create-animation"},c&&o.a.createElement(o.a.Suspense,{fallback:null},o.a.createElement(Ms,{ref:this.lottieRef,options:{width:80,height:80,autoplay:!0,loop:!1,fileId:"filters",stringData:c},onClick:this.handleAnimationClick}))),o.a.createElement("div",{className:"filters-create-hint"},t("CreateNewFilterInfo")),o.a.createElement(N.a,{className:"filters-create-button",color:"primary",variant:"contained",disableElevation:!0,startIcon:o.a.createElement(Kn,null),onClick:this.handleCreateFilter},t("CreateNewFilter"))),m&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("Filters")),(p||[]).map(e=>o.a.createElement(Es,{key:e.id,info:e,filter:h.get(e.id),chats:d,onEdit:()=>this.handleEditFilter(e)})))),g&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("FilterRecommended")),s.chat_filters.map(e=>o.a.createElement(ys,{key:e.filter.title,filter:e}))))),o.a.createElement(Un,{open:i,onClose:this.handleCloseFilter},o.a.createElement(bs,{filter:r,id:l,onDone:this.handleDone})))}}var Us=Object(d.a)(Object(_.a)(),p.b)(Is),ks=Object(he.a)(o.a.createElement("path",{d:"M19.2869988,2.88316725 L19.4142136,3 L21,4.58578644 C21.7399408,5.3257272 21.778885,6.50121136 21.1168328,7.28699879 L21,7.41421356 L17.414,10.9992136 L18.2071068,11.7928932 C18.5976311,12.1834175 18.5976311,12.8165825 18.2071068,13.2071068 C17.8466228,13.5675907 17.2793918,13.5953203 16.8871006,13.2902954 L16.7928932,13.2071068 L16,12.4142136 L7.70710678,20.7071068 C7.55082647,20.8633871 7.34814508,20.9625983 7.13144398,20.9913276 L7,21 L4,21 C3.48716416,21 3.06449284,20.6139598 3.00672773,20.1166211 L3,20 L3,17 C3,16.7789863 3.07316447,16.565516 3.20608063,16.3919705 L3.29289322,16.2928932 L11.585,7.99921356 L10.7928932,7.20710678 C10.4023689,6.81658249 10.4023689,6.18341751 10.7928932,5.79289322 C11.1533772,5.43240926 11.7206082,5.40467972 12.1128994,5.70970461 L12.2071068,5.79289322 L13,6.58521356 L16.5857864,3 C17.3257272,2.26005924 18.5012114,2.22111499 19.2869988,2.88316725 Z M13,9.415 L5,17.414 L5,18.999 L6.585,18.999 L14.585,11 L13,9.415 Z M18,4.41421356 L14.414,7.99921356 L16,9.58521356 L19.5857864,6 L18,4.41421356 Z"}),"Colorize"),xs=(a(525),a(77));class ws extends o.a.Component{constructor(...e){super(...e),this.state={loaded:!1},this.onClientUpdateDocumentThumbnailBlob=e=>{const t=this.props.wallpaper;if(!t)return;const a=t.document;if(!a)return;const n=a.thumbnail;if(!n)return;const s=n.file;if(!s)return;const i=e.fileId;s.id===i&&this.forceUpdate()},this.handleLoad=()=>{this.setState({loaded:!0})},this.handleClick=()=>{const e=this.props,t=e.wallpaper,a=e.onClick;a&&a(t)}}componentDidMount(){U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}componentWillUnmount(){U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}render(){const e=this.props,t=e.wallpaper,a=e.isSelected,n=(this.state.loaded,t.document),s=n.minithumbnail,i=n.thumbnail,r=s?"data:image/jpeg;base64, "+s.data:null,l=Object(W.m)(i?i.file:null),c=l||r;return o.a.createElement("div",{className:"shared-photo",onClick:this.handleClick},o.a.createElement("div",{className:"shared-photo-content",style:{backgroundImage:"url(".concat(l||r,")"),backgroundSize:"cover",backgroundPosition:"50%"}},c!==l&&o.a.createElement("div",{className:"shared-photo-main-content",style:{backgroundImage:"url(".concat(c,")")}})),a&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"wallpaper-selected"}),o.a.createElement("div",{className:"wallpaper-selected-inner"})),n&&n.document&&o.a.createElement(xs.a,{file:n.document,cancelButton:!1}))}}var Os=ws;a(526);class Ls extends o.a.Component{constructor(...e){super(...e),this.state={selectedId:Se.a.wallpaper?Se.a.wallpaper.id:-1},this.handleClick=e=>{this.setState({selectedId:e.id});const t=e.document;if(!t)return;t.thumbnail;const a=t.document;if(!a)return;if(!Object(W.m)(a)){const t=U.a.getStore();Object(W.u)(t,e,!0)}x.a.clientUpdate({"@type":"clientUpdateChatBackground",wallpaper:e})}}componentDidMount(){this.loadContent()}loadContent(){const e=this.props.backgrounds;if(!e)return;const t=U.a.getStore();Object(W.v)(t,e.backgrounds)}render(){const e=this.props,t=e.t,a=e.backgrounds,n=e.onClose,s=this.state.selectedId,i=a.backgrounds.filter(e=>"backgroundTypeWallpaper"===e.type["@type"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:n},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("ChatBackground")))),o.a.createElement("div",{className:"sidebar-page-content shared-media-list shared-photos-list"},i.map(e=>o.a.createElement(Os,{key:e.id,wallpaper:e,isSelected:e.id===s,onClick:this.handleClick}))))}}var _s=Object(_.a)()(Ls),Ns=a(188),js=a.n(Ns),Ps=a(659),Ts=a(661),Rs=a(412),Ds=a(370),Fs=a(257),As=a.n(Fs),Bs=a(258),Hs=a.n(Bs),Vs=a(528),zs=a.n(Vs),Ws=a(259),Gs=a.n(Ws),Zs=a(256),qs=a.n(Zs),Ks=a(529),Ys=a.n(Ks);a(527);class Js extends o.a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({type:e.target.value}),ae.a.emit("clientUpdateThemeChanging",{type:e.target.value,primary:this.getColor(this.state.color)})},this.handleAccentChange=e=>{this.setState({color:e.target.value}),ae.a.emit("clientUpdateThemeChanging",{type:this.state.type,primary:this.getColor(e.target.value)})},this.getColorString=e=>{switch(e){case As.a[500]:return"red";case Hs.a[500]:return"orange";case zs.a[500]:return"amber";case Gs.a[500]:return"green";case"#50A2E9":return"blue";case qs.a[500]:return"indigo";case Ys.a[500]:return"deepPurple"}return null},this.getColor=e=>{switch(e){case"red":return As.a;case"orange":return Hs.a;case"amber":return zs.a;case"green":return Gs.a;case"blue":return{main:"#50A2E9"};case"indigo":return qs.a;case"deepPurple":return Ys.a}return null},this.handleClose=()=>{this.setState({open:!1})},this.open=()=>{this.setState({open:!0})},this.state={open:!1,type:this.props.theme.palette.type,color:this.getColorString(this.props.theme.palette.primary.main)}}render(){const e=this.props.t,t=this.state,a=t.type,n=t.color,s=t.open;return o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:s,onClose:this.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(R.a,{id:"alert-dialog-title"},e("Appearance")),o.a.createElement(Ln.a,null,o.a.createElement(Rs.a,{component:"fieldset",className:"theme-picker-form"},o.a.createElement(Ds.a,{focused:!0,component:"legend"},e("Theme")),o.a.createElement(Ps.a,{"aria-label":"theme",name:"theme1",className:"theme-picker-group",value:a,onChange:this.handleChange},o.a.createElement(Ts.a,{value:"light",control:o.a.createElement(is.a,{color:"primary"}),label:"Light"}),o.a.createElement(Ts.a,{value:"dark",control:o.a.createElement(is.a,{color:"primary"}),label:"Dark"}))),o.a.createElement(Rs.a,{component:"fieldset",className:"theme-picker-form"},o.a.createElement(Ds.a,{focused:!0,component:"legend"},e("Accent")),o.a.createElement(Ps.a,{"aria-label":"accent",name:"accent1",className:"theme-picker-group",value:n,onChange:this.handleAccentChange},o.a.createElement(Ts.a,{value:"red",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-red"}}),label:"Red"}),o.a.createElement(Ts.a,{value:"orange",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-orange"}}),label:"Orange"}),o.a.createElement(Ts.a,{value:"amber",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-amber"}}),label:"Amber"}),o.a.createElement(Ts.a,{value:"green",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-green"}}),label:"Green"}),o.a.createElement(Ts.a,{value:"blue",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-blue"}}),label:"Blue"}),o.a.createElement(Ts.a,{value:"indigo",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-indigo"}}),label:"Indigo"}),o.a.createElement(Ts.a,{value:"deepPurple",control:o.a.createElement(is.a,{color:"primary",classes:{root:"theme-picker-deep-purple"}}),label:"Deep Purple"})))))}}var Xs=Object(d.a)(Object(d.d)(),js.a,Object(_.a)(),Object(d.c)())(Js);a(530);class Qs extends o.a.Component{constructor(e){super(e),this.handleAppearance=()=>{this.themePickerRef.current.open()},this.loadContent=()=>{x.a.send({"@type":"getBackgrounds",for_dark_theme:!1}).then(e=>this.setState({backgrounds:e}))},this.openChatBackground=()=>{this.state.backgrounds&&this.setState({openChatBackground:!0})},this.closeChatBackground=()=>{this.setState({openChatBackground:!1})},this.state={backgrounds:null,openChatBackground:!1},this.themePickerRef=o.a.createRef()}componentDidMount(){this.loadContent()}render(){const e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.backgrounds,i=n.openChatBackground;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:a},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("GeneralSettings")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(me.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:this.handleAppearance},o.a.createElement(ge.a,null,o.a.createElement(ks,null)),o.a.createElement(fe.a,{primary:t("Appearance")})))),o.a.createElement(Un,{open:i,onClose:this.closeChatBackground},o.a.createElement(_s,{backgrounds:s})),o.a.createElement(Xs,{ref:this.themePickerRef}))}}var $s=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(Qs);a(531);class ei extends o.a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({language:e}),x.a.clientUpdate({"@type":"clientUpdateLanguageChange",language:e})};const t=e.i18n,a=t?t.language:null;this.state={language:a||"en"}}render(){const e=this.props,t=e.t,a=e.onClose,n=this.state.language,s=(an.a.info||{language_packs:[]}).language_packs.map(e=>o.a.createElement("div",{key:e.id,className:"settings-item",onClick:()=>this.handleChange(e.id)},o.a.createElement(is.a,{color:"primary",className:"settings-item-control",checked:n===e.id,tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(fe.a,{id:"label-2",primary:e.name,secondary:e.native_name})));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:a},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("Language")))),o.a.createElement("div",{className:"sidebar-page-content"},s))}}var ti=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(ei);a(532);class ai extends o.a.Component{constructor(e){super(e),this.handleMuteFor=e=>{const t=this.state[e];if(!t)return;const a=t.mute_for,n=Object(Ve.a)(Object(Ve.a)({},t),{},{mute_for:0===a?31536e3:0});this.setState({[e]:n})},this.handleShowPreview=e=>{const t=this.state[e];if(!t)return;const a=t.show_preview,n=Object(Ve.a)(Object(Ve.a)({},t),{},{show_preview:!a});this.setState({[e]:n})},this.handleContactJoined=()=>{this.setState({contactJoined:!this.state.contactJoined})};const t=G.a.get("disable_contact_registered_notifications");this.state={privateChatsSettings:Te.a.settings.get("notificationSettingsScopePrivateChats"),groupChatsSettings:Te.a.settings.get("notificationSettingsScopeGroupChats"),channelChatsSettings:Te.a.settings.get("notificationSettingsScopeChannelChats"),contactJoined:!t||!t.value}}componentWillUnmount(){const e=this.state,t=e.privateChatsSettings,a=e.groupChatsSettings,n=e.channelChatsSettings,s=e.contactJoined;this.setScopeNotificationSettings("notificationSettingsScopePrivateChats",t),this.setScopeNotificationSettings("notificationSettingsScopeGroupChats",a),this.setScopeNotificationSettings("notificationSettingsScopeChannelChats",n),this.setContactJoinedOption(s)}setContactJoinedOption(){const e=this.state.contactJoined,t=G.a.get("disable_contact_registered_notifications");(!t||!t.value)!==e&&x.a.send({"@type":"setOption",name:"disable_contact_registered_notifications",value:{"@type":"optionValueBoolean",value:!e}})}setScopeNotificationSettings(e,t){if(!e)return;if(!t)return;const a=Te.a.settings.get(e);if(!a)return;const n=t.mute_for,s=t.show_preview,i=a.mute_for,r=a.show_preview;n===i&&s===r||x.a.send({"@type":"setScopeNotificationSettings",scope:{"@type":e},notification_settings:t})}isEnabled(e){if(!e)return!1;return 0===e.mute_for}showPreview(e){if(!e)return!1;return e.show_preview}render(){const e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.privateChatsSettings,i=n.groupChatsSettings,r=n.channelChatsSettings,l=n.contactJoined;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:a},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("Notifications")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("NotificationsPrivateChats")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("privateChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(s),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(fe.a,{id:"label-1",primary:t("NotificationsForPrivateChats"),secondary:this.isEnabled(s)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("privateChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(s),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(fe.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(s)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("NotificationsGroups")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("groupChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(i),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(fe.a,{id:"label-1",primary:t("NotificationsForGroups"),secondary:this.isEnabled(i)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("groupChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(i),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(fe.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(i)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("NotificationsChannels")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("channelChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(r),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(fe.a,{id:"label-1",primary:t("NotificationsForChannels"),secondary:this.isEnabled(r)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("channelChatsSettings")},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(r),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(fe.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(r)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("NotificationsOther")),o.a.createElement("div",{className:"settings-item",onClick:this.handleContactJoined},o.a.createElement(je.a,{color:"primary",className:"settings-item-control",checked:l,tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(fe.a,{id:"label-1",primary:t("ContactJoined"),secondary:t(l?"ContactJoinedEnabled":"ContactJoinedDisabled")})))))}}var ni=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(ai),si=Object(he.a)(o.a.createElement("g",{transform:"translate(-1.000000, -1.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M8,11 L16,11 C16.5522847,11 17,11.4477153 17,12 C17,12.5128358 16.6139598,12.9355072 16.1166211,12.9932723 L16,13 L8,13 C7.44771525,13 7,12.5522847 7,12 C7,11.4871642 7.38604019,11.0644928 7.88337887,11.0067277 L8,11 L16,11 L8,11 Z"})),"Stop");a(533);class ii extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0},this.handleContextMenu=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=this.props.session;if(!t)return;if(t.is_current)return;if(this.state.contextMenu)this.setState({contextMenu:!1});else{const t=e.clientX,a=e.clientY;this.setState({contextMenu:!0,left:t,top:a})}},this.handleCloseContextMenu=e=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleTerminate=e=>{this.handleCloseContextMenu(e);const t=this.props;(0,t.onTerminate)(t.session)}}render(){const e=this.props,t=e.session,a=e.t;if(!t)return null;const n=this.state,s=n.left,i=n.top,r=n.contextMenu,l=t.is_current,c=t.application_name,d=t.application_version,h=t.device_model,p=t.platform,u=t.system_version,m=t.ip,g=t.region,f=t.country,C=t.last_active_date,b=!l;return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{className:"settings-list-item",button:!0,onContextMenu:this.handleContextMenu},o.a.createElement("div",{className:"session"},o.a.createElement("div",{className:"session-title"},o.a.createElement("div",{className:"session-app"},"".concat(c," ").concat(d)),b&&o.a.createElement("div",{className:"session-date"},Object(F.I)({date:C}))),o.a.createElement("div",{className:"session-subtitle1"},"".concat(h,", ").concat(p," ").concat(u)),o.a.createElement("div",{className:"session-subtitle2"},"".concat(m," - "),g&&"".concat(g,", "),f&&"".concat(f)))),o.a.createElement(Ge.a,{open:r,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:i,left:s},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:this.handleTerminate},o.a.createElement(ge.a,null,o.a.createElement(si,null)),o.a.createElement(fe.a,{primary:a("Terminate")})))))}}var ri=Object(_.a)()(ii);a(534);class oi extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={open:!1,openAll:!1,session:null},this.handleTerminate=e=>{this.setState({open:!0,session:e})},this.handleTerminateAllOther=()=>{this.setState({openAll:!0})},this.handleCloseConfirmation=()=>{this.setState({open:!1,session:null})},this.handleDoneConfirmation=Object(i.a)(s.a.mark((function e(){var a,n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.sessions,a.t,i=t.state.session){e.next=4;break}return e.abrupt("return");case 4:return t.setState({open:!1,session:null}),e.next=7,x.a.send({"@type":"terminateSession",session_id:i.id});case 7:n.sessions=n.sessions.filter(e=>e.id!==i.id),t.forceUpdate();case 9:case"end":return e.stop()}}),e)}))),this.handleCloseAllConfirmation=()=>{this.setState({openAll:!1})},this.handleDoneAllConfirmation=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.props.sessions,t.setState({openAll:!1}),e.next=4,x.a.send({"@type":"terminateAllOtherSessions"});case 4:a.sessions=a.sessions.filter(e=>!e.is_current),t.forceUpdate();case 6:case"end":return e.stop()}}),e)})))}render(){const e=this.props,t=e.t,a=e.sessions,n=e.onClose,s=this.state,i=s.open,r=s.openAll,l=a.sessions.find(e=>e.is_current),c=a.sessions.filter(e=>!e.is_current);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:n},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("SessionsTitle")))),o.a.createElement("div",{className:"sidebar-page-content"},Boolean(l)&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("CurrentSession")),o.a.createElement(ri,{session:l,onTerminate:this.handleTerminate}),c.length>0&&o.a.createElement(me.a,{className:"settings-list-item",button:!0,disableRipple:!0,onClick:this.handleTerminateAllOther},o.a.createElement(ge.a,null,o.a.createElement(si,{color:"secondary"})),o.a.createElement(fe.a,{primaryTypographyProps:{color:"secondary"},primary:t("TerminateAllSessions")}))),c.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(En,null,t("OtherSessions")),c.map(e=>o.a.createElement(ri,{key:e.id,session:e,onTerminate:this.handleTerminate}))))),o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:i,onClose:this.handleCloseConfirmation,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,{style:{whiteSpace:"pre-wrap"}},t("TerminateSessionText"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCloseConfirmation,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDoneConfirmation,color:"primary"},t("Ok")))),o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:r,onClose:this.handleCloseAllConfirmation,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,{style:{whiteSpace:"pre-wrap"}},t("AreYouSureSessions"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCloseAllConfirmation,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDoneAllConfirmation,color:"primary"},t("Ok")))))}}var li=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(oi),ci=a(234),di=Object(he.a)(o.a.createElement("path",{d:"M18,1 C20.6887547,1 22.8818181,3.12230671 22.9953805,5.78311038 L23,6 L23,9 C23,9.55228475 22.5522847,10 22,10 C21.4871642,10 21.0644928,9.61395981 21.0067277,9.11662113 L21,9 L21,6 C21,4.34314575 19.6568542,3 18,3 C16.4023191,3 15.0963391,4.24891996 15.0050927,5.82372721 L15,6 L15,8 C16.6568542,8 18,9.34314575 18,11 L18,19 C18,20.6568542 16.6568542,22 15,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,11 C2,9.34314575 3.34314575,8 5,8 L13,8 L13,6 C13,3.3112453 15.1223067,1.11818189 17.7831104,1.00461951 L18,1 Z M15,10 L5,10 C4.44771525,10 4,10.4477153 4,11 L4,19 C4,19.5522847 4.44771525,20 5,20 L15,20 C15.5522847,20 16,19.5522847 16,19 L16,11 C16,10.4477153 15.5522847,10 15,10 Z M10,13.5 C10.8284271,13.5 11.5,14.1715729 11.5,15 C11.5,15.8284271 10.8284271,16.5 10,16.5 C9.17157288,16.5 8.5,15.8284271 8.5,15 C8.5,14.1715729 9.17157288,13.5 10,13.5 Z"}),"Unblock");a(535);const hi=o.a.memo(({userId:e,onClick:t,onUnblock:a})=>{const n=o.a.useState(!1),s=Object(L.a)(n,2),i=s[0],r=s[1],l=o.a.useState(0),c=Object(L.a)(l,2),d=c[0],h=c[1],p=o.a.useState(0),u=Object(L.a)(p,2),m=u[0],g=u[1],f=Object(ci.a)().t,C=()=>{r(!1),g(0),h(0)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{className:"settings-list-item",button:!0,onClick:()=>{t(e)},onContextMenu:e=>{if(e&&(e.preventDefault(),e.stopPropagation()),i)r(!1);else{const t=e.clientX,a=e.clientY;r(!0),g(t),h(a)}}},o.a.createElement(ve.a,{userId:e})),o.a.createElement(Ge.a,{open:i,onClose:C,anchorReference:"anchorPosition",anchorPosition:{top:d,left:m},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},o.a.createElement(We.a,{onClick:()=>{C(),a(e)}},o.a.createElement(ge.a,null,o.a.createElement(di,null)),o.a.createElement(fe.a,{primary:f("Unblock")})))))});class pi extends o.a.Component{constructor(...e){super(...e),this.handleUnblockUser=function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(ka.i)({"@type":"messageSenderUser",user_id:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}componentDidMount(){this.loadContent()}loadContent(){const e=this.props.users,t=U.a.getStore();Object(W.K)(t,e.senders.filter(e=>"messageSenderUser"===e["@type"]).map(e=>e.user_id)),Object(W.x)(t,e.senders.filter(e=>"messageSenderChat"===e["@type"]).map(e=>e.chat_id))}render(){const e=this.props,t=e.onClose,a=e.users,n=e.t;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:t},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},n("BlockedUsers")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},a.senders.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement(En,{multiline:!0},n("BlockedUsersInfo")),a.senders.filter(e=>"messageSenderUser"===e["@type"]).map(e=>o.a.createElement(hi,{key:e.user_id,userId:e.user_id,onClick:Q.m,onUnblock:this.handleUnblockUser}))):o.a.createElement(En,null,n("NoBlocked")))))}}var ui=Object(_.a)()(pi),mi=Object(he.a)(o.a.createElement("g",{transform:"translate(0.000000, -2.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M18,2 C20.209139,2 22,3.790861 22,6 L22,6 L22,8 C22,8.55228475 21.5522847,9 21,9 C20.4477153,9 20,8.55228475 20,8 L20,8 L20,6 C20,4.8954305 19.1045695,4 18,4 L18,4 L4,4 C2.8954305,4 2,4.8954305 2,6 L2,6 L2,14 C2,15.1045695 2.8954305,16 4,16 L4,16 L14,16 C14.5522847,16 15,16.4477153 15,17 C15,17.5522847 14.5522847,18 14,18 L14,18 L12,18 L12,20 L14,20 C14.5128358,20 14.9355072,20.3860402 14.9932723,20.8833789 L15,21 C15,21.5522847 14.5522847,22 14,22 L14,22 L8,22 C7.44771525,22 7,21.5522847 7,21 C7,20.4477153 7.44771525,20 8,20 L8,20 L10,20 L10,18 L4,18 C1.85780461,18 0.108921124,16.3160315 0.00489530723,14.1996403 L0,14 L0,6 C0,3.790861 1.790861,2 4,2 L4,2 Z M22,11 C23.1045695,11 24,11.8954305 24,13 L24,20 C24,21.1045695 23.1045695,22 22,22 L19,22 C17.8954305,22 17,21.1045695 17,20 L17,13 C17,11.8954305 17.8954305,11 19,11 L22,11 Z M22,13 L19,13 L19,20 L22,20 L22,13 Z"})),"Device"),gi=Object(he.a)(o.a.createElement("g",{transform:"translate(-1.000000, -3.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M9,13 C12.3229116,13 14.7530244,13.8337117 16.2223821,15.5699359 C16.724477,16.1632234 17,16.915291 17,17.6925226 L17,18.5 C17,19.8807119 15.8807119,21 14.5,21 L3.5,21 C2.11928813,21 1,19.8807119 1,18.5 L1,17.6925204 C1,16.9152876 1.2755246,16.1632192 1.77762117,15.569932 C3.24697824,13.8337108 5.67709024,13 9,13 Z M9,15 C6.21130036,15 4.33538166,15.6435809 3.30428673,16.861943 C3.10781409,17.0940989 3,17.3883868 3,17.6925212 L3,18.5 C3,18.7761424 3.22385763,19 3.5,19 L14.5,19 C14.7761424,19 15,18.7761424 15,18.5 L15,17.6925226 C15,17.3883883 14.8921864,17.0941004 14.6957148,16.8619448 C13.6646202,15.6435815 11.788701,15 9,15 Z M16,10 L22,10 C22.5522847,10 23,10.4477153 23,11 C23,11.5128358 22.6139598,11.9355072 22.1166211,11.9932723 L22,12 L16,12 C15.4477153,12 15,11.5522847 15,11 C15,10.4871642 15.3860402,10.0644928 15.8833789,10.0067277 L16,10 L22,10 L16,10 Z M9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 Z M9,5 C7.8954305,5 7,5.8954305 7,7 C7,8.1045695 7.8954305,9 9,9 C10.1045695,9 11,8.1045695 11,7 C11,5.8954305 10.1045695,5 9,5 Z"})),"RemoveMember");a(536);class fi extends o.a.Component{constructor(...e){super(...e),this.state={sessions:null,users:null,openBlockedUsers:!1,openActiveSessions:!1},this.onUpdateUserFullInfo=e=>{const t=e.user_id,a=e.user_full_info,n=this.state.users;if(!n)return;const s=n.total_count,i=n.senders,r=a.is_blocked;r!==(-1!==i.findIndex(e=>e.user_id===t))&&(r?this.setState({users:Object(Ve.a)(Object(Ve.a)({},n),{},{total_count:s+1,senders:[{"@type":"messageSenderUser",user_id:t},...i]})}):this.setState({users:Object(Ve.a)(Object(Ve.a)({},n),{},{total_count:s-1,senders:i.filter(e=>e.user_id!==t)})}))},this.openActiveSessions=()=>{this.state.sessions&&this.setState({openActiveSessions:!0})},this.closeActiveSessions=()=>{this.setState({openActiveSessions:!1})},this.openBlockedUsers=()=>{this.state.users&&this.setState({openBlockedUsers:!0})},this.closeBlockedUsers=()=>{this.setState({openBlockedUsers:!1})}}componentDidMount(){this.loadContent(),te.a.on("updateUserFullInfo",this.onUpdateUserFullInfo)}componentWillUnmount(){te.a.off("updateUserFullInfo",this.onUpdateUserFullInfo)}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:x.a.send({"@type":"getActiveSessions"}).then(t=>e.setState({sessions:t})),x.a.send({"@type":"getBlockedMessageSenders",offset:0,limit:100}).then(t=>e.setState({users:t}));case 2:case"end":return t.stop()}}),t)})))()}render(){const e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.openBlockedUsers,i=n.users,r=n.openActiveSessions,l=n.sessions,c=l&&l.sessions.length>0?1===l.sessions.length?"1 session":"".concat(l.sessions.length," sessions"):"1 session",d=i&&i.total_count>0?1===i.total_count?"1 user":"".concat(i.total_count," users"):"no users";return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:a},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("PrivacySettings")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(me.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:this.openBlockedUsers},o.a.createElement(ge.a,{className:"settings-list-item-icon"},o.a.createElement(gi,null)),o.a.createElement(fe.a,{id:"label-2",className:"settings-list-item-text",primary:t("BlockedUsers"),secondary:d})),o.a.createElement(me.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:this.openActiveSessions},o.a.createElement(ge.a,{className:"settings-list-item-icon"},o.a.createElement(mi,null)),o.a.createElement(fe.a,{id:"label-2",className:"settings-list-item-text",primary:t("SessionsTitle"),secondary:c})))),o.a.createElement(Un,{open:s,onClose:this.closeBlockedUsers},o.a.createElement(ui,{users:i})),o.a.createElement(Un,{open:r,onClose:this.closeActiveSessions},o.a.createElement(li,{sessions:l})))}}var Ci=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(fi);a(537);class bi extends o.a.Component{constructor(e){super(e),this.onUpdateChatPhoto=e=>{const t=this.props.chatId,a=e.chat_id,n=e.photo;if(a!==t)return;if(!n)return;const s=U.a.get();Object(W.w)(s,t,!0)},this.openEditProfile=()=>{this.setState({openEditProfile:!0})},this.closeEditProfile=()=>{this.setState({openEditProfile:!1})},this.openGeneral=()=>{this.setState({openGeneral:!0})},this.closeGeneral=()=>{this.setState({openGeneral:!1})},this.openNotifications=()=>{this.setState({openNotifications:!0})},this.closeNotifications=()=>{this.setState({openNotifications:!1})},this.openPrivacySecurity=()=>{this.setState({openPrivacySecurity:!0})},this.closePrivacySecurity=()=>{this.setState({openPrivacySecurity:!1})},this.openLanguage=()=>{this.setState({openLanguage:!0})},this.closeLanguage=()=>{this.setState({openLanguage:!1})},this.openFilters=()=>{this.setState({openFilters:!0})},this.closeFilters=()=>{this.setState({openFilters:!1})},this.handleCloseSettings=()=>{x.a.clientUpdate({"@type":"clientUpdateSettings",open:!1})},this.state={openEditProfile:!1,openGeneral:!1,openNotifications:!1,openPrivacySecurity:!1,openLanguage:!1,openFilters:!1}}componentDidMount(){this.loadContent(),Se.a.on("updateChatPhoto",this.onUpdateChatPhoto)}componentWillUnmount(){Se.a.off("updateChatPhoto",this.onUpdateChatPhoto)}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.props.chatId,n=U.a.getStore(),Object(W.w)(n,a,!0),t.next=5,x.a.send({"@type":"getUserFullInfo",user_id:te.a.getMyId()});case 5:i=t.sent,te.a.setFullInfo(te.a.getMyId(),i);case 7:case"end":return t.stop()}}),t)})))()}render(){const e=this.props,t=e.chatId,a=e.popup,n=this.state,s=n.openEditProfile,i=n.openGeneral,r=n.openNotifications,l=n.openPrivacySecurity,c=n.openLanguage,d=n.openFilters;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Fn,{chatId:t,popup:a,onClose:this.handleCloseSettings,onEditProfile:this.openEditProfile,onGeneral:this.openGeneral,onNotifications:this.openNotifications,onPrivacySecurity:this.openPrivacySecurity,onLanguage:this.openLanguage,onFilters:this.openFilters}),o.a.createElement(Un,{open:s,onClose:this.closeEditProfile},o.a.createElement(qn,{chatId:t})),o.a.createElement(Un,{open:i,onClose:this.closeGeneral},o.a.createElement($s,{chatId:t})),o.a.createElement(Un,{open:r,onClose:this.closeNotifications},o.a.createElement(ni,{chatId:t})),o.a.createElement(Un,{open:l,onClose:this.closePrivacySecurity},o.a.createElement(Ci,null)),o.a.createElement(Un,{open:d,onClose:this.closeFilters},o.a.createElement(Us,null)),o.a.createElement(Un,{open:c,onClose:this.closeLanguage},o.a.createElement(ti,null)))}}var vi=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(bi);a(442);class Ei extends o.a.Component{shouldComponentUpdate(e,t,a){const n=this.props,s=n.userId,i=n.style;return e.userId!==s||e.style.top!==i.top}render(){const e=this.props,t=e.userId,a=e.onClick,n=e.style;return o.a.createElement(me.a,{className:"user-list-item",onClick:()=>a(t),button:!0,style:n},o.a.createElement(ve.a,{userId:t}))}}class Si extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleScroll=e=>{this.handleDebounceScroll(),this.handleThrottleScroll()},this.loadRenderIdsContent=()=>{const e=this.state,t=e.items,a=e.searchItems,n=a||t,s=(n===a?this.searchListRef:this.listRef).current;if(!s)return;const i=s.getListRenderIds();if(i.size>0){const e=[];[...i.keys()].forEach(t=>{e.push(n.user_ids[t])});const t=U.a.getStore();Object(W.K)(t,e)}},this.handleOpenUser=e=>{Object(Q.m)(e,!1),this.handleClose()},this.renderItem=({index:e,style:t},a)=>{const n=a.user_ids[e];return o.a.createElement(Ei,{key:n,userId:n,onClick:()=>this.handleOpenUser(n),style:t})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null}),e.abrupt("return");case 4:return e.next=6,x.a.send({"@type":"searchContacts",query:n,limit:1e3});case 6:(i=e.sent).user_ids=i.user_ids.sort((e,t)=>Object(Et.c)(e).localeCompare(Object(Et.c)(t))),r=U.a.getStore(),Object(W.K)(r,i.user_ids.slice(0,20)),t.setState({searchItems:i});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateContacts",open:!1})},this.searchInputRef=o.a.createRef(),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.state={items:null,searchItems:null},this.handleDebounceScroll=Object(M.e)(this.handleDebounceScroll,100,!1),this.handleThrottleScroll=Object(M.C)(this.handleThrottleScroll,200,!1)}componentDidMount(){const e=this.searchInputRef.current;e&&setTimeout(()=>e.focus(),50),this.loadContent()}handleDebounceScroll(){this.loadRenderIdsContent()}handleThrottleScroll(){this.loadRenderIdsContent()}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Ya.contacts){t.next=7;break}return t.next=4,x.a.send({"@type":"getContacts"});case 4:(a=t.sent).user_ids=a.user_ids.sort((e,t)=>Object(Et.c)(e).localeCompare(Object(Et.c)(t))),Ya.contacts=a;case 7:n=U.a.getStore(),Object(W.K)(n,a.user_ids.slice(0,20)),e.setState({items:a});case 10:case"end":return t.stop()}}),t)})))()}render(){const e=this.props.popup,t=this.state,a=t.items,n=t.searchItems,s=e?{minHeight:800}:null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:this.handleClose},e?o.a.createElement(f.a,null):o.a.createElement(Le,null)),o.a.createElement($a,{inputRef:this.searchInputRef,onChange:this.handleSearch})),o.a.createElement("div",{className:"contacts-content",style:s},a&&o.a.createElement(Pa,{ref:this.listRef,className:"contacts-list",source:a.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,a),onScroll:this.handleScroll}),n&&o.a.createElement(Pa,{ref:this.searchListRef,className:"contacts-list contacts-search-list",source:n.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,n),onScroll:this.handleScroll})))}}var yi=Si,Mi=a(82);a(538);class Ii extends o.a.Component{constructor(e){super(e),this.onClientUpdatePageWidth=e=>{const t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onClientUpdateNewContentAvailable=()=>{this.setState({newContentAvailable:!0})},this.handleUpdate=()=>{this.handled||(this.handled=!0,setTimeout(()=>{window.location.reload()},250))};const t=ae.a.isSmallWidth;this.state={newContentAvailable:!1,isSmallWidth:t}}componentDidMount(){ae.a.on("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){ae.a.off("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}render(){const e=this.state,t=e.newContentAvailable,a=e.isSmallWidth,n=this.props.t;return t?o.a.createElement(N.a,{className:"update-button",variant:"contained",color:"primary",onClick:this.handleUpdate},a?o.a.createElement(Mi.a,null):n("Update")):null}}var Ui=Object(_.a)()(Ii);a(443),a(444);class ki extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewChannel",open:!1})},this.handleDone=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.error,n=t.state,i=n.defaultPhoto,r=n.defaultPhotoFile,o=t.titleRef.current.value.trim()){e.next=6;break}return t.setState({error:!0}),e.abrupt("return");case 6:return a&&t.setState({error:!1}),t.handleClose(),l=t.descriptionRef.current.value,e.next=11,x.a.send({"@type":"createNewSupergroupChat",title:o,description:l,is_channel:!0,location:null});case 11:c=e.sent,r?x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileId",id:r.id}}):i&&x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileBlob",name:"photo.jpg",data:i}}),Object(Q.k)(c.id);case 14:case"end":return e.stop()}}),e)}))),this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({defaultPhoto:a,defaultPhotoURL:n}),e.next=3,x.a.send({"@type":"uploadFile",file:{"@type":"inputFileBlob",name:"photo.jpg",data:a},file_type:{"@type":"fileTypePhoto"},priority:u.Hb});case 3:i=e.sent,t.setState({defaultPhotoFile:i});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.titleRef=o.a.createRef(),this.descriptionRef=o.a.createRef(),this.state={error:!1,defaultPhoto:null,defaultPhotoURL:null,defaultPhotoFile:null}}render(){const e=this.props,t=e.popup,a=e.t,n=this.state.error;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:this.handleClose},t?o.a.createElement(f.a,null):o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("NewChannel")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"new-chat-content"},o.a.createElement(Gn,{onChoose:this.handleChoosePhoto}),o.a.createElement("div",{className:"new-chat-title"},o.a.createElement(An.a,{inputRef:this.titleRef,error:n,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:a("EnterChannelName"),defaultValue:""}),o.a.createElement(An.a,{inputRef:this.descriptionRef,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:a("DescriptionOptionalPlaceholder"),defaultValue:""}),o.a.createElement("div",{className:"edit-profile-hint"},a("DescriptionInfo"))))),o.a.createElement("div",{className:"new-chat-bottom-button",onClick:this.handleDone},o.a.createElement(Le,null)))}}var xi=Object(_.a)()(ki);a(539);class wi extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){const e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){const t=this.divRef.current;t&&(t.style.cssText=e)}render(){const e=this.props,t=e.userId,a=e.selected,n=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":a}),onClick:n},o.a.createElement(Cn.a,{userId:t,small:!0}),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(f.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},Object(Et.e)(t)))}}var Oi=wi;class Li extends o.a.Component{shouldComponentUpdate(e,t,a){const n=this.props,s=n.userId,i=n.selected,r=n.style;return e.userId!==s||(e.selected!==i||e.style.top!==r.top)}render(){const e=this.props,t=e.userId,a=e.selected,n=e.onClick,s=e.style;return o.a.createElement(me.a,{className:"user-list-item",onClick:()=>n(t),button:!0,style:s},o.a.createElement(je.a,{className:"user-list-item-checkbox",checked:a,color:"primary"}),o.a.createElement(ve.a,{userId:t}))}}class _i extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleScroll=e=>{this.handleDebounceScroll(),this.handleThrottleScroll()},this.loadRenderIdsContent=()=>{const e=this.state,t=e.items,a=e.searchItems,n=a||t,s=(n===a?this.searchListRef:this.listRef).current;if(!s)return;const i=s.getListRenderIds();if(i.size>0){const e=[];[...i.keys()].forEach(t=>{e.push(n.user_ids[t])});const t=U.a.getStore();Object(W.K)(t,e)}},this.handleOpenUser=e=>{const t=this.state,a=t.selectedItems,n=t.focusedItem,s=a.map,i=a.array,r=new Map(s);let o,l=null,c=!1;s.has(e)?(r.delete(e),o=i.filter(t=>t!==e),l=n===e?null:n,c=!0):(r.set(e,e),o=i.concat([e]),l=null);const d=this.searchInputRef.current;d.focus(),c||(d.innerText="",this.handleSearch(""));const h=this.wrapPanelRef.current,p=h.scrollHeight,u=h.offsetHeight,m=new Map;var g,f=Object(ss.a)(this.itemsRef.keys());try{for(f.s();!(g=f.n()).done;){let e=g.value;const t=this.itemsRef.get(e);if(t){const a=t.getOffset();m.set(e,a)}}}catch(v){f.e(v)}finally{f.f()}const C=h.style.cssText,b=h.scrollTop;c&&(h.style.cssText=null),this.setState({focusedItem:l,selectedItems:{array:o,map:r}},()=>{this.animatePanel(c,p,u,b,C),this.animateItems(m)})},this.renderItem=({index:e,style:t},a,n)=>{const s=a[e],i=n.has(s);return o.a.createElement(Li,{key:s,userId:s,selected:i,onClick:()=>this.handleOpenUser(s),style:t})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null,publicItems:null,focusedItem:null}),e.abrupt("return");case 4:return(i=[]).push(x.a.send({"@type":"searchContacts",query:n,limit:20})),i.push(x.a.send({"@type":"searchPublicChats",query:n})),e.next=9,Promise.all(i);case 9:r=e.sent,o=Object(L.a)(r,2),l=o[0],c=o[1],l.user_ids=l.user_ids.sort((e,t)=>Object(Et.c)(e).localeCompare(Object(Et.c)(t))),d={"@type":"users",user_ids:[]},c.chat_ids.reduce((e,t)=>{const a=Se.a.get(t);return a&&"chatTypePrivate"===a.type["@type"]&&e.push(a.type.user_id),e},d.user_ids),h=U.a.getStore(),Object(W.K)(h,l.user_ids),Object(W.K)(h,d.user_ids),t.setState({searchItems:l,publicItems:d,focusedItem:null});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!1})},this.handleSearchClose=e=>{const t=this.state,a=t.selectedItems,n=t.focusedItem;if(!a)return;a.map.has(n)&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({focusedItem:null}))},this.handleBackspace=()=>{const e=this.state,t=e.selectedItems,a=e.focusedItem;if(!t)return;const n=t.array,s=t.map;if(!n)return;if(!n.length)return;if(s.has(a))return void this.handleOpenUser(a);const i=n[n.length-1];i&&this.setState({focusedItem:i})},this.titleRef=o.a.createRef(),this.searchInputRef=o.a.createRef(),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.wrapPanelRef=o.a.createRef(),this.itemsRef=new Map,this.state={items:null,searchItems:null,selectedItems:{array:[],map:new Map},focusedItem:null},this.handleDebounceScroll=Object(M.e)(this.handleDebounceScroll,100,!1),this.handleThrottleScroll=Object(M.C)(this.handleThrottleScroll,200,!1)}getUserIds(){return this.state.selectedItems.array}componentDidMount(){const e=this.searchInputRef.current;e&&setTimeout(()=>e.focus(),50),this.loadContent()}handleDebounceScroll(){this.loadRenderIdsContent()}handleThrottleScroll(){this.loadRenderIdsContent()}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Ya.contacts){t.next=7;break}return t.next=4,x.a.send({"@type":"getContacts"});case 4:(a=t.sent).user_ids=a.user_ids.sort((e,t)=>Object(Et.c)(e).localeCompare(Object(Et.c)(t))),Ya.contacts=a;case 7:n=U.a.getStore(),Object(W.K)(n,a.user_ids.slice(0,20)),e.setState({items:a});case 10:case"end":return t.stop()}}),t)})))()}animatePanel(e,t,a,n,s){const i=this.wrapPanelRef.current,r=i.scrollHeight,o=(i.offsetHeight,r<t);r>t?t<123?(i.style.cssText="max-height: ".concat(Math.min(t,123),"px;"),requestAnimationFrame(()=>{i.style.cssText="max-height: ".concat(Math.min(r,123),"px;"),setTimeout(()=>{this.searchInputRef.current.scrollIntoView({behavior:"auto"})},250)})):(i.style.cssText="max-height: ".concat(123,"px;"),this.searchInputRef.current.scrollIntoView({behavior:"smooth"})):o?r<123?(i.style.cssText="min-height: ".concat(Math.min(a,123),"px;"),requestAnimationFrame(()=>{i.style.cssText="min-height: ".concat(Math.min(r,123),"px;")})):(i.style.cssText="max-height: ".concat(123,"px;"),i.scrollTop=n):e?(i.style.cssText=s,i.scrollTop=n):this.searchInputRef.current.scrollIntoView({behavior:"smooth"})}animateItems(e){const t=new Map;var a,n=Object(ss.a)(this.itemsRef.keys());try{for(n.s();!(a=n.n()).done;){let n=a.value;const s=this.itemsRef.get(n);if(s){const a=s.getOffset(),i=e.has(n)?e.get(n):null;if(i){i.left<a.left&&t.set(s,{prevOffset:i,currentOffset:a});const e="transform: translate(".concat(i.left-a.left,"px, ").concat(i.top-a.top,"px)");s.setStyleCSSText(e)}}}}catch(s){n.e(s)}finally{n.f()}requestAnimationFrame(()=>{var e,a=Object(ss.a)(this.itemsRef.keys());try{for(a.s();!(e=a.n()).done;){let a=e.value;const n=this.itemsRef.get(a);if(n){let e="transition: transform 0.25s ease";if(t.has(n)){const a=t.get(n),s=a.prevOffset,i=a.currentOffset;e="transform: translate(".concat(s.left-i.left-s.width,"px, ").concat(s.top-i.top,"px);")+"transition: transform 0.1s ease;"}n.setStyleCSSText(e)}}}catch(s){a.e(s)}finally{a.f()}t.size&&setTimeout(()=>{var e,a=Object(ss.a)(t.keys());try{for(a.s();!(e=a.n()).done;){let a=e.value;const n=t.get(a).currentOffset,s="transform: translate(".concat(n.width,"px, 0);")+"transition: transform 0s ease;";a.setStyleCSSText(s)}}catch(s){a.e(s)}finally{a.f()}requestAnimationFrame(()=>{var e,a=Object(ss.a)(t.keys());try{for(a.s();!(e=a.n()).done;){let t=e.value;const a="transition: transform 0.15s ease";t.setStyleCSSText(a)}}catch(s){a.e(s)}finally{a.f()}})},101)})}render(){const e=this.props,t=e.popup,a=e.t,n=this.state,s=n.items,i=n.searchItems,r=n.publicItems,l=n.selectedItems,c=n.focusedItem,d=t?{minHeight:800}:null;return this.itemsRef.clear(),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:this.handleClose},t?o.a.createElement(f.a,null):o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("GroupAddMembers")))),o.a.createElement("div",{ref:this.wrapPanelRef,className:"animated-wrap-panel"},l.array.map(e=>o.a.createElement(Oi,{selected:c===e,ref:t=>{this.itemsRef.set(e,t)},key:e,userId:e,onClick:()=>this.handleOpenUser(e)})),o.a.createElement($a,{inputRef:this.searchInputRef,hint:a("SendMessageTo"),onClose:this.handleSearchClose,onChange:this.handleSearch,onBackspace:this.handleBackspace})),o.a.createElement("div",{className:"contacts-border"}),o.a.createElement("div",{className:"contacts-content",style:d},s&&o.a.createElement(Pa,{ref:this.listRef,className:"contacts-list",source:s.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,s.user_ids,l.map),onScroll:this.handleScroll}),i&&r&&o.a.createElement(Pa,{ref:this.searchListRef,className:"contacts-list contacts-search-list",source:i.user_ids.concat(r.user_ids),rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,i.user_ids.concat(r.user_ids),l.map),onScroll:this.handleScroll})))}}var Ni=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(_i);a(540);class ji extends o.a.Component{shouldComponentUpdate(e,t,a){const n=this.props.userId;return e.userId!==n}render(){const e=this.props,t=e.userId,a=e.style;return o.a.createElement(me.a,{className:"user-list-item",button:!0,style:a},o.a.createElement(ve.a,{userId:t}))}}class Pi extends o.a.Component{constructor(e){super(e),this.handleClose=()=>{const e=this.props.onClose;e&&e()},this.titleRef=o.a.createRef(),this.state={error:!1}}componentDidMount(){const e=this.props.userIds,t=U.a.getStore();Object(W.K)(t,e)}getTitle(){const e=this.state.error,t=this.titleRef.current.value.trim();return t?(e&&this.setState({error:!1}),t):(this.setState({error:!0}),t)}render(){const e=this.props,t=e.t,a=e.userIds,n=e.defaultPhotoURL,s=e.onChoosePhoto,i=this.state.error,r=a.map(e=>o.a.createElement(ji,{key:e,userId:e})),l=1!==a.length?"".concat(a.length," members"):"".concat(a.length," member");return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(j.a,{className:"header-left-button",onClick:this.handleClose},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("NewGroup")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"new-chat-content"},o.a.createElement(Gn,{defaultURL:n,onChoose:s}),o.a.createElement("div",{className:"new-chat-title"},o.a.createElement(An.a,{inputRef:this.titleRef,error:i,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:t("GroupName"),defaultValue:""})),o.a.createElement(En,null,l),r)))}}var Ti=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(Pi);class Ri extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleDone=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.openParams){e.next=8;break}if((a=t.addParticipantsRef.current.getUserIds()).length){e.next=5;break}return e.abrupt("return");case 5:t.setState({openParams:!0,userIds:a}),e.next=19;break;case 8:if(n=t.state,a=n.userIds,i=n.defaultPhoto,r=n.defaultPhotoFile,o=t.newGroupParamsRef.current.getTitle()){e.next=12;break}return e.abrupt("return");case 12:return t.handleClose(),e.next=15,x.a.send({"@type":"createNewSupergroupChat",title:o,is_channel:!1,description:"",location:null});case 15:l=e.sent,r?x.a.send({"@type":"setChatPhoto",chat_id:l.id,photo:{"@type":"inputFileId",id:r.id}}):i&&x.a.send({"@type":"setChatPhoto",chat_id:l.id,photo:{"@type":"inputFileBlob",name:"photo.jpg",data:i}}),a.length>0&&x.a.send({"@type":"addChatMembers",chat_id:l.id,user_ids:a}),Object(Q.k)(l.id);case 19:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!1})},this.handleCloseParams=()=>{this.setState({openParams:!1,userIds:[]})},this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({defaultPhoto:a,defaultPhotoURL:n}),e.next=3,x.a.send({"@type":"uploadFile",file:{"@type":"inputFileBlob",name:"photo.jpg",data:a},file_type:{"@type":"fileTypePhoto"},priority:u.Hb});case 3:i=e.sent,t.setState({defaultPhotoFile:i});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.addParticipantsRef=o.a.createRef(),this.newGroupParamsRef=o.a.createRef(),this.state={openParams:!1,userIds:[],defaultPhoto:null,defaultPhotoURL:null,defaultPhotoFile:null}}render(){const e=this.props.popup,t=this.state,a=t.openParams,n=t.userIds,s=t.defaultPhotoURL;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ni,{ref:this.addParticipantsRef,popup:e,onClose:this.handleClose}),o.a.createElement(Un,{open:a},o.a.createElement(Ti,{ref:this.newGroupParamsRef,defaultPhotoURL:s,userIds:n,onChoosePhoto:this.handleChoosePhoto,onClose:this.handleCloseParams})),o.a.createElement("div",{className:"new-chat-bottom-button",onClick:this.handleDone},o.a.createElement(Le,null)))}}var Di=Object(_.a)()(Ri);class Fi extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateSearchChat=e=>{if(!ae.a.isSmallWidth)return;const t=e.chatId,a=e.query,n=this.state,s=n.openSearch,i=n.searchChatId,r=n.searchText;s&&t===i&&a===r||(this.query=a,this.setState({openSearch:!0,searchChatId:t,searchText:null}))},this.handleDialogEnter=()=>{if(!this.query)return;const e=this.headerRef.current;e&&e.setInitQuery(this.query),this.query=null},this.onClientUpdateSettings=e=>{if(!ae.a.isSmallWidth)return;const t=e.open,a=e.chatId;this.setState({openSettings:t,meChatId:a})},this.onClientUpdateContacts=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openContacts:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewGroup=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewGroup:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewChannel=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewChannel:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{this.setState({openSettings:!1,openContacts:!1,openNewGroup:!1,openNewChannel:!1,openSearch:!1})},this.handleSearch=e=>{this.setState({openSearch:e,searchChatId:0,searchText:null})},this.handleSearchTextChange=e=>{this.setState({searchText:e,query:null})},this.handleSelectMessage=(e,t,a)=>{Object(Q.k)(e,t),this.handleCloseSearch()},this.handleCloseSearch=()=>{this.setState({openSearch:!1,searchChatId:0,searchText:null})},this.headerRef=o.a.createRef(),this.state={openSearch:!1,openSettings:!1,openContacts:!1,openNewGroup:!1,openNewChannel:!1}}shouldComponentUpdate(e,t,a){const n=this.state,s=n.openSearch,i=n.searchText,r=n.openSettings,o=n.openContacts,l=n.openNewGroup,c=n.openNewChannel;return t.openSearch!==s||(t.searchText!==i||(t.openSettings!==r||(t.openContacts!==o||(t.openNewGroup!==l||t.openNewChannel!==c))))}componentDidMount(){ae.a.on("clientUpdateSearchChat",this.onClientUpdateSearchChat),Se.a.on("clientUpdateSettings",this.onClientUpdateSettings),Se.a.on("clientUpdateContacts",this.onClientUpdateContacts),Se.a.on("clientUpdateNewGroup",this.onClientUpdateNewGroup),Se.a.on("clientUpdateNewChannel",this.onClientUpdateNewChannel)}componentWillUnmount(){ae.a.off("clientUpdateSearchChat",this.onClientUpdateSearchChat),Se.a.off("clientUpdateSettings",this.onClientUpdateSettings),Se.a.off("clientUpdateContacts",this.onClientUpdateContacts),Se.a.off("clientUpdateNewGroup",this.onClientUpdateNewGroup),Se.a.off("clientUpdateNewChannel",this.onClientUpdateNewChannel)}render(){const e=this.state,t=e.meChatId,a=e.searchChatId,n=e.searchText,s=e.openSearch,i=e.openContacts,r=e.openSettings,l=e.openNewGroup,c=e.openNewChannel;return s||i||r||l||c?o.a.createElement(P.a,{open:!0,transitionDuration:0,onClose:this.handleClose,classes:{root:"chat-info-dialog-root",container:"chat-info-dialog-container",paper:"chat-info-dialog-paper"},onEnter:this.handleDialogEnter},r&&o.a.createElement(vi,{chatId:t,popup:!0}),i&&o.a.createElement(yi,{popup:!0}),l&&o.a.createElement(Di,{popup:!0}),c&&o.a.createElement(xi,{popup:!0}),s&&o.a.createElement(o.a.Fragment,null,o.a.createElement(tn,{ref:this.headerRef,openSearch:!0,timeout:!1,onClick:this.handleHeaderClick,onSearch:this.handleSearch,onSearchTextChange:this.handleSearchTextChange,popup:!0}),o.a.createElement("div",{className:"search-content"},o.a.createElement(yn,{chatId:a,text:n,onSelectMessage:this.handleSelectMessage,onClose:this.handleCloseSearch})))):null}}var Ai=Fi;function Bi(){const e=Se.a.chatList.get("chatListArchive"),t=[],a=[];if(e){var n,s=Object(ss.a)(e.keys());try{for(s.s();!(n=s.n()).done;){const e=n.value,s=Se.a.get(e);if(s){const n=Object(F.r)(e,{"@type":"chatListArchive"});"0"!==n&&t.push(s),a.push({order:n,id:e,title:s.title})}}}catch(i){s.e(i)}finally{s.f()}}return t.sort((e,t)=>Object(M.z)(Object(F.r)(t,{"@type":"chatListArchive"}),Object(F.r)(e,{"@type":"chatListArchive"}))).map(e=>e.title).join(", ")}var Hi=a(260);a(541);const Vi={enter:Hi.duration.enteringScreen,exit:Hi.duration.leavingScreen};class zi extends r.Component{constructor(e){var t;super(e),t=this,this.onUpdateChatFilters=e=>{this.handleSaveCache()},this.onClientUpdatePageWidth=e=>{if(!e.isSmallWidth)return;const t=this.state,a=t.openSettings,n=t.openContacts,s=t.openSearch,i=t.openNewGroup,r=t.openNewChannel;(a||n||s||i||r)&&this.setState({openContacts:!1,openSettings:!1,openSearch:!1,openNewGroup:!1,openNewChannel:!1,timeout:0},()=>{this.setState({timeout:Vi})})},this.onUpdateChatOrder=e=>{const t=this.state.showArchive,a=this.dialogListRef.current;if(a&&a.loading)return;const n=this.archiveListRef.current;if(n&&n.loading)return;const s=Se.a.chatList.get("chatListArchive"),i=s&&s.size>0;this.setState({showArchive:i,archiveTitle:Bi()},()=>{if(!t&&i){const e=this.dialogListRef.current;if(e.listRef){const t=e.listRef.current;t&&t.scrollTop>0&&(e.scrollTop+=68)}}}),t&&!i&&x.a.clientUpdate({"@type":"clientUpdateCloseArchive"})},this.onClientUpdateContacts=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openContacts:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateSettings=e=>{if(ae.a.isSmallWidth)return;const t=e.open,a=e.chatId;this.setState({openSettings:t,meChatId:a})},this.onClientUpdateNewGroup=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewGroup:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewChannel=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewChannel:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateArchive=e=>{const t=e.open;this.setState({openArchive:t})},this.onClientUpdateThemeChange=e=>{this.forceUpdate()},this.onClientUpdateSearchChat=e=>{if(ae.a.isSmallWidth)return;const t=e.chatId,a=e.query,n=this.state,s=n.openSearch,i=n.searchChatId,r=n.searchText;if(s&&t===i&&a===r)return;const o=this.dialogsHeaderRef.current;this.setState({openSearch:!0,searchChatId:t,searchText:null,openArchive:!1,openContacts:!1,openSettings:!1,openNewGroup:!1,openNewChannel:!1},()=>{o&&o.setInitQuery(a)})},this.handleHeaderClick=()=>{this.state.openArchive?x.a.clientUpdate({"@type":"clientUpdateCloseArchive"}):this.dialogListRef.current.scrollToTop()},this.handleSearch=e=>{this.setState({openSearch:e,searchChatId:0,searchText:null})},this.handleSelectMessage=(e,t,a)=>{Object(Q.k)(e,t);const n=a?this.state.searchChatId:0,s=a?this.state.searchText:null;this.setState({openSearch:a,searchChatId:n,searchText:s})},this.handleCloseSearch=()=>{this.setState({openSearch:!1,searchChatId:0,searchText:null})},this.handleSearchTextChange=e=>{this.setState({searchText:e,query:null})},this.handleSaveCache=()=>{this.saveCache()},this.handleCloseArchive=()=>{this.setState({openArchive:!1})},this.handleCloseContacts=()=>{this.setState({openContacts:!1})},this.handleCloseSettings=()=>{this.setState({openSettings:!1})},this.handleCloseNewGroup=()=>{this.setState({openNewGroup:!1})},this.handleCloseNewChannel=()=>{this.setState({openNewChannel:!1})},this.dialogListRef=o.a.createRef(),this.archiveListRef=o.a.createRef(),this.dialogsHeaderRef=o.a.createRef(),this.state={cache:null,showArchive:!1,archiveTitle:null,mainItems:[],archiveItems:[],timeout:Vi,openSearch:!1,openArchive:!1,openContacts:!1,openSettings:!1,openNewGroup:!1,openNewChannel:!1,searchChatId:0,searchText:null,query:null}}shouldComponentUpdate(e,t){const a=this.state,n=a.cache,s=a.showArchive,i=a.archiveTitle,r=a.mainItems,o=a.archiveItems,l=a.openSearch,c=a.openArchive,d=a.openSettings,h=a.openContacts,p=a.openNewGroup,u=a.openNewChannel,m=a.searchChatId,g=a.searchText;return t.cache!==n||(t.showArchive!==s||(t.archiveTitle!==i||(t.archiveItems!==o||(t.mainItems!==r||(t.openSearch!==l||(t.openArchive!==c||(t.openSettings!==d||(t.openContacts!==h||(t.openNewGroup!==p||(t.openNewChannel!==u||(t.searchChatId!==m||t.searchText!==g)))))))))))}componentDidMount(){this.loadCache(),ae.a.on("clientUpdateSearchChat",this.onClientUpdateSearchChat),ae.a.on("clientUpdateThemeChange",this.onClientUpdateThemeChange),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),Se.a.on("updateChatDraftMessage",this.onUpdateChatOrder),Se.a.on("updateChatLastMessage",this.onUpdateChatOrder),Se.a.on("updateChatPosition",this.onUpdateChatOrder),Se.a.on("clientUpdateSettings",this.onClientUpdateSettings),Se.a.on("clientUpdateArchive",this.onClientUpdateArchive),Se.a.on("clientUpdateContacts",this.onClientUpdateContacts),Se.a.on("clientUpdateNewGroup",this.onClientUpdateNewGroup),Se.a.on("clientUpdateNewChannel",this.onClientUpdateNewChannel),Fa.a.on("updateChatFilters",this.onUpdateChatFilters)}componentWillUnmount(){ae.a.off("clientUpdateSearchChat",this.onClientUpdateSearchChat),ae.a.off("clientUpdateThemeChange",this.onClientUpdateThemeChange),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),Se.a.off("updateChatDraftMessage",this.onUpdateChatOrder),Se.a.off("updateChatLastMessage",this.onUpdateChatOrder),Se.a.off("updateChatPosition",this.onUpdateChatOrder),Se.a.off("clientUpdateSettings",this.onClientUpdateSettings),Se.a.off("clientUpdateArchive",this.onClientUpdateArchive),Se.a.off("clientUpdateContacts",this.onClientUpdateContacts),Se.a.off("clientUpdateNewGroup",this.onClientUpdateNewGroup),Se.a.off("clientUpdateNewChannel",this.onClientUpdateNewChannel),Fa.a.off("updateChatFilters",this.onUpdateChatFilters)}loadCache(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ya.load();case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0={};case 5:a=t.t0,n=a.chats,i=a.archiveChats,Fa.a.filters=Fa.a.filters||Ya.filters,e.setState({cache:a,showArchive:i&&i.length>0,archiveTitle:Bi()}),e.loadChatContents((n||[]).map(e=>e.id)),x.a.clientUpdate({"@type":"clientUpdateCacheLoaded"});case 11:case"end":return t.stop()}}),t)})))()}saveCache(){return Object(i.a)(s.a.mark((function e(){var t,a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=[]).push(x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:0,limit:u.f})),t.push(x.a.send({"@type":"getChats",chat_list:{"@type":"chatListArchive"},offset_order:"9223372036854775807",offset_chat_id:0,limit:u.f})),e.next=5,Promise.all(t);case 5:a=e.sent,n=Object(L.a)(a,2),i=n[0],r=n[1],o=Fa.a.filters,Ya.save(o,i.chat_ids,r.chat_ids);case 11:case"end":return e.stop()}}),e)})))()}loadChatContents(e){const t=U.a.getStore();Object(W.x)(t,e)}render(){const e=this.state,t=e.cache,a=e.showArchive,n=e.archiveTitle,s=e.mainItems,i=e.archiveItems,r=e.meChatId,l=e.openSettings,c=e.openContacts,d=e.openArchive,h=e.openSearch,p=e.openNewGroup,u=e.openNewChannel,m=e.timeout,g=e.searchChatId,f=e.searchText,C=t?t.chats||[]:null,b=t?t.archiveChats||[]:null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"dialogs"},o.a.createElement("div",{className:"sidebar-page"},o.a.createElement(tn,{ref:this.dialogsHeaderRef,openSearch:h,timeout:0!==m,onClick:this.handleHeaderClick,onSearch:this.handleSearch,onSearchTextChange:this.handleSearchTextChange}),o.a.createElement("div",{className:"dialogs-content"},o.a.createElement("div",{className:"dialogs-content-internal"},o.a.createElement(sn,null),o.a.createElement(ln,{type:"chatListMain",ref:this.dialogListRef,cacheItems:C,items:s,showArchive:a,archiveTitle:n,open:!0,onSaveCache:this.handleSaveCache})),o.a.createElement(aa.a,{classNames:"search",timeout:m,in:h,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement(yn,{chatId:g,text:f,onSelectMessage:this.handleSelectMessage,onClose:this.handleCloseSearch}))),o.a.createElement(Ui,null)),o.a.createElement(Un,{open:d,timeout:m,onClose:this.handleCloseArchive},o.a.createElement(dn,{innerListRef:this.archiveListRef,items:i,cacheItems:b})),o.a.createElement(Un,{open:c,timeout:m,onClose:this.handleCloseContacts},o.a.createElement(yi,null)),o.a.createElement(Un,{open:l,timeout:m,onClose:this.handleCloseSettings},o.a.createElement(vi,{chatId:r})),o.a.createElement(Un,{open:p,timeout:m,onClose:this.handleCloseNewGroup},o.a.createElement(Di,null)),o.a.createElement(Un,{open:u,timeout:m,onClose:this.handleCloseNewChannel},o.a.createElement(xi,null)),o.a.createElement(Ai,null)))}}var Wi=zi;class Gi extends o.a.Component{constructor(...e){super(...e),this.state={chatId:ae.a.dialogChatId},this.onClientUpdateMediaViewerContent=e=>{ae.a.mediaViewerContent&&this.handleClose()},this.onClientUpdateDialogChatId=e=>{const t=e.chatId;this.setState({chatId:t})},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})}}shouldComponentUpdate(e,t,a){const n=this.state.chatId;return t.chatId!==n}componentDidMount(){ae.a.on("clientUpdateDialogChatId",this.onClientUpdateDialogChatId),ae.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent)}componentWillUnmount(){ae.a.off("clientUpdateDialogChatId",this.onClientUpdateDialogChatId),ae.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent)}render(){const e=this.state.chatId;return e?o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:this.handleClose,classes:{root:"chat-info-dialog-root",container:"chat-info-dialog-container",paper:"chat-info-dialog-paper"}},o.a.createElement(ta,{className:"chat-info-dialog-content",chatId:e,popup:!0})):null}}var Zi=Gi,qi=a(203),Ki=a.n(qi),Yi=a(542),Ji=a.n(Yi),Xi=a(445),Qi=Object(he.a)(o.a.createElement("path",{d:"M2.65383364,2.92607697 L4.145798,9.778632 C4.26700994,10.3353554 4.73555061,10.7489799 5.30300879,10.8002098 L16.196355,11.7836569 C16.3159306,11.7944521 16.4041145,11.9001385 16.3933192,12.0197141 C16.3838746,12.1243302 16.3009783,12.2072294 16.1963626,12.2166777 L5.30295988,13.2005138 C4.73552551,13.2517615 4.26701089,13.6653731 4.14579755,14.2220735 L2.65385781,21.074154 C2.55168485,21.543407 2.84926209,22.0066394 3.31851517,22.1088123 C3.50628037,22.1496954 3.70229947,22.1272304 3.87594675,22.0449272 L23.4110848,12.7858981 C23.8450551,12.5802101 24.0301144,12.0616646 23.8244264,11.6276943 C23.7384721,11.4463438 23.5924353,11.300307 23.4110848,11.2143527 L3.87592461,1.95531307 C3.44195432,1.74962507 2.92340882,1.93468443 2.71772082,2.36865471 C2.63541897,2.54229904 2.61295329,2.73831451 2.65383364,2.92607697 Z"}),"Send"),$i=Object(he.a)(o.a.createElement("path",{d:"M19,10 C19.5522847,10 20,10.4477153 20,11 C20,15.0792885 16.9468043,18.445465 13.0009551,18.9379871 L13,22 C13,22.5522847 12.5522847,23 12,23 C11.4871642,23 11.0644928,22.6139598 11.0067277,22.1166211 L11,22 L11.0000487,18.9381123 C7.05371356,18.4460359 4,15.0796344 4,11 C4,10.4477153 4.44771525,10 5,10 C5.55228475,10 6,10.4477153 6,11 C6,14.3137085 8.6862915,17 12,17 C15.3137085,17 18,14.3137085 18,11 C18,10.4477153 18.4477153,10 19,10 Z M12,2 C14.209139,2 16,3.790861 16,6 L16,11 C16,13.209139 14.209139,15 12,15 C9.790861,15 8,13.209139 8,11 L8,6 C8,3.790861 9.790861,2 12,2 Z M12,4 C10.8954305,4 10,4.8954305 10,6 L10,11 C10,12.1045695 10.8954305,13 12,13 C13.1045695,13 14,12.1045695 14,11 L14,6 C14,4.8954305 13.1045695,4 12,4 Z"}),"Microphone"),er=Object(he.a)(o.a.createElement("path",{d:"M11.657825,8.68730116 L7.89384699,12.5266719 C6.53977525,13.9078658 6.53979565,16.118605 7.89389288,17.4997739 C9.18119565,18.812813 11.2598788,18.8798255 12.6276396,17.6859428 L12.8071445,17.5177786 L19.3928802,10.8005213 C21.4766204,8.67512215 21.4766204,5.27313659 19.3928802,3.14773741 C17.4051081,1.12022499 14.1862843,1.0310006 12.0906645,2.90336495 L11.834659,3.14773741 L5.26671543,9.84699003 C2.45333216,12.7166196 2.45333216,17.3098454 5.26671543,20.179475 C7.96150749,22.9281424 12.3352577,23.0332941 15.1578204,20.4629606 L15.452067,20.1794113 L19.2160679,16.340063 C19.6027032,15.945688 19.596429,15.3125541 19.202054,14.9259188 C18.8076791,14.5392835 18.1745452,14.5455577 17.7879099,14.9399327 L13.9520378,18.8511531 C11.9281881,20.8353343 8.67903707,20.8031766 6.6948559,18.7793268 C4.64395201,16.6874204 4.64395201,13.3390446 6.6948559,11.2471382 L13.3088798,4.50180526 C14.6072848,3.22884976 16.6917843,3.24948061 17.9647398,4.54788555 C19.2860006,5.89556155 19.2860006,8.05269718 17.9647398,9.40037319 L11.3764629,16.119959 C10.803533,16.6816592 9.88373353,16.6725557 9.32203335,16.0996258 C8.73040544,15.4961698 8.73039653,14.5302606 9.3220133,13.9267937 L13.0859914,10.0874229 C13.4726243,9.6930457 13.4663463,9.05991185 13.0719691,8.67327889 C12.6775919,8.28664594 12.044458,8.29292392 11.657825,8.68730116 Z"}),"Attach"),tr=a(553),ar=a.n(tr);a(552);class nr extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleMenuClick=e=>{this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleAttachPhoto=()=>{this.handleMenuClose();const e=this.props.onAttachPhoto;e&&setTimeout(()=>e(),u.c)},this.handleAttachDocument=()=>{this.handleMenuClose();const e=this.props.onAttachDocument;e&&setTimeout(()=>e(),u.c)},this.handleAttachPoll=()=>{this.handleMenuClose();const e=this.props.onAttachPoll;e&&e()}}render(){const e=this.props,t=(e.classes,e.t),a=e.chatId,n=this.state.anchorEl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{className:"inputbox-icon-button","aria-label":"Attach",open:Boolean(n),onClick:this.handleMenuClick},o.a.createElement(er,null)),o.a.createElement(Aa.a,{id:"attach-menu",anchorEl:n,open:Boolean(n),getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},classes:{paper:"attach-button-paper"},onClose:this.handleMenuClose},o.a.createElement(We.a,{onClick:this.handleAttachPhoto,disabled:!Object(F.e)(a)},o.a.createElement(ge.a,null,o.a.createElement(Ce,null)),o.a.createElement(fe.a,{primary:t("AttachPhoto")})),o.a.createElement(We.a,{onClick:this.handleAttachDocument,disabled:!Object(F.e)(a)},o.a.createElement(ge.a,null,o.a.createElement(pe,null)),o.a.createElement(fe.a,{primary:t("AttachDocument")})),!Object(F.hb)(a)&&o.a.createElement(We.a,{onClick:this.handleAttachPoll,disabled:!Object(F.g)(a)},o.a.createElement(ge.a,null,o.a.createElement(ar.a,null)),o.a.createElement(fe.a,{primary:t("Poll")}))))}}var sr=Object(_.a)()(nr),ir=a(662),rr=a(660),or=a(450);function lr(e,t=!1){if(e){if(t&&e.childNodes&&e.childNodes.length>0){const t=e.childNodes[e.childNodes.length-1],a=document.createRange();a.setStart(t,t.length),a.collapse(!0);const n=window.getSelection();n.removeAllRanges(),n.addRange(a),e.scrollTop=e.scrollHeight}e.focus()}}const cr=8,dr=16,hr=17,pr=18,ur=46,mr=37,gr=38,fr=39,Cr=40,br={special:{},navigational:{},isSpecial(e){return"undefined"!==typeof this.special[e.keyCode]},isNavigational(e){return"undefined"!==typeof this.navigational[e.keyCode]}};br.special[cr]=!0,br.special[dr]=!0,br.special[hr]=!0,br.special[pr]=!0,br.special[ur]=!0,br.navigational[gr]=!0,br.navigational[Cr]=!0,br.navigational[mr]=!0,br.navigational[fr]=!0;a(554);class vr extends o.a.Component{constructor(e){super(e),this.getText=()=>this.optionTextRef.current.innerText,this.focus=(e=!1)=>{lr(this.optionTextRef.current,e)},this.handleDelete=()=>{const e=this.props,t=e.option,a=e.onDelete;t&&a&&a(t.id)},this.handleInput=e=>{const t=this.props.option;e.preventDefault();const a=this.optionTextRef.current,n=a.dataset.length,s=(a.dataset.maxLength,this.getText());this.setState({remainLength:n-s.length}),x.a.clientUpdate({"@type":"clientUpdatePollOption",id:t.id,text:s})},this.handleKeyDown=e=>{const t=this.optionTextRef.current,a=t.dataset.maxLength,n=this.getText().length;let s=!1;const i=window.getSelection(),r=br.isSpecial(e),o=br.isNavigational(e);switch(i&&(s=!!i.toString()),e.key){case"Backspace":if(!this.getText()){const t=this.props,a=t.option,n=t.onDelete;return n&&n(a.id,!0),e.preventDefault(),!1}break;case"Enter":{const t=this.props,a=t.option,n=t.onFocusNext;return a&&n&&n(a.id),e.preventDefault(),!1}case"ArrowUp":{const a=window.getSelection();if(!a)break;if(!a.isCollapsed)break;const n=t.childNodes&&t.childNodes.length>0?t.childNodes[0]:null;if(!n||a.anchorNode===n&&!a.anchorOffset){const t=this.props,a=t.option,n=t.onFocusPrev;return n&&n(a.id),e.preventDefault(),!1}break}case"ArrowDown":{const a=window.getSelection();if(!a)break;if(!a.isCollapsed)break;const n=t.childNodes&&t.childNodes.length>0?t.childNodes[t.childNodes.length-1]:null;if(!n||a.anchorNode===n&&a.anchorOffset===n.length){const t=this.props,a=t.option,n=t.onFocusNext;return n&&n(a.id),e.preventDefault(),!1}break}}return!(!r&&!o)||(!(n>=a&&!s)||(e.preventDefault(),!1))},this.handlePaste=e=>{e.preventDefault();const t=this.optionTextRef.current.dataset.maxLength,a=window.getSelection(),n=a?a.toString():"",s=this.getText();if(s.length-a.length>=t)return;let i=e.clipboardData.getData("text/plain");i&&(i=i.replace("\r\n","\n").replace("\n"," "),s.length-n.length+i.length>t&&(i=i.substr(0,t-s.length+n.length)),document.execCommand("insertText",!1,i))},this.handleChange=()=>{const e=this.props.option;e&&x.a.clientUpdate({"@type":"clientUpdatePollChooseOption",id:e.id})},this.optionTextRef=o.a.createRef(),this.state={remainLength:u.hb}}render(){const e=this.props,t=e.t,a=e.option,n=this.state.remainLength,s=a.is_chosen;return o.a.createElement("div",{className:"create-poll-option"},o.a.createElement("div",{className:"create-poll-option-wrapper"},o.a.createElement(is.a,{key:Date.now(),classes:{root:"create-poll-radio-root"},color:"primary",checked:s,onChange:this.handleChange}),o.a.createElement("div",{ref:this.optionTextRef,className:"create-poll-option-text",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:t("Option"),"data-length":u.gb,"data-max-length":u.hb,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste})),o.a.createElement("div",{className:"create-poll-option-delete-button"},o.a.createElement(j.a,{className:"create-poll-option-button",onClick:this.handleDelete},o.a.createElement(f.a,{fontSize:"small"}))),o.a.createElement("div",{className:"create-poll-option-bottom-border"}),n<=u.gb-u.fb&&o.a.createElement(or.a,{align:"center",className:"create-poll-option-subtitle",color:n>=0?"textSecondary":"error",variant:"subtitle1"},n))}}var Er=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(vr),Sr=a(162),yr=a(166);a(555);class Mr extends o.a.Component{constructor(e){super(e),this.handleClientUpdateNewPoll=e=>{const t=yr.a.poll;this.setState({confirm:!1,remainLength:u.kb,poll:t})},this.handleClientUpdatePollQuestion=e=>{const t=yr.a.poll,a=this.questionRef.current,n=a.dataset.length,s=a.innerText;this.setState({remainLength:n-s.length,poll:t})},this.handleClientUpdatePoll=e=>{const t=yr.a.poll;this.setState({poll:t})},this.handleClientUpdateNewPollOption=e=>{const t=yr.a.poll;this.setState({poll:t},()=>{setTimeout(()=>{this.optionsRefMap.get(t.options.length-1).focus(!0)})})},this.handleKeyDown=e=>{const t=this.questionRef.current,a=t.dataset.maxLength,n=t.innerText.length;let s=!1;const i=window.getSelection(),r=br.isSpecial(e),o=br.isNavigational(e);switch(i&&(s=!!i.toString()),e.key){case"Enter":if(!e.shiftKey)return this.handleFocusNextOption(0),e.preventDefault(),!1;break;case"ArrowDown":{const a=window.getSelection();if(!a)break;if(!a.isCollapsed)break;const n=t.childNodes&&t.childNodes.length>0?t.childNodes[t.childNodes.length-1]:null;if(!n||a.anchorNode===n&&a.anchorOffset===n.length)return this.handleFocusNextOption(0),e.preventDefault(),!1;break}}return!(!r&&!o)||(!(n>=a&&!s)||(e.preventDefault(),!1))},this.handlePaste=e=>{e.preventDefault();const t=this.questionRef.current,a=t.dataset.maxLength,n=window.getSelection(),s=n?n.toString():"",i=t.innerText;if(i.length-n.length>=a)return;let r=e.clipboardData.getData("text/plain");r&&(i.length-s.length+r.length>a&&(r=r.substr(0,a-i.length+s.length)),document.execCommand("insertText",!1,r))},this.handleInput=e=>{e.preventDefault();const t=this.questionRef.current,a=t.innerText;"<br>"===t.innerHTML&&(t.innerText=""),x.a.clientUpdate({"@type":"clientUpdatePollQuestion",question:a})},this.handleAddOption=()=>{const e=this.state.poll;if(!e)return;if(e.options.length>=u.eb)return;const t={id:Date.now(),text:""};x.a.clientUpdate({"@type":"clientUpdateNewPollOption",option:t})},this.handleDeleteOption=(e,t=!1)=>{t?this.handleDeleteByBackspace(e):this.handleDelete(e)},this.handleDelete=e=>{x.a.clientUpdate({"@type":"clientUpdateDeletePollOption",id:e})},this.handleDeleteByBackspace=e=>{const t=this.state.poll;if(!t)return;const a=t.options,n=a.findIndex(t=>t.id===e),s=n-1;let i=!0;for(let o=n;o<a.length;o++){if(a[o].text){i=!1;break}}i&&this.handleDeleteOption(e);const r=this.optionsRefMap.get(s);if(r)r.focus(!0);else{lr(this.questionRef.current,!0)}},this.handleFocusPrevOption=e=>{const t=this.state.poll;if(!t)return;const a=t.options.findIndex(t=>t.id===e)-1,n=this.optionsRefMap.get(a);if(n)n.focus(!1);else{lr(this.questionRef.current,!1)}},this.handleFocusNextOption=e=>{const t=this.state.poll;if(!t)return;const a=t.options,n=a.findIndex(t=>t.id===e),s=n+1,i=this.optionsRefMap.get(s);if(i)i.focus(i,!0);else{const e=n>=0&&n<a.length?a[n].text:"";if(a.length&&!e)return;this.handleAddOption()}},this.getHint=()=>{const e=this.state.poll;if(!e)return;const t=e.options,a=u.eb-t.length;return a<=0?"You have added the maximum number of options.":1===a?"You can add 1 more option.":"You can add ".concat(u.eb-t.length," more options.")},this.handleClose=()=>{const e=this.state.poll;Object(Sr.a)(e)?this.setState({confirm:!0}):this.handleConfirmationDone()},this.handleSend=()=>{const e=this.props.onSend,t=yr.a.getInputMessagePoll();t&&(e(t),this.handleConfirmationDone())},this.handleConfirmationClose=()=>{this.setState({confirm:!1})},this.handleConfirmationDone=()=>{this.handleConfirmationClose(),x.a.clientUpdate({"@type":"clientUpdateDeletePoll"})},this.handleChangeAnonymous=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeAnonymous"})},this.handleChangeAllowMultipleAnswers=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeAllowMultipleAnswers"})},this.handleChangeType=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeType"})},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(f.a,null))]})},this.handleAllowMultipleAnswersClick=e=>{const t=this.props.t,a=this.state.poll;if(!a)return;"pollTypeQuiz"===a.type["@type"]&&(e.stopPropagation(),this.handleScheduledAction(t("PollQuizOneRightAnswer")))},this.questionRef=o.a.createRef(),this.optionsRefMap=new Map,this.state={poll:null,confirm:!1,remainLength:u.kb}}componentDidMount(){yr.a.on("clientUpdatePollChooseOption",this.handleClientUpdatePoll),yr.a.on("clientUpdatePollChangeAnonymous",this.handleClientUpdatePoll),yr.a.on("clientUpdatePollChangeAllowMultipleAnswers",this.handleClientUpdatePoll),yr.a.on("clientUpdatePollChangeType",this.handleClientUpdatePoll),yr.a.on("clientUpdateDeletePoll",this.handleClientUpdatePoll),yr.a.on("clientUpdateDeletePollOption",this.handleClientUpdatePoll),yr.a.on("clientUpdateNewPoll",this.handleClientUpdateNewPoll),yr.a.on("clientUpdateNewPollOption",this.handleClientUpdateNewPollOption),yr.a.on("clientUpdatePollOption",this.handleClientUpdatePoll),yr.a.on("clientUpdatePollQuestion",this.handleClientUpdatePollQuestion)}componentWillUnmount(){yr.a.off("clientUpdatePollChooseOption",this.handleClientUpdatePoll),yr.a.off("clientUpdatePollChangeAnonymous",this.handleClientUpdatePoll),yr.a.off("clientUpdatePollChangeAllowMultipleAnswers",this.handleClientUpdatePoll),yr.a.off("clientUpdatePollChangeType",this.handleClientUpdatePoll),yr.a.off("clientUpdateDeletePoll",this.handleClientUpdatePoll),yr.a.off("clientUpdateDeletePollOption",this.handleClientUpdatePoll),yr.a.off("clientUpdateNewPoll",this.handleClientUpdateNewPoll),yr.a.off("clientUpdateNewPollOption",this.handleClientUpdateNewPollOption),yr.a.off("clientUpdatePollOption",this.handleClientUpdatePoll),yr.a.off("clientUpdatePollQuestion",this.handleClientUpdatePollQuestion)}componentDidUpdate(e,t,a){this.state.poll&&!t.poll&&setTimeout(()=>{lr(this.questionRef.current,!0)},0)}render(){const e=this.props.t,t=this.state,a=t.remainLength,n=t.confirm,s=t.poll;if(!s)return null;const i=s.is_anonymous,r=s?s.options:[],l=s.type.allow_multiple_answers,d="pollTypeRegular"!==s.type["@type"],h="pollTypeQuiz"===s.type["@type"];this.optionsRefMap.clear();const p=r.map((e,t)=>o.a.createElement(Er,{ref:e=>this.optionsRefMap.set(t,e),key:e.id,option:e,onDelete:this.handleDeleteOption,onFocusPrev:this.handleFocusPrevOption,onFocusNext:this.handleFocusNextOption})),m=u.eb-r.length>0,g=this.getHint();return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{className:c()("create-poll-dialog",{"create-quiz-dialog":h}),open:!0,manager:$.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},e("NewPoll")),o.a.createElement(Ln.a,{classes:{root:"create-poll-dialog-root"}},o.a.createElement("div",{className:"create-poll-dialog-question-title"},o.a.createElement(be.a,{color:"primary",variant:"subtitle1",style:{flexGrow:1}},e("Question")),a<=u.jb-u.ib&&o.a.createElement(be.a,{color:a>=0?"textSecondary":"error",variant:"subtitle1"},a)),o.a.createElement("div",{ref:this.questionRef,id:"create-poll-dialog-question",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("QuestionHint"),"data-length":u.jb,"data-max-length":u.kb,onPaste:this.handlePaste,onKeyDown:this.handleKeyDown,onInput:this.handleInput}),o.a.createElement(ir.a,{className:"divider"}),o.a.createElement(be.a,{color:"primary",variant:"subtitle1"},e("PollOptions")),o.a.createElement(ue.a,{classes:{root:"create-poll-dialog-list"}},p,m&&o.a.createElement(me.a,{selected:!1,className:"create-poll-add-option",button:!0,onClick:this.handleAddOption},o.a.createElement(fe.a,{disableTypography:!0,primary:e("AddAnOption")}))),o.a.createElement(be.a,null,g),o.a.createElement(ir.a,{className:"divider"}),o.a.createElement(be.a,{color:"primary",variant:"subtitle1"},e("Settings")),o.a.createElement(rr.a,null,o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{color:"primary",checked:i,onChange:this.handleChangeAnonymous}),label:e("PollAnonymous")}),o.a.createElement("div",{onClick:this.handleAllowMultipleAnswersClick,style:{background:"transparent"}},o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{color:"primary",disabled:d,checked:l,onChange:this.handleChangeAllowMultipleAnswers}),label:e("PollMultiple")})),o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{color:"primary",checked:h,onChange:this.handleChangeType}),label:e("PollQuiz")})),o.a.createElement(be.a,null,e("QuizInfo"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{color:"primary",onClick:this.handleClose},e("Cancel")),Object(Sr.b)(s)&&o.a.createElement(N.a,{color:"primary",onClick:this.handleSend},e("Create")))),o.a.createElement(P.a,{className:"create-poll-dialog-root",open:n,manager:$.a,transitionDuration:0,onClose:this.handleConfirmationClose,"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},e("CancelPollAlertTitle")),o.a.createElement(Ln.a,{classes:{root:"create-poll-dialog-root"}},e("CancelPollAlertText")),o.a.createElement(T.a,null,o.a.createElement(N.a,{color:"primary",onClick:this.handleConfirmationClose},e("Cancel")),o.a.createElement(N.a,{color:"primary",onClick:this.handleConfirmationDone},e("Ok")))))}}var Ir=Object(d.a)(Object(d.d)(),Object(_.a)(),p.b,Object(d.c)())(Mr),Ur=a(92);a(556);class kr extends o.a.Component{constructor(e){super(e),this.handleTextKeyDown=e=>{"Enter"===e.key&&(this.urlInputRef.current.focus(),e.preventDefault(),e.stopPropagation())},this.handleUrlKeyDown=e=>{"Enter"===e.key&&(this.handleDone(),e.preventDefault(),e.stopPropagation())},this.handleTextChange=e=>{this.setState({text:e.target.value})},this.handleUrlChange=e=>{this.setState({url:e.target.value})},this.handleDone=()=>{const e=this.props,t=e.defaultText,a=e.defaultUrl;let n=this.state,s=n.text,i=n.url;if(s=null!==s?s:t,i=null!==i?i:a,!s&&!i)return void this.textInputRef.current.focus();if(!s)return this.setState({textError:!0}),void this.textInputRef.current.focus();if(i=Object(Ur.e)(i),!i)return this.setState({urlError:!0}),void this.urlInputRef.current.focus();(0,this.props.onDone)(s,i)},this.handleCancel=()=>{(0,this.props.onCancel)()},this.textRef=o.a.createRef(),this.textInputRef=o.a.createRef(),this.urlRef=o.a.createRef(),this.urlInputRef=o.a.createRef(),this.state={}}componentDidUpdate(e,t,a){const n=this.props,s=n.defaultText,i=n.defaultUrl,r=n.open;r&&e.open!==r&&setTimeout(()=>{const e=this.textInputRef.current,t=this.urlInputRef.current;e&&t&&(s?i?(e.focus(),e.select()):t.focus():e.focus())},0)}componentDidMount(){}shouldComponentUpdate(e,t,a){const n=this.props,s=n.defaultText,i=n.defaultUrl,r=n.onDone,o=n.onCancel,l=n.open,c=this.state,d=c.textError,h=c.urlError;return e.defaultText!==s||(e.defaultUrl!==i||(t.textError!==d||(t.urlError!==h||(e.onDone!==r||(e.onCancel!==o||e.open!==l)))))}static getDerivedStateFromProps(e,t){return t.prevOpen!==e.open?{prevOpen:!0,textError:!1,urlError:!1,text:null,url:null}:null}render(){const e=this.props,t=e.open,a=e.defaultUrl,n=e.defaultText,s=e.t,i=this.state,r=i.textError,l=i.urlError;return t?o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"edit-url-dialog-title"},o.a.createElement(R.a,{id:"edit-url-dialog-title"},s("CreateLink")),o.a.createElement(Ln.a,null,o.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:260}},o.a.createElement(An.a,{ref:this.textRef,inputRef:this.textInputRef,label:s("Text"),margin:"normal",autoComplete:"off",defaultValue:n,error:r,onChange:this.handleTextChange,onKeyDown:this.handleTextKeyDown}),o.a.createElement(An.a,{ref:this.urlRef,inputRef:this.urlInputRef,label:s("URL"),margin:"normal",autoComplete:"off",defaultValue:a,error:l,onChange:this.handleUrlChange,onKeyDown:this.handleUrlKeyDown}))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},s("Create")))):null}}var xr=Object(_.a)()(kr);a(557);class wr extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateBlob=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.thumbnail;if(!s)return;const i=s.photo||s.file;i&&e.chatId===a&&e.messageId===n&&e.fileId===i.id&&this.forceUpdate()}}componentDidMount(){U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdateBlob),U.a.on("clientUpdateAudioThumbnailBlob",this.onClientUpdateBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdateBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdateBlob),U.a.on("clientUpdateStickerThumbnailBlob",this.onClientUpdateBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateBlob),U.a.on("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdateBlob)}componentWillUnmount(){U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdateBlob),U.a.off("clientUpdateAudioThumbnailBlob",this.onClientUpdateBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdateBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdateBlob),U.a.off("clientUpdateStickerThumbnailBlob",this.onClientUpdateBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateBlob),U.a.off("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdateBlob)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.thumbnail,s=e.minithumbnail,i=e.onClick;if(!n)return null;const r=n.photo||n.file;if(!r)return null;const l=s?"data:image/jpeg;base64, "+s.data:null,d=Object(W.m)(r),h=Object(Qe.l)(n,u.Gb,u.Fb),p=Object(tt.F)(t,a);return o.a.createElement("div",{className:"reply-tile",onClick:i},l&&o.a.createElement("img",{className:c()("reply-tile-photo",{"reply-tile-photo-round":p},{"media-mini-blurred":!0}),draggable:!1,src:l,alt:""}),d&&o.a.createElement("img",{className:c()("reply-tile-photo",{"reply-tile-photo-round":p},{"media-blurred":d&&h}),draggable:!1,src:d,alt:""}))}}var Or=wr;a(558);class Lr extends o.a.Component{constructor(...e){super(...e),this.onGetMessageResult=e=>{const t=this.props,a=t.chatId,n=t.messageId;a===e.chat_id&&n===e.id&&this.forceUpdate()},this.handleClick=e=>{e.stopPropagation()},this.handleOpen=e=>{if(0!==e.button)return;e.stopPropagation();const t=this.props,a=t.chatId,n=t.messageId,s=t.onClick,i=ee.a.get(a,n);return i?Object(tt.J)(i)?null:(Object(Q.k)(a,n,!1),Object(Q.d)(),void(s&&s())):null}}componentDidMount(){ee.a.on("getMessageResult",this.onGetMessageResult)}componentWillUnmount(){ee.a.off("getMessageResult",this.onGetMessageResult)}render(){const e=this.props,t=e.t,a=e.chatId,n=e.messageId;let s=this.props.title;const i=ee.a.get(a,n);s=s||Object(tt.z)(i,t);let r=i?Object(tt.j)(i,t):t("Loading");const l=Object(tt.v)(a,n),d=Object(tt.u)(a,n);return Object(tt.J)(i)&&(s=null,r=t("DeletedMessage")),o.a.createElement("div",{className:"reply",onMouseDown:this.handleOpen,onClick:this.handleClick},o.a.createElement("div",{className:"reply-wrapper"},o.a.createElement("div",{className:"border reply-border"}),l&&o.a.createElement(Or,{chatId:a,messageId:n,minithumbnail:d,thumbnail:l}),o.a.createElement("div",{className:"reply-content"},s&&o.a.createElement("div",{className:"reply-content-title"},s),o.a.createElement("div",{className:c()("reply-content-subtitle")},r))))}}var _r=Object(_.a)()(Lr);a(559);class Nr extends o.a.Component{constructor(...e){super(...e),this.onUpdateMessageContent=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.editMessageId,i=e.chat_id,r=e.message_id;a===i&&(n!==r&&s!==r||this.forceUpdate())},this.handleClose=()=>{const e=this.props,t=e.chatId;e.editMessageId?Object(Q.f)(t,0):Object(Q.n)(t,0)}}componentDidMount(){ee.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){ee.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.editMessageId,s=e.t,i=e.onClick;return t&&(a||n)?o.a.createElement("div",{className:"inputbox-header"},o.a.createElement("div",{className:"inputbox-header-left-column"},o.a.createElement(j.a,{className:"inputbox-icon-button","aria-label":"Close",onClick:this.handleClose},o.a.createElement(f.a,null))),o.a.createElement("div",{className:"inputbox-header-middle-column"},o.a.createElement(_r,{chatId:t,messageId:n||a,title:n?s("EditMessage"):null,onClick:i})),o.a.createElement("div",{className:"inputbox-header-right-column"})):null}}var jr=Object(_.a)()(Nr);a(560);class Pr extends o.a.Component{constructor(...e){super(...e),this.handleDone=()=>{(0,this.props.onConfirm)()},this.handleCancel=()=>{(0,this.props.onCancel)()}}render(){const e=this.props,t=e.files,a=e.t;return t?o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},a("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,t.length>1?a("SendFilesConfirmation"):a("SendFileConfirmation"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},a("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},a("Ok")))):null}}var Tr=Object(d.a)(Object(_.a)())(Pr);a(561);class Rr extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateRecordStart=()=>{this.timer=setInterval(()=>{const e=new Date-this.startTime;this.setState({time:e})},25),this.startTime=new Date},this.onClientUpdateRecordStop=()=>{this.timer&&clearTimeout(this.timer),this.setState({time:null})},this.onClientUpdateRecordError=()=>{this.timer&&clearTimeout(this.timer),this.setState({time:null})}}componentDidMount(){ee.a.on("clientUpdateRecordStart",this.onClientUpdateRecordStart),ee.a.on("clientUpdateRecordStop",this.onClientUpdateRecordStop),ee.a.on("clientUpdateRecordError",this.onClientUpdateRecordError)}componentWillUnmount(){ee.a.off("clientUpdateRecordStart",this.onClientUpdateRecordStart),ee.a.off("clientUpdateRecordStop",this.onClientUpdateRecordStop),ee.a.off("clientUpdateRecordError",this.onClientUpdateRecordError)}normalizeM(e){let t=e.toString();return 1===t.length?t+="0":t.length>2&&(t=t.substr(0,2)),t}normalizeS(e){let t=e.toString();return 1===t.length&&(t="0"+t),t}msToTime(e){let t=e%1e3,a=(e=(e-t)/1e3)%60,n=(e=(e-a)/60)%60,s=(e-n)/60,i=n+":"+this.normalizeS(a)+","+this.normalizeM(t);return s>0&&(i=s+":"+i),i}render(){const e=this.state.time;return e?o.a.createElement("div",{className:"record-timer"},this.msToTime(e),o.a.createElement("div",{className:"record-timer-icon"})):null}}var Dr=Rr,Fr=a(563),Ar=a.n(Fr);a(562);class Br extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleSelectionChange=()=>{document.activeElement===this.captionRef.current&&this.saveSelection()},this.handleEnter=()=>{const e=this.props,t=e.chatId,a=e.messageId,n=e.open,s=e.newItem;if(!n)return;let i=null,r=null;const o=ee.a.get(t,a);if(o){const e=o.content;e&&(i=e.text,r=e.caption)}const l=this.captionRef.current;l&&(i?this.setFormattedText(i):r?this.setFormattedText(r):s&&s.caption?l.innerHTML=s.caption:l.innerText=null,Ra(l))},this.handleDone=()=>{const e=this.props,t=e.chatId,a=e.newItem,n=e.onSend,s=e.onEdit,i=this.state,r=i.editMessage,o=i.editFile,l=i.editMedia,c=i.sendAsPhoto,d=this.captionRef.current;if(!d)return;const h=d.innerHTML;d.innerText=null;const p=Object(tt.n)(h),u={"@type":"formattedText",text:p.text,entities:p.entities};if(Boolean(r)){if(l){const e=l.photo;if(!e)return;const t=e.sizes;if(!t)return;const a=t[t.length-1],n=a.width,i=a.height;s(null,{"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:o.name,data:o},width:n,height:i,caption:u})}else s(u,null);Object(Q.f)(t,0)}else{const e=a.media,t=a.file,s=e.audio,i=e.photo,r=e.document;let o=null;if(i){const e=i.sizes;if(!e)return;const a=e[e.length-1],n=a.width,s=a.height;o=c?{"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:t.name,data:t},width:n,height:s,caption:u}:{"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:t.name,data:t},thumbnail:null,caption:u}}else if(r)o={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:t.name,data:t},thumbnail:null,caption:u};else if(s){const e=s.duration,a=s.title,n=s.performer;o={"@type":"inputMessageAudio",audio:{"@type":"inputFileBlob",name:t.name,data:t},thumbnail:null,duration:e,title:a,performer:n,caption:u}}if(!o)return;n(o,t)}},this.handleCancel=()=>{const e=this.props,t=e.chatId,a=e.messageId,n=e.onCancel,s=ee.a.get(t,a);Boolean(s)&&Object(Q.f)(t,0),n()},this.handleKeyDown=e=>{const t=e.altKey,a=e.ctrlKey,n=(e.key,e.keyCode,e.code,e.metaKey),s=e.shiftKey,i=e.repeat,r=e.nativeEvent;if(r.isComposing)e.stopPropagation();else switch(r.code){case"Enter":case"NumpadEnter":t||!(a||n||s)||i?t||a||n||s||i||(this.handleDone(),e.preventDefault(),e.stopPropagation()):(document.execCommand("insertLineBreak"),e.preventDefault(),e.stopPropagation());break;case"KeyB":t||!a&&!n||s||i||(this.handleBold(),e.preventDefault(),e.stopPropagation());break;case"KeyI":t||!a&&!n||s||i||(this.handleItalic(),e.preventDefault(),e.stopPropagation());break;case"KeyK":t||!a&&!n||s||i?!t||!a&&!n||s||i||(this.handleMono(),e.preventDefault(),e.stopPropagation()):(this.handleUrl(),e.preventDefault(),e.stopPropagation());break;case"KeyN":!t||!a&&!n||s||i||(this.handleClear(),e.preventDefault(),e.stopPropagation())}},this.handleClear=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null)},this.handleBold=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("bold",!1,null)},this.handleItalic=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("italic",!1,null)},this.handleMono=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null);let e="";const t=this.selection;t&&!t.isCollapsed&&(e=t.toString()),e&&(e="<code>".concat(e,"</code>"),document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,e))},this.handleUnderline=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("underline",!1,null)},this.handleStrikeThrough=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("strikeThrough",!1,null)},this.handleUrl=()=>{this.openEditUrlDialog()},this.openEditUrlDialog=()=>{let e="",t="";const a=this.selection,n=this.range;if(n){let a=n.startContainer;if(a===n.endContainer){const n=a.parentElement;n&&"A"===n.nodeName&&(e=n.innerText,t=n.href)}}e||!a||a.isCollapsed||(e=a.toString()),this.setState({openEditUrl:!0,defaultUrl:t,defaultText:e})},this.closeEditUrlDialog=()=>{this.setState({openEditUrl:!1},()=>{this.restoreSelection()})},this.handlePaste=e=>{const t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleInput=()=>{this.clearInnerHtml()},this.handleCancelEditUrl=()=>{this.closeEditUrlDialog()},this.handleDoneEditUrl=(e,t)=>{this.closeEditUrlDialog(),setTimeout(()=>{const a=this.range;if(a){const n=a.startContainer,s=a.endContainer;if(n&&n===s){const a=n.parentNode;if(a&&"A"===a.nodeName){a.href=t,a.title=t,a.innerText=e;const n=a.lastChild;if(n){const e=document.createRange();e.setStart(n,n.textContent.length),e.setEnd(n,n.textContent.length);const t=document.getSelection();t.removeAllRanges(),t.addRange(e)}return}}}const n="<a href=".concat(t," title=").concat(t," rel='noopener noreferrer' target='_blank'>").concat(e,"</a>");document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,n)},0)},this.handleEditMedia=e=>{const t=this.editMediaRef.current;t&&t.click()},this.handleEditMediaComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.editMediaRef.current){e.next=3;break}return e.abrupt("return");case 3:if(0!==(n=a.files).length){e.next=6;break}return e.abrupt("return");case 6:if(i=Array.from(n),r=Object(Bn.a)(i),o=r[0],r.slice(1),o){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,Object(Qe.g)(o);case 11:l=e.sent,t.setState({editFile:o,editMedia:l}),a.value="";case 14:case"end":return e.stop()}}),e)}))),this.handleSendAsPhoto=()=>{const e=this.state.sendAsPhoto;this.setState({sendAsPhoto:!e})},this.captionRef=o.a.createRef(),this.editMediaRef=o.a.createRef(),this.state={}}static getDerivedStateFromProps(e,t){const a=t.prevOpen,n=e.open,s=e.chatId,i=e.messageId,r=e.newItem;if(a!==n){if(n){const e=ee.a.get(s,i);let t=!1;return(e&&"messagePhoto"===e.content["@type"]||r&&r.media&&"messagePhoto"===r.media["@type"])&&(t=!0),{prevOpen:!0,sendAsPhoto:t,editMessage:e,editMedia:null,editFile:null}}return{prevOpen:!1,sendAsPhoto:!1,editMessage:null,editMedia:null,editFile:null}}return null}componentDidMount(){document.addEventListener("selectionchange",this.handleSelectionChange,!0)}componentWillUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange,!0)}setFormattedText(e){const t=this.props.t,a=this.captionRef.current;if(!e)return void(a.innerText=null);const n=e.text,s=e.entities;try{const e=Object(tt.t)(n,s,t);a.innerHTML=null,e.forEach(e=>{a.appendChild(e)})}catch(i){a.innerText=n}}saveSelection(){this.selection=document.getSelection(),this.selection&&this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}restoreSelection(){const e=this.range;if(!e)return void Ra();const t=document.getSelection();t.removeAllRanges(),t.addRange(e),this.captionRef.current.focus()}clearInnerHtml(){const e=this.captionRef.current;if(!e)return;const t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.newItem,s=e.open,i=e.t,r=this.state,l=r.defaultText,c=r.defaultUrl,d=r.openEditUrl,h=r.editMessage,p=r.editMedia,u=r.sendAsPhoto;if(!s)return null;const m=ee.a.get(t,a),g=Boolean(m);let f=!1;(n&&n.media&&"messagePhoto"===n.media["@type"]||p&&"messagePhoto"===p["@type"]||h&&"messagePhoto"===h.content["@type"])&&(f=!0);let C=null;g?C=p?Object(Qe.e)({content:p}):Object(Qe.e)(m,null):n&&(C=Object(Qe.e)({content:n.media}));const b=i(g?"Save":"Send");return o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"edit-media-dialog-title",onEnter:this.handleEnter},o.a.createElement("div",{className:"edit-media-dialog-content"},o.a.createElement("div",{style:{margin:24}},C),g&&o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{disableRipple:!0,"aria-label":i("Edit"),className:"edit-media-dialog-edit-button",size:"small",onClick:this.handleEditMedia},o.a.createElement(Ar.a,{fontSize:"inherit"})),o.a.createElement("input",{ref:this.editMediaRef,className:"inputbox-attach-button",type:"file",accept:"image/*",onChange:this.handleEditMediaComplete})),!g&&f&&o.a.createElement(Ps.a,{value:u,onChange:this.handleSendAsPhoto,style:{margin:"0 24px 24px"}},o.a.createElement(Ts.a,{value:!0,control:o.a.createElement(is.a,{color:"primary"}),label:i("SendAsPhoto")}),o.a.createElement(Ts.a,{value:!1,control:o.a.createElement(is.a,{color:"primary"}),label:i("SendAsFile")}))),o.a.createElement("div",{ref:this.captionRef,id:"edit-media-dialog-caption",className:"scrollbars-hidden",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:i("Caption"),onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onInput:this.handleInput}),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},i("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},b)),o.a.createElement(xr,{open:d,defaultText:l,defaultUrl:c,onDone:this.handleDoneEditUrl,onCancel:this.handleCancelEditUrl}))}}var Hr=Object(_.a)()(Br);var Vr=class{constructor(e){this.chatId=e,this.lastAction=null}setTyping(e){if(this.chatId){if(this.lastAction&&this.lastAction["@type"]===e["@type"]){let e=new Date;if(e.setSeconds(e.getSeconds()-u.Jb),this.lastTypingDate&&this.lastTypingDate>e)return}this.lastAction=e,this.lastTypingDate=new Date,x.a.send({"@type":"sendChatAction",chat_id:this.chatId,action:e})}}},zr=a(158),Wr=a(97);a(564);const Gr=o.a.lazy(()=>Promise.all([a.e(7),a.e(6)]).then(a.bind(null,665)));class Zr extends r.Component{constructor(e){var t;super(e),t=this,this.selectionChangeListener=()=>{document.activeElement===this.newMessageRef.current&&this.saveSelection()},this.onClientUpdateClearHistory=e=>{this.props.chatId;e.chatId},this.onClientUpdateSendText=e=>{const t=e.text;if(!t)return;const a=this.newMessageRef.current;a&&(a.innerText=t,Ra(a))},this.onClientUpdateInputShake=e=>{const t=this.props;t.chatId,t.messageId;this.state.shook?this.setState({shook:!1},()=>{setTimeout(()=>{this.setState({shook:!0})},0)}):this.setState({shook:!0})},this.onClientUpdateSendFiles=e=>{const t=e.files;t&&this.handleSendFiles(Array.from(t))},this.onUpdateDeleteMessages=e=>{const t=this.state,a=t.chatId,n=t.editMessageId,s=e.chat_id,i=e.message_ids,r=e.is_permanent;n&&r&&a===s&&-1!==i.indexOf(n)&&this.handleCancel()},this.onClientUpdateEditMessage=e=>{const t=e.chatId,a=e.messageId;if(this.state.recordingTime)return;if(this.state.chatId!==t)return;a?this.saveDraftAndSelection():this.restoreDraftAndSelection();const n=0!==a&&Object(Qe.m)(t,a);this.setState({editMessageId:a,openEditMedia:n},()=>{this.state.openEditMedia||(this.setEditMessage(),this.handleInput(),setTimeout(()=>{this.focusInput()},0))})},this.onClientUpdateFocusWindow=e=>{e.focused||this.saveDraft()},this.onUpdateChatDraftMessage=e=>{const t=e.chat_id,a=this.state,n=a.chatId;a.recordingTime||n===t&&this.loadDraft()},this.onClientUpdateAnimationSend=e=>{const t=e.animation;if(!t)return;const a=t.animation,n=t.thumbnail,s=t.width,i=t.height,r=t.duration;if(!a)return;const o=this.newMessageRef.current;if(!o)return;o.innerText=null,this.restoreSelection();const l={"@type":"inputMessageAnimation",animation:{"@type":"inputFileId",id:a.id},width:s,height:i,duration:r};if(n){const e=n.width,t=n.height,a=n.file;l.thumbnail={"@type":"inputThumbnail",thumbnail:{"@type":"inputFileId",id:a.id},width:e,height:t}}this.sendMessage(l,!1,e=>{})},this.onClientUpdateStickerSend=e=>{const t=e.sticker;if(!t)return;const a=t.sticker,n=t.thumbnail,s=t.width,i=t.height;if(!a)return;const r=this.newMessageRef.current;if(!r)return;r.innerText=null,this.restoreSelection();const o={"@type":"inputMessageSticker",sticker:{"@type":"inputFileId",id:a.id},width:s,height:i};if(n){const e=n.width,t=n.height,a=n.file;o.thumbnail={"@type":"inputThumbnail",thumbnail:{"@type":"inputFileId",id:a.id},width:e,height:t}}this.sendMessage(o,!1,e=>{}),x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null})},this.onClientUpdateReply=e=>{const t=this.state,a=t.chatId,n=t.recordingTime,s=e.chatId,i=e.messageId;a===s&&(this.setState({replyToMessageId:i}),i&&!n&&this.setInputFocus())},this.onClientUpdateChatId=e=>{this.state.chatId!==e.nextChatId&&(this.saveDraft(),this.beforeEditText=null,this.setState({chatId:e.nextChatId,replyToMessageId:Object(F.m)(e.nextChatId),editMessageId:0,openEditUrl:!1},()=>{this.loadDraft()}),this.handleCancelRecord())},this.setDraft=()=>{const e=this.state.chatId,t=this.newMessageRef.current,a=ae.a.chatSelectOptions;if(a&&a.switchInline)return void this.setFormattedText({"@type":"formattedText",text:a.switchInline,entities:[]});const n=Object(F.l)(e);n?(this.setFormattedText(n),this.setState({replyToMessageId:Object(F.m)(e)})):t.innerText=null},this.setInputFocus=()=>{this.state.recordingTime||setTimeout(()=>{Ra(this.newMessageRef.current)},100)},this.setChatDraftMessage=e=>{if(!e)return;const t=e.chatId,a=e.draftMessage;t&&x.a.send({"@type":"setChatDraftMessage",chat_id:t,draft_message:a})},this.getDraftMessage=(e,t,a)=>{const n=Se.a.get(e);if(!n)return;const s=n.draft_message,i=Object(tt.n)(a),r=i.text,o=i.entities,l=r&&r.length>0||o.length>0?{"@type":"draftMessage",reply_to_message_id:t,input_message_text:{"@type":"inputMessageText",text:{"@type":"formattedText",text:r,entities:o},disable_web_page_preview:!1,clear_draft:!1}}:null;return Object(F.j)(s,l)?null:{chatId:e,draftMessage:l}},this.handleSubmit=(e=!0)=>{const t=this.state,a=t.chatId,n=t.editMessageId,s=(t.replyToMessageId,t.recordingReady),i=t.recordingTime;if(i){if(new Date-i<u.Pb)return;return void this.handleStopRecord()}if(s)return void(e&&this.handleRecord());const r=this.newMessageRef.current;if(!r)return;let o=r.innerHTML;if(r.innerText=null,this.handleInput(),!o)return;if(!o.trim())return;const l=Object(tt.n)(o),c={"@type":"formattedText",text:l.text,entities:l.entities},d={"@type":"inputMessageText",text:c,disable_web_page_preview:!1,clear_draft:!0};if(n){const e=ee.a.get(a,n);if(!e)return;const t=e.content;if(!t)return;const s=t.text,i=t.caption;s?this.editMessageText(d,e=>{}):i&&this.editMessageCaption(c),Object(Q.f)(a,0)}else this.sendMessage(d,!1,e=>{})},this.handleAttachPoll=()=>{x.a.clientUpdate({"@type":"clientUpdateNewPoll"})},this.handleAttachPhoto=()=>{this.attachPhotoRef&&this.attachPhotoRef.current.click()},this.handleAttachPhotoComplete=Object(i.a)(s.a.mark((function e(){var a,n,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachPhotoRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=13;break}if(n=Array.from(a),r=Object(Bn.a)(n),o=r[0],r.slice(1),o){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.getNewItem(o,!0);case 9:l=e.sent,t.setState({openEditMedia:!0,newItem:l}),e.next=14;break;case 13:Array.from(a).forEach(function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.A)(a);case 2:n=e.sent,i=Object(L.a)(n,2),r=i[0],o=i[1],l={"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:a.name,size:a.size,data:a},width:r,height:o},t.handleSendPhoto(l,a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:t.attachPhotoRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.handleAttachDocument=()=>{this.attachDocumentRef&&this.attachDocumentRef.current.click()},this.handleAttachDocumentComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachDocumentRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=13;break}if(n=Array.from(a),i=Object(Bn.a)(n),r=i[0],i.slice(1),r){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.getNewItem(r,!1);case 9:o=e.sent,t.setState({openEditMedia:!0,newItem:o}),e.next=14;break;case 13:Array.from(a).forEach(e=>{const a={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:e.name,size:e.size,data:e}};t.handleSendDocument(a,e)});case 14:t.attachDocumentRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.handleClear=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null)},this.handleBold=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("bold",!1,null)},this.handleItalic=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("italic",!1,null)},this.handleMono=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null);let e="";const t=this.selection;t&&!t.isCollapsed&&(e=t.toString()),e&&(e="<code>".concat(e,"</code>"),document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,e))},this.handleUnderline=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("underline",!1,null)},this.handleStrikeThrough=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("strikeThrough",!1,null)},this.handleUrl=()=>{this.openEditUrlDialog()},this.handleCancel=()=>{const e=this.state,t=e.chatId,a=e.editMessageId,n=e.replyToMessageId;return a?(Object(Q.f)(t,0),!0):!!n&&(Object(Q.n)(t,0),!0)},this.handleKeyDown=e=>{const t=e.altKey,a=e.ctrlKey,n=(e.key,e.keyCode,e.charCode,e.metaKey),s=e.shiftKey,i=e.repeat,r=e.nativeEvent,o=this.state,l=o.editMessageId,c=o.replyToMessageId;if(!r.isComposing)switch(r.code){case"Digit0":if(t&&a&&!n&&!s){if(l)return;if(c)return;e.preventDefault()}break;case"Enter":case"NumpadEnter":t||!(a||n||s)||i?t||a||n||s||i||(this.handleSubmit(!1),e.preventDefault(),e.stopPropagation()):(document.execCommand("insertLineBreak"),e.preventDefault(),e.stopPropagation());break;case"Escape":t||a||n||s||!i&&this.handleCancel()&&(e.preventDefault(),e.stopPropagation());break;case"ArrowUp":if(!i&&!t&&!a&&!n&&!s){const t=this.newMessageRef.current;if(t&&!t.innerText){if(this.state.editMessageId)return;x.a.clientUpdate({"@type":"clientUpdateTryEditMessage"}),e.preventDefault(),e.stopPropagation()}}break;case"KeyB":t||!a&&!n||s||i||(this.handleBold(),e.preventDefault(),e.stopPropagation());break;case"KeyI":t||!a&&!n||s||i||(this.handleItalic(),e.preventDefault(),e.stopPropagation());break;case"KeyK":t||!a&&!n||s||i?!t||!a&&!n||s||i||(this.handleMono(),e.preventDefault(),e.stopPropagation()):(this.handleUrl(),e.preventDefault(),e.stopPropagation());break;case"KeyN":!t||!a&&!n||s||i||(this.handleClear(),e.preventDefault(),e.stopPropagation())}},this.handleSendPhoto=(e,t)=>{e&&this.sendMessage(e,!0,e=>{const a=ee.a.get(e.chat_id,e.id);null!=a&&this.handleSendingMessage(a,t),U.a.uploadFile(e.content.photo.sizes[0].photo.id,e)})},this.handleSendPoll=e=>{this.sendMessage(e,!0,()=>{})},this.handleSendDocument=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.document.document.id,e))},this.handleSendAudio=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.audio.audio.id,e))},this.handleSendVoiceNote=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.voice_note.voice.id,e))},this.handlePaste=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.clipboardData||a.originalEvent.clipboardData,i=n.items){e.next=3;break}return e.abrupt("return");case 3:if(r=[],Array.from(i).forEach(e=>{if(0===e.kind.indexOf("file")){const t=e.getAsFile();t&&r.push(t)}}),!(r.length>0)){e.next=9;break}return a.preventDefault(),t.handleSendFiles(r),e.abrupt("return");case 9:if(!(o=a.clipboardData.getData("text/plain"))){e.next=14;break}return a.preventDefault(),document.execCommand("insertText",!1,o),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handlePasteConfirm=()=>{const e=this.state.files;e&&e.length&&(e.forEach(e=>{const t={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:e.name,data:e}};this.handleSendDocument(t,e)}),this.handlePasteCancel())},this.handlePasteCancel=()=>{this.setState({files:null})},this.handleUpdateDraftConfirm=()=>{this.state.newDraft&&(this.loadDraft(),this.handleUpdateDraftCancel())},this.handleUpdateDraftCancel=()=>{this.setState({newDraft:null})},this.handleSendingMessage=(e,t)=>{if(!e)return;const a=e.sending_state,n=e.content,s=e.chat_id,i=e.id;if(!a)return;if("messageSendingStatePending"!==a["@type"])return;if("messagePhoto"!==n["@type"])return;const r=n.photo;if(!r)return;const o=Object(M.p)(r.sizes,u.K);if(!o)return;const l=o.photo;l&&(U.a.setBlob(l.id,t),U.a.updatePhotoBlob(s,i,l.id))},this.sendMessage=function(){var e=Object(i.a)(s.a.mark((function e(a,n,i){var r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,o=r.chatId,l=r.replyToMessageId,o){e.next=3;break}return e.abrupt("return");case 3:if(a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,ae.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(o));case 8:return e.next=10,x.a.send({"@type":"sendMessage",chat_id:o,reply_to_message_id:l,input_message_content:a});case 10:c=e.sent,t.setState({replyToMessageId:0},()=>{n&&t.saveDraft()}),x.a.send({"@type":"viewMessages",chat_id:o,message_ids:[c.id]}),l&&Object(Q.n)(o,0),i(c),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),alert("sendMessage error "+JSON.stringify(e.t0));case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleEmojiSelect=e=>{e&&(this.restoreSelection(),document.execCommand("insertText",!1,e.native),this.handleInput())},this.handleInput=function(){var e=Object(i.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setTyping(),t.setHints(),t.setRecordingReadyState();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTextAndCaretPosition=()=>{const e=this.newMessageRef.current;if(!e)return;e.focus();let t=document.getSelection().getRangeAt(0),a=t.cloneRange();return a.selectNodeContents(e),a.setEnd(t.endContainer,t.endOffset),{text:e.innerText,position:a.toString().length}},this.openEditUrlDialog=()=>{let e="",t="";const a=this.selection,n=this.range;if(n){let a=n.startContainer;if(a===n.endContainer){const n=a.parentElement;n&&"A"===n.nodeName&&(e=n.innerText,t=n.href)}}e||!a||a.isCollapsed||(e=a.toString()),this.setState({openEditUrl:!0,defaultUrl:t,defaultText:e})},this.closeEditUrlDialog=()=>{this.setState({openEditUrl:!1},()=>{this.restoreSelection()})},this.focusInput=()=>{const e=this.newMessageRef.current;if(!e)return;if(!e.childNodes.length)return void e.focus();const t=Ta(e);if(!t)return;const a=document.createRange();a.setStart(t,t.length),a.collapse(!0);const n=window.getSelection();n.removeAllRanges(),n.addRange(a),e.focus()},this.handleCancelEditUrl=()=>{this.closeEditUrlDialog()},this.handleDoneEditUrl=(e,t)=>{this.closeEditUrlDialog(),setTimeout(()=>{const a=this.range;if(a){const n=a.startContainer,s=a.endContainer;if(n&&n===s){const a=n.parentNode;if(a&&"A"===a.nodeName){a.href=t,a.title=t,a.innerText=e;const n=a.lastChild;if(n){const e=document.createRange();e.setStart(n,n.textContent.length),e.setEnd(n,n.textContent.length);const t=document.getSelection();t.removeAllRanges(),t.addRange(e)}return}}}const n="<a href=".concat(t," title=").concat(t," rel='noopener noreferrer' target='_blank'>").concat(e,"</a>");document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,n)},0)},this.handleCancelEditMedia=()=>{this.closeEditMediaDialog()},this.handleEditMedia=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=25;break}return e.next=3,t.editMessageMedia(n);case 3:if(!(i=e.sent)){e.next=24;break}r=i.content,e.t0=r["@type"],e.next="messagePhoto"===e.t0?9:24;break;case 9:if(o=n.photo){e.next=12;break}return e.abrupt("break",24);case 12:if(l=o.data){e.next=15;break}return e.abrupt("break",24);case 15:if(c=r.photo){e.next=18;break}return e.abrupt("break",24);case 18:if(d=c.sizes.find(e=>"i"===e.type)){e.next=21;break}return e.abrupt("break",24);case 21:return(h=d.photo)&&U.a.setBlob(h.id,l),e.abrupt("break",24);case 24:return e.abrupt("return");case 25:t.editMessageCaption(a);case 26:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.handleSendMedia=(e,t)=>{switch(this.closeEditMediaDialog(!1),e["@type"]){case"inputMessageAudio":this.handleSendAudio(e,t);break;case"inputMessagePhoto":this.handleSendPhoto(e,t);break;case"inputMessageDocument":this.handleSendDocument(e,t)}},this.handleHeaderClick=()=>{setTimeout(()=>this.restoreSelection(),0)},this.handleStopRecord=(e=!1)=>{this.recorder&&(this.recorder.cancelled=e,this.recorder.stop(),this.recorder.stream.getAudioTracks().forEach(e=>e.stop()))},this.handleCancelRecord=()=>{this.handleStopRecord(!0)},this.handleRecord=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.recorder){e.next=2;break}return e.abrupt("return");case 2:return a=null,e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:if(a=e.sent,!t.recorder){e.next=9;break}return e.abrupt("return");case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(3);case 13:if(a){e.next=16;break}return t.setState({recordPermissionDenied:!0}),e.abrupt("return");case 16:n={channelCount:1,sampleRate:48e3},a.getAudioTracks()[0].applyConstraints(n),i={mimeType:"audio/ogg; codecs=opus",audioBitsPerSecond:64e3},r={encoderWorkerFactory:function(){return new Worker("/tgxkat/opus-media-recorder/encoderWorker.umd.js")},OggOpusEncoderWasmPath:"/tgxkat/opus-media-recorder/OggOpusEncoder.wasm"},o=new Ji.a(a,i,r),l=[],o.ondataavailable=e=>{l.push(e.data)},o.onstart=()=>{},o.onstop=()=>{x.a.clientUpdate({"@type":"clientUpdateRecordStop"}),t.setState({recordingTime:null});const e=t.recorder.cancelled;if(t.recorder=null,t.loadDraft(),e)return;const a=new Blob(l,{type:"audio/ogg; codecs=opus"}),n=window.URL.createObjectURL(a),s=new Audio(n);s.oncanplay=()=>{const e={"@type":"inputMessageVoiceNote",voice_note:{"@type":"inputFileBlob",name:"",size:a.size,data:a},duration:Math.trunc(s.duration),waveform:"",caption:null};t.handleSendVoiceNote(e,a)}},o.onerror=()=>{x.a.clientUpdate({"@type":"clientUpdateRecordError"}),t.setState({recordingTime:null}),t.loadDraft()},t.recorder=o,t.recorder.start(50),t.startTime=new Date,x.a.clientUpdate({"@type":"clientUpdateRecordStart"}),t.setState({recordingTime:new Date});case 32:case"end":return e.stop()}}),e,null,[[3,11]])}))),this.handleClosePermission=()=>{this.setState({recordPermissionDenied:!1})},this.attachDocumentRef=o.a.createRef(),this.attachPhotoRef=o.a.createRef(),this.newMessageRef=o.a.createRef();const a=ae.a.getChatId();this.state={chatId:a,replyToMessageId:Object(F.m)(a),editMessageId:0,recordingReady:!0,recordingTime:null,recordPermissionDenied:!1,sendFile:null},document.execCommand("defaultParagraphSeparator",!1,"br")}shouldComponentUpdate(e,t){const a=this.props.t,n=this.state,s=n.chatId,i=n.newDraft,r=n.files,o=n.replyToMessageId,l=n.editMessageId,c=n.openEditMedia,d=n.openEditUrl,h=n.sendFile,p=n.recordingReady,u=n.recordingTime,m=n.recordPermissionDenied,g=n.shook;return e.t!==a||(t.chatId!==s||(t.newDraft!==i||(t.files!==r||(t.replyToMessageId!==o||(t.editMessageId!==l||(t.sendFile!==h||(t.openEditUrl!==d||(t.openEditMedia!==c||(t.recordingTime!==u||(t.recordingReady!==p||(t.recordPermissionDenied!==m||t.shook!==g)))))))))))}loadDraft(){this.setDraft(),this.setInputFocus(),this.handleInput()}saveDraft(){const e=this.state,t=e.chatId,a=e.editMessageId,n=e.replyToMessageId,s=this.newMessageRef.current;if(!s)return;let i=null;i=a?this.beforeEditText?this.beforeEditText.innerHTML:null:s.innerHTML;const r=this.getDraftMessage(t,n,i);this.setChatDraftMessage(r)}componentDidMount(){document.addEventListener("selectionchange",this.selectionChangeListener,!0),zr.a.on("clientUpdateAnimationSend",this.onClientUpdateAnimationSend),ae.a.on("clientUpdateInputShake",this.onClientUpdateInputShake),ae.a.on("clientUpdateChatId",this.onClientUpdateChatId),ae.a.on("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),Se.a.on("updateChatDraftMessage",this.onUpdateChatDraftMessage),U.a.on("clientUpdateSendFiles",this.onClientUpdateSendFiles),ee.a.on("clientUpdateEditMessage",this.onClientUpdateEditMessage),ee.a.on("clientUpdateReply",this.onClientUpdateReply),ee.a.on("clientUpdateSendText",this.onClientUpdateSendText),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),Wr.a.on("clientUpdateStickerSend",this.onClientUpdateStickerSend),this.loadDraft()}componentWillUnmount(){this.saveDraft(),zr.a.off("clientUpdateAnimationSend",this.onClientUpdateAnimationSend),ae.a.off("clientUpdateInputShake",this.onClientUpdateInputShake),ae.a.off("clientUpdateChatId",this.onClientUpdateChatId),ae.a.off("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),Se.a.off("updateChatDraftMessage",this.onUpdateChatDraftMessage),U.a.off("clientUpdateSendFiles",this.onClientUpdateSendFiles),ee.a.off("clientUpdateEditMessage",this.onClientUpdateEditMessage),ee.a.off("clientUpdateReply",this.onClientUpdateReply),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("clientUpdateSendText",this.onClientUpdateSendText),Wr.a.off("clientUpdateStickerSend",this.onClientUpdateStickerSend),document.removeEventListener("selectionchange",this.selectionChangeListener,!0),this.handleCancelRecord()}restoreDraftAndSelection(){const e=this.newMessageRef.current;if(!e)return;const t=this.beforeEditText;if(t){if(e.innerHTML=t.innerHTML,!t.range)return void this.focusInput();const a=document.getSelection();a.removeAllRanges(),a.addRange(t.range),e.focus()}else e.innerHTML=null,this.focusInput();this.handleInput()}saveDraftAndSelection(){const e=this.newMessageRef.current;e&&(this.beforeEditText={innerHTML:e.innerHTML,range:this.range})}setEditMessage(){const e=this.state,t=e.chatId,a=e.editMessageId,n=ee.a.get(t,a);if(!n)return;const s=n.content;if(!s)return;const i=s.text,r=s.caption;if(!i&&!r)return;const o=this.newMessageRef.current;i?this.setFormattedText(i):r?this.setFormattedText(r):o.innerText=null}setFormattedText(e){const t=this.props.t,a=this.newMessageRef.current;if(!e)return void(a.innerText=null);const n=e.text,s=e.entities;try{const e=Object(tt.t)(n,s,t);a.innerHTML=null,e.forEach(e=>{a.appendChild(e)})}catch(i){a.innerText=n}}getNewItem(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",null);case 2:if((i=a.newMessageRef.current.innerHTML)&&(a.newMessageRef.current.innerHTML=null,a.handleInput()),!t){n.next=10;break}return n.next=7,Object(Qe.g)(e);case 7:n.t0=n.sent,n.next=13;break;case 10:return n.next=12,Object(Qe.f)(e);case 12:n.t0=n.sent;case 13:return r=n.t0,n.abrupt("return",{file:e,media:r,caption:i});case 15:case"end":return n.stop()}}),n)})))()}setTyping(){const e=this.state,t=e.chatId,a=e.editMessageId,n=Se.a.get(t);if(!n)return;const s=this.newMessageRef.current;if(!s)return;const i=s.innerHTML;"<br>"!==i&&"<div><br></div>"!==i||(s.innerHTML=null);if(!s.innerText)return;if(Object(F.gb)(t))return;if(a)return;(n.OutputTypingManager||(n.OutputTypingManager=new Vr(n.id))).setTyping({"@type":"chatActionTyping"})}setHints(){const e=this.state.editMessageId,t=this.newMessageRef.current.innerText;if(!t||t.length>11||e){return void(Wr.a.hint&&x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null}))}performance.now();let a=Ki()().exec(t);performance.now();if(!a||t!==a[0]){return void(Wr.a.hint&&x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null}))}const n=Date.now();x.a.send({"@type":"getStickers",emoji:a[0],limit:100}).then(e=>{x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:{timestamp:n,emoji:a[0],stickers:e}})}),x.a.send({"@type":"searchStickers",emoji:a[0],limit:100}).then(e=>{x.a.clientUpdate({"@type":"clientUpdateRemoteStickersHint",hint:{timestamp:n,emoji:a[0],stickers:e}})})}handleSendFiles(e){var t=this;return Object(i.a)(s.a.mark((function a(){var n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:if(e.length){a.next=4;break}return a.abrupt("return");case 4:if(1!==e.length){a.next=13;break}return a.next=7,t.getNewItem(e[0],e[0].type.startsWith("image"));case 7:if(n=a.sent){a.next=10;break}return a.abrupt("return");case 10:t.setState({openEditMedia:!0,newItem:n}),a.next=14;break;case 13:t.setState({files:e});case 14:case"end":return a.stop()}}),a)})))()}editMessageMedia(e){var t=this;return Object(i.a)(s.a.mark((function a(){var n,i,r;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=t.state,i=n.chatId,r=n.editMessageId,i){a.next=3;break}return a.abrupt("return");case 3:if(r){a.next=5;break}return a.abrupt("return");case 5:if(e){a.next=7;break}return a.abrupt("return");case 7:return a.abrupt("return",x.a.send({"@type":"editMessageMedia",chat_id:i,message_id:r,input_message_content:e}));case 8:case"end":return a.stop()}}),a)})))()}editMessageCaption(e){const t=this.state,a=t.chatId,n=t.editMessageId;a&&n&&e&&x.a.send({"@type":"editMessageCaption",chat_id:a,message_id:n,caption:e})}editMessageText(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=a.state,r=i.chatId,o=i.editMessageId,r){n.next=3;break}return n.abrupt("return");case 3:if(o){n.next=5;break}return n.abrupt("return");case 5:if(e){n.next=7;break}return n.abrupt("return");case 7:return n.prev=7,n.next=10,x.a.send({"@type":"editMessageText",chat_id:r,message_id:o,input_message_content:e});case 10:l=n.sent,t(l);case 12:return n.prev=12,n.finish(12);case 14:case"end":return n.stop()}}),n,null,[[7,,12,14]])})))()}searchUsernameOrHashtag(e,t,a,n){var r=this;const o=this.state.chatId,l=[];this.cancelDelayRunnable&&(clearTimeout(this.cancelDelayRunnable),this.cancelDelayRunnable=null);const c=Object(F.n)(o),d=Date.now();this.now=d;let h=t;e.length>0&&h--,this.lastText=e,this.lastUsernameOnly=n;let p,u,m=-1,g="",f=-1;if(n)g+=e.substring(1),p=0,u=g.length,m=0;else for(let s=h;s>=0;s--){if(s>=e.length)continue;let n=e[s];if((0===s||" "===e[s-1]||"\n"===e[s-1]||":"===e[s-1])&&"@"===n){if(!c&&0!==s)return this.lastText=e,this.lastPosition=t,this.messages=a,void this.closeHints(d);f=s,m=0,p=s,u=g.length+1}g=n+g}if(-1!==m){if(0===m){const e=[],t=new Map;for(let n=0;n<Math.min(100,a.length);n++){const s=a[n].sender;s&&s.user_id&&!t.has(s.user_id)&&(t.set(s.user_id,s.user_id),e.push(s.user_id))}let h=g.substr(p,u).toLowerCase();const m=h.indexOf(" ")>=0,C=[],b=new Map,v=new Map,E=[];!n&&0===f&&E.length;const S=Se.a.get(o);if(S&&c&&c.members)for(let a=-1;a<c.members.length;a++){let e,t,s,i,r;if(-1===a){if(!h.length){C.push(S);continue}t=S.title,s="",e=S.username,i=S,r=-S.id}else{const o=c.members[a].user_id,l=te.a.get(o);if(!l||!n&&Object(Et.j)(o)||b.has(o))continue;if(!h.length&&!Object(Et.i)(o)){C.push(l);continue}t=l.first_name,s=l.last_name,e=l.username,i=l,r=l.id}(e.length>0&&e.toLowerCase().startsWith(h)||t.length>0&&t.toLowerCase().startsWith(h)||s.length>0&&s.toLowerCase().startsWith(h)||m&&"".concat(t," ").concat(s).toLowerCase().startsWith(h))&&(C.push(i),v.set(r,i))}Object(F.ib)(o)&&h.length>0?(C.length<5?this.cancelDelayRunnable=setTimeout(()=>{this.cancelDelayRunnable=null,this.showUsersResult(d,C,v,!0)},0):this.showUsersResult(d,C,v,!0),setTimeout(Object(i.a)(s.a.mark((function e(){var t,a,n,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.now===d){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"searchChatMembers",chat_id:o,query:h,limit:20,filter:{"@type":"chatMembersFilterMention",message_thread_id:0}});case 4:if(t=e.sent,r.now===d){e.next=7;break}return e.abrupt("return");case 7:if(!((a=t.members).length>0)){e.next=22;break}n=0;case 10:if(!(n<a.length)){e.next=21;break}if(i=a[n].user_id,!Object(Et.j)(i)){e.next=14;break}return e.abrupt("continue",18);case 14:if(c=te.a.get(i)){e.next=17;break}return e.abrupt("continue",18);case 17:l.push(c);case 18:n++,e.next=10;break;case 21:r.notifyDataSetChanged(d,l);case 22:case"end":return e.stop()}}),e)}))),200)):this.showUsersResult(d,C,v,!0)}}else this.closeHints(d)}notifyDataSetChanged(e,t){console.log("[search] global",t),x.a.clientUpdate({"@type":"clientUpdateHintsGlobal",id:e,global:t})}showUsersResult(e,t,a,n){console.log("[search] local",t),x.a.clientUpdate({"@type":"clientUpdateHintsLocal",id:e,local:t})}closeHints(e){console.log("[search] close"),x.a.clientUpdate({"@type":"clientUpdateHintsClose",id:e})}openHints(){}setRecordingReadyState(){const e=this.state.editMessageId;this.newMessageRef.current.innerText||e?this.setState({recordingReady:!1}):this.setState({recordingReady:!0})}saveSelection(){this.selection=document.getSelection(),this.selection&&this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}restoreSelection(){const e=this.range;if(!e)return void this.focusInput();const t=document.getSelection();t.removeAllRanges(),t.addRange(e),this.newMessageRef.current.focus()}closeEditMediaDialog(e=!0){const t=this.state.newItem;this.setState({openEditMedia:!1,newItem:null},()=>{e&&t&&t.caption?(this.newMessageRef.current.innerHTML=t.caption,this.focusInput(),this.handleInput()):this.restoreSelection()})}render(){const e=this.props.t,t=this.state,a=t.chatId,n=t.editMessageId,s=t.newItem,i=t.replyToMessageId,r=t.files,l=(t.newDraft,t.defaultText),d=t.defaultUrl,h=t.openEditUrl,p=t.openEditMedia,u=t.recordingReady,m=t.recordingTime,g=t.recordPermissionDenied,f=t.shook,C=n>0&&!Object(tt.R)(a,n);let b=o.a.createElement(_t.a,{open:!m&&u,openIcon:o.a.createElement($i,null),icon:o.a.createElement(Qi,null)});return n&&(b=o.a.createElement(ns,null)),o.a.createElement("div",{className:"inputbox-background"},o.a.createElement("div",{className:c()("inputbox",{"inputbox-recording":m},{shook:f})},o.a.createElement("div",{className:c()("inputbox-bubble")},o.a.createElement(jr,{chatId:a,messageId:i,editMessageId:p?0:n,onClick:this.handleHeaderClick}),o.a.createElement("div",{className:"inputbox-wrapper"},o.a.createElement("div",{className:"inputbox-left-column"},o.a.createElement(o.a.Suspense,{fallback:o.a.createElement(j.a,{className:"inputbox-icon-button","aria-label":"Emoticon"},o.a.createElement(Xi.a,null))},o.a.createElement(Gr,{onSelect:this.handleEmojiSelect}))),o.a.createElement("div",{className:"inputbox-middle-column"},o.a.createElement("div",{id:"inputbox-message",className:"scrollbars-hidden",ref:this.newMessageRef,placeholder:e(C?"Caption":"Message"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onInput:this.handleInput})),o.a.createElement("div",{className:"inputbox-right-column"},o.a.createElement(Dr,null),o.a.createElement("input",{ref:this.attachDocumentRef,className:"inputbox-attach-button",type:"file",multiple:"multiple",onChange:this.handleAttachDocumentComplete}),o.a.createElement("input",{ref:this.attachPhotoRef,className:"inputbox-attach-button",type:"file",multiple:"multiple",accept:"image/*",onChange:this.handleAttachPhotoComplete}),!Boolean(n)&&!m&&o.a.createElement(sr,{chatId:a,onAttachPhoto:this.handleAttachPhoto,onAttachDocument:this.handleAttachDocument,onAttachPoll:this.handleAttachPoll})))),m&&o.a.createElement("div",{className:"inputbox-cancel-record-button-background"},o.a.createElement(j.a,{className:"inputbox-cancel-record-button","aria-label":"Delete",size:"small",color:"secondary",onClick:this.handleCancelRecord},o.a.createElement(Ke,null))),o.a.createElement("div",{className:"inputbox-send-button-background"},o.a.createElement(j.a,{className:c()("inputbox-send-button",{"inputbox-send-accent-button":m||!u}),"aria-label":"Send",size:"small",onClick:this.handleSubmit},b))),!Object(F.hb)(a)&&o.a.createElement(Ir,{onSend:this.handleSendPoll}),o.a.createElement(Tr,{files:r,onConfirm:this.handlePasteConfirm,onCancel:this.handlePasteCancel}),o.a.createElement(xr,{open:h,defaultText:l,defaultUrl:d,onDone:this.handleDoneEditUrl,onCancel:this.handleCancelEditUrl}),o.a.createElement(Hr,{open:p,chatId:a,messageId:n,newItem:s,onEdit:this.handleEditMedia,onSend:this.handleSendMedia,onCancel:this.handleCancelEditMedia}),o.a.createElement(P.a,{transitionDuration:0,open:g,onClose:this.handleClosePermission,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},e("RecordDeniedTitle")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,e("RecordDeniedDescription"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleClosePermission,color:"primary"},e("Ok")))))}}var qr=Object(_.a)()(Zr),Kr=a(222),Yr=a.n(Kr);a(565);class Jr extends o.a.Component{render(){const e=this.props,t=e.command,a=e.onCommand;return o.a.createElement("div",{className:"footer-command"},o.a.createElement("div",{className:"inputbox"},o.a.createElement("div",{className:"inputbox-bubble"},o.a.createElement(Yr.a,{color:"primary",className:"footer-command-button",onClick:a},t))))}}var Xr=Jr;var Qr=Object(_.a)()(class extends De{render(){const e=this.props.t,t=e(this.state.isMuted?"ChatsUnmute":"ChatsMute");return o.a.createElement(Xr,{command:t,onCommand:this.handleSetChatNotifications})}});a(566);class $r extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={},this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&this.setState({clearHistory:e.inProgress})},this.onUpdateChatLastMessage=e=>{const t=e.chat_id,a=e.last_message;t===this.props.chatId&&this.setState({hasLastMessage:Boolean(a)})},this.onUpdateChatIsBlocked=e=>{const t=e.chat_id,a=e.is_blocked;t===this.props.chatId&&this.setState({isBlocked:a})},this.onUpdateBasicGroup=e=>{const t=this.props.chatId;Object(F.O)(t,e.basic_group.id)&&this.forceUpdate()},this.onUpdateSupergroup=e=>{const t=this.props.chatId;Object(F.R)(t,e.supergroup.id)&&this.forceUpdate()},this.handleJoin=()=>{const e=this.props.chatId;e&&x.a.send({"@type":"joinChat",chat_id:e})},this.handleDeleteAndExit=()=>{const e=this.props.chatId;e&&x.a.send({"@type":"deleteChatHistory",chat_id:e,remove_from_chat_list:!0})},this.handleUnblock=()=>{const e=this.props.chatId;Object(ka.i)({"@type":"messageSenderChat",chat_id:e})},this.handleStartBot=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.props,n=a.chatId,i=a.options,e.next=3,ae.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(n));case 3:if(!i||!i.botStartMessage){e.next=9;break}return r=i.botStartMessage,o=r.botUserId,l=r.parameter,e.next=7,Object(ka.f)(n,o,l);case 7:e.next=11;break;case 9:return e.next=11,x.a.send({"@type":"sendMessage",chat_id:n,reply_to_message_id:0,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:"/start",entities:[]},disable_web_page_preview:!0,clear_draft:!0}});case 11:case"end":return e.stop()}}),e)})))}static getDerivedStateFromProps(e,t){const a=e.chatId;if(t.prevChatId!==a){const e=Se.a.get(a);if(e){const t=e.is_blocked,n=e.last_message;return{prevChatId:a,isBlocked:t,hasLastMessage:Boolean(n)}}}return null}shouldComponentUpdate(e,t){const a=this.props,n=a.t,s=a.chatId,i=a.options,r=this.state,o=r.hasLastMessage,l=r.isBlocked,c=r.clearHistory;return e.chatId!==s||(e.options!==i||(e.t!==n||(t.hasLastMessage!==o||(t.isBlocked!==l||t.clearHistory!==c))))}componentDidMount(){Ie.a.on("updateBasicGroup",this.onUpdateBasicGroup),Se.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.on("updateChatIsBlocked",this.onUpdateChatIsBlocked),Se.a.on("updateChatLastMessage",this.onUpdateChatLastMessage),Ue.a.on("updateSupergroup",this.onUpdateSupergroup)}componentWillUnmount(){Ie.a.off("updateBasicGroup",this.onUpdateBasicGroup),Se.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Se.a.off("updateChatIsBlocked",this.onUpdateChatIsBlocked),Se.a.off("updateChatLastMessage",this.onUpdateChatLastMessage),Ue.a.off("updateSupergroup",this.onUpdateSupergroup)}render(){const e=this.props,t=e.chatId,a=e.options,n=e.t,s=this.state,i=s.hasLastMessage,r=s.clearHistory,l=Se.a.get(t);if(!l)return null;const c=l.type,d=l.is_blocked;if(!c)return null;if(d)return o.a.createElement(Xr,{command:n("Unblock"),onCommand:this.handleUnblock});if(a&&a.botStartMessage){if(Object(F.U)(t))return o.a.createElement(Xr,{command:n("BotStart"),onCommand:this.handleStartBot})}switch(c["@type"]){case"chatTypeBasicGroup":{const e=Ie.a.get(c.basic_group_id);if(!e)return null;const t=e.status;if(!t)return null;const a=t.is_member,s=t.permissions;switch(t["@type"]){case"chatMemberStatusAdministrator":return o.a.createElement(qr,null);case"chatMemberStatusBanned":return o.a.createElement(Xr,{command:n("DeleteChat"),onCommand:this.handleDeleteAndExit});case"chatMemberStatusCreator":return a?o.a.createElement(qr,null):o.a.createElement(Xr,{command:n("JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusLeft":return null;case"chatMemberStatusMember":return o.a.createElement(qr,null);case"chatMemberStatusRestricted":return a?s&&s.can_send_messages?o.a.createElement(qr,null):null:o.a.createElement(Xr,{command:n("JoinGroup"),onCommand:this.handleJoin})}break}case"chatTypeSecret":case"chatTypePrivate":return!Object(F.U)(t)||i&&!r?o.a.createElement(qr,null):o.a.createElement(Xr,{command:n("BotStart"),onCommand:this.handleStartBot});case"chatTypeSupergroup":{const e=Ue.a.get(c.supergroup_id);if(!e)return null;const a=e.is_channel,s=e.status;if(!s)return null;const i=s.is_member,r=s.permissions;switch(s["@type"]){case"chatMemberStatusAdministrator":return o.a.createElement(qr,null);case"chatMemberStatusBanned":return o.a.createElement(Xr,{command:n("DeleteChat"),onCommand:this.handleDeleteAndExit});case"chatMemberStatusCreator":return i?o.a.createElement(qr,null):o.a.createElement(Xr,{command:n(a?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusLeft":return o.a.createElement(Xr,{command:n(a?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusMember":return a?o.a.createElement(Qr,{chatId:t}):o.a.createElement(qr,null);case"chatMemberStatusRestricted":return i?r&&r.can_send_messages?o.a.createElement(qr,null):null:o.a.createElement(Xr,{command:n(a?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin})}}}return null}}var eo=Object(_.a)()($r),to=Object(he.a)(o.a.createElement("g",{transform:"translate(-1.000000, -3.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M9,13 C12.3229116,13 14.7530244,13.8337117 16.2223821,15.5699359 C16.724477,16.1632234 17,16.915291 17,17.6925226 L17,18.5 C17,19.8807119 15.8807119,21 14.5,21 L3.5,21 C2.11928813,21 1,19.8807119 1,18.5 L1,17.6925204 C1,16.9152876 1.2755246,16.1632192 1.77762117,15.569932 C3.24697824,13.8337108 5.67709024,13 9,13 Z M9,15 C6.21130036,15 4.33538166,15.6435809 3.30428673,16.861943 C3.10781409,17.0940989 3,17.3883868 3,17.6925212 L3,18.5 C3,18.7761424 3.22385763,19 3.5,19 L14.5,19 C14.7761424,19 15,18.7761424 15,18.5 L15,17.6925226 C15,17.3883883 14.8921864,17.0941004 14.6957148,16.8619448 C13.6646202,15.6435815 11.788701,15 9,15 Z M18.8833789,7.00672773 L19,7 C19.5128358,7 19.9355072,7.38604019 19.9932723,7.88337887 L20,8 L20,10 L22,10 C22.5128358,10 22.9355072,10.3860402 22.9932723,10.8833789 L23,11 C23,11.5128358 22.6139598,11.9355072 22.1166211,11.9932723 L22,12 L20,12 L20,14 C20,14.5128358 19.6139598,14.9355072 19.1166211,14.9932723 L19,15 C18.4871642,15 18.0644928,14.6139598 18.0067277,14.1166211 L18,14 L18,12 L16,12 C15.4871642,12 15.0644928,11.6139598 15.0067277,11.1166211 L15,11 C15,10.4871642 15.3860402,10.0644928 15.8833789,10.0067277 L16,10 L18,10 L18,8 C18,7.48716416 18.3860402,7.06449284 18.8833789,7.00672773 L19,7 L18.8833789,7.00672773 Z M9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 Z M9,5 C7.8954305,5 7,5.8954305 7,7 C7,8.1045695 7.8954305,9 9,9 C10.1045695,9 11,8.1045695 11,7 C11,5.8954305 10.1045695,5 9,5 Z"})),"AddMember"),ao=Object(he.a)(o.a.createElement("path",{d:"M19.36,2.72L20.78,4.14L15.06,9.85C16.13,11.39 16.28,13.24 15.38,14.44L9.06,8.12C10.26,7.22 12.11,7.37 13.65,8.44L19.36,2.72M5.93,17.57C3.92,15.56 2.69,13.16 2.35,10.92L7.23,8.83L14.67,16.27L12.58,21.15C10.34,20.81 7.94,19.58 5.93,17.57Z"}),"Broom");a(567);class no extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={anchorEl:null},this.handleButtonClick=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.currentTarget,i=ae.a.getChatId(),e.next=4,x.a.send({"@type":"getChat",chat_id:i});case 4:r=e.sent,Se.a.set(r),t.setState({anchorEl:n});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleChatInfo=()=>{this.handleMenuClose(),setTimeout(()=>this.props.openChatDetails(),150)},this.handleClearHistory=()=>{this.handleMenuClose(),Object(Pe.c)(ae.a.getChatId())},this.handleDeleteChat=()=>{this.handleMenuClose(),Object(Pe.e)(ae.a.getChatId())},this.handleUnpin=()=>{this.handleMenuClose();const e=ae.a.getChatId(),t=ee.a.getMedia(e);if(!t)return!1;const a=t.pinned;return!!a&&(1===a.length&&void Object(Q.p)(e,a[0].id))},this.handleSwitchBlocked=()=>{this.handleMenuClose();const e=ae.a.getChatId(),t=Se.a.get(e);if(!t)return;const a=Object(F.t)(e);t.is_blocked?Object(ka.i)(a):Object(ka.e)(a)}}render(){const e=this.props.t,t=this.state.anchorEl,a=ae.a.getChatId(),n=Se.a.get(a);if(!n)return null;const s=n.is_blocked,i=Object(F.b)(a),r=Object(F.c)(a),l=Object(F.D)(a,e),c=Object(F.Q)(a),d=Object(F.h)(a);return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{"aria-owns":t?"simple-menu":null,"aria-haspopup":"true",className:"main-menu-button","aria-label":"Menu",onClick:this.handleButtonClick},o.a.createElement(On,null)),o.a.createElement(Aa.a,{id:"main-menu",anchorEl:t,open:Boolean(t),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(We.a,{onClick:this.handleChatInfo},o.a.createElement(ge.a,null,Object(F.hb)(a)?o.a.createElement(ya,null):o.a.createElement(Ma,null)),o.a.createElement(fe.a,{primary:Object(F.N)(a,e)})),i&&o.a.createElement(We.a,{onClick:this.handleClearHistory},o.a.createElement(ge.a,null,o.a.createElement(ao,null)),o.a.createElement(fe.a,{primary:e("ClearHistory")})),r&&l&&o.a.createElement(We.a,{onClick:this.handleDeleteChat},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:l})),c&&o.a.createElement(We.a,{onClick:this.handleUnpin},o.a.createElement(ge.a,null,o.a.createElement(va,null)),o.a.createElement(fe.a,{primary:e("UnpinMessageAlertTitle")})),d&&o.a.createElement(We.a,{onClick:this.handleSwitchBlocked},o.a.createElement(ge.a,null,s?o.a.createElement(to,null):o.a.createElement(gi,null)),o.a.createElement(fe.a,{primary:e(s?"Unblock":"BlockContact")}))))}}var so=Object(_.a)()(no);a(568);class io extends o.a.Component{constructor(...e){super(...e),this.onUpdateChatOnlineMemberCount=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateChatTitle=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateUserChatAction=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateUserStatus=e=>{const t=this.props.chatId,a=Se.a.get(t);if(a&&a.type)switch(a.type["@type"]){case"chatTypeBasicGroup":{const t=Ie.a.getFullInfo(a.type.basic_group_id);if(t&&t.members){t.members.find(t=>t.user_id===e.user_id)&&this.forceUpdate()}break}case"chatTypePrivate":case"chatTypeSecret":a.type.user_id===e.user_id&&this.forceUpdate()}},this.onUpdateUserFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);a&&a.type&&("chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||a.type.user_id!==e.user_id||this.forceUpdate())},this.onUpdateBasicGroupFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);a&&a.type&&"chatTypeBasicGroup"===a.type["@type"]&&a.type.basic_group_id===e.basic_group_id&&this.forceUpdate()},this.onUpdateSupergroupFullInfo=e=>{const t=this.props.chatId,a=Se.a.get(t);a&&a.type&&"chatTypeSupergroup"===a.type["@type"]&&a.type.supergroup_id===e.supergroup_id&&this.forceUpdate()},this.onUpdateBasicGroup=e=>{const t=this.props.chatId,a=Se.a.get(t);a&&a.type&&"chatTypeBasicGroup"===a.type["@type"]&&a.type.basic_group_id===e.basic_group.id&&this.forceUpdate()},this.onUpdateSupergroup=e=>{const t=this.props.chatId,a=Se.a.get(t);a&&a.type&&"chatTypeSupergroup"===a.type["@type"]&&a.type.supergroup_id===e.supergroup.id&&this.forceUpdate()}}componentDidMount(){Se.a.on("updateChatOnlineMemberCount",this.onUpdateChatOnlineMemberCount),Se.a.on("updateChatTitle",this.onUpdateChatTitle),te.a.on("updateUserStatus",this.onUpdateUserStatus),Se.a.on("updateUserChatAction",this.onUpdateUserChatAction),te.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo),Ie.a.on("updateBasicGroup",this.onUpdateBasicGroup),Ue.a.on("updateSupergroup",this.onUpdateSupergroup)}componentWillUnmount(){Se.a.off("updateChatOnlineMemberCount",this.onUpdateChatOnlineMemberCount),Se.a.off("updateChatTitle",this.onUpdateChatTitle),te.a.off("updateUserStatus",this.onUpdateUserStatus),Se.a.off("updateUserChatAction",this.onUpdateUserChatAction),te.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),Ie.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Ue.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo),Ie.a.off("updateBasicGroup",this.onUpdateBasicGroup),Ue.a.off("updateSupergroup",this.onUpdateSupergroup)}render(){const e=this.props.chatId,t=Object(F.v)(e,!0),a=Object(F.S)(e);return o.a.createElement("div",{className:c()("header-chat-subtitle",{"header-chat-subtitle-accent":a})},t)}}var ro=io;a(569);class oo extends o.a.Component{render(){const e=this.props,t=e.className,a=e.chatId,n=e.onClick;return o.a.createElement("div",{className:c()("header-chat",t),onClick:n},o.a.createElement(D.a,{chatId:a,size:44}),o.a.createElement("div",{className:"header-chat-content"},o.a.createElement(Me,{chatId:a}),o.a.createElement(ro,{chatId:a})))}}var lo=oo;a(570),a(571);class co extends o.a.Component{constructor(e){super(e),this.animate=(e,t,a)=>{const n=this.props.height,s=this.containerRef.current,i=this.item1Ref.current,r=this.item2Ref.current;if(!s||!i||!r)return;a?(s.style.cssText="transform: translateY(-".concat(n,"px)"),i.style.cssText="opacity: 0",r.style.cssText="opacity: 1",requestAnimationFrame(()=>{s.style.cssText="transform: translateY(0); transition: transform ".concat("250ms"," ").concat("ease-in-out"),i.style.cssText="opacity: 1; transition: opacity ".concat("250ms"," ").concat("ease-in-out","; height: ").concat(n,"px"),r.style.cssText="opacity: 0; transition: opacity ".concat("250ms"," ").concat("ease-in-out","; height: ").concat(n,"px")})):(s.style.cssText="transform: translateY(0px)",i.style.cssText="opacity: 1",r.style.cssText="opacity: 0",requestAnimationFrame(()=>{s.style.cssText="transform: translateY(-".concat(n,"px); transition: transform ").concat("250ms"," ").concat("ease-in-out"),i.style.cssText="opacity: 0; transition: opacity ".concat("250ms"," ").concat("ease-in-out","; height: ").concat(n,"px"),r.style.cssText="opacity: 1; transition: opacity ".concat("250ms"," ").concat("ease-in-out","; height: ").concat(n,"px")}))},this.containerRef=o.a.createRef(),this.item1Ref=o.a.createRef(),this.item2Ref=o.a.createRef(),this.state={}}shouldComponentUpdate(e,t,a){return e.item!==this.props.item}static getDerivedStateFromProps(e,t){const a=e.item,n=t.to;return a!==t.prevItem?{prevItem:a,from:n,to:a,scrollDown:a>n}:null}componentDidMount(){const e=this.props.scrollDown,t=this.state.to;this.animate("",t,e)}componentDidUpdate(e,t,a){const n=this.props,s=n.item,i=n.scrollDown,r=this.state,o=r.from,l=r.to;e.item!==s&&this.animate(o,l,i)}render(){const e=this.props,t=e.scrollDown,a=e.height,n=this.state,s=n.from,i=n.to;return o.a.createElement("div",{className:"animated-item",style:{height:a}},o.a.createElement("div",{className:"animated-item-placeholder"},i),o.a.createElement("div",{ref:this.containerRef,className:"animated-item-wrapper"},o.a.createElement("div",{ref:this.item1Ref,className:"animated-item-1",style:{height:a}},t?i:s),o.a.createElement("div",{ref:this.item2Ref,className:"animated-item-2",style:{height:a}},t?s:i)))}}co.defaultProps={item:null,scrollDown:!0,height:21};var ho=co;a(572);class po extends o.a.Component{constructor(...e){super(...e),this.state={}}static getDerivedStateFromProps(e,t){const a=e.counter,n=t.prevCounter;return a!==n?{prevCounter:a,scrollDown:a>n}:null}render(){const e=this.props,t=e.counter,a=e.height,n=e.reverse,s=this.state.scrollDown;if(!t)return null;const i=t+"";return o.a.createElement("div",{className:"animated-counter",style:{height:a}},[...i].reverse().map((e,t)=>o.a.createElement(ho,{key:t,item:e,scrollDown:n?!s:s,height:a})))}}po.defaultProps={counter:0,height:21,reverse:!1};var uo=po;class mo extends o.a.Component{constructor(...e){super(...e),this.handleCancel=()=>{Object(Q.b)()},this.handleDelete=()=>{let e=0,t=[];var a,n=Object(ss.a)(ee.a.selectedItems.values());try{for(n.s();!(a=n.n()).done;){let n=a.value,s=n.chatId,i=n.messageId;e=s,t.push(i)}}catch(s){n.e(s)}finally{n.f()}Object(Q.e)(e,t)},this.handleForward=()=>{let e;const t=[];var a,n=Object(ss.a)(ee.a.selectedItems.values());try{for(n.s();!(a=n.n()).done;){let n=a.value,s=n.chatId,i=n.messageId;e=s,t.push(i)}}catch(s){n.e(s)}finally{n.f()}Object(Q.h)(e,t)}}render(){const e=this.props,t=e.t,a=e.count;let n=!0;var s,i=Object(ss.a)(ee.a.selectedItems.values());try{for(i.s();!(s=i.n()).done;){let e=s.value,t=e.chatId,a=e.messageId;const i=ee.a.get(t,a);if(!i){n=!1;break}if(!i.can_be_deleted_only_for_self&&!i.can_be_deleted_for_all_users){n=!1;break}}}catch(d){i.e(d)}finally{i.f()}let r=!0;var l,c=Object(ss.a)(ee.a.selectedItems.values());try{for(c.s();!(l=c.n()).done;){let e=l.value,t=e.chatId,a=e.messageId;const n=ee.a.get(t,a);if(!n){r=!1;break}if(!n.can_be_forwarded){r=!1;break}}}catch(d){c.e(d)}finally{c.f()}return o.a.createElement("div",{className:"header-command"},r&&o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleForward},t("Forward"),o.a.createElement("span",null,"\xa0"),o.a.createElement(uo,{counter:a})),n&&o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleDelete},t("Delete"),o.a.createElement("span",null,"\xa0"),o.a.createElement(uo,{counter:a})),o.a.createElement("div",{className:"header-command-space"}),o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleCancel},t("Cancel")))}}var go=Object(_.a)()(mo),fo=a(88),Co=Object(he.a)(o.a.createElement("path",{d:"M13.3888889,16 C13.7263962,16 14,16.4477153 14,17 C14,17.5128358 13.7640866,17.9355072 13.4601574,17.9932723 L13.3888889,18 L3.61111111,18 C3.27360376,18 3,17.5522847 3,17 C3,16.4871642 3.23591345,16.0644928 3.53984265,16.0067277 L3.61111111,16 L13.3888889,16 Z M21.6775853,3 L21.7874884,3.00503549 C22.3661813,3.05833764 22.8187635,3.52822285 22.8187635,4.1 C22.8187635,4.42111738 22.6731917,4.72620184 22.4202543,4.93518226 L20.7728252,6.29631085 L20.4502303,9.71680948 L22.7117368,12.1691998 C23.1304556,12.6232608 23.0880258,13.3185404 22.6169671,13.7221503 C22.4080732,13.9011336 22.1383003,14 21.8588096,14 L18,14 L18,17.375 C18,17.6936258 17.6185148,17.9565637 17.1254379,17.9951304 L17,18 C16.4477153,18 16,17.720178 16,17.375 L16,17.375 L16,14 L12.1411782,14 C11.5109229,14 11,13.5075132 11,12.9 C11,12.6305944 11.1025675,12.370556 11.288251,12.1691998 L13.5497575,9.71680948 L13.2271626,6.29631085 L11.5797335,4.93518226 C11.101208,4.5398179 11.0457907,3.84538792 11.4559554,3.38412949 C11.6727589,3.140319 11.9892641,3 12.3224024,3 L21.6775853,3 Z M8.66666667,11 C8.85076158,11 9,11.4477153 9,12 C9,12.5128358 8.87131994,12.9355072 8.70554038,12.9932723 L8.66666667,13 L3.33333333,13 C3.14923842,13 3,12.5522847 3,12 C3,11.4871642 3.12868006,11.0644928 3.29445962,11.0067277 L3.33333333,11 L8.66666667,11 Z M19.7289592,5 L14.2710408,5 L14.919153,5.62138118 C15.1441218,5.83707131 15.2849972,6.14241408 15.3118231,6.47248045 L15.5530612,9.44068174 C15.5815232,9.79087913 15.4791848,10.1386429 15.2703267,10.401463 L14,12 L20,12 L18.7296733,10.401463 C18.5208152,10.1386429 18.4184768,9.79087913 18.4469388,9.44068174 L18.6881769,6.47248045 C18.7150028,6.14241408 18.8558782,5.83707131 19.080847,5.62138118 L19.7289592,5 Z M10.5555556,6 C10.8010154,6 11,6.44771525 11,7 C11,7.51283584 10.8284266,7.93550716 10.6073872,7.99327227 L10.5555556,8 L3.44444444,8 C3.19898456,8 3,7.55228475 3,7 C3,6.48716416 3.17157342,6.06449284 3.39261283,6.00672773 L3.44444444,6 L10.5555556,6 Z"}),"PlaylistEdit");a(573),a(574);class bo extends o.a.Component{constructor(...e){super(...e),this.drawRect=(e,t,a,n,s)=>"M".concat(e,",").concat(t+s,"a").concat(s,",").concat(s,",0,0,1,").concat(a,",0v").concat(n-2*s,"a").concat(s,",").concat(s,",0,0,1,").concat(-a,",0Z"),this.getClipPath=(e,t,a)=>{let n="";if(3===a)n=this.drawRect(0,0,2,t,1)+this.drawRect(0,11,2,t+1,1)+this.drawRect(0,23,2,t,1);else for(let s=0;s<a;s++)n+=this.drawRect(0,(t+2)*s,2,t,1);return o.a.createElement("clipPath",{id:e},o.a.createElement("path",{d:n}))},this.getBarHeight=(e,t)=>{let a=32;return 1===e?a=32:2===e?a=15:3===e?a=9:(4===e||e>3)&&(a=7),a},this.getMarkHeight=(e,t)=>{let a=32;return 1===e?a=32:2===e?a=15:3===e?a=1===t?10:9:(4===e||e>3)&&(a=7),a},this.getMarkTranslateY=(e,t,a)=>1===a?0:2===a?0===e?0:t+2:3===a?0===e?0:1===e?11:23:(t+2)*e,this.getTrackTranslateY=(e,t,a,n)=>t<=4||e<=1?0:e>=t-2?n-32:(a+4)/2+(e-2)*(a+2),this.getTrackHeight=(e,t)=>e<=3?32:t*e+2*(e-1)}render(){const e=this.props,t=e.count,a=e.index;if(1===t)return o.a.createElement("div",{className:"pinned-message-border"},o.a.createElement("div",{className:"pinned-message-border-wrapper-1"}));const n=this.getBarHeight(t,a),s=this.getMarkHeight(t,a),i=this.getTrackHeight(t,n),r="clipPath_".concat(t),l=this.getClipPath(r,n,t),d=this.getMarkTranslateY(a,n,t),h=this.getTrackTranslateY(a,t,n,i);return o.a.createElement("div",{className:c()("pinned-message-border",{"pinned-message-border-mask":t>4})},o.a.createElement("div",{className:"pinned-message-border-wrapper",style:{clipPath:"url(#".concat(r,")"),width:2,height:i,transform:"translateY(-".concat(h,"px)")}},o.a.createElement("svg",{height:"0",width:"0"},o.a.createElement("defs",null,l)),o.a.createElement("div",{className:"pinned-message-border-mark",style:{height:s,transform:"translateY(".concat(d,"px)")}})))}}var vo=bo;class Eo extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateCurrentPinnedMessage=e=>{this.props.chatId===e.chatId&&this.scrollToMessageId(e.messageId)},this.onUpdateMessageIsPinned=e=>{this.props.chatId===e.chat_id&&this.setPinnedState()},this.onUpdateNewMessage=e=>{const t=this.props.chatId,a=e.message;t===a.chat_id&&a.is_pinned&&this.setPinnedState()},this.onUpdateDeleteMessages=e=>{const t=this.props.chatId,a=this.state.pinned,n=e.chat_id,s=e.is_permanent,i=e.message_ids,r=new Map(i.map(e=>[e,e]));t===n&&a.some(e=>r.has(e.id))&&s&&this.setPinnedState()},this.onUpdateMessageContent=e=>{const t=this.props.chatId,a=this.state.pinned,n=e.chat_id,s=e.message_id;t===n&&a.some(e=>e.id===s)&&this.setPinnedState()},this.animateText=(e,t,a=250)=>{const n=document.getElementById("pinned-message-animated-text"),s=document.getElementById("pinned-message-animated-text-1"),i=document.getElementById("pinned-message-animated-text-2");if(!n||!s||!i)return;0===t||e<t?(n.style.cssText="transform: translateY(-19px)",s.style.cssText="opacity: 0",i.style.cssText="opacity: 1",requestAnimationFrame(()=>{n.style.cssText="transform: translateY(0); transition: transform ".concat(a,"ms ").concat("ease-in-out"),s.style.cssText="opacity: 1; transition: opacity ".concat(a,"ms ").concat("ease-in-out"),i.style.cssText="opacity: 0; transition: opacity ".concat(a,"ms ").concat("ease-in-out")})):(n.style.cssText="transform: translateY(0px)",s.style.cssText="opacity: 1",i.style.cssText="opacity: 0",requestAnimationFrame(()=>{n.style.cssText="transform: translateY(-19px); transition: transform ".concat(a,"ms ").concat("ease-in-out"),s.style.cssText="opacity: 0; transition: opacity ".concat(a,"ms ").concat("ease-in-out"),i.style.cssText="opacity: 1; transition: opacity ".concat(a,"ms ").concat("ease-in-out")}))},this.setPinnedState=()=>{const e=this.props.chatId,t=this.state,a=t.messageId,n=t.prevMessageId,s=Se.a.getClientData(e),i=ee.a.getMedia(e),r=i?i.pinned:[];let o=r.some(e=>e.id===a)?a:0;!o&&r.length>0&&(o=r[0].id);let l=a===o?n:a;const c=Object(tt.v)(e,o),d=Object(tt.u)(e,o);ee.a.currentPinned={chatId:e,id:o},this.setState({clientData:s,pinned:r,prevMessageId:l,messageId:o,thumbnail:c,minithumbnail:d,lastPhoto:{messageId:o,thumbnail:c,minithumbnail:d}},()=>{0!==this.state.prevMessageId&&a!==this.state.messageId&&this.animateText(this.state.messageId,this.state.prevMessageId)})},this.onClientUpdateChatMedia=e=>{const t=this.props.chatId;e.chatId===t&&this.setPinnedState()},this.onClientUpdateSetChatClientData=e=>{const t=e.chatId,a=e.clientData;this.props.chatId===t&&this.setState({clientData:a})},this.scrollToMessageId=e=>{const t=this.props.chatId,a=this.state,n=a.messageId,s=a.thumbnail,i=a.minithumbnail,r=Object(tt.v)(t,e),o=Object(tt.u)(t,e),l=r?{messageId:e,thumbnail:r,minithumbnail:o}:{messageId:n,thumbnail:s,minithumbnail:i};ee.a.currentPinned={chatId:t,id:n},this.setState({prevMessageId:n,messageId:e,thumbnail:r,minithumbnail:o,lastPhoto:l},()=>{0!==this.state.prevMessageId&&n!==this.state.messageId&&this.animateText(this.state.messageId,this.state.prevMessageId)})},this.handleClick=e=>{const t=this.props.chatId,a=this.state,n=a.pinned,s=a.messageId;if(!n.length)return;if(!s)return;if(1!==e.nativeEvent.which)return;ee.a.clickedPinned={chatId:t,id:s},Object(Q.k)(t,s);const i=n.findIndex(e=>e.id===s);if(-1===i)return;const r=i>=n.length-1?0:i+1;this.scrollToMessageId(n[r].id)},this.handleMouseDown=e=>{e.stopPropagation()},this.handleEditClick=e=>{const t=this.props.chatId;x.a.clientUpdate({"@type":"clientUpdateOpenPinned",chatId:t})}}static getDerivedStateFromProps(e,t){const a=t.prevPropsChatId,n=e.chatId;if(a!==n){const e=ee.a.getMedia(n),t=e?e.pinned:[],a=t&&t.length>0?t[0].id:0,s=Object(tt.v)(n,a),i=Object(tt.u)(n,a);return{prevPropsChatId:n,clientData:Se.a.getClientData(n),pinned:t,prevMessageId:0,messageId:a,minithumbnail:i,thumbnail:s,lastPhoto:{messageId:a,minithumbnail:i,thumbnail:s}}}return null}shouldComponentUpdate(e,t,a){const n=this.props.chatId,s=this.state,i=s.clientData,r=s.pinned,o=s.messageId;return e.chatId!==n||(t.clientData!==i||(t.pinned!==r||t.messageId!==o))}componentDidUpdate(e,t,a){const n=this.props.chatId,s=this.state,i=s.prevMessageId,r=s.messageId;e.chatId!==n&&this.animateText(r,i,0)}componentDidMount(){Se.a.on("clientUpdateSetChatClientData",this.onClientUpdateSetChatClientData),ee.a.on("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.on("clientUpdateCurrentPinnedMessage",this.onClientUpdateCurrentPinnedMessage),ee.a.on("updateNewMessage",this.onUpdateNewMessage),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateMessageContent",this.onUpdateMessageContent),ee.a.on("updateMessageIsPinned",this.onUpdateMessageIsPinned)}componentWillUnmount(){Se.a.off("clientUpdateSetChatClientData",this.onClientUpdateSetChatClientData),ee.a.off("clientUpdateChatMedia",this.onClientUpdateChatMedia),ee.a.off("clientUpdateCurrentPinnedMessage",this.onClientUpdateCurrentPinnedMessage),ee.a.off("updateNewMessage",this.onUpdateNewMessage),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateMessageContent",this.onUpdateMessageContent),ee.a.off("updateMessageIsPinned",this.onUpdateMessageIsPinned)}render(){const e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.messageId,i=n.prevMessageId,r=n.pinned,l=n.thumbnail,d=(n.minithumbnail,n.lastPhoto),h=n.clientData;if(!t)return null;if(h){if(h.unpinned)return null}const p=ee.a.get(t,s);if(!p)return null;const u=ee.a.get(t,i);let m=p?Object(tt.j)(p,a):a("Loading");Object(tt.J)(p)&&(m=a("DeletedMessage"));let g=u?Object(tt.j)(u,a):"";Object(tt.J)(u)&&(m=a("DeletedMessage"));let f=0,C=a("PinnedMessage");r&&r.length>1&&(f=r?r.findIndex(e=>e.id===s):-1,C=2===r.length?a(1===f?"PreviousPinnedMessage":"PinnedMessage"):o.a.createElement(o.a.Fragment,null,a("PinnedMessage"),f>0&&o.a.createElement(o.a.Fragment,null," #",o.a.createElement(uo,{counter:r.length-f,height:19,reverse:!0}))));const b=0===i||s<i;return o.a.createElement(o.a.Fragment,null,o.a.createElement(me.a,{button:!0,className:c()("pinned-message",{"pinned-message-photo":l}),onMouseDown:this.handleClick},o.a.createElement(vo,{index:r.length-f-1,count:r.length}),o.a.createElement(aa.a,{in:!!l,classNames:"pinned-message-tile",timeout:250,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement("div",null,o.a.createElement(Or,{chatId:t,messageId:d?d.messageId:null,thumbnail:d?d.thumbnail:null,minithumbnail:d?d.minithumbnail:null}))),o.a.createElement("div",{className:"pinned-message-content"},o.a.createElement("div",{className:"pinned-message-title"},C),o.a.createElement("div",{className:"pinned-message-subtitle"},o.a.createElement("div",{id:"pinned-message-animated-text"},o.a.createElement("div",{id:"pinned-message-animated-text-1"},b?m:g),o.a.createElement("div",{id:"pinned-message-animated-text-2"},b?g:m)))),r.length>1&&o.a.createElement(j.a,{className:"pinned-message-edit-button","aria-label":"Edit",onClick:this.handleEditClick,onMouseDown:this.handleMouseDown},o.a.createElement(Co,null))))}}var So=Object(_.a)()(Eo);class yo extends r.Component{constructor(...e){super(...e),this.state={authorizationState:ae.a.getAuthorizationState(),connectionState:ae.a.getConnectionState()},this.onClientUpdateMessageSelected=e=>{this.setState({selectionCount:ee.a.selectedItems.size})},this.onClientUpdateChatId=e=>{this.forceUpdate()},this.onUpdateConnectionState=e=>{this.setState({connectionState:e.state})},this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.openChatDetails=()=>{const e=ae.a.getChatId();if(!Se.a.get(e))return;ae.a.isSmallWidth?Object(Q.k)(e,null,!0):Object(Pe.b)(!0)},this.handleSearchChat=()=>{const e=ae.a.getChatId();Se.a.get(e)&&Object(Q.q)(e)},this.localize=e=>(0,this.props.t)(e).replace("...","").replace("\u2026","")}componentDidMount(){ae.a.on("clientUpdateChatId",this.onClientUpdateChatId),ae.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),ae.a.on("updateConnectionState",this.onUpdateConnectionState),ee.a.on("clientUpdateClearSelection",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId),ae.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),ae.a.off("updateConnectionState",this.onUpdateConnectionState),ee.a.off("clientUpdateClearSelection",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected)}render(){const e=this.props.t,t=this.state,a=t.authorizationState,n=t.connectionState,s=t.selectionCount,i=ae.a.getChatId(),r=Se.a.get(i),l=Object(F.S)(i);let d=Object(F.x)(i,!0,e),h=Object(F.v)(i,!0),p=!1;if(n)switch(n["@type"]){case"connectionStateConnecting":d=this.localize("Connecting"),h="",p=!0;break;case"connectionStateConnectingToProxy":d=this.localize("Connecting to proxy"),h="",p=!0;break;case"connectionStateReady":break;case"connectionStateUpdating":d=this.localize("Updating"),h="",p=!0;break;case"connectionStateWaitingForNetwork":d=this.localize("Waiting for network"),h="",p=!0}else if(a)switch(a["@type"]){case"authorizationStateClosed":case" authorizationStateClosing":break;case"authorizationStateLoggingOut":d=this.localize("Logging out"),h="",p=!0;break;case"authorizationStateReady":case"authorizationStateWaitCode":break;case"authorizationStateWaitEncryptionKey":d=this.localize("Loading"),h="",p=!0;break;case"authorizationStateWaitPassword":case"authorizationStateWaitPhoneNumber":break;case"authorizationStateWaitTdlibParameters":d=this.localize("Loading"),h="",p=!0}else d=this.localize("Loading"),h="",p=!0;return o.a.createElement("div",{className:c()("header-details",{"header-details-selection":s>0})},o.a.createElement("div",{className:"header-details-content"},o.a.createElement(go,{count:s}),o.a.createElement("div",{className:"header-details-row"},p?o.a.createElement("div",{className:c()("header-status","grow",r?"cursor-pointer":"cursor-default"),onClick:this.openChatDetails},o.a.createElement("span",{className:"header-status-content"},d),o.a.createElement(fo.a,null),o.a.createElement("span",{className:c()("header-status-title",{"header-status-accent":l})},h),o.a.createElement("span",{className:"header-status-tail"})):o.a.createElement(lo,{className:c()("grow","cursor-pointer"),chatId:i,onClick:this.openChatDetails}),o.a.createElement(So,{chatId:i}),r&&o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{className:"header-right-second-button","aria-label":"Search",onClick:this.handleSearchChat},o.a.createElement(Lt,null)),o.a.createElement(so,{openChatDetails:this.openChatDetails})))))}}var Mo=Object(_.a)()(yo),Io=a(583),Uo=a.n(Io),ko=a(582),xo=a.n(ko),wo=a(214),Oo=a.n(wo),Lo=a(215),_o=a.n(Lo),No=a(216),jo=a.n(No),Po=a(121),To=a.n(Po);a(575);class Ro extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null,value:k.b.volume,prevValue:k.b.volume,dragging:!1,buttonOver:!1,popupOver:!1},this.onClientUpdateMediaVolume=e=>{const t=e.volume,a=e.prevVolume;void 0===a?this.setState({value:t}):this.setState({value:t,prevValue:a})},this.handlePopoverOpen=e=>{this.setState({anchorEl:e})},this.handlePopoverClose=()=>{const e=this.state,t=e.dragging,a=e.buttonOver,n=e.popupOver;t||a||n||this.setState({anchorEl:null})},this.handleMouseEnter=(e,t)=>{this.setState({buttonOver:!0}),t&&this.handlePopoverOpen(e.currentTarget)},this.handleMouseLeave=()=>{this.setState({buttonOver:!1},()=>{this.handlePopoverClose()})},this.handlePopupMouseLeave=()=>{this.setState({popupOver:!1},()=>{this.handlePopoverClose()})},this.handleVoiceClick=()=>{const e=this.state,t=e.value,a=e.prevValue,n=t>0?0:a||u.cb;x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:n})},this.handleChange=(e,t)=>{const a=this.state,n=a.dragging,s=a.prevValue;n?x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:t}):x.a.clientUpdate({"@type":"clientUpdateMediaVolume",prevVolume:t>0?t:s,volume:t})},this.handleDragStart=()=>{const e=this.state.value;this.setState({dragging:!0,prevValue:e})},this.handleDragEnd=()=>{const e=this.state,t=e.value,a=e.prevValue;this.setState({dragging:!1,prevValue:t>0?t:a},()=>{this.handlePopoverClose()})},this.getVolumeIcon=e=>0===e?o.a.createElement(To.a,{fontSize:"small"}):e<.25?o.a.createElement(Oo.a,{fontSize:"small"}):e<.5?o.a.createElement(_o.a,{fontSize:"small"}):o.a.createElement(jo.a,{fontSize:"small"})}componentDidMount(){k.b.on("clientUpdateMediaVolume",this.onClientUpdateMediaVolume)}componentWillUnmount(){k.b.off("clientUpdateMediaVolume",this.onClientUpdateMediaVolume)}render(){const e=this.state,t=e.anchorEl,a=e.value,n=Boolean(t);return o.a.createElement("div",{onMouseEnter:e=>this.handleMouseEnter(e,!0),onMouseLeave:this.handleMouseLeave,style:{position:"relative",background:"transparent"}},o.a.createElement(j.a,{className:"header-player-button",color:"primary",onClick:this.handleVoiceClick},this.getVolumeIcon(a)),o.a.createElement("div",{style:{position:"absolute",background:"transparent",visibility:n?"visible":"hidden",zIndex:1},onMouseEnter:e=>this.handleMouseEnter(e,!1),onMouseLeave:this.handlePopupMouseLeave},o.a.createElement("div",{className:"volume-button-panel"},o.a.createElement(g.a,{min:0,max:1,step:.01,value:a,onChange:this.handleChange,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,orientation:"vertical"}))))}}var Do=Ro,Fo=a(576),Ao=a.n(Fo),Bo=a(577),Ho=a.n(Bo);class Vo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaRepeat=e=>{const t=e.repeat;this.setState({repeat:t})},this.handleRepeat=()=>{const e=this.state.repeat;let t=e;switch(e){case k.a.NONE:t=k.a.REPEAT;break;case k.a.REPEAT:t=k.a.REPEAT_ONE;break;case k.a.REPEAT_ONE:t=k.a.NONE}x.a.clientUpdate({"@type":"clientUpdateMediaRepeat",repeat:t})},this.getIcon=e=>{switch(e){case k.a.NONE:case k.a.REPEAT:return o.a.createElement(Ao.a,{fontSize:"small"});case k.a.REPEAT_ONE:return o.a.createElement(Ho.a,{fontSize:"small"});default:return o.a.createElement(Ao.a,{fontSize:"small"})}};const t=k.b.repeat;this.state={repeat:t}}componentDidMount(){k.b.on("clientUpdateMediaRepeat",this.onClientUpdateMediaRepeat)}componentWillUnmount(){k.b.off("clientUpdateMediaRepeat",this.onClientUpdateMediaRepeat)}render(){const e=this.state.repeat;return o.a.createElement(j.a,{className:"header-player-button",color:e===k.a.NONE?"default":"primary",onClick:this.handleRepeat},this.getIcon(e))}}var zo=Vo,Wo=a(578),Go=a.n(Wo);class Zo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaShuffle=e=>{const t=e.shuffle;this.setState({shuffle:t})},this.handleShuffle=()=>{const e=this.state.shuffle;x.a.clientUpdate({"@type":"clientUpdateMediaShuffle",shuffle:!e})};const t=k.b.shuffle;this.state={shuffle:t}}componentDidMount(){k.b.on("clientUpdateMediaShuffle",this.onClientUpdateMediaShuffle)}componentWillUnmount(){k.b.off("clientUpdateMediaShuffle",this.onClientUpdateMediaShuffle)}render(){const e=this.state.shuffle;return o.a.createElement(j.a,{className:"header-player-button",color:e?"primary":"default",onClick:this.handleShuffle},o.a.createElement(Go.a,{fontSize:"small"}))}}var qo=Zo;class Ko extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaPlaybackRate=e=>{const t=e.playbackRate;this.setState({playbackRate:t})},this.onClientUpdateMediaAudioPlaybackRate=e=>{const t=e.audioPlaybackRate;this.setState({audioPlaybackRate:t})},this.handlePlaybackRate=()=>{const e=this.props.audio,t=this.state,a=t.audioPlaybackRate,n=t.playbackRate,s=(e?a:n)===u.S?u.P:u.S;e?x.a.clientUpdate({"@type":"clientUpdateMediaAudioPlaybackRate",audioPlaybackRate:s}):x.a.clientUpdate({"@type":"clientUpdateMediaPlaybackRate",playbackRate:s})};const t=k.b.audioPlaybackRate,a=k.b.playbackRate;this.state={audioPlaybackRate:t,playbackRate:a}}componentDidMount(){k.b.on("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.on("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate)}componentWillUnmount(){k.b.off("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.off("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate)}render(){const e=this.props.audio,t=this.state,a=t.audioPlaybackRate,n=t.playbackRate,s=e?a:n;return o.a.createElement(j.a,{className:"header-player-button",color:s>u.S?"primary":"default",onClick:this.handlePlaybackRate},o.a.createElement("div",{className:"header-player-playback-icon"},"2X"))}}Ko.defaultProps={audio:!1};var Yo=Ko;a(579);class Jo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaTime=e=>{const t=e.currentTime,a=e.duration,n=this.state.reverse;this.setState({currentTime:t,duration:a,currentTimeString:Object(M.g)(Math.floor(t||0),a,n)})},this.handleReverse=e=>{e.stopPropagation(),e.preventDefault();const t=this.state,a=t.currentTime,n=t.duration,s=t.reverse;this.setState({reverse:!s,currentTimeString:Object(M.g)(Math.floor(a||0),n,!s)})};const t=this.props.duration;this.state={reverse:!1,currentTime:0,duration:t,currentTimeString:Object(M.g)(0,t,!1)}}componentDidMount(){k.b.on("clientUpdateMediaTime",this.onClientUpdateMediaTime)}componentWillUnmount(){k.b.off("clientUpdateMediaTime",this.onClientUpdateMediaTime)}render(){const e=this.state.currentTimeString;return o.a.createElement("div",{className:"header-player-time",onClick:this.handleReverse},e)}}var Xo=Jo,Qo=a(34),$o=a.n(Qo),el=a(131),tl=a(136),al=a(31),nl=a(51);a(580);class sl extends o.a.Component{constructor(e){super(e),this.scrollToActive=()=>{const e=this.listRef.current;if(!e)return;const t=this.state,a=t.playlist,n=t.message,s=t.block;if(!n&&!s)return;if(!a)return;const i=[...a.items].reverse().findIndex(e=>Object(al.f)(e,n||s));if(-1===i)return;const r=this.itemRefMap.get(i);if(!r)return;const o=Qo.findDOMNode(r);o&&(e.scrollTop=o.offsetTop-15)},this.onClientUpdateMediaTitleMouseOver=e=>{const t=e.over;t?this.setState({playlistMouseOver:t},()=>{this.tryOpen()}):this.setState({playlistMouseOver:t},()=>{this.tryClose()})},this.onClientUpdateMediaActive=e=>{const t=e.source;switch(t["@type"]){case"message":this.setState({message:t,block:null});break;case"instantViewSource":this.setState({message:null,block:t.block})}},this.onClientUpdateMediaPlaylistLoading=e=>{const t=this.state,a=t.message,n=t.block,s=e.source,i=a?a.chat_id:0,r=a?a.id:0;Object(al.e)(i,r,n,s)&&this.setState({playlist:null})},this.onClientUpdateMediaPlaylist=e=>{const t=this.state,a=t.message,n=t.block,s=e.source,i=e.playlist,r=a?a.chat_id:0,o=a?a.id:0;Object(al.e)(r,o,n,s)&&this.setState({playlist:i})},this.tryOpen=()=>{clearTimeout(this.openTimeout),this.openTimeout=setTimeout(()=>{const e=this.state,t=e.titleMouseOver,a=e.playlistMouseOver;this.setState({open:t||a})},250)},this.tryClose=()=>{clearTimeout(this.timeout),this.timeout=setTimeout(()=>{const e=this.state,t=e.titleMouseOver,a=e.playlistMouseOver;this.setState({open:t||a})},250)},this.handleMouseEnter=()=>{this.setState({playlistMouseOver:!0,open:!0})},this.handleMouseLeave=()=>{this.setState({playlistMouseOver:!1},()=>{this.tryClose()})},this.handleScroll=()=>{const e=this.listRef.current;e&&(e.scrollTop<=u.yb?x.a.clientUpdate({"@type":"clientUpdateMediaPlaylistNext"}):e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&x.a.clientUpdate({"@type":"clientUpdateMediaPlaylistPrev"}))},this.listRef=o.a.createRef(),this.itemRefMap=new Map;const t=k.b.message,a=k.b.block,n=k.b.playlist;this.state={message:t,block:a,playlist:n,open:!1,titleMouseOver:!1,playlistMouseOver:!1}}componentDidUpdate(e,t,a){const n=this.state.open;!t.open&&n&&this.scrollToActive()}componentDidMount(){k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.on("clientUpdateMediaPlaylistLoading",this.onClientUpdateMediaPlaylistLoading),k.b.on("clientUpdateMediaTitleMouseOver",this.onClientUpdateMediaTitleMouseOver)}componentWillUnmount(){k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.off("clientUpdateMediaPlaylistLoading",this.onClientUpdateMediaPlaylistLoading),k.b.off("clientUpdateMediaTitleMouseOver",this.onClientUpdateMediaTitleMouseOver)}getPageBlock(e,t){if(!e)return null;let a=null;switch(e["@type"]){case"pageBlockAudio":a=o.a.createElement(el.a,{block:e,audio:e.audio,openMedia:()=>Object(nl.o)(e.audio,e.caption,e,t,!0)});break;case"pageBlockVoiceNote":a=o.a.createElement(tl.a,{block:e,voiceNote:e.voice_note,openMedia:()=>Object(nl.o)(e.voice_note,e.caption,e,t,!0)})}return a}render(){const e=this.state,t=e.open,a=e.playlist;if(!t)return null;if(!a)return null;const n=a.items;if(!n)return null;if(n.length<=1)return null;this.itemRefMap.clear();let s=null;"instantViewSource"===n[0]["@type"]&&(s=a.source.instantView);const i="message"===n[0]["@type"]?e=>Object(Qe.e)(e,()=>Object(tt.U)(e.chat_id,e.id)):e=>this.getPageBlock(e,s);return o.a.createElement("div",{className:"playlist"},o.a.createElement("div",{className:"playlist-wrapper"},o.a.createElement("div",{ref:this.listRef,className:"playlist-items",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onScroll:this.handleScroll},[...n].reverse().map((e,t)=>o.a.createElement("div",{key:e.id||t,ref:e=>this.itemRefMap.set(t,e),className:"playlist-item"},i(e))))))}}var il=sl;let rl=null;const ol=new Map,ll=new Map;function cl(e){return dl.apply(this,arguments)}function dl(){return(dl=Object(i.a)(s.a.mark((function e(t){var a,n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=null,!ol.has(t)){e.next=6;break}a=ol.get(t),e.next=14;break;case 6:return n=rl=new Date,e.next=9,x.a.send({"@type":"getWebPageInstantView",url:t,force_full:!0});case 9:if(a=e.sent,ol.set(t,a),ll.set(a,t),rl===n){e.next=14;break}return e.abrupt("return");case 14:console.log("[IV] open",a),Object(W.z)(a),Object(Q.s)({instantView:a,url:t}),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),(i=window.open()).opener=null,i.location=t;case 24:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}a(581);class hl extends o.a.Component{constructor(e){super(e),this.handleSeekForward=()=>{const e=this.videoRef.current;e&&this.handleSeek(e.currentTime+u.X)},this.handleSeekBackward=()=>{const e=this.videoRef.current;e&&this.handleSeek(e.currentTime-u.X)},this.handleSeekTo=e=>{this.videoRef.current&&this.handleSeek(e.seekTime)},this.handleSeek=e=>{const t=this.videoRef.current;t&&(e=Object(M.d)(e,0,t.duration||0),t.currentTime=e)},this.onClientUpdateRecordStart=e=>{const t=this.videoRef.current;t&&(t.paused||(this.fadeOutVolume(250),this.pausedForRecord=!0))},this.onClientUpdateRecordStop=e=>{const t=this.videoRef.current;t&&t.paused&&this.pausedForRecord&&(this.fadeInVolume(250),this.pausedForRecord=!1)},this.onClientUpdateMediaPlaybackRate=e=>{const t=e.playbackRate,a=this.state,n=a.message,s=a.block;if(!n&&!s)return;if(Object(tt.E)(n||s))return;const i=this.videoRef.current;i&&(i.playbackRate=t)},this.onClientUpdateMediaAudioPlaybackRate=e=>{const t=e.audioPlaybackRate,a=this.state,n=a.message,s=a.block;if(!n&&!s)return;if(!Object(tt.E)(n||s))return;if(!Object(tt.Y)(n||s))return;const i=this.videoRef.current;i&&(i.playbackRate=t)},this.onClientUpdateMediaVolume=e=>{const t=e.volume,a=this.videoRef.current;a&&(a.volume=t)},this.onClientUpdateMediaSeek=e=>{const t=e.source,a=e.value,n=e.duration,s=this.state,i=s.message,r=s.block;if(!Object(al.e)(i?i.chat_id:0,i?i.id:0,r,t))return;const o=this.videoRef.current;o&&(o.duration?o.currentTime=a*o.duration:this.currentValue={value:a,duration:n})},this.onClientUpdateMediaViewerContent=e=>{this.playingMediaViewer=Boolean(ae.a.mediaViewerContent)},this.onClientUpdateMediaViewerEnded=e=>{this.playingMediaViewer=!1},this.onClientUpdateMediaViewerPause=e=>{this.playingMediaViewer=!1},this.onClientUpdateMediaViewerPlay=e=>{this.playingMediaViewer=!0;this.videoRef.current&&this.fadeOutVolume(250)},this.startPlayingFile=e=>{if(!e)return;const t=k.b.playlist,a=this.state.src,n=Object(al.c)(e),s=Object(al.b)(e),i=Object(al.a)(e),r=i.currentTime,o=i.duration,l=Boolean(n),c="instantViewSource"===e["@type"]?{message:null,block:e.block,instantView:e.instantView}:{message:e,block:null,instantView:null};this.setState(Object(Ve.a)(Object(Ve.a)({currentTime:r,duration:o,playlist:t,playing:l,src:n},c),{},{mimeType:s}),()=>{const t=this.videoRef.current;t&&(a!==n&&(t.load(),this.currentValue?(t.currentTime=this.currentValue.value*this.currentValue.duration,this.currentValue=null):t.currentTime=r),this.playingMediaViewer?(t.pause(),x.a.clientUpdate({"@type":"clientUpdateMediaPause",source:e})):t.paused&&t.play())})},this.onClientUpdateMediaBlob=e=>{const t=e.chatId,a=e.messageId,n=e.fileId,s=this.state,i=s.message,r=s.block,o=s.instantView;if(i){const e=i.chat_id,n=i.id,s=i.content;if(!s)return;if(t!==e||a!==n)return;let r=!1;switch(s["@type"]){case"messageText":{const e=s.web_page;if(e){const t=e.audio,a=e.voice_note,n=e.video_note;if(t){if(Object(W.R)())return;if(t.audio){r=!0;break}}if(a){if(a.voice){r=!0;break}}if(n){if(n.video){r=!0;break}}}break}case"messageAudio":{const e=s.audio;if(e){if(Object(W.R)())return;if(e.audio){r=!0;break}}break}case"messageVoiceNote":{const e=s.voice_note;if(e){if(e.voice){r=!0;break}}break}case"messageVideoNote":{const e=s.video_note;if(e){if(e.video){r=!0;break}}break}}r&&this.startPlayingFile(i)}else if(r){let e=!1;switch(r["@type"]){case"pageBlockAudio":{const t=r.audio;if(t){if(Object(W.R)())return;const a=t.audio;a&&a.id===n&&(e=!0)}break}case"pageBlockVoiceNote":{const t=r.voice_note;if(t){const a=t.voice;a&&a.id===n&&(e=!0)}break}case"pageBlockVideoNote":{const t=r.video_note;if(t){const a=t.video;a&&a.id===n&&(e=!0)}break}}e&&this.startPlayingFile({"@type":"instantViewSource",block:r,instantView:o})}},this.onClientUpdateMediaPlaylist=e=>{const t=e.playlist,a=e.source,n=this.state,s=n.message,i=n.block,r=s?s.chat_id:0,o=s?s.id:0;Object(al.e)(r,o,i,a)&&this.setState({playlist:t})},this.onClientUpdateMediaClose=e=>{this.setState({message:null,block:null,instantView:null,playlist:null,playing:!1,src:null,mimeType:null},()=>{const e=this.videoRef.current;e&&e.load()})},this.onClientUpdateMediaActive=e=>{const t=e.source,a=this.state,n=a.message,s=a.block,i=a.src;if(Object(al.e)(n?n.chat_id:0,n?n.id:0,s,t)){if(!i)return;const e=this.videoRef.current;if(!e)return;this.pausedForRecord=!1,e.paused?e.play():e.pause()}else this.startPlayingFile(t)},this.handlePrev=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaPrev"})},this.handlePlay=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;if(!t&&!a)return;const s=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaActive",source:s})},this.handleNext=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaNext"})},this.handleEnded=(e=!0)=>{const t=this.state,a=t.message,n=t.block,s=t.instantView;if(!a&&!n)return;const i=a||{"@type":"instantViewSource",block:n,instantView:s};x.a.clientUpdate({"@type":"clientUpdateMediaEnding",source:i,moveNext:e}),this.setState({},()=>{x.a.clientUpdate({"@type":"clientUpdateMediaEnd",source:i,moveNext:e})})},this.handleVideoEnded=()=>{const e=this.videoRef.current;this.setCurrentTime({currentTime:0,duration:e.duration}),this.handleEnded(!0)},this.handleClose=()=>{const e=this.videoRef.current;e&&e.pause(),this.handleEnded(!1)},this.handleLoadedMetadata=()=>{let e=this.state,t=e.message,a=e.block,n=e.instantView,s=e.currentTime;if(!t&&!a)return;const i=this.videoRef.current;if(!i)return;const r=k.b.audioPlaybackRate,o=k.b.playbackRate,l=k.b.volume,c=Object(tt.E)(t||a),d=Object(tt.G)(t||a);let h=u.S;d?h=o:c&&Object(tt.Y)(t||a)&&(h=r),i.playbackRate=h,i.volume=l,i.muted=!1,this.currentValue?(i.currentTime=i.duration*this.currentValue.value,this.currentValue=null):i.currentTime=s,i.play();const p=i.buffered,m=i.duration,g=i.videoWidth,f=i.videoHeight,C=t||{"@type":"instantViewSource",block:a,instantView:n};if(x.a.clientUpdate({"@type":"clientUpdateMediaLoadedMetadata",source:C,buffered:p,duration:m,videoWidth:g,videoHeight:f}),c)return;if(d)return;let b=null;"captureStream"in i?b=i.captureStream():"mozCaptureStream"in i&&(b=i.mozCaptureStream()),b&&x.a.clientUpdate({"@type":"clientUpdateMediaCaptureStream",chatId:t.chat_id,messageId:t.id,stream:b})},this.handleProgress=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;if(!t&&!a)return;const s=this.videoRef.current;if(!s)return;const i=s.buffered,r=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaProgress",source:r,buffered:i})},this.handleTimeUpdate=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;if(!t&&!a)return;const s=this.videoRef.current;if(!s)return;const i=s.currentTime,r=s.buffered,o=s.duration;this.setState({currentTime:i});const l=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaTime",source:l,duration:o,currentTime:i,buffered:r,timestamp:Date.now()}),this.setCurrentTime({currentTime:i,duration:o})},this.handleCanPlay=()=>{},this.handleVideoPlay=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;if(!t&&!a)return;this.setState({playing:!0});const s=this.videoRef.current;if(!s)return;const i=s.currentTime,r=s.duration,o=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaPlay",source:o,currentTime:i,duration:r,timestamp:Date.now()})},this.handleVideoPause=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;if(!t&&!a)return;this.setState({playing:!1});if(!this.videoRef.current)return;const s=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaPause",source:s})},this.hasPrev=(e,t)=>{if(!e)return!1;if(!t||!t.items.length)return!1;const a=t.items.findIndex(t=>Object(al.f)(t,e));return-1!==a&&a+1<t.items.length},this.hasNext=(e,t)=>{if(!e)return!1;if(!t||!t.items.length)return!1;const a=t.items.findIndex(t=>Object(al.f)(t,e));return-1!==a&&a-1>=0},this.handleTitleMouseEnter=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaTitleMouseOver",over:!0})},this.handleTitleMouseLeave=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaTitleMouseOver",over:!1})},this.handleTitleClick=()=>{const e=this.state,t=e.message,a=e.block,n=e.instantView;t?Object(Q.k)(t.chat_id,t.id):a&&n&&function(e,t){const a=ll.get(e);a&&(console.log("[IV] open",e),Object(W.z)(e),Object(Q.s)({instantView:e,block:t,url:a}))}(n,a)},this.setCurrentTime=e=>{const t=this.state,a=t.message,n=t.block;if(!a&&!n)return;if(!Object(tt.Y)(a||n))return;const s=Object(tt.r)(a.chat_id,a.id);if(!s)return;const i=s.audio;if(!i)return;const r=i.remote;if(!r)return;const o=r.unique_id;o&&(e?k.b.setCurrentTime(o,e):k.b.clearCurrentTime(o))},this.videoRef=o.a.createRef();const t=k.b.message,a=k.b.block,n=k.b.instantView,s=k.b.playlist,i=Object(al.a)(t),r=i.currentTime,l=i.duration;this.state={currentTime:r,duration:l,message:t,block:a,instantView:n,playlist:s,playing:!1,src:Object(al.c)(t),mimeType:Object(al.b)(t)}}shouldComponentUpdate(e,t,a){const n=this.state,s=n.message,i=n.block,r=n.playlist,o=n.src,l=n.playing;return t.block!==i||(t.message!==s||(t.playlist!==r||(t.src!==o||t.playing!==l)))}componentDidMount(){this.addMediaSessionHandlers(),ae.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),U.a.on("clientUpdateVoiceNoteBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoNoteBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAudioBlob",this.onClientUpdateMediaBlob),ee.a.on("clientUpdateRecordStart",this.onClientUpdateRecordStart),ee.a.on("clientUpdateRecordStop",this.onClientUpdateRecordStop),k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaClose",this.onClientUpdateMediaClose),k.b.on("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.on("clientUpdateMediaViewerPlay",this.onClientUpdateMediaViewerPlay),k.b.on("clientUpdateMediaViewerPause",this.onClientUpdateMediaViewerPause),k.b.on("clientUpdateMediaViewerEnded",this.onClientUpdateMediaViewerEnded),k.b.on("clientUpdateMediaVolume",this.onClientUpdateMediaVolume),k.b.on("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.on("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate),k.b.on("clientUpdateMediaSeek",this.onClientUpdateMediaSeek)}componentWillUnmount(){this.removeMediaSessionHandlers(),ae.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),U.a.off("clientUpdateVoiceNoteBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoNoteBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAudioBlob",this.onClientUpdateMediaBlob),ee.a.off("clientUpdateRecordStart",this.onClientUpdateRecordStart),ee.a.off("clientUpdateRecordStop",this.onClientUpdateRecordStop),k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaClose",this.onClientUpdateMediaClose),k.b.off("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.off("clientUpdateMediaViewerPlay",this.onClientUpdateMediaViewerPlay),k.b.off("clientUpdateMediaViewerPause",this.onClientUpdateMediaViewerPause),k.b.off("clientUpdateMediaViewerEnded",this.onClientUpdateMediaViewerEnded),k.b.off("clientUpdateMediaVolume",this.onClientUpdateMediaVolume),k.b.off("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.off("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate),k.b.off("clientUpdateMediaSeek",this.onClientUpdateMediaSeek)}addMediaSessionHandlers(){const e=navigator.mediaSession;if(e)try{e.setActionHandler("nexttrack",this.handleNext),e.setActionHandler("previoustrack",this.handlePrev),e.setActionHandler("seekforward",this.handleSeekForward),e.setActionHandler("seekbackward",this.handleSeekBackward),e.setActionHandler("seekto",this.handleSeekTo)}catch(t){}}removeMediaSessionHandlers(){const e=navigator.mediaSession;if(e)try{e.setActionHandler("nexttrack",null),e.setActionHandler("previoustrack",null),e.setActionHandler("seekforward",null),e.setActionHandler("seekbackward",null),e.setActionHandler("seekto",null)}catch(t){}}fadeOutVolume(e){const t=this.videoRef.current;if(!t)return;let a=0;const n=t.volume;this.volumeInterval=setInterval(()=>{a>=20?(t.pause(),t.volume=n,clearInterval(this.volumeInterval)):(t.volume=n/(a+1),a++)},e/20)}fadeInVolume(e){const t=this.videoRef.current;if(!t)return;let a=0;const n=t.volume;t.volume=0,t.play(),this.volumeInterval=setInterval(()=>{a>=20?(t.volume=n,clearInterval(this.volumeInterval)):(t.volume=n/20*(a+1),a++)},e/20)}render(){const e=this.props.t,t=this.state,a=t.playing,n=t.message,s=t.block,i=t.duration,r=t.playlist,l=t.src,c=t.mimeType,d=Object(tt.E)(n||s),h=Object(tt.Y)(n||s),p=n?n.date:null,u=Object(al.d)(n||s,e),m=(Object(tt.l)(p),Object(tt.k)(p),!d||h),g=d,v=d,E=this.hasPrev(n||s,r),S=this.hasNext(n||s,r),y=l?o.a.createElement("source",{src:l,type:c}):null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("video",{className:"header-player-video",ref:this.videoRef,autoPlay:!0,controls:!1,width:44,height:44,disablePictureInPicture:!0,onLoadedMetadata:this.handleLoadedMetadata,onCanPlay:this.handleCanPlay,onPlay:this.handleVideoPlay,onPause:this.handleVideoPause,onEnded:this.handleVideoEnded,onTimeUpdate:this.handleTimeUpdate,onProgress:this.handleProgress},y),(n||s)&&o.a.createElement("div",{className:"header-player"},o.a.createElement(j.a,{disabled:!E,className:"header-player-button",color:"primary",onClick:this.handlePrev},o.a.createElement(xo.a,{fontSize:"small"})),o.a.createElement(j.a,{className:"header-player-button",color:"primary",disabled:!l,onClick:this.handlePlay},a?o.a.createElement(C.a,null):o.a.createElement(b.a,null)),o.a.createElement(j.a,{disabled:!S,className:"header-player-button",color:"primary",onClick:this.handleNext},o.a.createElement(Uo.a,{fontSize:"small"})),o.a.createElement(il,null),o.a.createElement("div",{className:"header-player-content",onMouseEnter:this.handleTitleMouseEnter,onMouseLeave:this.handleTitleMouseLeave,onClick:this.handleTitleClick},o.a.createElement("div",{className:"header-player-title"},u,!1),"\xa0"),o.a.createElement(Xo,{duration:i}),o.a.createElement(Do,null),m&&o.a.createElement(Yo,{audio:d}),g&&o.a.createElement(zo,null),v&&o.a.createElement(qo,null),o.a.createElement(j.a,{className:"header-player-button",onClick:this.handleClose},o.a.createElement(f.a,{fontSize:"small"}))))}}var pl=Object(_.a)()(hl);a(584);class ul extends o.a.Component{constructor(...e){super(...e),this.onUpdateChatActionBar=e=>{const t=this.props.chatId;e.chat_id===t&&this.forceUpdate()},this.handleClose=()=>{const e=this.props.chatId;if(!Se.a.get(e))return null;x.a.send({"@type":"removeChatActionBar",chat_id:e})},this.handleReportSpam=()=>{const e=this.props.chatId;Object(ka.e)(Object(F.t)(e))},this.handleReportUnrelatedLocation=()=>{const e=this.props.chatId;Object(ka.e)(Object(F.t)(e))},this.handleSharePhoneNumber=()=>{const e=this.props.chatId,t=Object(F.B)(e);t&&x.a.send({"@type":"sharePhoneNumber",user_id:t})},this.handleAddContact=()=>{const e=this.props.chatId,t=Object(F.B)(e);if(!t)return;const a=te.a.get(t);if(!a)return;const n=a.user_id,s=a.phone_number,i=a.first_name,r=a.last_name;x.a.send({"@type":"addContact",contact:{"@type":"contact",phone_number:s,first_name:i,last_name:r,vcard:"",user_id:n},share_phone_number:!1})},this.handleBlockUser=()=>{const e=this.props.chatId;Object(ka.e)(Object(F.t)(e))}}componentDidMount(){Se.a.on("updateChatActionBar",this.onUpdateChatActionBar)}componentWillUnmount(){Se.a.off("updateChatActionBar",this.onUpdateChatActionBar)}render(){const e=this.props,t=e.chatId,a=e.t;if(!t)return null;const n=Se.a.get(t);if(!n)return null;const s=n.action_bar;if(!s)return null;let i=null;switch(s["@type"]){case"chatActionBarSharePhoneNumber":i=o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleSharePhoneNumber},a("ShareMyPhone"));break;case"chatActionBarAddContact":i=o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleAddContact},a("AddContactChat"));break;case"chatActionBarReportAddBlock":i=o.a.createElement(o.a.Fragment,null,o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleAddContact},a("AddContactChat")),o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleBlockUser},a("ReportSpamUser")));break;case"chatActionBarUnrelatedLocation":i=o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleReportUnrelatedLocation},a("ReportSpamLocation"));break;case"chatActionBarReportSpam":i=o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleReportSpam},a("ReportSpam"))}return o.a.createElement("div",{className:"action-bar",onMouseDown:this.handleClick},o.a.createElement("div",{className:"action-bar-content"},i),o.a.createElement("div",{className:"action-bar-close-button"},o.a.createElement(j.a,{onClick:this.handleClose},o.a.createElement(f.a,null))))}}var ml=Object(_.a)()(ul),gl=a(435),fl=a.n(gl),Cl=a(190),bl=Object(he.a)(o.a.createElement("path",{d:"M18,5 C19.6568542,5 21,6.34314575 21,8 L21,20 C21,21.6568542 19.6568542,23 18,23 L9,23 C7.34314575,23 6,21.6568542 6,20 L6,8 C6,6.34314575 7.34314575,5 9,5 L18,5 Z M18,7 L9,7 C8.44771525,7 8,7.44771525 8,8 L8,20 C8,20.5522847 8.44771525,21 9,21 L18,21 C18.5522847,21 19,20.5522847 19,20 L19,8 C19,7.44771525 18.5522847,7 18,7 Z M15,1 C15.5522847,1 16,1.44771525 16,2 C16,2.55228475 15.5522847,3 15,3 L15,3 L5,3 C4.44771525,3 4,3.44771525 4,4 L4,4 L4,16 C4,16.5522847 3.55228475,17 3,17 C2.44771525,17 2,16.5522847 2,16 L2,16 L2,4 C2,2.34314575 3.34314575,1 5,1 L5,1 Z"}),"Copy"),vl=Object(he.a)(o.a.createElement("path",{d:"M18,3 C19.6568542,3 21,4.34314575 21,6 L21,18 C21,19.6568542 19.6568542,21 18,21 L6,21 C4.34314575,21 3,19.6568542 3,18 L3,6 C3,4.34314575 4.34314575,3 6,3 L18,3 Z M18,5 L6,5 C5.44771525,5 5,5.44771525 5,6 L5,18 C5,18.5522847 5.44771525,19 6,19 L18,19 C18.5522847,19 19,18.5522847 19,18 L19,6 C19,5.44771525 18.5522847,5 18,5 Z M15.7928932,8.29289322 C16.1834175,7.90236893 16.8165825,7.90236893 17.2071068,8.29289322 C17.5976311,8.68341751 17.5976311,9.31658249 17.2071068,9.70710678 L17.2071068,9.70710678 L11.2071068,15.7071068 C10.8165825,16.0976311 10.1834175,16.0976311 9.79289322,15.7071068 L9.79289322,15.7071068 L7.29289322,13.2071068 C6.90236893,12.8165825 6.90236893,12.1834175 7.29289322,11.7928932 C7.68341751,11.4023689 8.31658249,11.4023689 8.70710678,11.7928932 L8.70710678,11.7928932 L10.5,13.5857864 Z"}),"FrameCheck"),El=Object(he.a)(o.a.createElement("g",{stroke:"currentColor",strokeWidth:"2",fill:"none",fillRule:"evenodd",strokeLinecap:"round",transform:"translate(4, 1)"},o.a.createElement("path",{d:"M2,3 L14,3 C15.1045695,3 16,3.8954305 16,5 L16,17 C16,18.1045695 15.1045695,19 14,19 L2,19 C0.8954305,19 0,18.1045695 0,17 L0,10 L0,10"}),o.a.createElement("polyline",{strokeLinejoin:"round",points:"4 11.5 6.5 14 12.5 8"}),o.a.createElement("polyline",{strokeLinejoin:"round",points:"3 0 -2.87547763e-14 3 3 6"})),"RemoveCheck"),Sl=a(202),yl=a(164),Ml=a(35);a(585);class Il extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={confirmStopPoll:!1},this.handleConfirmStopPoll=e=>{this.state.dialog||this.setState({confirmStopPoll:!0,contextMenu:!1})},this.handleCloseConfirm=e=>{e&&e.stopPropagation(),this.setState({confirmStopPoll:!1})},this.handleStopPoll=e=>{e.stopPropagation();const t=this.props,a=t.chatId,n=t.messageId;this.state.confirmStopPoll&&this.setState({confirmStopPoll:!1}),Object(yl.c)(a,n)},this.handleUnvote=e=>{e&&e.stopPropagation();const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(yl.a)(a,n)},this.handleCopyLink=e=>{const t=this.props,a=t.onClose,n=t.copyLink,s=t.t;a(e),n&&(H(n),this.handleScheduledAction(s("LinkCopied")))},this.handleCopyPublicMessageLink=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props,i=n.onClose,r=n.chatId,o=n.messageId,l=n.t,i(a),e.next=4,x.a.send({"@type":"getMessageLink",chat_id:r,message_id:o,for_album:!1,for_comment:!1});case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(d=c.link){e.next=10;break}return e.abrupt("return");case 10:H(d),t.handleScheduledAction(l("LinkCopied"));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>{n(s)}},o.a.createElement(f.a,null))]})},this.handleReply=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(Q.b)(),s(e),Object(Q.n)(a,n)},this.handlePin=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(Q.b)(),s(e),Object(tt.O)(a,n)?Object(Q.p)(a,n):Object(Q.o)(a,n)},this.handleForward=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(Q.h)(a,[n])},this.handleEdit=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(Q.b)(),s(e),Object(Q.f)(a,n)},this.handleSelect=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e);const s=window.getSelection().toString();if(!Object(tt.L)(s))return;const i=!ee.a.selectedItems.has("chatId=".concat(a,"_messageId=").concat(n));Object(Q.r)(a,n,i)},this.handleDelete=e=>{const t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(Q.e)(a,[n])},this.handleDownload=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=ee.a.get(a,n);if(!s)return;const i=s.content;if(!i)return;const r=i.sticker;if(!r)return;const o=r.sticker;if(!o)return;const l=U.a.getBlob(o.id);l&&Object(W.O)(l,"sticker.tgs")}}render(){const e=this.props,t=e.t,a=e.chatId,n=e.messageId,s=e.anchorPosition,i=e.copyLink,r=e.open,l=e.onClose,c=e.source,d=this.state.confirmStopPoll;if(!d&&!r)return null;const h=Object(tt.O)(a,n),p=Object(tt.e)(a,n)&&"chat"===c,u=Object(tt.a)(a,n)&&"chat"===c,m=Object(F.f)(a)&&"chat"===c,g=Object(F.d)(a)&&!Object(Ml.b)(ee.a.get(a,n)),f=Object(tt.d)(a,n),C=Object(tt.b)(a,n),b=Object(tt.c)(a,n)&&!ae.a.recording&&"chat"===c,v=!ee.a.hasSelectedMessage(a,n)&&!Object(Ml.b)(ee.a.get(a,n)),E=Boolean(i),S=Object(Sl.b)(a);return p||u||m||g||f||C||b||v||E||S?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ge.a,{open:!0,onClose:l,anchorReference:"anchorPosition",anchorPosition:s,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(ze.a,{onClick:e=>e.stopPropagation()},v&&o.a.createElement(We.a,{onClick:this.handleSelect},o.a.createElement(ge.a,null,o.a.createElement(vl,null)),o.a.createElement(fe.a,{primary:t("Select")})),S&&o.a.createElement(We.a,{onClick:this.handleCopyPublicMessageLink},o.a.createElement(ge.a,null,o.a.createElement(bl,null)),o.a.createElement(fe.a,{primary:t("CopyMessageLink")})),E&&o.a.createElement(We.a,{onClick:this.handleCopyLink},o.a.createElement(ge.a,null,o.a.createElement(bl,null)),o.a.createElement(fe.a,{primary:t("CopyLink")})),m&&o.a.createElement(We.a,{onClick:this.handleReply},o.a.createElement(ge.a,null,o.a.createElement(Ye,{style:{transform:"scaleX(-1)"}})),o.a.createElement(fe.a,{primary:t("Reply")})),g&&o.a.createElement(We.a,{onClick:this.handlePin},h?o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(va,null)),o.a.createElement(fe.a,{primary:t("UnpinMessage")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,null,o.a.createElement(ba,null)),o.a.createElement(fe.a,{primary:t("PinMessage")}))),f&&o.a.createElement(We.a,{onClick:this.handleForward},o.a.createElement(ge.a,null,o.a.createElement(Ye,null)),o.a.createElement(fe.a,{primary:t("Forward")})),b&&o.a.createElement(We.a,{onClick:this.handleEdit},o.a.createElement(ge.a,null,o.a.createElement(xn,null)),o.a.createElement(fe.a,{primary:t("Edit")})),C&&o.a.createElement(We.a,{color:"secondary",onClick:this.handleDelete},o.a.createElement(ge.a,null,o.a.createElement(Ke,null)),o.a.createElement(fe.a,{primary:t("Delete")})),p&&o.a.createElement(We.a,{onClick:this.handleUnvote},o.a.createElement(ge.a,null,o.a.createElement(El,null)),o.a.createElement(fe.a,{primary:t("Unvote")})),u&&o.a.createElement(We.a,{onClick:this.handleConfirmStopPoll},o.a.createElement(ge.a,null,o.a.createElement(si,null)),o.a.createElement(fe.a,{primary:t("StopPoll")})))),o.a.createElement(P.a,{transitionDuration:0,open:d,onClose:this.handleCloseConfirm,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("StopPollAlertTitle")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,t("StopPollAlertText"))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleCloseConfirm,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleStopPoll,color:"primary"},t("Stop"))))):null}}var Ul=Object(d.a)(Object(_.a)(),p.b)(Il),kl=Object(he.a)(o.a.createElement("path",{d:"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z"}),"PinFilled"),xl=a(187),wl=a.n(xl);a(586);class Ol extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateMessageIsPinned=e=>{const t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=[n.messageId,...n.messageIds||[]].filter(e=>Boolean(e));t===s&&i.some(e=>e===a)&&this.setState({isPinned:i.some(e=>ee.a.get(s,e).is_pinned)})},this.onUpdateMessageEdited=e=>{const t=e.chat_id,a=e.message_id,n=e.edit_date,s=this.state.message;s&&s.chat_id===t&&s.id===a&&this.setState({editDate:n})},this.onUpdateMessageInteractionInfo=e=>{const t=e.chat_id,a=e.message_id,n=e.interaction_info,s=this.state.message;s&&s.chat_id===t&&s.id===a&&this.setState({interactionInfo:n})}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.messageId,s=e.messageIds,i=t.prevChatId,r=t.prevMessageId,o=t.prevMessageIds;if(i!==a||r!==n||Object(M.a)(o,s)){const e=[n,...s||[]].filter(e=>Boolean(e)),t=e[e.length-1],i=ee.a.get(a,t);if(!i)return null;const r=i.date,o=i.edit_date,l=i.interaction_info,c=i.is_outgoing;return{prevChatId:a,prevMessageId:n,prevMessageIds:s,message:i,date:r,editDate:o,interactionInfo:l,isOutgoing:c,isPinned:e.some(e=>ee.a.get(a,e).is_pinned)}}return null}componentDidMount(){ee.a.on("updateMessageEdited",this.onUpdateMessageEdited),ee.a.on("updateMessageInteractionInfo",this.onUpdateMessageInteractionInfo),ee.a.on("updateMessageIsPinned",this.onUpdateMessageIsPinned)}componentWillUnmount(){ee.a.off("updateMessageEdited",this.onUpdateMessageEdited),ee.a.off("updateMessageInteractionInfo",this.onUpdateMessageInteractionInfo),ee.a.off("updateMessageIsPinned",this.onUpdateMessageIsPinned)}render(){const e=this.props,t=e.className,a=e.chatId,n=e.messageId,s=e.onDateClick,i=e.t,r=e.style,l=this.state,d=l.date,h=l.editDate,p=l.isOutgoing,u=l.isPinned,m=(l.interactionInfo||{view_count:0,forward_count:0}).view_count,g=Object(tt.k)(d),f=Object(tt.l)(d),C=Object(tt.C)(m);return o.a.createElement("div",{className:c()("meta",t),style:r},o.a.createElement("span",null,"\u2002"),m>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(wl.a,{className:"meta-views-icon"}),o.a.createElement("span",{className:"meta-views",title:m},"\xa0",C,"\xa0 \xa0")),u&&o.a.createElement(o.a.Fragment,null,o.a.createElement(kl,{className:"meta-pin-icon"}),o.a.createElement("span",null,"\xa0")),h>0&&o.a.createElement("span",null,i("EditedMessage"),"\xa0"),o.a.createElement("a",{onClick:s},o.a.createElement("span",{title:f},g)),p&&o.a.createElement(ua,{chatId:a,messageId:n}))}}var Ll=Object(_.a)()(Ol),_l=a(79),Nl=a(135);a(587);class jl extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1},this.getAlbumItem=(e,t)=>{const a=e.chat_id,n=e.id,s=e.content;switch(s["@type"]){case"messageAudio":{const i=o.a.createElement(Ll,{className:"meta-hidden",key:"".concat(a,"_").concat(n,"_meta"),chatId:a,messageId:n}),r=Object(tt.D)(e),l=Object(tt.y)(e,r?null:i,e=>e);return o.a.createElement(o.a.Fragment,null,o.a.createElement(el.a,{type:"message",chatId:a,messageId:n,audio:s.audio,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia}),l&&l.length>0&&o.a.createElement("div",{className:"message-text"},l))}case"messagePhoto":return o.a.createElement(_l.a,{type:"message",chatId:a,messageId:n,photo:s.photo,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia});case"messageVideo":return o.a.createElement(Nl.a,{type:"message",chatId:a,messageId:n,video:s.video,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia});case"messageDocument":{const i=o.a.createElement(Ll,{className:"meta-hidden",key:"".concat(a,"_").concat(n,"_meta"),chatId:a,messageId:n}),r=Object(tt.D)(e),l=Object(tt.y)(e,r?null:i,e=>e);return o.a.createElement(o.a.Fragment,null,o.a.createElement(Cl.a,{type:"message",chatId:a,messageId:n,document:s.document,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia}),l&&l.length>0&&o.a.createElement("div",{className:"message-text"},l))}}return null},this.onClientUpdateMessageHighlighted=e=>{const t=this.props.message,a=this.state,n=a.selected,s=a.highlighted;n||(t.chat_id===e.chatId&&t.id===e.messageId?s?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):s&&this.setState({highlighted:!1}))},this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onClientUpdateMessageSelected=e=>{const t=this.props.message,a=t.chat_id,n=t.id,s=e.selected;a===e.chatId&&n===e.messageId&&this.setState({selected:s,highlighted:!1})},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,r=a.target&&"A"===a.target.tagName&&a.target.href?a.target.href:null,t.setState({contextMenu:!0,copyLink:r,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.openMedia=e=>{if(ee.a.selectedItems.size>0)return;e&&(e.preventDefault(),e.stopPropagation());const t=this.props.message;if(!t)return;const a=t.chat_id,n=t.id;Object(tt.U)(a,n)},this.handleSelection=e=>{const t=window.getSelection().toString();if(!Object(tt.L)(t))return;const a=this.props.message,n=a.chat_id,s=a.id;if(0===ee.a.selectedItems.size)return;const i=!ee.a.selectedItems.has("chatId=".concat(n,"_messageId=").concat(s));Object(Q.r)(n,s,i),e.preventDefault(),e.stopPropagation()}}componentDidMount(){ee.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection)}componentWillUnmount(){ee.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection)}render(){const e=this.props,t=e.message,a=e.position,n=e.displaySize,s=e.source,i=this.state,r=i.contextMenu,l=i.copyLink,d=i.top,h=i.left,p=i.selected,u=i.highlighted,m=t.chat_id,g=t.id;let f={},C="album-document-item";return a&&(f={width:a.width,height:a.height*n},C="album-item"),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:c()(C,{"album-item-highlighted":u&&!p},{"item-selected":p}),onClick:this.handleSelection,onContextMenu:this.handleOpenContextMenu,style:f},o.a.createElement("div",{className:"album-item-wrapper"},this.getAlbumItem(t,n)),(p||u)&&o.a.createElement("div",{className:"album-item-selection"},o.a.createElement("div",{className:"album-item-selection-mark"},p&&o.a.createElement(fl.a,{className:"album-item-select-tick"})))),o.a.createElement(Ul,{chatId:m,messageId:g,anchorPosition:{top:d,left:h},open:r,onClose:this.handleCloseContextMenu,copyLink:l,source:s}))}}var Pl=jl;a(588);class Tl extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateLanguage=()=>{this.forceUpdate()}}componentDidMount(){an.a.on("clientUpdateLanguageChange",this.onClientUpdateLanguage)}componentWillUnmount(){an.a.off("clientUpdateLanguageChange",this.onClientUpdateLanguage)}render(){const e=this.props,t=e.date,a=e.i18n,n=new Date(1e3*t).getFullYear()!==(new Date).getFullYear()?{day:"numeric",month:"long",year:"numeric"}:{day:"numeric",month:"long"};return o.a.createElement("div",{className:"day-meta"},o.a.createElement("div",{className:"day-meta-wrapper"},o.a.createElement("div",null,new Date(1e3*t).toLocaleDateString([a.language],n))))}}var Rl=Object(_.a)()(Tl);a(589);class Dl extends o.a.Component{constructor(...e){super(...e),this.state={arrowRef:null},this.handleArrowRef=e=>{this.setState({arrowRef:e})},this.openForward=e=>{e.stopPropagation();const t=this.props.forwardInfo;if(!t)return null;const a=t.origin;switch(a["@type"]){case"messageForwardOriginUser":{const e=a.sender_user_id;Object(Q.m)(e,!0);break}case"messageForwardOriginHiddenUser":break;case"messageForwardOriginChannel":{const e=a.chat_id,t=a.message_id;Object(Q.k)(e,t);break}}}}render(){const e=this.props,t=e.t,a=e.forwardInfo,n=(this.state.arrowRef,Object(tt.p)(a,t));Object(tt.M)(a)&&(o.a.Fragment,t("HidAccount"),this.handleArrowRef);return o.a.createElement("div",{className:c()("message-author","forward")},o.a.createElement("div",null,t("ForwardedMessage")),o.a.createElement("div",{className:"forward-subtitle"},t("From")+" ",o.a.createElement("a",{onClick:this.openForward},n)))}}var Fl=Object(_.a)()(Dl);class Al{constructor(e,t){this.lineCounts=e,this.heights=t}}class Bl{set(e,t,a,n,s,i,r){this.minX=e,this.maxX=t,this.minY=a,this.maxY=n,this.spanSize=s,this.width=s,this.height=i,this.flags=r}getInfo(){return"minX=".concat(this.minX,"\nmaxX=").concat(this.maxX,"\nminY=").concat(this.minY,"\nmaxY=").concat(this.maxY,"\nspanSize=").concat(this.spanSize,"\nwidth=").concat(this.width,"\nheight=").concat(this.height,"\nflags=").concat(this.flags,"\nsiblingHeights=").concat(this.siblingHeights,"\nleftSpanOffset=").concat(this.leftSpanOffset)}}class Hl{constructor(){this.posArray=[],this.positions=new Map,this.maxSizeWidth=800,this.hasSibling=!1,this.scale=1}multiHeight(e,t,a){let n=0;for(let s=t;s<a;s++)n+=e[s];return 800*this.scale/n}calculate(e,t){if(this.posArray=[],this.positions=new Map,this.messages=e,!e)return;const a=e.length;if(a<=1)return;this.totalWidth=0,this.totalHeight=0,this.scale=t/this.maxSizeWidth,this.maxSizeWidth=t;Math.trunc(200*this.scale);const n=Math.trunc(120*this.scale),s=Math.trunc(96*this.scale),i=Math.trunc(32*this.scale),r=814*this.scale;let o=1,l="";let c=0,d=!1;for(let p=0;p<a;p++){const t=e[p],a=Hl.getWidthHeight(t),n=a.w,s=a.h,i=new Bl;i.isLast=p===e.length-1,i.aspectRatio=n/s,i.aspectRatio>1.2?l+="w":i.aspectRatio<.8?l+="n":l+="q",o+=i.aspectRatio,i.aspectRatio>2&&(d=!0),this.positions.set(t,i),this.posArray.push(i)}const h=this.maxSizeWidth/r;if(o/=a,d||2!==a&&3!==a&&4!==a){const e=new Array(this.posArray.length);for(let s=0;s<a;s++)e[s]=o>1.1?Math.max(1,this.posArray[s].aspectRatio):Math.min(1,this.posArray[s].aspectRatio),e[s]=Math.max(.66667,Math.min(1.7,e[s]));let t,n,i,l;const d=[];for(t=1;t<e.length;t++)n=e.length-t,t>3||n>3||d.push(new Al([t,n],[this.multiHeight(e,0,t),this.multiHeight(e,t,e.length)]));for(t=1;t<e.length-1;t++)for(n=1;n<e.length-t;n++)i=e.length-t-n,t>3||n>(o<.85?4:3)||i>3||d.push(new Al([t,n,i],[this.multiHeight(e,0,t),this.multiHeight(e,t,t+n),this.multiHeight(e,t+n,e.length)]));for(t=1;t<e.length-2;t++)for(n=1;n<e.length-t;n++)for(i=1;i<e.length-t-n;i++)l=e.length-t-n-i,t>3||n>3||i>3||l>3||d.push(new Al([t,n,i,l],[this.multiHeight(e,0,t),this.multiHeight(e,t,t+n),this.multiHeight(e,t+n,t+n+i),this.multiHeight(e,t+n+i,e.length)]));let h=null,p=0,u=this.maxSizeWidth/3*4;for(let a=0;a<d.length;a++){const e=d[a];let t=0,n=Number.MAX_VALUE;for(let a=0;a<e.heights.length;a++)t+=e.heights[a],e.heights[a]<n&&(n=e.heights[a]);let i=Math.abs(t-u);e.lineCounts.length>1&&(e.lineCounts[0]>e.lineCounts[1]||e.lineCounts.length>2&&e.lineCounts[1]>e.lineCounts[2]||e.lineCounts.length>3&&e.lineCounts[2]>e.lineCounts[3])&&(i*=1.5),n<s&&(i*=1.5),(null===h||i<p)&&(h=e,p=i)}if(null===h)return;let m=0,g=0;for(let a=0;a<h.lineCounts.length;a++){let t=h.lineCounts[a],n=h.heights[a],s=this.maxSizeWidth,i=null;c=Math.max(c,t-1);for(let o=0;o<t;o++){let l=e[m],c=Math.trunc(l*n);s-=c;let d=this.posArray[m],p=0;0===a&&(p|=4),a===h.lineCounts.length-1&&(p|=8),0===o&&(p|=1),o===t-1&&(p|=2,i=d),d.set(o,o,a,a,c,n/r,p),m++}i.width+=s,i.spanSize+=s,g+=n}this.totalWidth=this.maxSizeWidth,this.totalHeight=g/r}else switch(a){case 2:{const e=this.posArray[0],t=this.posArray[1];if("ww"===l&&o>1.4*h&&e.aspectRatio-t.aspectRatio<.2){const a=Math.round(Math.min(this.maxSizeWidth/e.aspectRatio,Math.min(this.maxSizeWidth/t.aspectRatio,r/2)))/r;e.set(0,0,0,0,this.maxSizeWidth,a,7),t.set(0,0,1,1,this.maxSizeWidth,a,11),this.totalWidth=this.maxSizeWidth,this.totalHeight=2*a}else if("ww"===l||"qq"===l){const a=this.maxSizeWidth/2,n=Math.round(Math.min(a/e.aspectRatio,Math.min(a/t.aspectRatio,r)))/r;e.set(0,0,0,0,a,n,13),t.set(1,1,0,0,a,n,14),c=1,this.totalWidth=a+a,this.totalHeight=n}else{let a=Math.max(.4*this.maxSizeWidth,Math.round(this.maxSizeWidth/e.aspectRatio/(1/e.aspectRatio+1/t.aspectRatio))),n=this.maxSizeWidth-a;if(n<s){const e=s-n;n=s,a-=e}const i=Math.min(r,Math.round(Math.min(n/e.aspectRatio,a/t.aspectRatio)))/r;e.set(0,0,0,0,n,i,13),t.set(1,1,0,0,a,i,14),c=1,this.totalWidth=n+a,this.totalHeight=i}break}case 3:{const e=this.posArray[0],t=this.posArray[1],a=this.posArray[2];if("n"===l[0]){const n=Math.min(.5*r,Math.round(t.aspectRatio*this.maxSizeWidth/(a.aspectRatio+t.aspectRatio))),o=r-n,l=Math.max(s,Math.min(.5*this.maxSizeWidth,Math.round(Math.min(n*a.aspectRatio,o*t.aspectRatio)))),d=Math.round(Math.min(r*e.aspectRatio+i,this.maxSizeWidth-l));e.set(0,0,0,1,d,1,13),t.set(1,1,0,0,l,o/r,6),a.set(0,1,1,1,l,n/r,10),a.spanSize=this.maxSizeWidth,e.siblingHeights=[n/r,o/r],t.spanSize=this.maxSizeWidth-d,a.leftSpanOffset=d,this.hasSibling=!0,c=1,this.totalWidth=d+l,this.totalHeight=1}else{const n=Math.round(Math.min(this.maxSizeWidth/e.aspectRatio,.66*r))/r;e.set(0,1,0,0,this.maxSizeWidth,n,7);const s=this.maxSizeWidth/2,i=Math.min(r-n,Math.round(Math.min(s/t.aspectRatio,s/a.aspectRatio)))/r;t.set(0,0,1,1,s,i,9),a.set(1,1,1,1,s,i,10),c=1,this.totalWidth=this.maxSizeWidth,this.totalHeight=n+i}break}case 4:{const e=this.posArray[0],t=this.posArray[1],a=this.posArray[2],o=this.posArray[3];if("w"===l[0]){const n=Math.round(Math.min(this.maxSizeWidth/e.aspectRatio,.66*r))/r;e.set(0,2,0,0,this.maxSizeWidth,n,7);let i=Math.round(this.maxSizeWidth/(t.aspectRatio+a.aspectRatio+o.aspectRatio));const l=Math.max(s,Math.min(.4*this.maxSizeWidth,i*t.aspectRatio)),d=Math.max(Math.max(s,.33*this.maxSizeWidth),i*o.aspectRatio),h=this.maxSizeWidth-l-d;i=Math.min(r-n,i),i/=r,t.set(0,0,1,1,l,i,9),a.set(1,1,1,1,h,i,8),o.set(2,2,1,1,d,i,10),c=2,this.totalWidth=this.maxSizeWidth,this.totalHeight=n+i}else{const l=Math.max(s,Math.round(r/(1/t.aspectRatio+1/a.aspectRatio+1/o.aspectRatio))),d=Math.min(.33,Math.max(n,l/t.aspectRatio)/r),h=Math.min(.33,Math.max(n,l/a.aspectRatio)/r),p=1-d-h,u=Math.round(Math.min(r*e.aspectRatio+i,this.maxSizeWidth-l));e.set(0,0,0,2,u,d+h+p,13),t.set(1,1,0,0,l,d,6),a.set(0,1,1,1,l,h,2),a.spanSize=this.maxSizeWidth,o.set(0,1,2,2,l,p,10),o.spanSize=this.maxSizeWidth,t.spanSize=this.maxSizeWidth-u,a.leftSpanOffset=u,o.leftSpanOffset=u,e.siblingHeights=[d,h,p],this.hasSibling=!0,c=1,this.totalWidth=l+u,this.totalHeight=d+h+p}break}}}static getWidthHeight(e){let t=0,a=0,n=[];switch(e.content["@type"]){case"messagePhoto":{const t=e.content,a=t.photo,s=t.minithumbnail;a?n=a.sizes:s&&n.push(s);break}case"messageVideo":{const t=e.content,a=t.video,s=t.thumbnail,i=t.minithumbnail;if(a){const e=a.width,t=a.height;n.push({width:e,height:t})}else i?n.push(i):s&&n.push(s);break}case"messageDocument":{const t=e.content,a=t.thumbnail,s=t.minithumbnail;s?n.push(s):a?n.push(a):n.push({width:90,height:90});break}}const s=Hl.getPhotoSize(n,1280);return s&&(t=s.width,a=s.height),{w:t,h:a}}static getPhotoSize(e,t,a){if(!e||!e.length)return null;let n=0,s=null;for(let i=0;i<e.length;i++){const r=e[i],o=r.width,l=r.height;if(a){const a=l>=o?o:l;(!s||t>100&&t>n&&n<a)&&(n=a,s=e[i])}else{const a=o>=l?o:l;(!s||t>100&&a<=t&&n<a)&&(n=a,s=e[i])}}return s}}var Vl=Hl;a(590);var zl=Object(_.a)()((function(e){const t=e.t;return o.a.createElement("div",{className:"unread-separator"},t("UnreadMessages"))}));a(591);var Wl=function(e){const t=e.dialog,a=e.small,n=e.big,s=e.style;return o.a.createElement("div",{className:c()("chat-tile",{"tile-dialog":t},{"tile-small":a},{"tile-big":n}),style:s})};a(592);class Gl extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateMessageHighlighted=e=>{const t=this.props,a=t.chatId,n=t.messageIds,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n.some(t=>t===e.messageId)?r?this.setState({highlighted:!1,lastHighlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0,lastHighlighted:n.length>0&&n[n.length-1]===e.messageId})},0)}):this.setState({highlighted:!0,lastHighlighted:n.length>0&&n[n.length-1]===e.messageId}):r&&this.setState({highlighted:!1,lastHighlighted:!1}))},this.onClientUpdateMessageSelected=e=>{const t=this.props,a=t.chatId,n=t.messageIds;e.selected;a===e.chatId&&n.some(t=>t===e.messageId)&&this.setState({selected:n.every(e=>ee.a.hasSelectedMessage(a,e))})},this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onUpdateMessageContent=e=>{const t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageIds,r=n.displaySize,o=this.state.emojiMatches;if(s!==t)return;if(!i.some(e=>e===a))return;const l=new Vl;l.calculate(i.map(e=>ee.a.get(s,e)),r);null!==o?this.setState({emojiMatches:null,grouped:l}):this.setState({grouped:l})},this.handleSelection=()=>{const e=window.getSelection().toString();if(!Object(tt.L)(e))return;const t=this.props,a=t.chatId,n=t.messageIds;if(this.state.selected)for(let s=0;s<n.length;s++)Object(Q.r)(a,n[s],!1);else for(let s=0;s<n.length;s++)Object(Q.r)(a,n[s],!0)}}shouldComponentUpdate(e,t,a){const n=this.props.messageIds,s=this.state,i=s.emojiMatches,r=s.selected,o=s.highlighted;return!Object(M.a)(e.messageIds,n)||(t.emojiMatches!==i||(t.selected!==r||t.highlighted!==o))}static getDerivedStateFromProps(e,t){const a=e.displaySize,n=e.chatId,s=e.messageIds;if(s!==t.prevMessageIds){const e=new Vl;return e.calculate(s.map(e=>ee.a.get(n,e)),a),{grouped:e,prevMessageIds:s}}return null}componentDidMount(){ee.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){ee.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){let e=this.props,t=e.showTail,a=e.source;const n=this.props,s=n.chatId,i=n.messageIds,r=n.displaySize,l=n.showUnreadSeparator,d=n.showTitle,h=n.showDate,p=(n.t,this.state),u=p.emojiMatches,m=p.selected,g=(p.highlighted,p.shook),f=(p.copyLink,p.contextMenu,p.left,p.top,this.state.grouped);if(!f)return null;if(!i.length)return null;let C=i[i.length-1];const b=ee.a.get(s,C);if(!b)return o.a.createElement("div",null,"[empty message]");const v=b.content,E=b.is_outgoing,S=b.date,y=b.reply_to_message_id,M=b.forward_info,I=b.sender,U=E&&!Object(F.V)(s),k=o.a.createElement(Ll,{className:"meta-hidden",key:"".concat(s,"_").concat(C,"_meta"),chatId:s,messageIds:i}),x=Object(tt.D)(b);let w=null;for(let o=0;o<i.length;o++){const e=ee.a.get(s,i[o]),t=Object(tt.y)(e,x?null:k,t);if(t&&t.length){if(null!==w){w=null;break}w=t,C=i[o]}}const O=null!==w&&w.length>0,L=o.a.createElement(Ll,{className:c()("meta-text",{"meta-bubble":!O}),chatId:s,messageIds:i,onDateClick:this.handleDateClick}),_=Object(tt.W)(s,C),N=Boolean(y),j=Object(F.hb)(s)&&!(Object(F.gb)(s)&&!U),P=!j&&d||_||N,T=Object(F.V)(s),R=Object(F.hb)(s);let A=null;if(t)if(Object(F.gb)(s)&&M)switch(M.origin["@type"]){case"messageForwardOriginHiddenUser":A=o.a.createElement(Cn.a,{small:!0,firstName:M.origin.sender_name,onSelect:this.handleSelectUser});break;case"messageForwardOriginUser":A=o.a.createElement(Cn.a,{small:!0,userId:M.origin.sender_user_id,onSelect:this.handleSelectUser});break;case"messageForwardOriginChannel":A=o.a.createElement(D.a,{small:!0,chatId:M.origin.chat_id,onSelect:this.handleSelectChat})}else A=R||T||E?o.a.createElement(Wl,{small:!0}):I.user_id?o.a.createElement(Cn.a,{small:!0,userId:I.user_id,onSelect:this.handleSelectUser}):o.a.createElement(D.a,{small:!0,chatId:s,onSelect:this.handleSelectChat});const B={width:f.totalWidth-2-2},H="messageSticker"!==v["@type"]&&"messageVideoNote"!==v["@type"],V=!O&&("messageAnimation"===v["@type"]||"messageVideo"===v["@type"]||"messagePhoto"===v["@type"]),z=f.messages.map(e=>o.a.createElement(Pl,{key:e.id,message:e,position:f.positions.get(e),displaySize:r,source:a}));return o.a.createElement("div",null,h&&o.a.createElement(Rl,{date:S}),o.a.createElement("div",{className:c()("message","message-album",{"message-rounded":d&&t&&V,"message-short":!A,"message-out":U,"message-selected":m,"message-group-title":d&&!t,"message-group":!d&&!t,"message-group-tail":!d&&t&&!V,"message-group-tail-rounded":!d&&t&&V,"message-bubble-hidden":!H}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},l&&o.a.createElement(zl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(fl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:g})},A,o.a.createElement("div",{className:c()("message-content",{"message-bubble":H,"message-bubble-out":H&&U}),style:B},H&&(d&&!j||_)&&o.a.createElement("div",{className:"message-title"},d&&!_&&o.a.createElement(pt.a,{sender:I,forwardInfo:M,openChat:!0,openUser:!0}),_&&o.a.createElement(Fl,{forwardInfo:M})),N&&o.a.createElement(_r,{chatId:s,messageId:y,onClick:this.handleReplyClick}),o.a.createElement("div",{className:c()("album",{"album-caption":O},{"album-title":P})},o.a.createElement("div",{className:"album-wrapper",style:{width:f.totalWidth}},z)),o.a.createElement("div",{className:c()("message-text",{"message-text-1emoji":1===u,"message-text-2emoji":2===u,"message-text-3emoji":3===u})},w),H&&L),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))))}}Gl.defaultProps={displaySize:u.I,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showData:!1};var Zl=Gl;a(593);class ql extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateMessageHighlighted=e=>{const t=this.props,a=t.chatId,n=t.messageIds,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n.some(t=>t===e.messageId)?r?this.setState({highlighted:!1,lastHighlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0,lastHighlighted:n.length>0&&n[n.length-1]===e.messageId})},0)}):this.setState({highlighted:!0,lastHighlighted:n.length>0&&n[n.length-1]===e.messageId}):r&&this.setState({highlighted:!1,lastHighlighted:!1}))},this.onClientUpdateMessageSelected=e=>{const t=this.props,a=t.chatId,n=t.messageIds;e.selected;a===e.chatId&&n.some(t=>t===e.messageId)&&this.setState({selected:n.every(e=>ee.a.hasSelectedMessage(a,e)),lastSelected:n.length>0&&ee.a.hasSelectedMessage(a,n[n.length-1])})},this.onClientUpdateClearSelection=e=>{this.setState({selected:!1,lastSelected:!1})},this.onUpdateMessageContent=e=>{const t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageIds,r=(n.displaySize,this.state.emojiMatches);if(s!==t)return;if(!i.some(e=>e===a))return;null!==r?this.setState({emojiMatches:null}):this.forceUpdate()},this.handleSelection=()=>{const e=window.getSelection().toString();if(!Object(tt.L)(e))return;const t=this.props,a=t.chatId,n=t.messageIds;if(this.state.selected)for(let s=0;s<n.length;s++)Object(Q.r)(a,n[s],!1);else for(let s=0;s<n.length;s++)Object(Q.r)(a,n[s],!0)}}shouldComponentUpdate(e,t,a){const n=this.props.messageIds,s=this.state,i=s.emojiMatches,r=s.lastSelected,o=s.selected,l=s.lastHighlighted,c=s.highlighted;return!Object(M.a)(e.messageIds,n)||(t.emojiMatches!==i||(t.selected!==o||(t.lastSelected!==r||(t.highlighted!==c||t.lastHighlighted!==l))))}static getDerivedStateFromProps(e,t){e.displaySize,e.chatId;const a=e.messageIds;return a!==t.prevMessageIds?{prevMessageIds:a}:null}componentDidMount(){ee.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){ee.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){let e=this.props,t=e.showTail,a=e.source;const n=this.props,s=n.chatId,i=n.messageIds,r=n.displaySize,l=n.showUnreadSeparator,d=n.showTitle,h=n.showDate,p=(n.t,this.state),u=(p.emojiMatches,p.selected),m=p.lastSelected,g=(p.highlighted,p.lastHighlighted),f=p.shook;p.copyLink,p.contextMenu,p.left,p.top;if(!i.length)return null;let C=i[i.length-1];const b=ee.a.get(s,C);if(!b)return o.a.createElement("div",null,"[empty message]");const v=b.content,E=b.is_outgoing,S=b.date,y=b.reply_to_message_id,M=b.forward_info,I=b.sender,U=E&&!Object(F.V)(s),k=o.a.createElement(Ll,{className:"meta-hidden",key:"".concat(s,"_").concat(C,"_meta"),chatId:s,messageIds:i}),x=Object(tt.D)(b);let w=null;for(let o=0;o<i.length;o++){const e=ee.a.get(s,i[o]),t=Object(tt.y)(e,x?null:k,t);if(t&&t.length){if(null!==w){w=null;break}w=t,C=i[o]}}const O=null!==w&&w.length>0,L=o.a.createElement(Ll,{className:c()("meta-text",{"meta-bubble":!1}),chatId:s,messageIds:i,onDateClick:this.handleDateClick}),_=Object(tt.W)(s,C),N=Boolean(y),j=Object(F.hb)(s)&&!(Object(F.gb)(s)&&!U),P=!j&&d||_||N,T=Object(F.V)(s),R=Object(F.hb)(s);let A=null;if(t)if(Object(F.gb)(s)&&M)switch(M.origin["@type"]){case"messageForwardOriginHiddenUser":A=o.a.createElement(Cn.a,{small:!0,firstName:M.origin.sender_name,onSelect:this.handleSelectUser});break;case"messageForwardOriginUser":A=o.a.createElement(Cn.a,{small:!0,userId:M.origin.sender_user_id,onSelect:this.handleSelectUser});break;case"messageForwardOriginChannel":A=o.a.createElement(D.a,{small:!0,chatId:M.origin.chat_id,onSelect:this.handleSelectChat})}else A=R||T||E?o.a.createElement(Wl,{small:!0}):I.user_id?o.a.createElement(Cn.a,{small:!0,userId:I.user_id,onSelect:this.handleSelectUser}):o.a.createElement(D.a,{small:!0,chatId:s,onSelect:this.handleSelectChat});const B="messageSticker"!==v["@type"]&&"messageVideoNote"!==v["@type"],H=!O&&("messageAnimation"===v["@type"]||"messageVideo"===v["@type"]||"messagePhoto"===v["@type"]),V=i.map(e=>ee.a.get(s,e)).map(e=>o.a.createElement(Pl,{key:e.id,message:e,position:null,displaySize:r,source:a}));return o.a.createElement("div",null,h&&o.a.createElement(Rl,{date:S}),o.a.createElement("div",{className:c()("message","message-album","message-document-album",{"message-rounded":d&&t&&H,"message-short":!A,"message-out":U,"message-selected":u,"message-album-last-selected":m,"message-album-last-highlighted":g&&!u,"message-group-title":d&&!t,"message-group":!d&&!t,"message-group-tail":!d&&t&&!H,"message-group-tail-rounded":!d&&t&&H,"message-bubble-hidden":!B}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},l&&o.a.createElement(zl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(fl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:f})},A,o.a.createElement("div",{className:c()("message-content",{"message-bubble":B,"message-bubble-out":B&&U}),style:{}},B&&(d&&!j||_)&&o.a.createElement("div",{className:"message-title"},d&&!_&&o.a.createElement(pt.a,{sender:I,forwardInfo:M,openChat:!0,openUser:!0}),_&&o.a.createElement(Fl,{forwardInfo:M})),N&&o.a.createElement(_r,{chatId:s,messageId:y,onClick:this.handleReplyClick}),o.a.createElement("div",{className:c()("album","document-album",{"album-caption":!1},{"album-title":P})},o.a.createElement("div",{className:"album-wrapper"},V)),B&&L),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))))}}ql.defaultProps={displaySize:u.I,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showData:!1};var Kl=ql;a(594);class Yl extends o.a.Component{constructor(e){super(e),this.onClientUpdateDragging=e=>{const t=ae.a.dragParams;this.setState({dragParams:t})},this.handleDragEnter=e=>{e.preventDefault(),e.stopPropagation()},this.handleDrop=e=>{e.preventDefault(),e.stopPropagation(),x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!1}),this.handleAttachDocumentComplete(e.dataTransfer.files)},this.handleDragLeave=e=>{e.preventDefault(),e.stopPropagation(),x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!1})},this.handleAttachDocumentComplete=e=>{0!==e.length&&x.a.clientUpdate({"@type":"clientUpdateSendFiles",files:e})};const t=ae.a.dragParams;this.state={dragParams:t}}componentDidMount(){ae.a.on("clientUpdateDragging",this.onClientUpdateDragging)}componentWillUnmount(){ae.a.off("clientUpdateDragging",this.onClientUpdateDragging)}render(){return this.state.dragParams?o.a.createElement("div",{className:"files-drop-target",onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},o.a.createElement("div",{className:"files-drop-target-wrapper"},o.a.createElement("div",{className:"files-drop-target-text"},o.a.createElement("div",{className:"files-drop-target-title"},"Drop files here"),o.a.createElement("div",{className:"files-drop-target-subtitle"},"to send them")))):null}}var Jl=Yl;a(595);o.a.Component;const Xl=o.a.createContext({chatId:0,messageId:0});var Ql=Xl;var $l=Object(he.a)(o.a.createElement("path",{d:"M8.5,18.31L5.69,15.5L12.06,9.12H7.11V5.69H18.31V16.89H14.89V11.94L8.5,18.31Z"}),"ArrowTopRight"),ec=Object(he.a)(o.a.createElement("path",{d:"M21,12L14,5V9C7,10 4,15 3,20C5.5,16.5 9,14.9 14,14.9V19L21,12Z"}),"ShareFilled");a(596);class tc extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={loading:!1},this.handleCallbackQueryAnswer=(e,t,a)=>{const n=this.props.chatId,s=a.sender,i=a.content,r=a.via_bot_user_id,l=t.text,c=t.show_alert,d=t.url,h=i.game;let p="";if(a&&(p=r?Object(Et.c)(r,null):Object(F.x)(n,!1)),p=p||an.a.getString("Bot"),l)c?Object(Q.x)({title:p,message:l,ok:an.a.getString("OK")}):Object(Q.C)(l,e=>t=>o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>{e(t)}},o.a.createElement(f.a,null)));else if(d)if("inlineKeyboardButtonTypeCallbackGame"===e["@type"]){const e=r||s.user_id,t=te.a.get(e);Object(Q.z)(h,{message:a,url:d,userId:e,isVerified:t&&t.is_verified})}else Object(Q.A)(d,{punycode:!1,ask:!1,tryTelegraph:!0})},this.handleClick=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,r,o,l,c,d,h,p,u,m,g,f,C,b,v,E,S,y,M,I,U,k;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.preventDefault(),a.stopPropagation(),n=t.props,r=n.chatId,o=n.messageId,l=n.type,e.t0=l["@type"],e.next="inlineKeyboardButtonTypeBuy"===e.t0?6:"inlineKeyboardButtonTypeCallback"===e.t0||"inlineKeyboardButtonTypeCallbackGame"===e.t0?8:"inlineKeyboardButtonTypeCallbackWithPassword"===e.t0?31:"inlineKeyboardButtonTypeLoginUrl"===e.t0?44:"inlineKeyboardButtonTypeSwitchInline"===e.t0?65:"inlineKeyboardButtonTypeUrl"===e.t0?78:81;break;case 6:return Object(Q.x)({title:an.a.getString("AppName"),message:an.a.getString("PaymentsNotSupported"),ok:an.a.getString("OK")}),e.abrupt("break",81);case 8:if(c=l.data,d=ee.a.get(r,o)){e.next=12;break}return e.abrupt("break",81);case 12:if(h=d.sender,p=d.content,u=d.via_bot_user_id,p){e.next=15;break}return e.abrupt("break",81);case 15:if(m=null,g=null,"inlineKeyboardButtonTypeCallbackGame"!==l["@type"]){e.next=24;break}if(g=p.game){e.next=21;break}return e.abrupt("break",81);case 21:m={"@type":"callbackQueryPayloadGame",game_short_name:g.short_name},e.next=25;break;case 24:m={"@type":"callbackQueryPayloadData",data:c};case 25:return t.setState({loading:!0}),e.next=28,x.a.send({"@type":"getCallbackQueryAnswer",chat_id:r,message_id:o,payload:m}).finally(()=>{t.setState({loading:!1})});case 28:return f=e.sent,t.handleCallbackQueryAnswer(l,f,d),e.abrupt("break",81);case 31:if(c=l.data,d=ee.a.get(r,o)){e.next=35;break}return e.abrupt("break",81);case 35:return t.setState({loading:!0}),e.next=38,x.a.send({"@type":"getPasswordState"}).finally(()=>{t.setState({loading:!1})});case 38:if(C=e.sent,C.has_password){e.next=42;break}return e.abrupt("break",81);case 42:return Object(Q.y)(C,function(){var e=Object(i.a)(s.a.mark((function e(a,n,i){var h,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[pwd] onPassword",a),t.setState({loading:!0}),h=null,e.next=5,x.a.send({"@type":"getCallbackQueryAnswer",chat_id:r,message_id:o,payload:{"@type":"callbackQueryPayloadDataWithPassword",data:c,password:a}}).catch(e=>{h=e}).finally(()=>{t.setState({loading:!1})});case 5:p=e.sent,h?(console.log("[pwd] onPassword error",h),i&&i(h)):p&&(console.log("[pwd] onPassword result",p),n&&n(),t.handleCallbackQueryAnswer(l,p,d));case 7:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()),e.abrupt("break",81);case 44:return b=l.url,v=l.id,l.forward_text,t.setState({loading:!0}),E=!1,e.next=49,x.a.send({"@type":"getLoginUrlInfo",chat_id:r,message_id:o,button_id:v}).catch(e=>{E=!0}).finally(()=>{t.setState({loading:!1})});case 49:if(f=e.sent,!E){e.next=54;break}Object(Q.A)(b,{punycode:!1,ask:!0,tryTelegraph:!0}),e.next=64;break;case 54:e.t1=f["@type"],e.next="loginUrlInfoOpen"===e.t1?57:"loginUrlInfoRequestConfirmation"===e.t1?60:64;break;case 57:return b=f.url,S=f.skip_confirm,Object(Q.A)(b,{punycode:!1,ask:!S,tryTelegraph:!0}),e.abrupt("break",64);case 60:return b=f.url,console.log("[login] result",f),Object(Q.B)(b,{result:f,chatId:r,messageId:o,buttonId:v}),e.abrupt("break",64);case 64:return e.abrupt("break",81);case 65:if(y=l.in_current_chat,M=l.query,d=ee.a.get(r,o)){e.next=69;break}return e.abrupt("break",81);case 69:if(h=d.sender,u=d.via_bot_user_id,I=h.user_id,0!==u&&(I=u),U=te.a.get(I)){e.next=75;break}return e.abrupt("break",81);case 75:return k="@".concat(U.username," ").concat(M),y?Object(Q.w)(k):Object(ka.c)({switchInline:k}),e.abrupt("break",81);case 78:return b=l.url,Object(Q.A)(b,{punycode:!1,ask:!0,tryTelegraph:!0}),e.abrupt("break",81);case 81:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}getIcon(e){switch(e["@type"]){case"inlineKeyboardButtonTypeBuy":return null;case"inlineKeyboardButtonTypeCallback":case"inlineKeyboardButtonTypeCallbackGame":case"inlineKeyboardButtonTypeCallbackWithPassword":return null;case"inlineKeyboardButtonTypeLoginUrl":return o.a.createElement($l,{className:"keyboard-button-icon"});case"inlineKeyboardButtonTypeSwitchInline":return!e.in_current_chat&&o.a.createElement(ec,{className:"keyboard-button-icon"});case"inlineKeyboardButtonTypeUrl":return o.a.createElement($l,{className:"keyboard-button-icon"})}}render(){const e=this.props,t=e.text,a=e.type,n=this.state.loading,s=this.getIcon(a);return o.a.createElement(me.a,{className:"keyboard-button",button:!0,onClick:this.handleClick},t,s,n&&o.a.createElement(ca,{className:"keyboard-button-progress",viewBox:"0 0 14 14"}))}}var ac=function(e){class t extends o.a.Component{render(){return o.a.createElement(Xl.Consumer,null,t=>o.a.createElement(e,Object.assign({chatId:t?t.chatId:0,messageId:t?t.messageId:0},this.props)))}}return t.displayName="WithMessage(".concat(Object(d.b)(e),")"),t}(tc);a(597);class nc extends o.a.Component{render(){const e=this.props.row;return e&&e.length?o.a.createElement("div",{className:"keyboard-row"},e.map((e,t)=>o.a.createElement(ac,{key:t,text:e.text,type:e.type}))):null}}var sc=nc;a(598);class ic extends o.a.Component{constructor(...e){super(...e),this.state={}}static getDerivedStateFromProps(e,t){const a=t.prevChatId,n=t.prevMessageId,s=e.chatId,i=e.messageId;return a!==s&&n!==i?{prevChatId:s,prevMessageId:i,message:{chatId:s,messageId:i}}:null}render(){const e=this.props.markup,t=this.state.message;if(!e)return null;if("replyMarkupInlineKeyboard"!==e["@type"])return null;const a=e.rows;return a.length?o.a.createElement("div",{className:"reply-markup"},o.a.createElement(Ql.Provider,{value:t},a.map((e,t)=>o.a.createElement(sc,{key:t,row:e})))):null}}var rc=ic,oc=a(245),lc=a(107),cc=a(156),dc=a(218);a(599);class hc extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.getMedia=()=>{const e=this.props,t=e.chatId,a=e.messageId,n=e.size,s=(e.displaySize,e.displaySmallSize),i=e.displayExtraSmallSize,r=e.openMedia,l=ee.a.get(t,a);if(!l)return null;const c=l.content;if(!c)return null;const d=c.web_page;if(!d)return null;const h=d.site_name,p=d.title,m=d.description,g=(d.url,d.photo),f=d.animation,C=d.video,b=d.audio,v=d.document,E=d.voice_note,S=d.video_note,y=d.sticker,I=d.type;if(y)return[null,o.a.createElement(cc.b,{chatId:t,messageId:a,sticker:y,openMedia:r,source:cc.a.MESSAGE})];if(E)return[null,o.a.createElement(tl.a,{chatId:t,messageId:a,voiceNote:E,openMedia:r})];if(S)return[null,o.a.createElement(dc.a,{chatId:t,messageId:a,videoNote:S,openMedia:r})];if(b)return[null,o.a.createElement(el.a,{chatId:t,messageId:a,audio:b,openMedia:r})];if(v)return[null,o.a.createElement(Cl.a,{chatId:t,messageId:a,document:v,openMedia:r})];if(f){if(Object(W.m)(f.animation)||f.thumbnail)return[null,o.a.createElement(lc.a,{stretch:!0,chatId:t,messageId:a,animation:f,openMedia:r})]}if(C&&C.thumbnail)return[null,o.a.createElement(Nl.a,{stretch:!0,chatId:t,messageId:a,video:C,openMedia:r})];if(g){const e=Object(M.p)(g.sizes,n),l=("article"===I||"photo"===I||"telegram_megagroup"===I||"telegram_channel"===I)&&(h||p||m&&m.text.length>0)&&e&&(e.width===e.height||Math.max(e.width,e.height)<u.K);let c=0;h&&(c+=h.length),p&&(c+=p.length),m&&(c+=m.text.length);const d=l&&c<50,f=l||d?{float:"right",marginLeft:6}:{};return[l?o.a.createElement(_l.a,{displaySize:d?i:s,style:f,chatId:t,messageId:a,photo:g,openMedia:r}):null,l?null:o.a.createElement(_l.a,{stretch:!0,chatId:t,messageId:a,photo:g,openMedia:r})]}return[null,null]},this.handleInstantViewClick=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),a.stopPropagation(),n=t.props,i=n.chatId,r=n.messageId,o=ee.a.get(i,r)){e.next=6;break}return e.abrupt("return",null);case 6:if(l=o.content){e.next=9;break}return e.abrupt("return",null);case 9:if(c=l.web_page){e.next=12;break}return e.abrupt("return",null);case 12:cl(c.url);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}getWebPage(){const e=this.props,t=e.chatId,a=e.messageId,n=e.t,s=ee.a.get(t,a);if(!s)return null;const i=s.content;if(!i)return null;const r=i.web_page;if(!r)return null;const l=r.instant_view_version,c=r.site_name;let d=r.description,h=r.title;if("formattedText"===d["@type"])d=Object(tt.o)(d);else if("string"===typeof d&&c&&("twitter"===c.toLowerCase()||"instagram"===c.toLowerCase())){const e=Object(tt.A)("instagram"===c.toLowerCase()?1:2,d,[]),t=(e.text,e.entities);d=Object(tt.o)({"@type":"formattedText",text:d,entities:t})}const p=o.a.createElement(o.a.Fragment,null,c&&o.a.createElement("div",{className:"web-page-site-name"},c),h&&o.a.createElement("div",{className:"web-page-title"},h),d&&o.a.createElement("div",{className:"web-page-description"},d)),u=this.getMedia(),m=Object(L.a)(u,2),g=m[0],f=m[1],C=l>0&&o.a.createElement(N.a,{variant:"outlined",color:"primary",classes:{outlinedPrimary:"message-control",disabled:"message-control-disabled"},fullWidth:!0,onClick:this.handleInstantViewClick,className:"web-page-button"},o.a.createElement(oc.a,null,o.a.createElement("path",{d:"M10.5159727,16.7438514 C10.1741929,18.1203636 10.687342,18.4055299 11.6053255,17.4005852 L15.4613785,12.9698209 C16.3535455,11.8808642 16.1300862,11.0059438 14.8452805,10.7872179 L12.9861121,10.4429102 L12.9861121,10.4429102 C12.8775019,10.4227962 12.8057616,10.3184447 12.8258756,10.2098345 C12.8265392,10.2062511 12.8273007,10.2026864 12.8281591,10.1991446 L13.5436135,7.24719783 C13.8863521,5.8619451 13.3150978,5.61107807 12.4582164,6.59275159 C11.2270125,7.98097123 10.2913754,9.02966176 9.65130514,9.73882318 C9.42814828,9.98606827 9.06894462,10.3719875 8.57369417,10.8965808 C7.48829706,12.1010165 8.05955136,12.9745105 9.31498713,13.1932365 L11.0917769,13.5117472 L11.0917769,13.5117472 C11.2005008,13.5312372 11.2728391,13.6351751 11.253349,13.743899 C11.2525988,13.7480841 11.2517153,13.7522442 11.2506999,13.756373 L10.5159727,16.7438514 Z"})),n("InstantView"));return o.a.createElement(o.a.Fragment,null,g,p,f,C)}render(){const e=this.props.meta;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"web-page"},o.a.createElement("div",{className:"border"}),o.a.createElement("div",{className:"web-page-wrapper"},this.getWebPage())),e)}}hc.defaultProps={size:u.K,displaySize:u.I,displaySmallSize:u.J,displayExtraSmallSize:u.H};var pc=Object(_.a)()(hc);a(600);class uc extends r.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onClientUpdateMessageShake=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=this.state.shook;a===e.chatId&&n===e.messageId&&(s?this.setState({shook:!1},()=>{setTimeout(()=>{this.setState({shook:!0})},0)}):this.setState({shook:!0}))},this.onClientUpdateMessageHighlighted=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n===e.messageId?r?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):r&&this.setState({highlighted:!1}))},this.onClientUpdateMessageSelected=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=e.selected;a===e.chatId&&n===e.messageId&&this.setState({selected:s,highlighted:!1})},this.onUpdateMessageContent=e=>{const t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageId;s===t&&i===a&&(this.updateMessageContent=e,setTimeout(this.handleUpdateMessageContentAndEditedOnce,50))},this.onUpdateMessageEdited=e=>{const t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageId;s===t&&i===a&&(this.updateMessageEdited=e,setTimeout(this.handleUpdateMessageContentAndEditedOnce,50))},this.handleUpdateMessageContentAndEditedOnce=()=>{const e=this.updateMessageContent,t=this.updateMessageEdited;if(this.updateMessageContent=null,this.updateMessageEdited=null,!e&&!t)return;const a=this.props,n=a.chatId,s=a.messageId;let i=!1;if(e){const e=this.state.emojiMatches,t=Object(tt.m)(n,s);t!==e&&(i=!0,this.setState({emojiMatches:t}))}i||(Object(ka.g)(n,s),this.forceUpdate(()=>{Object(ka.h)(n,s)}))},this.handleSelectUser=e=>{Object(Q.m)(e,!0)},this.handleSelectChat=e=>{Object(Q.k)(e,null,!0)},this.handleSelection=()=>{if(!this.mouseDown)return;const e=window.getSelection().toString();if(!Object(tt.L)(e))return;const t=this.props,a=t.chatId,n=t.messageId,s=!ee.a.selectedItems.has("chatId=".concat(a,"_messageId=").concat(n));Object(Q.r)(a,n,s)},this.handleDateClick=e=>{e.preventDefault(),e.stopPropagation();const t=this.props,a=t.chatId,n=t.messageId;if(Object(F.f)(a))return void Object(Q.n)(a,n);Object(tt.d)(a,n)&&Object(Q.h)(a,[n])},this.openMedia=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=this.props,a=t.chatId,n=t.messageId;Object(tt.U)(a,n)},this.handleAnimationEnd=()=>{this.setState({highlighted:!1})},this.handleMouseDown=()=>{this.mouseDown=!0},this.handleMouseOver=()=>{this.mouseDown=!1},this.handleMouseOut=()=>{this.mouseOut=!1},this.handleReplyClick=()=>{const e=this.props,t=e.chatId,a=e.messageId;Object(Q.l)(t,a)},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),!t.state.contextMenu){e.next=6;break}t.setState({contextMenu:!1}),e.next=12;break;case 6:if(!(ee.a.selectedItems.size>1)){e.next=8;break}return e.abrupt("return");case 8:n=a.clientX,i=a.clientY,r=a.target&&"A"===a.target.tagName&&a.target.href?a.target.href:null,t.setState({contextMenu:!0,copyLink:r,left:n,top:i});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})};const a=this.props,n=a.chatId,r=a.messageId;this.state={message:ee.a.get(n,r),emojiMatches:Object(tt.m)(n,r),selected:!1,highlighted:!1,shook:!1,contextMenu:!1,copyLink:null,left:0,top:0}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId,i=a.sendingState,r=a.showUnreadSeparator,o=a.showTail,l=a.showTitle,c=this.state,d=c.contextMenu,h=c.selected,p=c.highlighted,u=c.shook,m=c.emojiMatches;return e.chatId!==n||(e.messageId!==s||(e.sendingState!==i||(e.showUnreadSeparator!==r||(e.showTail!==o||(e.showTitle!==l||(t.contextMenu!==d||(t.selected!==h||(t.highlighted!==p||(t.shook!==u||t.emojiMatches!==m)))))))))}componentDidMount(){ee.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateMessageShake",this.onClientUpdateMessageShake),ee.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.on("updateMessageContent",this.onUpdateMessageContent),ee.a.on("updateMessageEdited",this.onUpdateMessageEdited)}componentWillUnmount(){ee.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateMessageShake",this.onClientUpdateMessageShake),ee.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),ee.a.off("updateMessageContent",this.onUpdateMessageContent),ee.a.off("updateMessageEdited",this.onUpdateMessageEdited)}render(){let e=this.props.showTail;const t=this.props,a=t.t,n=t.chatId,s=t.messageId,i=t.showUnreadSeparator,r=t.showTitle,l=t.showDate,d=t.source,h=this.state,p=h.emojiMatches,u=h.selected,m=h.highlighted,g=h.shook,f=h.copyLink,C=h.contextMenu,b=h.left,v=h.top,E=ee.a.get(n,s);if(!E)return o.a.createElement("div",null,"[empty message]");const S=E.content,y=E.is_outgoing,M=E.date,I=E.reply_to_message_id,U=E.forward_info,k=E.sender,x=E.reply_markup,w=y&&!Object(F.V)(n),O=o.a.createElement(Ll,{className:"meta-hidden",key:"".concat(n,"_").concat(s,"_meta"),chatId:n,messageId:s}),L=o.a.createElement(Ll,{className:c()("meta-text",{"meta-bubble":Object(tt.Q)(n,s)}),chatId:n,messageId:s,onDateClick:this.handleDateClick}),_=Object(tt.D)(E),N=Object(tt.y)(E,_?null:O,a,{chatId:n,messageId:s}),j=null!==N&&N.length>0,P=Object(tt.W)(n,s),T=Boolean(I),R=Object(F.hb)(n)&&!(Object(F.gb)(n)&&!w)||Object(F.fb)(n)&&w,A=!R&&r||P||T,B=Object(Qe.e)(E,this.openMedia,{hasTitle:A,hasCaption:j,inlineMeta:O,meta:L}),H=Object(F.V)(n),V=Object(F.hb)(n);let z=null;if(e)if(Object(F.gb)(n)&&U)switch(U.origin["@type"]){case"messageForwardOriginHiddenUser":z=o.a.createElement(Cn.a,{small:!0,firstName:U.origin.sender_name,onSelect:this.handleSelectUser});break;case"messageForwardOriginUser":z=o.a.createElement(Cn.a,{small:!0,userId:U.origin.sender_user_id,onSelect:this.handleSelectUser});break;case"messageForwardOriginChannel":z=o.a.createElement(D.a,{small:!0,chatId:U.origin.chat_id,onSelect:this.handleSelectChat})}else z=V||H||y?o.a.createElement(Wl,{small:!0}):k.user_id?o.a.createElement(Cn.a,{small:!0,userId:k.user_id,onSelect:this.handleSelectUser}):o.a.createElement(D.a,{small:!0,chatId:n,onSelect:this.handleSelectChat});const W=Object(tt.s)(n,s),G="messageSticker"!==S["@type"]&&"messageVideoNote"!==S["@type"],Z=!j&&("messageAnimation"===S["@type"]||"messageVideo"===S["@type"]||"messagePhoto"===S["@type"]||"messageInvoice"===S["@type"]&&S.photo)||x&&"replyMarkupInlineKeyboard"===x["@type"];return o.a.createElement("div",null,l&&o.a.createElement(Rl,{date:M}),o.a.createElement("div",{className:c()("message",{"message-rounded":r&&e&&Z,"message-short":!z,"message-out":w,"message-selected":u,"message-highlighted":m&&!u,"message-group-title":r&&!e,"message-group":!r&&!e,"message-group-tail":!r&&e&&!Z,"message-group-tail-rounded":!r&&e&&Z,"message-bubble-hidden":!G}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},i&&o.a.createElement(zl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(fl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:g})},z,o.a.createElement("div",null,o.a.createElement("div",{className:c()("message-content",{"message-bubble":G,"message-bubble-out":G&&w}),style:W},G&&(r&&!R||P)&&o.a.createElement("div",{className:"message-title"},r&&!P&&o.a.createElement(pt.a,{sender:k,forwardInfo:U,openChat:!0,openUser:!0}),P&&o.a.createElement(Fl,{forwardInfo:U})),T&&o.a.createElement(_r,{chatId:n,messageId:I,onClick:this.handleReplyClick}),B,o.a.createElement("div",{className:c()("message-text",{"message-text-1emoji":1===p,"message-text-2emoji":2===p,"message-text-3emoji":3===p})},N),_&&o.a.createElement(pc,{chatId:n,messageId:s,openMedia:this.openMedia,meta:O}),G&&L),x&&o.a.createElement(rc,{chatId:n,messageId:s,markup:x})),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))),o.a.createElement(Ul,{chatId:n,messageId:s,anchorPosition:{top:v,left:b},open:C,onClose:this.handleCloseContextMenu,copyLink:f,source:d}))}}uc.defaultProps={sendingState:null,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showDate:!1};var mc=Object(_.a)(["translation","local"],{withRef:!0})(uc);a(601);const gc={width:96,height:96,borderRadius:"50%",margin:"0 auto 5px"};class fc extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateMessageHighlighted=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n===e.messageId?r?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):r&&this.setState({highlighted:!1}))},this.handleAnimationEnd=()=>{this.setState({highlighted:!1})},this.openMedia=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=this.props,a=t.chatId,n=t.messageId;Object(tt.U)(a,n)},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),!t.state.contextMenu){e.next=6;break}t.setState({contextMenu:!1}),e.next=12;break;case 6:if(!(ee.a.selectedItems.size>1)){e.next=8;break}return e.abrupt("return");case 8:n=a.clientX,i=a.clientY,r=a.target&&"A"===a.target.tagName&&a.target.href?a.target.href:null,t.setState({contextMenu:!0,copyLink:r,left:n,top:i});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})};const a=this.props,n=a.chatId,r=a.messageId;this.state={message:ee.a.get(n,r),highlighted:!1,contextMenu:!1}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId,i=a.sendingState,r=a.showUnreadSeparator,o=a.t,l=this.state,c=l.highlighted,d=l.contextMenu;return e.t!==o||(e.chatId!==n||(e.messageId!==s||(e.sendingState!==i||(e.showUnreadSeparator!==r||(t.highlighted!==c||t.contextMenu!==d)))))}componentDidMount(){ee.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted)}componentWillUnmount(){ee.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=e.showUnreadSeparator,s=e.showDate,i=this.state,r=i.highlighted,l=i.contextMenu,d=i.left,h=i.top,p=ee.a.get(t,a);if(!p)return null;const u=p.content,m=p.date;if(!u)return null;if("messageChatUpgradeTo"===u["@type"])return null;const g=u.photo,f=Object(Ml.a)(p,!0);return o.a.createElement("div",null,s&&o.a.createElement(Rl,{date:m}),o.a.createElement("div",{className:c()("service-message",{"message-highlighted":r}),onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},n&&o.a.createElement(zl,null),o.a.createElement("div",{className:"service-message-wrapper"},o.a.createElement("div",{className:"service-message-content"},o.a.createElement("div",null,f))),g&&o.a.createElement(_l.a,{chatId:t,messageId:a,photo:g,displaySize:96,style:gc,openMedia:this.openMedia})),o.a.createElement(Ul,{chatId:t,messageId:a,anchorPosition:{top:h,left:d},open:l,onClose:this.handleCloseContextMenu,copyLink:null,source:"chat"}))}}fc.defaultProps={showTitle:!1,showTail:!1,showUnreadSeparator:!1};var Cc=Object(d.a)(Object(d.d)(),Object(_.a)(),Object(d.c)())(fc);a(602);class bc extends o.a.Component{constructor(e){super(e),this.onClientUpdateCacheLoaded=e=>{const t=ae.a.cacheLoaded;this.setState({cacheLoaded:t})},this.onClientUpdateChatId=e=>{const t=e.nextChatId;this.setState({chatId:t})},this.onClientUpdateDialogsReady=e=>{const t=ae.a.dialogsReady;this.setState({dialogsReady:t})};const t=ae.a.chatId,a=ae.a.dialogsReady,n=ae.a.cacheLoaded;this.state={chatId:t,dialogsReady:a,cacheLoaded:n}}shouldComponentUpdate(e,t,a){return t.chatId!==this.state.chatId||(t.dialogsReady!==this.state.dialogsReady||(t.cacheLoaded!==this.state.cacheLoaded||e.t!==this.props.t))}componentDidMount(){ae.a.on("clientUpdateChatId",this.onClientUpdateChatId),ae.a.on("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),ae.a.on("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded)}componentWillUnmount(){ae.a.off("clientUpdateChatId",this.onClientUpdateChatId),ae.a.off("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),ae.a.off("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded)}render(){const e=this.props,t=e.t,a=(e.force,this.state),n=a.chatId;a.dialogsReady,a.cacheLoaded;return n?null:o.a.createElement("div",{className:"placeholder"},o.a.createElement("div",{className:"placeholder-wrapper"},o.a.createElement("div",{className:"placeholder-meta"},t("SelectChatToStartMessaging"))))}}var vc=Object(_.a)()(bc),Ec=a(604),Sc=a.n(Ec);a(603);class yc extends o.a.Component{render(){const e=this.props.onClick;return o.a.createElement("div",{className:"scroll-down-button"},o.a.createElement(j.a,{disableRipple:!0,onMouseDown:e},o.a.createElement(Sc.a,null)))}}var Mc=yc,Ic=a(437);a(605);class Uc extends o.a.Component{constructor(e){super(e),this.onClientUpdateRemoteStickersHint=e=>{const t=e.hint,a=this.state.hint;if(a&&t.timestamp!==a.timestamp)return;this.setState({hint:Wr.a.hint,items:this.getItems(Wr.a.hint)});const n=U.a.getStore(),s=t.stickers;Object(W.I)(n,s.stickers)},this.onClientUpdateLocalStickersHint=e=>{const t=e.hint;if(this.setState({hint:t,items:this.getItems(t),previewStickerId:0,showPreview:!1,cancelSend:!1}),!t)return;const a=U.a.getStore(),n=t.stickers;Object(W.I)(a,n.stickers)},this.handleSend=e=>{this.state.cancelSend||e&&x.a.clientUpdate({"@type":"clientUpdateStickerSend",sticker:e})},this.loadPreviewContent=e=>{const t=this.state.items,a=t.find(t=>t.sticker.id===e);if(!a)return;const n=U.a.getStore();Object(W.F)(n,a,null);let s=8;this.hintsRef&&this.hintsRef.current&&(s=Math.floor(this.hintsRef.current.clientWidth/u.Cb));this.getNeighborStickers(e,t,s).forEach(e=>{Object(W.F)(n,e,null)})},this.getNeighborStickers=(e,t,a)=>{if(!t)return[];const n=[],s=t.findIndex(t=>t.sticker.id===e);if(-1===s)return[];const i=Math.floor(s/a),r=s%a,o=i-1,l=i+1,c=r-1,d=r+1;return o>=0&&(c>=0&&n.push(a*o+c),n.push(a*o+r),d<a&&n.push(a*o+d)),c>=0&&n.push(a*i+c),d<a&&n.push(a*i+d),l<Math.ceil(t.length/a)&&(c>=0&&n.push(a*l+c),n.push(a*l+r),d<a&&n.push(a*l+d)),n.map(e=>t[e])},this.handleMouseEnter=e=>{const t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);a&&this.mouseDown&&(this.mouseDownStickerId!==t&&(this.mouseDownStickerId=null),this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t))},this.handleMouseDown=e=>{const t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);if(!a)return;this.mouseDownStickerId=t;const n=Date.now();return this.setState({sticker:a,timestamp:n,showPreview:!1,cancelSend:!1}),setTimeout(()=>{this.state.timestamp===n&&(this.setState({showPreview:!0,cancelSend:!0}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}))},500),this.loadPreviewContent(t),this.mouseDown=!0,document.addEventListener("mouseup",this.handleMouseUp),e.preventDefault(),e.stopPropagation(),!1},this.handleMouseUp=()=>{this.setState({sticker:null,timestamp:0,showPreview:!1}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:null}),this.mouseDown=!1,document.removeEventListener("mouseup",this.handleMouseUp)},this.getItems=e=>{const t=[];if(!e)return t;const a=new Map,n=e.stickers,s=e.foundStickers;return n&&n.stickers.forEach(e=>{t.push(e),a.set(e.sticker.id,e.sticker.id)}),s&&s.stickers.forEach(e=>{a.has(e.sticker.id)||(t.push(e),a.set(e.sticker.id,e.sticker.id))}),t},this.hintsRef=o.a.createRef(),this.state={hint:null,items:[],previewStickerId:0,showPreview:!1,cancelSend:!1}}componentDidMount(){Wr.a.on("clientUpdateLocalStickersHint",this.onClientUpdateLocalStickersHint),Wr.a.on("clientUpdateRemoteStickersHint",this.onClientUpdateRemoteStickersHint)}componentWillUnmount(){Wr.a.off("clientUpdateLocalStickersHint",this.onClientUpdateLocalStickersHint),Wr.a.off("clientUpdateRemoteStickersHint",this.onClientUpdateRemoteStickersHint)}getSticker(e){const t=this.state.items,a=t.findIndex(t=>t.sticker.id===e);return-1!==a?t[a]:null}render(){const e=this.state,t=e.hint,a=e.items,n=e.sticker,s=e.showPreview;if(!t)return null;if(!a)return null;if(!a.length)return null;const i=a.map(e=>o.a.createElement("div",{className:"sticker-set-dialog-item",key:e.sticker.id,"data-sticker-id":e.sticker.id,style:{width:u.Cb,height:u.Cb},onClick:()=>this.handleSend(e),onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown},o.a.createElement(cc.b,{key:e.sticker.id,className:"sticker-set-dialog-item-sticker",sticker:e,autoplay:!1,blur:!1,displaySize:u.Eb,preview:!0,source:cc.a.HINTS})));return o.a.createElement("div",{ref:this.hintsRef,className:"stickers-hint scrollbars-hidden"},i,Boolean(n)&&s&&o.a.createElement(Ic.a,{sticker:n}))}}var kc=Uc;a(606);const xc=Object.freeze({SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",SCROLL_TO_MESSAGE:"SCROLL_TO_MESSAGE",SCROLL_TO_POSITION:"SCROLL_TO_POSITION",KEEP_SCROLL_POSITION:"KEEP_SCROLL_POSITION",NONE:"NONE"});class wc extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateStartMessageEditing=e=>{const t=e.chatId,a=e.messageId;if(this.props.chatId!==t)return;const n=this.state.history;if(!n.length)return;const s=this.listRef.current;s.offsetHeight+s.scrollTop<s.scrollHeight||n.some(e=>e.chat_id===t&&e.id===a)&&(this.scrollBottomAfterEditing={chatId:t,messageId:a})},this.onClientUpdateStopMessageEditing=e=>{const t=e.chatId,a=e.messageId;if(this.props.chatId!==t)return;const n=this.scrollBottomAfterEditing;if(!n)return;if(t!==n.chatId)return;if(a!==n.messageId)return;const s=this.listRef.current;s.scrollTop=s.scrollHeight-s.offsetHeight,this.scrollBottomAfterEditing=null},this.onUpdateMessageIsPinned=e=>{const t=e.chat_id,a=e.message_id,n=e.is_pinned,s=this.props,i=s.chatId,r=s.filter;if(i===t&&r)if(n){const e=ee.a.get(t,a),n=this.listRef.current;let s=e.is_outgoing&&!Object(Ml.b)(e)?xc.SCROLL_TO_BOTTOM:xc.NONE;n.scrollTop+n.offsetHeight>=n.scrollHeight&&(s=xc.SCROLL_TO_BOTTOM);const i=e.is_outgoing?{scrollDownVisible:!1}:{},r=[e];this.scrollBehaviorNone=!0,this.insert(r,i,()=>{this.scrollBehaviorNone=!1,this.handleScrollBehavior(s,this.snapshot)});const o=U.a.getStore();Object(W.B)(o,r),this.viewMessages(r)}else{this.deleteHistory([a]);const e=ee.a.getMedia(i);e&&!e.pinned.length&&Object(Q.d)()}},this.onKeyDown=e=>{},this.onClientUpdateTryEditMessage=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasLastMessage()){e.next=11;break}n=t.state.history,i=n.length-1;case 3:if(!(i>=0)){e.next=11;break}if(r=n[i],!Object(tt.c)(r.chat_id,r.id)){e.next=8;break}return Object(Q.f)(r.chat_id,r.id),e.abrupt("return");case 8:i--,e.next=3;break;case 11:return e.next=13,x.a.send({"@type":"searchChatMessages",chat_id:t.props.chatId,query:"",sender_user_id:te.a.getMyId(),from_message_id:0,offset:0,limit:100,filter:{"@type":"searchMessagesFilterEmpty"}});case 13:o=e.sent,i=0;case 15:if(!(i<o.messages.length)){e.next=23;break}if(r=o.messages[i],!Object(tt.c)(r.chat_id,r.id)){e.next=20;break}return Object(Q.f)(r.chat_id,r.id),e.abrupt("return");case 20:i++,e.next=15;break;case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateDialogsReady=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.list){e.next=3;break}return e.abrupt("return");case 3:if("chatListMain"===n["@type"]){e.next=5;break}return e.abrupt("return");case 5:if(!((r=t.state.history)&&r.length>0)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,U.a.initDB(Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,!n){e.next=18;break}if(!(r=Se.a.get(n))){e.next=18;break}o=r.type,e.t0=o["@type"],e.next="chatTypePrivate"===e.t0||"chatTypeSecret"===e.t0?8:"chatTypeBasicGroup"===e.t0?11:"chatTypeSupergroup"===e.t0?14:17;break;case 8:return e.next=10,x.a.send({"@type":"createPrivateChat",user_id:o.user_id,force:!1});case 10:return e.abrupt("break",17);case 11:return e.next=13,x.a.send({"@type":"createBasicGroupChat",basic_group_id:o.basic_group_id,force:!1});case 13:return e.abrupt("break",17);case 14:return e.next=16,x.a.send({"@type":"createSupergroupChat",supergroup_id:o.supergroup_id,force:!1});case 16:return e.abrupt("break",17);case 17:t.handleSelectChat(n,0,i,0);case 18:case"end":return e.stop()}}),e)}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateFocusWindow=e=>{e.focused&&(this.defferedActions.forEach(e=>e()),this.defferedActions=[])},this.onClientUpdateOpenReply=e=>{const t=e.chatId,a=e.messageId,n=this.state.replyHistory;if(this.props.chatId!==t)return;const s=n.length>0?n[n.length-1]:null;s&&s.chatId===t&&s.messageId===a||n.push({chatId:t,messageId:a})},this.onClientUpdateMediaActive=e=>{const t=this.listRef.current,a=t.offsetHeight,n=t.scrollTop;this.setState({playerOpened:!0},()=>{t.scrollTop===n&&(t.scrollTop+=Math.abs(a-t.offsetHeight))})},this.onClientUpdateMediaEnding=e=>{const t=this.listRef.current;this.prevOffsetHeight=t.offsetHeight,this.prevScrollTop=t.scrollTop},this.onClientUpdateMediaEnd=e=>{const t=this.listRef.current;this.setState({playerOpened:!1},()=>{t.scrollTop===this.prevScrollTop&&(t.scrollTop-=Math.abs(this.prevOffsetHeight-t.offsetHeight))})},this.onClientUpdateSelection=e=>{this.setState({selectionActive:ee.a.selectedItems.size>0})},this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&this.setState({clearHistory:e.inProgress})},this.onUpdateMessageContent=e=>{const t=this.props.chatId,a=this.state.history,n=e.chat_id,s=e.message_id;if(t===n&&-1!==a.findIndex(e=>e.id===s)){const e=ee.a.get(n,s);if(!e)return;const t=U.a.getStore();Object(W.B)(t,[e])}},this.onUpdateMessageSendSucceeded=e=>{const t=e.message,a=e.old_message_id;if(this.props.chatId!==t.chat_id)return;const n=t.is_outgoing?xc.SCROLL_TO_BOTTOM:xc.KEEP_SCROLL_POSITION;this.replaceMessage(a,t,()=>{n!==xc.KEEP_SCROLL_POSITION&&this.handleScrollBehavior(n,this.snapshot),this.updateItemsInView()});const s=U.a.getStore();Object(W.B)(s,[t]),this.viewMessages([t])},this.onUpdateNewMessage=e=>{if(!this.hasLastMessage())return;const t=e.message;if(this.props.chatId!==t.chat_id)return;if(0===t.date)return;const a=this.listRef.current;let n=t.is_outgoing&&!Object(Ml.b)(t)?xc.SCROLL_TO_BOTTOM:xc.NONE;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(n=xc.SCROLL_TO_BOTTOM);const s=t.is_outgoing?{scrollDownVisible:!1}:{},i=[t];this.scrollBehaviorNone=!0,this.insertPrevious(i,s,()=>{this.scrollBehaviorNone=!1,this.handleScrollBehavior(n,this.snapshot)});const r=U.a.getStore();Object(W.B)(r,i),this.viewMessages(i)},this.onUpdateDeleteMessages=e=>{const t=this.props.chatId,a=e.chat_id,n=e.is_permanent,s=e.message_ids;t===a&&n&&this.deleteHistory(s)},this.loadIncompleteHistory=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=5,r=t.isCompleteHistory(a,u.x),o=0;case 3:if(!(o<i)||r){e.next=11;break}return e.next=6,t.onLoadNext();case 6:a=e.sent,r=t.isCompleteHistory(a,u.x);case 8:o++,e.next=3;break;case 11:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.isCompleteHistory=(e,t)=>!!e&&(!e.messages.length||e.messages.length>=t),this.onLoadNext=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,i=t.sessionId,a){e.next=5;break}return e.abrupt("return");case 5:if(!i.loading){e.next=7;break}return e.abrupt("return");case 7:if(!i.loadMigratedHistory){e.next=11;break}return e.next=10,t.onLoadMigratedHistory();case 10:return e.abrupt("return",e.sent);case 11:if(r=n&&n.length>0?n[0].id:0,o=n.length<u.x?2*u.x:u.x,l=null,c="".concat(a,"_").concat(r),!t.lastRequests.has(c)){e.next=19;break}l=t.lastRequests.get("".concat(a,"_").concat(r)),e.next=23;break;case 19:return i.loading=!0,e.next=22,t.getRequest(a,r,0,o).finally(()=>{i.loading=!1});case 22:l=e.sent;case 23:if(i===t.sessionId){e.next=25;break}return e.abrupt("return");case 25:return l.messages.length||t.lastRequests.set(c,l),ee.a.setItems(l.messages),l.messages.reverse(),t.insertNext(l.messages,e=>{l.messages.length>0&&(t.handleScrollBehavior(xc.KEEP_SCROLL_POSITION,t.snapshot),setTimeout(()=>{const e=t.state.history;e.length>=3*u.x&&t.setState({history:e.slice(0,3*u.x)})},100)),l.messages.length||t.onLoadMigratedHistory()}),d=U.a.getStore(),Object(W.B)(d,l.messages),t.viewMessages(l.messages),e.abrupt("return",l);case 33:case"end":return e.stop()}}),e)}))),this.onLoadMigratedHistory=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,i=t.sessionId,a){e.next=5;break}return e.abrupt("return");case 5:if(r=Object(F.M)(a)){e.next=8;break}return e.abrupt("return");case 8:if(o=Ue.a.getFullInfo(r)){e.next=13;break}return e.next=12,Object(F.n)(a);case 12:o=e.sent;case 13:if(o.upgraded_from_basic_group_id){e.next=15;break}return e.abrupt("return");case 15:return i.loadMigratedHistory=!0,e.next=18,x.a.send({"@type":"createBasicGroupChat",basic_group_id:o.upgraded_from_basic_group_id});case 18:if(l=e.sent){e.next=21;break}return e.abrupt("return");case 21:if(!i.loading){e.next=23;break}return e.abrupt("return");case 23:return c=n.length>0&&n[0].chat_id===l.id?n[0].id:0,d=0===c?2*u.x:u.x,i.loading=!0,e.next=28,t.getRequest(l.id,c,0,d).finally(()=>{i.loading=!1});case 28:if(h=e.sent,i===t.sessionId){e.next=31;break}return e.abrupt("return");case 31:return ee.a.setItems(h.messages),h.messages.reverse(),t.insertNext(h.messages,e=>{h.messages.length>0&&t.handleScrollBehavior(xc.KEEP_SCROLL_POSITION,t.snapshot),t.loadIncompleteHistory(h,d)}),p=U.a.getStore(),Object(W.B)(p,h.messages),t.viewMessages(h.messages),e.abrupt("return",h);case 38:case"end":return e.stop()}}),e)}))),this.onLoadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,i=t.sessionId,Se.a.get(a)){e.next=6;break}return e.abrupt("return");case 6:if(!i.loading){e.next=8;break}return e.abrupt("return");case 8:if(!t.hasLastMessage()){e.next=10;break}return e.abrupt("return");case 10:return r=n&&n.length>0?n[n.length-1].id:0,o=n.length<u.x?2*u.x:u.x,i.loading=!0,e.next=15,t.getRequest(a,r,1-o,o).finally(()=>{i.loading=!1});case 15:if(l=e.sent,i===t.sessionId){e.next=18;break}return e.abrupt("return");case 18:return Object(tt.f)(l,t.state.history),ee.a.setItems(l.messages),l.messages.reverse(),t.scrollBehaviorNone=!0,t.insertPrevious(l.messages,{},()=>{t.scrollBehaviorNone=!1,l.messages.length>0&&setTimeout(()=>{const e=t.state.history;e.length>3*u.x&&t.setState({history:e.slice(e.length-3*u.x)},()=>{t.handleScrollBehavior(xc.KEEP_SCROLL_POSITION,t.snapshot)})},0)}),c=U.a.getStore(),Object(W.B)(c,l.messages),t.viewMessages(l.messages),e.abrupt("return",l);case 27:case"end":return e.stop()}}),e)}))),this.updateItemsInView=()=>{if(!this.messages)return null;const e=[],t=new Map,a=Object(M.x)(this.listRef,this.itemsRef);for(let n=0;n<a.length;n++){const s=this.messages[a[n]];if(s){const a=s.props,n=a.chatId,i=a.messageId,r=a.messageIds;if(i){const a="".concat(n,"_").concat(i);t.set(a,a),e.push({chatId:n,messageId:i})}else if(r)for(let s=0;s<r.length;s++){const a="".concat(n,"_").concat(r[s]);t.set(a,a),e.push({chatId:n,messageId:r[s]})}}}return Object(M.y)(this.inViewMap,t)?null:(x.a.clientUpdate({"@type":"clientUpdateMessagesInView",messages:t}),this.inViewMap=t,e)},this.updatePinnedMessage=e=>{const t=this.props,a=t.chatId;if(t.filter)return;if(null===this.prevScrollTop)return;const n=ee.a.getMedia(a);if(!n)return;if(!n.pinned)return;if(n.pinned.length<=1)return;const s=[],i=Object(M.x)(this.listRef,this.itemsRef);for(let h=0;h<i.length;h++){const e=this.messages[i[h]];if(e){const t=e.props,a=t.chatId,n=t.messageId,i=t.messageIds;if(n)s.push({chatId:a,messageId:n});else if(i)for(let e=0;e<i.length;e++)s.push({chatId:a,messageId:i[e]})}}if(!s)return;if(s.length<=1)return;const r=s[0].messageId,o=s[s.length-1].messageId;let l=0;for(let h=0;h<n.pinned.length;h++){const e=n.pinned[h];if(e.id>=r&&e.id<=o){l=e.id;break}}if(!l){const e=n.pinned[n.pinned.length-1].id,t=n.pinned[0].id;t<r?l=t:e>o&&(l=e)}const c=ee.a.clickedPinned,d=ee.a.currentPinned;if(l&&(!d||d.chatId===a&&d.id!==l)){if(e&&c&&c.chatId===a&&c.id<l)return;x.a.clientUpdate({"@type":"clientUpdateCurrentPinnedMessage",chatId:a,messageId:l})}},this.updateScrollDownVisibility=()=>{const e=this.state,t=e.scrollDownVisible,a=e.replyHistory,n=e.history,s=this.listRef.current;s.scrollTop+s.offsetHeight>=s.scrollHeight-u.yb?this.hasLastMessage()&&t&&(this.prevScrollTop!==s.scrollTop&&this.prevScrollTop&&this.prevHistory===n?this.setState({scrollDownVisible:!1,replyHistory:[]}):a.length||this.setState({scrollDownVisible:!1})):t||this.setState({scrollDownVisible:!0}),this.prevHistory=n},this.handleScroll=()=>{const e=this.listRef.current,t=this.prevScrollTop>e.scrollTop;this.updateItemsInView(),this.cancelUpdatePinnedMessage||this.updatePinnedMessage(t),this.updateScrollDownVisibility(),null!==this.prevScrollTop&&(t&&e.scrollTop<=u.yb&&this.onLoadNext(),!t&&e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&this.onLoadPrevious()),this.prevScrollTop=e.scrollTop},this.handleScrollBehavior=(e,t,a)=>{const n=this.props,s=(n.chatId,n.messageId,t||{scrollTop:0,scrollHeight:0,offsetHeight:0});s.scrollTop,s.scrollHeight,s.offsetHeight;switch(e){case xc.SCROLL_TO_BOTTOM:this.scrollToBottom();break;case xc.SCROLL_TO_MESSAGE:this.scrollToMessage();break;case xc.SCROLL_TO_UNREAD:this.scrollToUnread();break;case xc.SCROLL_TO_POSITION:this.scrollToPosition(a);break;case xc.KEEP_SCROLL_POSITION:this.keepScrollPosition(t);break;case xc.NONE:}},this.keepScrollPosition=e=>{const t=e.scrollTop,a=e.scrollHeight,n=(e.offsetHeight,this.listRef.current);n.scrollTop=t+(n.scrollHeight-a)},this.scrollToUnread=()=>{const e=this.props,t=e.chatId,a=(e.messageId,this.state.history),n=this.listRef.current;Se.a.get(t);let s=!1;for(let i=0;i<a.length;i++){let e=this.itemsMap.get(i),t=Qo.findDOMNode(e);if(t&&e.props.showUnreadSeparator){n.scrollTop=t.offsetTop-0,s=!0;break}}s||this.scrollToBottom()},this.scrollToPosition=e=>{const t=e.messageId,a=e.offset,n=this.state.history,s=this.listRef.current;let i=!1;for(let r=0;r<n.length;r++){const e=this.itemsMap.get(r),n=Qo.findDOMNode(e);if(n&&e.props.messageId===t){s.scrollTop=n.offsetTop-a,i=!0;break}}},this.scrollToMessage=()=>{const e=this.props,t=e.chatId,a=e.messageId,n=this.state.history,s=this.listRef.current;let i=!1;for(let r=0;r<n.length;r++){const e=this.itemsMap.get(r),t=Qo.findDOMNode(e);if(t&&(e.props.messageId===a||e.props.messageIds&&-1!==e.props.messageIds.indexOf(a))){s.offsetHeight<t.offsetHeight?s.scrollTop=t.offsetTop:s.scrollTop=t.offsetTop-s.offsetHeight/2+t.offsetHeight/2,i=!0;break}}i||this.handleSelectChat(t,t,a,a)},this.scrollToBottom=()=>{const e=this.props,t=(e.chatId,e.messageId,this.listRef.current);t.scrollHeight-t.offsetHeight!==t.scrollTop&&(t.scrollTop=t.scrollHeight-t.offsetHeight)},this.getRequest=(e,t,a,n)=>{const s=this.props.filter;if(s){if(0===t&&0===a&&n===u.x){const t=ee.a.getMedia(e);if(t&&t.pinned&&t.pinned.length>0)return Promise.resolve({"@type":"messages",messages:[...t.pinned]})}return x.a.send({"@type":"searchChatMessages",chat_id:e,from_message_id:t,offset:a,limit:n,filter:s,sender_user_id:null,query:null})}return x.a.send({"@type":"getChatHistory",chat_id:e,from_message_id:t,offset:a,limit:n})},this.scrollToStart=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.props,n=a.chatId,i=a.messageId,r=t.state.history,o=Se.a.get(n),r.some(e=>e.chat_id===n&&o&&o.last_message&&o.last_message.id===e.id)?t.scrollToBottom():t.handleSelectChat(n,n,0,i);case 5:case"end":return e.stop()}}),e)}))),this.handleListDragEnter=e=>{e.preventDefault(),e.stopPropagation();const t=this.props.chatId;Object(F.e)(t)&&e.dataTransfer&&e.dataTransfer.types.some(e=>"Files"===e)&&x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!0,dataTransfer:e.dataTransfer})},this.handleScrollDownClick=e=>{const t=this.state.replyHistory;if(t.length>0){const e=t.pop();if(e){const t=e.chatId,a=e.messageId;t===this.props.chatId&&Object(Q.k)(t,a)}}else this.scrollToStart()},this.lastRequests=new Map,this.sessionId={date:new Date,loading:!1,completed:!1,loadMigratedHistory:!1},this.state={prevChatId:0,prevMessageId:null,playerOpened:!1,history:[],clearHistory:!1,selectionActive:!1,separatorMessageId:0,scrollDownVisible:!1,replyHistory:[]},this.listRef=o.a.createRef(),this.itemsRef=o.a.createRef(),this.scrollDownButtonRef=o.a.createRef(),this.defferedActions=[],this.itemsMap=new Map,this.updateItemsInView=Object(M.C)(this.updateItemsInView,500),this.updatePinnedMessage=Object(M.C)(this.updatePinnedMessage,200)}hasLastMessage(){const e=this.props.chatId,t=this.state.history,a=Se.a.get(e);if(!a)return!1;const n=a.last_message;return!n||t.length>0&&t[t.length-1].id>=n.id}static getDerivedStateFromProps(e,t){return e.chatId!==t.prevChatId||e.messageId!==t.prevMessageId?{prevChatId:e.chatId,prevMessageId:e.messageId,clearHistory:!1,selectionActive:!1,separatorMessageId:e.chatId!==t.prevChatId?0:t.separatorMessageId,scrollDownVisible:e.chatId===t.prevChatId&&(t.scrollDownVisible||t.replyHistory.length>0),replyHistory:e.chatId!==t.prevChatId?[]:t.replyHistory}:null}getSnapshotBeforeUpdate(e,t){const a=this.listRef.current,n={scrollTop:a.scrollTop,scrollHeight:a.scrollHeight,offsetHeight:a.offsetHeight};return this.snapshot=n,n}componentDidUpdate(e,t,a){const n=this.props,s=n.chatId,i=n.messageId;this.state.scrollDownVisible,this.listRef.current;e.chatId===s&&e.messageId===i||this.handleSelectChat(s,e.chatId,i,e.messageId)}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId,i=this.state,r=i.playerOpened,o=i.history,l=i.dragging,c=i.clearHistory,d=i.selectionActive,h=i.scrollDownVisible;return e.chatId!==n||(e.messageId!==s||(t.scrollDownVisible!==h||(t.playerOpened!==r||(!Object(M.q)(t.history,o)||(t.dragging!==l||(t.clearHistory!==c||t.selectionActive!==d))))))}componentDidMount(){const e=this.props,t=e.chatId,a=e.messageId;this.handleSelectChat(t,null,a,null),ae.a.on("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),ae.a.on("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Se.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),ee.a.on("clientUpdateClearSelection",this.onClientUpdateSelection),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateSelection),ee.a.on("clientUpdateOpenReply",this.onClientUpdateOpenReply),ee.a.on("clientUpdateStartMessageEditing",this.onClientUpdateStartMessageEditing),ee.a.on("clientUpdateStopMessageEditing",this.onClientUpdateStopMessageEditing),ee.a.on("clientUpdateTryEditMessage",this.onClientUpdateTryEditMessage),ee.a.on("updateNewMessage",this.onUpdateNewMessage),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateMessageContent",this.onUpdateMessageContent),ee.a.on("updateMessageIsPinned",this.onUpdateMessageIsPinned),ee.a.on("updateMessageSendSucceeded",this.onUpdateMessageSendSucceeded),ee.a.on("updateMessageSendFailed",this.onUpdateMessageSendSucceeded),k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaEnding",this.onClientUpdateMediaEnding),k.b.on("clientUpdateMediaEnd",this.onClientUpdateMediaEnd)}componentWillUnmount(){ae.a.off("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),ae.a.off("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Se.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),ee.a.off("clientUpdateClearSelection",this.onClientUpdateSelection),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateSelection),ee.a.off("clientUpdateOpenReply",this.onClientUpdateOpenReply),ee.a.off("clientUpdateStartMessageEditing",this.onClientUpdateStartMessageEditing),ee.a.off("clientUpdateStopMessageEditing",this.onClientUpdateStopMessageEditing),ee.a.off("clientUpdateTryEditMessage",this.onClientUpdateTryEditMessage),ee.a.off("updateNewMessage",this.onUpdateNewMessage),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateMessageContent",this.onUpdateMessageContent),ee.a.off("updateMessageIsPinned",this.onUpdateMessageIsPinned),ee.a.off("updateMessageSendSucceeded",this.onUpdateMessageSendSucceeded),ee.a.off("updateMessageSendFailed",this.onUpdateMessageSendSucceeded),k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaEnding",this.onClientUpdateMediaEnding),k.b.off("clientUpdateMediaEnd",this.onClientUpdateMediaEnd)}handleSelectChat(e,t,a,n){var r=this;return Object(i.a)(s.a.mark((function e(){var a,n,i,o,l,c,d,h,p,m,g,f,C,b,v,E,S,y,I,k,w,O;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Se.a.get(w),n=Se.a.get(t),r.sessionId={date:new Date,loading:!1,completed:!1,loadMigratedHistory:!1},i=r.sessionId,r.prevScrollTop=null,r.defferedActions=[],o=null,!a){e.next=57;break}return t===w||r.props.filter||x.a.send({"@type":"openChat",chat_id:w}),l=!O&&a.unread_count>1,c=0,l&&a.last_read_inbox_message_id?c=a.last_read_inbox_message_id:O?c=O:o&&(c=o.messageId),d=l||O||o?-1-u.x:0,h=l||O||o?2*u.x:u.x,i.loading=!0,e.next=17,r.getRequest(a.id,c,d,h).catch(e=>({"@type":"messages",messages:[],total_count:0})).finally(()=>{i.loading=!1});case 17:if(p=e.sent,i===r.sessionId){e.next=20;break}return e.abrupt("return");case 20:if(ee.a.setItems(p.messages),p.messages.reverse(),m=r.state.separatorMessageId,w===t){e.next=38;break}if(m=Number.MAX_VALUE,!(a&&a.unread_count>1)){e.next=37;break}g=p.messages.length-1;case 27:if(!(g>=0)){e.next=37;break}if(f=p.messages[g].id,!(!p.messages[g].is_outgoing&&f>a.last_read_inbox_message_id&&f<m)){e.next=33;break}m=f,e.next=34;break;case 33:return e.abrupt("break",37);case 34:g--,e.next=27;break;case 37:m=m===Number.MAX_VALUE?0:m;case 38:if(C=xc.SCROLL_TO_BOTTOM,O?C=xc.SCROLL_TO_MESSAGE:l&&m?C=xc.SCROLL_TO_UNREAD:o&&(C=xc.SCROLL_TO_POSITION),r.cancelUpdatePinnedMessage=!0,r.replace(m,p.messages,()=>{r.handleScrollBehavior(C,r.snapshot,o),O&&Object(Q.i)(w,O),requestAnimationFrame(()=>{r.cancelUpdatePinnedMessage=!1}),r.loadIncompleteHistory(p,h)}),b=U.a.getStore(),Object(W.B)(b,p.messages),r.viewMessages(p.messages),Object(W.x)(b,[w]),Object(W.y)(b,w),t===w||r.props.filter){e.next=55;break}if(Object(F.q)(w),!r.props.options){e.next=55;break}if(!((v=r.props.options.botStartMessage)&&Object(F.f)(w)&&Object(F.fb)(w))){e.next=55;break}return E=v.botUserId,S=v.parameter,e.next=55,Object(ka.f)(w,E,S);case 55:e.next=59;break;case 57:i.loading=!0,r.replace(0,[],()=>{i.loading=!1});case 59:t===w||r.props.filter||n&&(x.a.send({"@type":"closeChat",chat_id:t}),y=Object(M.o)(r.snapshot,r.itemsRef),(I=r.messages[y.index])&&(k=I.props,w=k.chatId,O=k.messageId,Se.a.setScrollPosition(t,{chatId:w,messageId:O,offset:y.offset})));case 60:case"end":return e.stop()}}),e)})))()}viewMessages(e){if(!e)return;if(0===e.length)return;if(!e[0].chat_id)return;const t=()=>{x.a.send({"@type":"viewMessages",chat_id:e[0].chat_id,message_ids:e.map(e=>e.id)})};window.hasFocus?t():this.defferedActions.push(t)}cancelLoadMessageContents(e){for(let t=e.length-1;t>=0;t--){let a=e[t];if(a&&a.content)switch(a.content["@type"]){case"messagePhoto":{let e=this.getMessagePhoto(a),t=Object(L.a)(e,2),n=t[0];if(t[1]){Object(M.l)(a.content.photo.sizes).blob||U.a.cancelGetRemoteFile(n,a)}break}case"messageSticker":{let e=this.getMessageSticker(a),t=Object(L.a)(e,2),n=t[0];if(t[1]){a.content.sticker.sticker.blob||U.a.cancelGetRemoteFile(n,a)}break}}}}replace(e,t,a){this.setState({separatorMessageId:e,history:t},a)}replaceMessage(e,t,a){if(!t)return void(a&&a());let n=[...this.state.history];const s=n.findIndex(t=>t.id===e);-1!==s?n.splice(s,1,t):n=this.state.history,this.setState({history:n},a)}insert(e,t,a){0!==e.length?this.setState({history:e.concat(this.state.history).sort((e,t)=>e.id<t.id?-1:e.id>t.id?1:0)},a):a&&a()}insertNext(e,t){0!==e.length?this.setState({history:e.concat(this.state.history)},t):t&&t()}insertPrevious(e,t,a){0!==e.length?this.setState(Object(Ve.a)({history:this.state.history.concat(e)},t),a):a&&a()}deleteHistory(e,t){const a=this.state.history;if(0===a.length)return void(t&&t());const n=new Map(e.map(e=>[e,e]));this.setState({history:a.filter(e=>!n.has(e.id))},t)}showMessageTitle(e,t,a,n){if(!e)return!1;const s=e.chat_id,i=e.date,r=e.is_outgoing,o=e.sender,l=(e.content,e.forward_info);return!!a||(!!n||(!!Object(F.V)(s)||t&&(Object(Ml.b)(t)||"messageSticker"===t.content["@type"]||"messageVideoNote"===t.content["@type"]||!Object(tt.V)(o,t.sender)||r!==t.is_outgoing||Object(F.gb)(s)&&!Object(tt.g)(l,t.forward_info)||i-t.date>u.y)))}showMessageDate(e,t,a){if(a)return!0;const n=new Date(1e3*e.date),s=t?new Date(1e3*t.date):n;return n.getFullYear()!==s.getFullYear()||n.getMonth()!==s.getMonth()||n.getDate()!==s.getDate()}render(){const e=this.props,t=e.chatId,a=e.filter,n=this.state,s=n.history,i=n.separatorMessageId,r=n.clearHistory,l=n.selectionActive,d=n.scrollDownVisible;if(this.itemsMap.clear(),r)this.messages=null;else{this.messages=[];for(let e=0;e<s.length;e++){const t=s[e],n=t.chat_id,r=t.media_album_id,l=t.ttl,c=t.content;t.is_outgoing;let d=!1;if("0"===r||l||"messageVideo"!==c["@type"]&&"messagePhoto"!==c["@type"]){if("0"!==r&&!l&&("messageDocument"===c["@type"]||"messageAudio"===c["@type"])){const l=[t];for(let t=e+1;t<e+u.a&&t<s.length&&s[t].media_album_id===r;t++)l.push(s[t]);if(l.length>1){const c=t,h=e>0?s[e-1]:null,p=e+l.length<s.length?s[e+l.length]:null,u=this.showMessageDate(c,h,0===e),m=i===c.id,g=!!p&&i===p.id,f=this.showMessageTitle(c,h,0===e,m),C=this.showMessageTitle(p,c,!1,g),b=!p||Object(Ml.b)(p)||"messageSticker"===p.content["@type"]||"messageVideoNote"===p.content["@type"]||!Object(tt.V)(c.sender,p.sender)||Object(F.gb)(c.chat_id)&&!Object(tt.g)(c.forward_info,p.forward_info)||c.is_outgoing!==p.is_outgoing||C;this.messages.push(o.a.createElement(Kl,{key:"chat_id=".concat(n," media_album_id=").concat(r," date=").concat(u," title=").concat(f," tail=").concat(b),ref:t=>l.forEach((a,n)=>{this.itemsMap.set(e+n,t)}),chatId:n,messageIds:l.map(e=>e.id),showTitle:f,showTail:b,showUnreadSeparator:l.map(e=>e.id).some(e=>e.id===i),showDate:u,source:a?"pinned":"chat"})),e+=l.length-1,d=!0}}}else{const l=[t];for(let t=e+1;t<e+u.a&&t<s.length&&s[t].media_album_id===r;t++)l.push(s[t]);if(l.length>1){const c=t,h=e>0?s[e-1]:null,p=e+l.length<s.length?s[e+l.length]:null,u=this.showMessageDate(c,h,0===e),m=i===c.id,g=!!p&&i===p.id,f=this.showMessageTitle(c,h,0===e,m),C=this.showMessageTitle(p,c,!1,g),b=!p||Object(Ml.b)(p)||"messageSticker"===p.content["@type"]||"messageVideoNote"===p.content["@type"]||!Object(tt.V)(c.sender,p.sender)||Object(F.gb)(c.chat_id)&&!Object(tt.g)(c.forward_info,p.forward_info)||c.is_outgoing!==p.is_outgoing||C;this.messages.push(o.a.createElement(Zl,{key:"chat_id=".concat(n," media_album_id=").concat(r," date=").concat(u," title=").concat(f," tail=").concat(b),ref:t=>l.forEach((a,n)=>{this.itemsMap.set(e+n,t)}),chatId:n,messageIds:l.map(e=>e.id),showTitle:f,showTail:b,showUnreadSeparator:l.map(e=>e.id).some(e=>e.id===i),showDate:u,source:a?"pinned":"chat"})),e+=l.length-1,d=!0}}if(!d){const n=t,r=e>0?s[e-1]:null,l=e<s.length-1?s[e+1]:null,c=this.showMessageDate(n,r,0===e);let d=null;if(Object(Ml.b)(n))d=o.a.createElement(Cc,{key:"chat_id=".concat(n.chat_id," id=").concat(n.id," date=").concat(c),ref:t=>this.itemsMap.set(e,t),chatId:n.chat_id,messageId:n.id,showUnreadSeparator:i===n.id,showDate:c,source:a?"pinned":"chat"});else{const t=i===n.id,s=l&&i===l.id,h=this.showMessageTitle(n,r,0===e,t),p=this.showMessageTitle(l,n,!1,s),u=!l||Object(Ml.b)(l)||"messageSticker"===l.content["@type"]||"messageVideoNote"===l.content["@type"]||!Object(tt.V)(n.sender,l.sender)||Object(F.gb)(n.chat_id)&&!Object(tt.g)(n.forward_info,l.forward_info)||n.is_outgoing!==l.is_outgoing||p;d=o.a.createElement(mc,{key:"chat_id=".concat(n.chat_id," id=").concat(n.id," date=").concat(c," title=").concat(h," tail=").concat(u),ref:t=>this.itemsMap.set(e,t),chatId:n.chat_id,messageId:n.id,sendingState:n.sending_state,showTitle:h,showTail:u,showUnreadSeparator:i===n.id,showDate:c,source:a?"pinned":"chat"})}this.messages.push(d)}}}return o.a.createElement("div",{className:c()("messages-list",{"messages-list-selection-active":l}),onDragEnter:this.handleListDragEnter},o.a.createElement("div",{ref:this.listRef,className:"messages-list-wrapper",onScroll:this.handleScroll},o.a.createElement("div",{className:"messages-list-top"}),o.a.createElement("div",{ref:this.itemsRef,className:"messages-list-items"},this.messages)),o.a.createElement(ml,{chatId:t}),o.a.createElement(vc,null),d&&o.a.createElement(Mc,{ref:this.scrollDownButtonRef,onClick:this.handleScrollDownClick}),o.a.createElement(Jl,null),o.a.createElement(kc,null))}}var Oc=wc;a(607);class Lc extends o.a.Component{constructor(e){super(e),this.onUpdateDeleteMessages=e=>{const t=this.props.chatId;if(t!==e.chat_id)return;const a=ee.a.getMedia(t),n=a&&a.pinned.length?a.pinned.length:0;this.setState({pinnedCount:n})},this.onUpdateMessageIsPinned=e=>{const t=this.props.chatId;if(t!==e.chat_id)return;const a=ee.a.getMedia(t),n=a&&a.pinned.length?a.pinned.length:0;this.setState({pinnedCount:n})},this.onClientUpdateMessageSelected=e=>{this.setState({selectedCount:ee.a.selectedItems.size})},this.handleClose=()=>{this.state.selectedCount>0&&Object(Q.b)(),Object(Q.d)()};const t=ee.a.getMedia(e.chatId);this.state={selectedCount:ee.a.selectedItems.size,pinnedCount:t&&t.pinned.length?t.pinned.length:0}}shouldComponentUpdate(e,t,a){const n=this.state,s=n.selectedCount;n.pinnedCount;return t.selectedCount!==s||t.pinnedCount,!0}componentDidMount(){ee.a.on("clientUpdateClearSelection",this.onClientUpdateMessageSelected),ee.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.on("updateMessageIsPinned",this.onUpdateMessageIsPinned),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages)}componentWillUnmount(){ee.a.off("clientUpdateClearSelection",this.onClientUpdateMessageSelected),ee.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),ee.a.off("updateMessageIsPinned",this.onUpdateMessageIsPinned),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages)}render(){const e=this.props.t,t=this.state,a=t.selectedCount,n=t.pinnedCount;let s=e("PinnedMessages");return 1===n?s=e("PinnedMessage"):n>1&&(s="".concat(n," ").concat(e("PinnedMessages"))),o.a.createElement("div",{className:c()("header-details",{"header-details-selection":a>0})},o.a.createElement(j.a,{className:"header-left-button main-menu-button",onClick:this.handleClose},o.a.createElement(Le,null)),o.a.createElement("div",{className:"header-details-content"},o.a.createElement(go,{count:a}),o.a.createElement("div",{className:c()("header-status","grow")},o.a.createElement("span",{className:"header-status-content"},s))))}}var _c=Object(_.a)()(Lc);a(608);class Nc extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={},this.onClientUpdateOpenPinned=e=>{this.props.chatId===e.chatId&&this.setState({opened:!0})},this.onClientUpdateClosePinned=e=>{this.setState({opened:!1})},this.handleUnpinAll=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.props.chatId,Object(Q.p)(a,null);case 2:case"end":return e.stop()}}),e)})))}static getDerivedStateFromProps(e,t){const a=t.prevChatId,n=e.chatId;return a!==n?{prevChatId:n,opened:!1}:null}componentDidMount(){ee.a.on("clientUpdateOpenPinned",this.onClientUpdateOpenPinned),ee.a.on("clientUpdateClosePinned",this.onClientUpdateClosePinned)}componentWillUnmount(){ee.a.off("clientUpdateOpenPinned",this.onClientUpdateOpenPinned),ee.a.off("clientUpdateClosePinned",this.onClientUpdateClosePinned)}render(){const e=this.props,t=e.chatId,a=e.t;if(!this.state.opened)return null;const n=Object(F.d)(t)?a("UnpinAllMessages"):a("HidePinnedMessages");return o.a.createElement("div",{className:"pinned-messages"},o.a.createElement("div",{className:"pinned-messages-wrapper"},o.a.createElement("div",{className:"dialog-background"}),o.a.createElement("div",{className:"dialog-details-wrapper"},o.a.createElement(_c,{chatId:t}),o.a.createElement(Oc,{chatId:t,filter:{"@type":"searchMessagesFilterPinned"}}),o.a.createElement(Xr,{command:n,onCommand:this.handleUnpinAll}))))}}var jc=Object(_.a)()(Nc),Pc=a(609),Tc=a.n(Pc),Rc=a(610),Dc=a.n(Rc);class Fc extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleMenuClick=e=>{this.handleOpen(e.currentTarget)},this.handleOpen=e=>{this.setState({anchorEl:e})},this.handleClose=()=>{this.setState({anchorEl:null})},this.handleCopyLink=()=>{this.handleClose();const e=this.props.t,t=this.getStickersLink(Wr.a.stickerSet);t&&(H(t),this.handleScheduledAction(e("LinkCopied")))},this.getStickersLink=e=>{if(!e)return"";const t=e.name;if(!t)return"";const a=G.a.get("t_me_url");return(a?a.value:"https://telegram.org/")+"addstickers/"+t},this.handleScheduledAction=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(f.a,null))]})},this.handleShare=()=>{this.handleClose();const e=this.getStickersLink(Wr.a.stickerSet);if(!e)return;x.a.clientUpdate({"@type":"clientUpdateStickerSet",stickerSet:null});const t={"@type":"inputMessageText",text:{"@type":"formattedText",text:e,entities:null},disable_web_page_preview:!1,clear_draft:!1};Object(Q.g)(t)}}render(){const e=this.props,t=e.t,a=e.className,n=this.state.anchorEl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{className:a,"aria-label":"Share",open:Boolean(n),onClick:this.handleMenuClick},o.a.createElement(On,null)),o.a.createElement(Aa.a,{id:"sticker-set-menu",anchorEl:n,open:Boolean(n),getContentAnchorEl:null,disableAutoFocusItem:!0,disableEnforceFocus:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},o.a.createElement(We.a,{onClick:this.handleCopyLink},o.a.createElement(ge.a,null,o.a.createElement(Tc.a,null)),o.a.createElement(fe.a,{primary:t("CopyLink")})),o.a.createElement(We.a,{onClick:this.handleShare},o.a.createElement(ge.a,null,o.a.createElement(Dc.a,null)),o.a.createElement(fe.a,{primary:t("StickersShare")}))))}}var Ac=Object(d.a)(Object(_.a)(),p.b)(Fc);a(611);class Bc extends o.a.Component{constructor(e){super(e),this.handleUpdateInstalledStickerSets=e=>{const t=Wr.a.stickerSet;this.setState({stickerSet:t})},this.handleClientUpdateStickerSet=e=>{const t=e.stickerSet;if(this.setState({stickerSet:t},()=>{setTimeout(()=>{this.handleScroll()},0)}),t){const e=U.a.getStore();Object(W.G)(e,t)}},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateStickerSet",stickerSet:null})},this.handleDone=()=>{const e=this.state.stickerSet;if(!e)return;const t=e.is_installed;x.a.send({"@type":"changeStickerSet",set_id:e.id,is_installed:!t}),this.handleClose()},this.loadPreviewContent=e=>{const t=this.state.stickerSet.stickers.find(t=>t.sticker.id===e);if(!t)return;const a=U.a.getStore();Object(W.F)(a,t,null);this.getNeighborStickers(e).forEach(e=>{Object(W.F)(a,e,null)})},this.getNeighborStickers=e=>{const t=this.state.stickerSet;if(!t)return[];const a=t.stickers;if(!a)return[];const n=[],s=a.findIndex(t=>t.sticker.id===e);if(-1===s)return[];const i=Math.floor(s/5),r=s%5,o=i-1,l=i+1,c=r-1,d=r+1;return o>=0&&(c>=0&&n.push(5*o+c),n.push(5*o+r),d<5&&n.push(5*o+d)),c>=0&&n.push(5*i+c),d<5&&n.push(5*i+d),l<Math.ceil(a.length/5)&&(c>=0&&n.push(5*l+c),n.push(5*l+r),d<5&&n.push(5*l+d)),n.map(e=>a[e])},this.handleMouseUp=()=>{this.setState({sticker:null}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:null}),this.mouseDown=!1,document.removeEventListener("mouseup",this.handleMouseUp)},this.handleMouseEnter=e=>{const t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);a&&this.mouseDown&&(this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t))},this.handleMouseDown=e=>{const t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);if(a)return this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t),this.mouseDown=!0,document.addEventListener("mouseup",this.handleMouseUp),e.preventDefault(),e.stopPropagation(),!1},this.handleScroll=()=>{const e=this.contentRef.current;if(!e)return;const t=e.scrollHeight>e.offsetHeight,a=t&&0===e.scrollTop,n=t&&e.scrollTop+e.offsetHeight===e.scrollHeight,s=t&&e.scrollTop>0&&e.scrollTop+e.offsetHeight<e.scrollHeight;this.setState({scrollTop:a,scrollBottom:n,scroll:s})},this.handleInViewport=(e,t)=>{const a=this.contentRef.current;if(!a)return!1;const n=a.getBoundingClientRect(),s=t.top-n.top,i=t.bottom-n.bottom;return!(s>n.height)&&!(i<-n.height)},this.contentRef=o.a.createRef(),this.state={stickerSet:Wr.a.stickerSet,stickerId:0,scroll:!1,scrollTop:!1,scrollBottom:!1}}shouldComponentUpdate(e,t,a){const n=this.state,s=n.stickerSet,i=n.sticker,r=n.scroll,o=n.scrollTop,l=n.scrollBottom;return s!==t.stickerSet||(i!==t.sticker||(r!==t.scroll||(o!==t.scrollTop||l!==t.scrollBottom)))}componentDidMount(){Wr.a.on("clientUpdateStickerSet",this.handleClientUpdateStickerSet),Wr.a.on("updateInstalledStickerSets",this.handleUpdateInstalledStickerSets)}componentWillUnmount(){Wr.a.off("clientUpdateStickerSet",this.handleClientUpdateStickerSet),Wr.a.off("updateInstalledStickerSets",this.handleUpdateInstalledStickerSets)}getSticker(e){const t=this.state.stickerSet;if(!t)return null;const a=t.stickers,n=a.findIndex(t=>t.sticker.id===e);return-1!==n?a[n]:null}render(){const e=this.props.t,t=this.state,a=t.stickerSet,n=t.sticker,s=t.scroll,i=t.scrollTop,r=t.scrollBottom;if(!a)return null;const l=a.title,d=a.stickers,h=a.is_installed,p=d.map(e=>o.a.createElement("div",{className:"sticker-set-dialog-item",key:e.sticker.id,"data-sticker-id":e.sticker.id,onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown},o.a.createElement(cc.b,{key:e.sticker.id,className:"sticker-set-dialog-item-sticker",sticker:e,autoplay:!0,blur:!1,displaySize:u.Eb,preview:!0,source:cc.a.STICKER_SET,inViewportFunc:this.handleInViewport}),o.a.createElement("div",{className:"sticker-set-dialog-item-emoji"},e.emoji)));return o.a.createElement(P.a,{className:c()("sticker-set-dialog",{"sticker-set-dialog-scroll":s},{"sticker-set-dialog-scroll-top":i},{"sticker-set-dialog-scroll-bottom":r}),open:!0,manager:$.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"sticker-set-dialog-title-text",classes:{paper:"sticker-set-dialog-paper"}},o.a.createElement(R.a,{className:c()("sticker-set-dialog-title",{"sticker-set-dialog-disabled":Boolean(n)}),disableTypography:!0},o.a.createElement(j.a,{"aria-label":"Close",onClick:this.handleClose},o.a.createElement(f.a,null)),o.a.createElement(be.a,{variant:"h6",id:"sticker-set-dialog-title-text",className:"sticker-set-dialog-title-typography",noWrap:!0},l),o.a.createElement(Ac,null)),o.a.createElement(Ln.a,{ref:this.contentRef,classes:{root:c()("sticker-set-dialog-content-root","scrollbars-hidden")},onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onScroll:this.handleScroll},p),o.a.createElement(T.a,{className:c()("sticker-set-dialog-actions",{"sticker-set-dialog-disabled":Boolean(n)})},o.a.createElement(N.a,{className:"sticker-set-dialog-action-button",disableElevation:!0,variant:"contained",color:h?"secondary":"primary",onClick:this.handleDone},e(h?"StickersRemove":"AddStickers"))),o.a.createElement(Ic.a,{sticker:n}))}}var Hc=Object(_.a)()(Bc);a(612);class Vc extends o.a.Component{constructor(...e){super(...e),this.handleClick=()=>{Object(ka.b)()}}render(){const e=this.props.t;return o.a.createElement("div",{className:"switch-inline-placeholder",onClick:this.handleClick},o.a.createElement("div",{className:"switch-inline-text"},e("SelectChat")+"..."))}}var zc=Object(_.a)()(Vc);a(613);class Wc extends r.Component{constructor(e){super(e),this.onClientUpdateClearOpenChatOptions=e=>{this.setState({chatOpenOptions:null})},this.onClientUpdateChatSelect=e=>{const t=e.options;this.setState({chatSelectOptions:t})},this.onClientUpdateDocumentBlob=e=>{const t=this.state.wallpaper;if(!t)return;const a=t.document;if(!a)return;const n=a.document;if(!n)return;const s=e.fileId;if(n.id===s){if(this.thumbnailTime&&this.thumbnailTime.wallpaper===t){if(new Date-this.thumbnailTime.time<250)return void setTimeout(()=>{this.forceUpdate()},250)}this.forceUpdate()}},this.onClientUpdateDocumentThumbnailBlob=e=>{const t=this.state.wallpaper;if(!t)return;const a=t.document;if(!a)return;const n=a.thumbnail;if(!n)return;const s=n.file;if(!s)return;const i=e.fileId;s.id===i&&(this.thumbnailTime={wallpaper:t,time:new Date},this.forceUpdate())},this.onClientUpdateChatBackground=e=>{const t=e.wallpaper;this.thumbnailTime={wallpaper:t,time:new Date},this.setState({wallpaper:t})},this.onClientUpdateChatDetailsVisibility=e=>{this.forceUpdate()},this.onClientUpdateChatId=e=>{const t=this.state.chatSelectOptions,a=e.nextChatId,n=e.nextMessageId,s=e.options;this.setState({chatId:a,messageId:n,chatOpenOptions:s,chatSelectOptions:s&&s.closeChatSelect?null:t})},this.scrollToBottom=()=>{this.messagesList.scrollToBottom()},this.scrollToStart=()=>{this.messagesList.scrollToStart()},this.scrollToMessage=()=>{this.messagesList.scrollToMessage()},this.state={chatId:ae.a.getChatId(),messageId:ae.a.getMessageId(),selectedCount:0,wallpaper:null,wallpaperSrc:null,chatSelectOptions:null,chatOpenOptions:null}}shouldComponentUpdate(e,t){const a=this.state,n=a.chatId,s=a.messageId,i=a.selectedCount,r=a.wallpaper,o=a.chatSelectOptions,l=a.chatOpenOptions;return t.chatId!==n||(t.messageId!==s||(t.selectedCount!==i||(t.wallpaper!==r||(t.chatSelectOptions!==o||t.chatOpenOptions!==l))))}componentDidMount(){ae.a.on("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),ae.a.on("clientUpdateChatId",this.onClientUpdateChatId),ae.a.on("clientUpdateChatSelect",this.onClientUpdateChatSelect),Se.a.on("clientUpdateChatBackground",this.onClientUpdateChatBackground),Se.a.on("clientUpdateClearOpenChatOptions",this.onClientUpdateClearOpenChatOptions),U.a.on("clientUpdateDocumentBlob",this.onClientUpdateDocumentBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}componentWillUnmount(){ae.a.off("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),ae.a.off("clientUpdateChatId",this.onClientUpdateChatId),ae.a.off("clientUpdateChatSelect",this.onClientUpdateChatSelect),Se.a.off("clientUpdateChatBackground",this.onClientUpdateChatBackground),Se.a.on("clientUpdateClearOpenChatOptions",this.onClientUpdateClearOpenChatOptions),U.a.off("clientUpdateDocumentBlob",this.onClientUpdateDocumentBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}render(){const e=this.state,t=e.chatId,a=e.messageId,n=e.chatOpenOptions,s=e.wallpaper,i=e.chatSelectOptions;let r=null,l=null;if(s){const e=s.document;if(e){const t=e.thumbnail,a=e.document;a&&(l=Object(W.m)(a)),!l&&t&&(l=Object(W.m)(t.file))}r={backgroundImage:l?"url(".concat(l,")"):null}}return o.a.createElement("div",{className:"dialog-details",style:r},o.a.createElement("div",{className:"dialog-background"}),o.a.createElement("div",{className:"dialog-details-wrapper"},o.a.createElement(pl,null),o.a.createElement(Mo,{chatId:t}),o.a.createElement(Oc,{ref:e=>this.messagesList=e,chatId:t,messageId:a,options:n}),o.a.createElement(eo,{chatId:t,options:n})),i&&o.a.createElement(zc,null),o.a.createElement(jc,{chatId:t}),o.a.createElement(Hc,null),o.a.createElement(Zi,null))}}var Gc=Wc,Zc=a(56);a(614);const qc=new Map;class Kc extends o.a.PureComponent{render(){const e=this.props,t=e.forwardedRef,a=e.iv;if(!a)return null;const n=a.page_blocks,s=a.is_rtl;if(!n)return;qc.clear();const i=n.map((e,t)=>Object(nl.g)(e,a,t,t=>{qc.set(e,t)}));return o.a.createElement("article",{ref:t,dir:s?"rtl":"ltr"},i)}}var Yc=Object(d.a)(Object(d.d)(),Zc.b)(Kc),Jc=Object(he.a)(o.a.createElement("path",{d:"M9.91421356,11.5 L16.2071068,5.20710678 C16.5976311,4.81658249 16.5976311,4.18341751 16.2071068,3.79289322 C15.8165825,3.40236893 15.1834175,3.40236893 14.7928932,3.79289322 L7.79289322,10.7928932 C7.40236893,11.1834175 7.40236893,11.8165825 7.79289322,12.2071068 L14.7928932,19.2071068 C15.1834175,19.5976311 15.8165825,19.5976311 16.2071068,19.2071068 C16.5976311,18.8165825 16.5976311,18.1834175 16.2071068,17.7928932 L9.91421356,11.5 Z"}),"Left");a(615);class Xc extends o.a.Component{constructor(e){super(e),this.handleClick=e=>{e.stopPropagation()},this.handleScroll=()=>{const e=this.scrollRef.current;if(!e)return;const t=0===e.scrollTop&&e.scrollHeight>e.offsetHeight,a=e.scrollTop+e.offsetHeight===e.scrollHeight&&e.scrollHeight>e.offsetHeight;this.setState({top:t,bottom:a})},this.state={top:!1,bottom:!1},this.scrollRef=o.a.createRef()}shouldComponentUpdate(e,t,a){const n=this.props.text,s=this.state,i=s.top,r=s.bottom;return e.text!==n||(t.top!==i||t.bottom!==r)}componentDidMount(){this.handleScroll()}componentDidUpdate(e,t,a){const n=this.props.text;e.text!==n&&this.handleScroll()}render(){const e=this.props.text,t=this.state,a=t.top,n=t.bottom;return o.a.createElement("div",{className:"media-caption",onClick:this.handleClick},o.a.createElement("div",{ref:this.scrollRef,className:c()("scrollbars-hidden","media-caption-wrapper",{"media-caption-wrapper-top":a,"media-caption-wrapper-bottom":n,"media-caption-wrapper-both":!a&&!n}),onScroll:this.handleScroll},o.a.createElement("div",{className:"media-caption-text"},e)))}}Xc.defaultProps={};var Qc=Xc,$c=a(46);class ed extends o.a.Component{constructor(e){super(e),this.onClientUpdatePictureInPicture=e=>{const t=e.videoInfo;if(!t)return;this.state.file.id===t.fileId&&x.a.clientUpdate({"@type":"clientUpdateInstantViewViewerContent",content:null})},this.onClientUpdateMediaBlob=e=>{const t=e.fileId,a=this.props,n=a.media,s=a.size,i=this.state.file;if(i&&i.id===t){const e=Object(W.o)(n,s),t=Object(L.a)(e,5),a=t[0],i=t[1],r=t[2],o=t[3],l=t[4];this.setState({width:a,height:i,file:r,src:Object(W.m)(r),supportsStreaming:l,mimeType:o})}},this.onClientUpdateMediaThumbnailBlob=e=>{const t=e.fileId,a=this.state.thumbnail;a&&a.file.id===t&&this.forceUpdate()},this.videoRef=o.a.createRef(),this.state={}}static getDerivedStateFromProps(e,t){const a=e.media,n=e.size;e.caption,e.url;if(a!==t.prevMedia){const e=Object(W.q)(a),t=Object(W.p)(a);let s=Object(W.o)(a,n),i=Object(L.a)(s,5),r=i[0],o=i[1],l=i[2],c=i[3],d=i[4];l=U.a.get(l.id)||l;let h=Object(W.m)(l),p=null;if(!h&&d){const e=a.video;e&&(h="/streaming/file?id=".concat(l.id,"&size=").concat(l.size,"&mime_type=").concat(e.mime_type))}return{prevMedia:a,speed:1,isPlaying:!1,width:r,height:o,file:l,src:h,source:p,supportsStreaming:d,mimeType:c,thumbnail:e,minithumbnail:t}}return null}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentDidUpdate(e,t,a){const n=this.state.src;if(t.src!==n){const e=this.videoRef.current;if(!e)return;e.load()}}render(){const e=this.props,t=e.media,a=e.caption,n=e.url;if(!t)return null;const s=this.state,i=s.width,r=s.height,l=s.file,c=s.src,d=s.mimeType,h=s.thumbnail,p=s.minithumbnail,m=s.isPlaying,g=s.supportsStreaming;if(!l)return null;const f=p?"data:image/jpeg;base64, "+p.data:null,C=Object(W.m)(h);let b=i,v=r;const E=u.w/Math.max(b,v),y=b>v?u.w:Math.floor(b*E),M=v>b?u.w:Math.floor(v*E);b=y,v=M;let I=null;const U=c?o.a.createElement("source",{src:c,type:d}):null,k=Object(Qe.k)(h,p,b,v);switch(t["@type"]){case"video":I=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement(S.a,{ref:this.videoRef,className:"media-viewer-content-video-player",fileId:l.id,width:b,height:v,poster:g?C||f:null,onPlay:()=>{this.setState({isPlaying:!0})}},U),!m&&!g&&k);break;case"animation":I=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("video",{ref:this.videoRef,className:"media-viewer-content-video-player",onClick:this.handleContentClick,loop:!0,autoPlay:!0,width:b,height:v,onPlay:()=>{this.setState({isPlaying:!0})}},U),!m&&k);break;default:I=o.a.createElement("img",{className:"media-viewer-content-image",src:c,alt:"",onClick:this.handleContentClick})}return o.a.createElement("div",{className:"media-viewer-content"},I,!g&&o.a.createElement(xs.a,{file:l,zIndex:2}),a&&(!Object(nl.k)(a.text)||!Object(nl.k)(a.credit)||n)&&o.a.createElement(Qc,{text:o.a.createElement(o.a.Fragment,null,o.a.createElement($c.a,{text:a.text,credit:a.credit}),o.a.createElement(st.a,{url:n}))}))}}var td=ed;a(616);class ad extends o.a.Component{constructor(...e){super(...e),this.handleClick=e=>{e.stopPropagation();const t=this.props,a=t.disabled,n=t.onClick;a||n(e)}}render(){const e=this.props,t=e.disabled,a=e.grow,n=e.children,s=e.className,i=e.style,r=c()(t?"media-viewer-button-disabled":"media-viewer-button",{grow:a},s);return o.a.createElement("div",{className:r,style:i,onClick:this.handleClick},n)}}var nd=ad;a(617);class sd extends o.a.Component{render(){const e=this.props,t=e.title,a=e.subtitle,n=e.style;return o.a.createElement("div",{className:"media-viewer-footer-text",style:n},o.a.createElement("div",{className:"media-viewer-footer-text-wrapper"},o.a.createElement("span",null,t),Boolean(a)&&o.a.createElement("span",null,"\xa0",a)))}}var id=sd;a(447);class rd extends o.a.Component{constructor(...e){super(...e),this.handleClick=e=>{e.stopPropagation();const t=this.props,a=t.onClick;t.disabled||a(e)}}render(){const e=this.props,t=e.checked,a=e.children,n=e.disabled,s=e.title;return o.a.createElement("div",{className:c()("media-viewer-footer-button",{"media-viewer-footer-button-checked":t,"media-viewer-footer-button-disabled":n}),title:s,onClick:this.handleClick},a)}}var od=rd;class ld extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateFile=e=>{const t=this.props.fileId,a=e.file;a.id===t&&a.local.is_downloading_completed&&this.checkFileLoaded()},this.onClientUpdateMediaBlob=e=>{const t=this.state.fileId;t===e.fileId&&this.setState({disabled:ld.saveDisabled(t)})},this.handleClick=e=>{e.stopPropagation();const t=this.props.onClick;this.state.disabled||t(e)}}static getDerivedStateFromProps(e,t){const a=e.fileId;return a!==t.prevPropsFileId?{prevPropsFileId:a,fileId:a,disabled:ld.saveDisabled(a)}:null}componentDidUpdate(e,t,a){e.fileId!==this.props.chatId&&this.checkFileLoaded()}checkFileLoaded(){const e=this.props.fileId;if(U.a.getBlob(e))return;const t=U.a.get(e);if(!t)return;const a=t.local;if(!a)return;if(!a.is_downloading_completed)return;const n=U.a.getStore();U.a.getLocalFile(n,t,null,()=>{this.setState({disabled:ld.saveDisabled(e)})})}componentDidMount(){this.checkFileLoaded(),U.a.on("updateFile",this.onUpdateFile),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateChatBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateDocumentBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateUserBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob)}componentWillUnmount(){U.a.off("updateFile",this.onUpdateFile),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateChatBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateDocumentBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateUserBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob)}render(){const e=this.props,t=e.title,a=e.children,n=e.disabled,s=this.state.disabled;return o.a.createElement(od,{disabled:s||n,title:t,onClick:this.handleClick},a||o.a.createElement(Mi.a,null))}}ld.saveDisabled=e=>!Boolean(U.a.getBlob(e));var cd=ld;a(618);class dd extends o.a.Component{constructor(e){super(e),this.onKeyDown=e=>{if($.a.modals.length>0)return;if(e.isComposing)return;const t=this.state,a=t.index,n=t.blocks;if(!n)return null;if(-1===a)return null;const s=n[a],i=Object(nl.c)(s);if(!i)return;switch(e.key){case"Escape":return this.handleClose(),e.stopPropagation(),void e.preventDefault();case"ArrowLeft":return this.handleNext(),e.stopPropagation(),void e.preventDefault();case"ArrowRight":return this.handlePrevious(),e.stopPropagation(),void e.preventDefault()}"video"===i["@type"]&&x.a.clientUpdate({"@type":"clientUpdateMediaShortcut",event:e})},this.handlePrevious=e=>{e&&e.stopPropagation();const t=this.state,a=t.index,n=t.blocks,s=a+1;if(this.hasPreviousMedia(a,n))return this.loadMedia(s)},this.handleNext=e=>{e&&e.stopPropagation();const t=this.state,a=t.index,n=t.blocks,s=a-1;if(this.hasNextMedia(a,n))return this.loadMedia(s)},this.loadMedia=e=>{const t=this.state.blocks;return!(e<0)&&(!(e>=t.length)&&(this.setState({index:e,hasPreviousMedia:this.hasPreviousMedia(e,t),hasNextMedia:this.hasNextMedia(e,t)}),Object(W.L)(e,t),!0))},this.handleClose=()=>{Object(Q.t)(null);const e=this.state,t=e.index,a=e.blocks;-1!==t&&Object(W.a)(t,a)},this.handleForward=()=>{const e=this.props.media,t=Object(Qe.d)(e,null);t&&Object(Q.g)(t)},this.handleSave=()=>{const e=this.props.media;Object(W.P)(e,null)},this.handleWrapperMouseDown=e=>{this.mouseDownTarget=e.currentTarget},this.handleWrapperClick=e=>{const t=this.mouseDownTarget;this.mouseDownTarget=null,e.currentTarget===t&&this.handleClose()},this.state={index:-1,hasPreviousMedia:!1,hasNextMedia:!1,blocks:[]},this.keyboardHandler=new I.a(this.onKeyDown)}componentDidMount(){this.loadContent(),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}loadContent(){const e=this.props,t=e.iv,a=e.media,n=Object(nl.i)(t,nl.m),s=n.findIndex(e=>Object(nl.c)(e)===a);this.setState({blocks:n,index:s,hasPreviousMedia:this.hasPreviousMedia(s,n),hasNextMedia:this.hasNextMedia(s,n)}),Object(W.L)(s,n)}hasPreviousMedia(e,t){if(-1===e)return!1;return e+1<t.length}hasNextMedia(e,t){if(-1===e)return!1;return e-1>=0}render(){const e=this.props,t=e.size,a=e.t,n=this.state,s=n.index,i=n.blocks,r=n.hasNextMedia,l=n.hasPreviousMedia;if(!i)return null;if(-1===s)return null;const d=i[s],h=Object(nl.c)(d),p=Object(nl.b)(d),u=Object(nl.d)(d),m=Object(W.o)(h,t),g=Object(L.a)(m,3),C=(g[0],g[1],g[2]);let b="";"photo"===h["@type"]&&(b=a("AttachPhoto")),"video"===h["@type"]?b=a("AttachVideo"):"animation"===h["@type"]&&(b=a("AttachGif"));const v=i.length;return o.a.createElement("div",{className:c()("instant-view-media-viewer","media-viewer-default")},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(id,{title:b,subtitle:v>1&&s>=0?an.a.formatString("Of",s+1,v):null,style:{marginLeft:128}}),o.a.createElement(cd,{title:a("Save"),fileId:C.id,onClick:this.handleSave}),o.a.createElement(od,{title:a("Forward"),onClick:this.handleForward},o.a.createElement(Ye,null)),o.a.createElement(od,{title:a("Close"),onClick:this.handleClose},o.a.createElement(f.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onMouseDown:this.handleWrapperMouseDown,onClick:this.handleWrapperClick},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(nd,{disabled:!r,grow:!0,onClick:this.handleNext},o.a.createElement(Jc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(td,{media:h,size:t,caption:p,url:u})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(nd,{disabled:!l,grow:!0,onClick:this.handlePrevious},o.a.createElement(Jc,{style:{transform:"rotate(180deg)"}})))))}}var hd=Object(d.a)(Object(_.a)(),Zc.b)(dd),pd=a(44);a(619);class ud extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateInstantViewViewerContent=e=>{const t=e.content;if(!t)return void this.setState({media:null,caption:null,url:null});const a=t.media,n=t.caption,s=t.url,i=t.instantView;this.props.instantView===i&&this.setState({media:a,caption:n,url:s})},this.onClientUpdateInstantViewUrl=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.url,i=pd.a.getCurrent(),r=t.props,o=r.instantView,l=r.url,i===o){e.next=5;break}return e.abrupt("return");case 5:if(!o||!n.startsWith(l)){e.next=14;break}if(c=new URL(n).hash,n.indexOf("#")!==n.length-1){e.next=12;break}return t.scrollTop("smooth"),e.abrupt("return");case 12:if(!c||!t.scrollToHash(c,"smooth")){e.next=14;break}return e.abrupt("return");case 14:cl(n);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onKeyDown=e=>{if(!($.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":e.stopPropagation(),e.preventDefault();if(this.state.media)return void Object(Q.t)(null);this.handleClose();break}},this.handleBack=()=>{const e=this.state,t=e.hasPrev;e.hasScroll?this.scrollTop("smooth"):t?x.a.clientUpdate({"@type":"clientUpdatePrevInstantView"}):this.handleClose()},this.handleScroll=()=>{const e=this.instantViewerRef.current;this.setState({hasScroll:e.scrollTop>50}),this.updateItemsInView()},this.keyboardHandler=new I.a(this.onKeyDown),this.articleRef=o.a.createRef(),this.instantViewerRef=o.a.createRef(),this.state={},this.updateItemsInView=Object(M.C)(this.updateItemsInView,500)}static getDerivedStateFromProps(e,t){return e.instantView!==t.prevInstantView?{prevInstantView:e.instantView,hasPrev:pd.a.hasPrev(),hasScroll:!1,media:null,caption:null,url:null}:null}shouldComponentUpdate(e,t,a){const n=this.props.instantView,s=this.state,i=s.hasScroll,r=s.hasPrev,o=s.media,l=s.caption,c=s.url;return n!==e.instantView||(i!==t.hasScroll||(r!==t.hasPrev||(o!==t.media||(l!==t.caption||c!==t.url))))}componentDidMount(){this.mounted=!0,this.handleScroll(),this.scrollToBlock(this.props.block,"smooth"),I.b.add(this.keyboardHandler),pd.a.on("clientUpdateInstantViewUrl",this.onClientUpdateInstantViewUrl),pd.a.on("clientUpdateInstantViewViewerContent",this.onClientUpdateInstantViewViewerContent)}componentWillUnmount(){this.mounted=!1,I.b.remove(this.keyboardHandler),pd.a.off("clientUpdateInstantViewUrl",this.onClientUpdateInstantViewUrl),pd.a.off("clientUpdateInstantViewViewerContent",this.onClientUpdateInstantViewViewerContent)}scrollToBlock(e,t){if(!e)return!1;if(!qc)return!1;const a=qc.get(e);if(!a)return!1;const n=$o.a.findDOMNode(a);return this.scrollToElement(n,t)}scrollToElement(e,t){if(!e)return!1;const a=[];let n=!1,s=e;do{s=s.parentNode,s?"DETAILS"===s.nodeName?a.push(s):"ARTICLE"===s.nodeName&&(n=!0):n=!0}while(!n);return a.forEach(e=>e.open=!0),e.scrollIntoView({block:"center",behavior:t}),!0}scrollToHash(e,t){if(!e)return!1;const a=document.getElementById(e.substr(1));return this.scrollToElement(a,t)}scrollTop(e){const t=this.instantViewerRef.current;switch(e){case"smooth":Da(t);break;default:t.scrollTo({top:0,behavior:e})}}componentDidUpdate(e,t,a){const n=this.props,s=n.instantView,i=(n.block,n.url),r=new URL(i).hash;e.instantView!==s&&(e.url!==i?i.indexOf("#")===i.length-1?this.scrollTop("auto"):r?this.scrollToHash(r,"auto"):this.scrollTop("auto"):r?this.scrollToHash(r,"auto"):this.scrollTop("smooth"),this.handleScroll())}handleClose(){Object(Q.s)(null)}updateItemsInView(){if(!this.mounted)return;const e=this.props.instantView;if(!e)return;const t=e.page_blocks,a=new Map,n=Object(M.x)(this.instantViewerRef,this.articleRef);for(let s=0;s<n.length;s++){const e=t[n[s]];a.set(e,e);Object(nl.f)(e).forEach(e=>a.set(e,e))}x.a.clientUpdate({"@type":"clientUpdateBlocksInView",blocks:a})}render(){const e=this.props.instantView,t=this.state,a=(t.hasPrev,t.hasScroll),n=t.media,s=t.caption,i=t.url;return e?o.a.createElement(Zc.a.Provider,{value:e},o.a.createElement("div",{ref:this.instantViewerRef,className:"instant-viewer",onScroll:this.handleScroll},o.a.createElement("div",{className:"instant-viewer-left-column",onClick:this.handleBack},o.a.createElement(nd,{className:"instant-viewer-left-button",style:{alignItems:"flex-start"},onClick:this.handleBack},o.a.createElement(Jc,{style:{transition:"transform 0.25s ease-out",transform:a?"rotate(90deg)":"rotate(0deg)"}}))),o.a.createElement("div",{className:"instant-viewer-content-column"},o.a.createElement("div",null,o.a.createElement(Yc,{ref:this.articleRef}))),o.a.createElement("div",{className:"instant-viewer-right-column"},o.a.createElement(nd,{className:"instant-viewer-right-button",onClick:this.handleClose},o.a.createElement(f.a,null)))),n&&o.a.createElement(hd,{media:n,size:u.n,caption:s,url:i})):null}}var md=Object(_.a)()(ud);a(448);class gd extends o.a.Component{constructor(e){super(e)}render(){const e=this.props,t=e.chatId,a=e.messageId,n=ee.a.get(t,a);if(!n)return null;const s=n.date,i=n.sender,r=Object(tt.l)(s),l=i.user_id?o.a.createElement(Cn.a,{userId:i.user_id}):o.a.createElement(D.a,{chatId:t});return o.a.createElement("div",{className:"media-info"},o.a.createElement("div",{className:"media-info-wrapper"},l,o.a.createElement("div",{className:"media-info-content"},o.a.createElement("div",{className:"media-info-row"},o.a.createElement(pt.a,{sender:i})),o.a.createElement("div",{className:"media-info-row meta"},o.a.createElement("span",null,r)))))}}var fd=gd;a(620);class Cd extends o.a.Component{constructor(e){super(e),this.onClientUpdatePictureInPicture=e=>{const t=e.videoInfo;if(!t)return;this.state.file.id===t.fileId&&x.a.clientUpdate({"@type":"clientUpdateMediaViewerContent",content:null})},this.onClientUpdateMediaBlob=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.size;if(a===e.chatId&&n===e.messageId){let e=Object(W.i)(a,n,s),t=Object(L.a)(e,5),i=t[0],r=t[1],o=t[2],l=t[3],c=t[4];o=U.a.get(o.id)||o;let d=Object(W.m)(o),h=null;!d&&c&&Object(tt.S)(a,n)&&(d="/streaming/file?id=".concat(o.id,"&size=").concat(o.size,"&mime_type=").concat(l)),this.setState({width:i,height:r,file:o,src:d,source:h,supportsStreaming:c,mimeType:l})}},this.onClientUpdateMediaThumbnailBlob=e=>{const t=this.props,a=t.chatId,n=t.messageId;if(a===e.chatId&&n===e.messageId){const e=Object(W.k)(a,n);this.setState({thumbnail:e})}},this.onUpdateMessageContent=e=>{const t=this.props,a=t.chatId,n=t.messageId,s=t.size,i=t.t,r=e.chat_id,o=e.message_id;if(a===r&&n===o){const e=ee.a.get(a,n),t=Object(tt.y)(e,null,i),r=Object(W.i)(a,n,s),o=Object(L.a)(r,5),l=o[0],c=o[1],d=o[2],h=o[3],p=o[4];let u=Object(W.m)(d),m=null;!u&&p&&Object(tt.S)(a,n)&&(u="/streaming/file?id=".concat(d.id,"&size=").concat(d.size,"&mime_type=").concat(h)),this.setState({width:l,height:c,file:d,src:u,source:m,supportsStreaming:p,mimeType:h,text:t})}},this.handleContentClick=e=>{e&&e.stopPropagation()},this.handleClick=e=>{e.preventDefault(),e.stopPropagation();const t=this.state.source;t&&t.loadNextBuffer()},this.state={},this.videoRef=o.a.createRef()}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.messageId,s=e.size,i=e.t;if(a!==t.prevChatId||n!==t.prevMessageId){const e=Object(W.k)(a,n),t=Object(W.j)(a,n),r=ee.a.get(a,n),o=Object(tt.y)(r,null,i);let l=Object(W.i)(a,n,s),c=Object(L.a)(l,5),d=c[0],h=c[1],p=c[2],u=c[3],m=c[4];p=U.a.get(p.id)||p;let g=Object(W.m)(p),f=null;!g&&m&&Object(tt.S)(a,n)&&(g="/streaming/file?id=".concat(p.id,"&size=").concat(p.size,"&mime_type=").concat(u));return{prevChatId:a,prevMessageId:n,speed:1,isPlaying:!1,width:d,height:h,file:p,src:g,source:f,supportsStreaming:m,mimeType:u,text:o,thumbnail:e,minithumbnail:t,webPage:r.content.web_page}}return null}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),ee.a.on("updateMessageContent",this.onUpdateMessageContent),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),ee.a.off("updateMessageContent",this.onUpdateMessageContent),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentDidUpdate(e,t,a){const n=this.state.src;if(t.src!==n){const e=this.videoRef.current;if(!e)return;e.load()}}render(){const e=this.props,t=e.chatId,a=e.messageId,n=this.state,s=n.width,i=n.height,r=n.file,l=n.src,c=n.supportsStreaming,d=n.mimeType,h=n.text,p=n.minithumbnail,m=n.thumbnail,g=n.webPage,f=n.isPlaying;if(!r)return null;const C=p?"data:image/jpeg;base64, "+p.data:null,b=Object(W.m)(m?m.file:null),v=Object(tt.K)(t,a),E=Object(tt.S)(t,a),y=Object(tt.H)(t,a);let M=s,I=i;const U=u.w/Math.max(M,I),k=M>I?u.w:Math.floor(M*U),x=I>M?u.w:Math.floor(I*U);M=k,I=x;let w=null;const O=l?o.a.createElement("source",{src:l,type:d}):null,L=Object(Qe.k)(m,p,M,I);if(E)w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement(S.a,{ref:this.videoRef,className:"media-viewer-content-video-player",fileId:r.id,width:M,height:I,poster:c?b||C:null,onPlay:()=>{this.setState({isPlaying:!0})}},O),!f&&!c&&L);else if(y)w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("video",{ref:this.videoRef,className:"media-viewer-content-video-player",onClick:this.handleContentClick,loop:!0,autoPlay:!0,width:M,height:I,onPlay:()=>{this.setState({isPlaying:!0})}},O),!f&&L);else if(g&&g.embed_url){let e=g.embed_url;switch(g.site_name){case"Coub":case"SoundCloud":case"Spotify":break;case"Twitch":e+="&parent=".concat(window.location.hostname);break;case"YouTube":e+="?iv_load_policy=3&controls=2&playsinline=1&rel=0&modestbranding=0&autoplay=1&enablejsapi=0&widgetid=1&showinfo=0";break;case"Vimeo":e+="?playsinline=true&autoplay=true&dnt=true&title=false"}w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("iframe",{src:e,width:M,height:I,frameBorder:0,allowFullScreen:!0,scrolling:"no",style:{background:"black"}}))}else w=o.a.createElement("img",{className:"media-viewer-content-image",src:l,alt:"",onClick:this.handleContentClick});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"media-viewer-content"},w,!c&&o.a.createElement(xs.a,{file:r,zIndex:2})),h&&h.length>0&&!E&&!v&&o.a.createElement(Qc,{text:h}))}}var bd=Object(_.a)()(Cd);a(621);class vd extends o.a.Component{constructor(e){var t;super(e),t=this,this.onKeyDown=e=>{const t=this.props.chatId,a=this.state.currentMessageId;if($.a.modals.length>0)return;if(e.isComposing)return;const n=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;switch(e.key){case"Escape":return this.handleClose(),e.stopPropagation(),void e.preventDefault();case"ArrowLeft":if(!n)return this.handlePrevious(),e.stopPropagation(),void e.preventDefault();break;case"ArrowRight":if(!n)return this.handleNext(),e.stopPropagation(),void e.preventDefault()}Object(tt.S)(t,a)&&x.a.clientUpdate({"@type":"clientUpdateMediaShortcut",event:e})},this.onUpdateMessageContent=e=>{const t=e.chat_id,a=e.message_id,n=e.new_content,s=e.old_content,i=this.props.chatId,r=this.state,o=r.currentMessageId,l=r.totalCount;if(i!==t)return;const c=ee.a.get(t,a);if(!c)return;Object(W.A)([c]);if(Object(tt.N)(n)&&!Object(tt.N)(s)){if(this.history.length>=2&&(this.firstSliceLoaded||Object(M.c)(a,this.history[0].id,this.history[this.history.length-1].id))){let e=!1,t=[];for(let n=0;n<this.history.length;n++)this.history[n].id>a||e||(e=!0,t.push(c)),t.push(this.history[n]);this.history=t}const e=this.history.findIndex(e=>e.id===o);this.setState({hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e),totalCount:l+1})}if(!Object(tt.N)(n)&&Object(tt.N)(s)){let e=this.history;if(this.history=this.history.filter(e=>e.id!==a),o===a){const t=new Map;t.set(a,a),this.moveToNextMedia(e,t),this.setState({totalCount:Math.max(l-1,0)})}else{const e=this.history.findIndex(e=>e.id===o);this.setState({hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e),totalCount:Math.max(l-1,0)})}}},this.onUpdateDeleteMessages=e=>{const t=e.chat_id,a=e.message_ids,n=e.is_permanent,s=this.props.chatId,i=this.state,r=i.currentMessageId,o=i.totalCount;if(!n)return;if(s!==t)return;const l=a.reduce((e,t)=>(e.set(t,t),e),new Map),c=this.history;let d=c.length;this.history=this.history.filter(e=>!l.has(e.id)),d-=this.history.length,this.setState({totalCount:Math.max(o-d,0)}),this.history.length?l.has(r)&&this.moveToNextMedia(c,l):Object(Q.u)(null)},this.onUpdateNewMessage=e=>{const t=this.props.chatId,a=this.state,n=a.currentMessageId,s=a.totalCount,i=e.message;if(!i)return;if(!Object(tt.N)(i.content))return;if(i.chat_id!==t)return;if(!this.firstSliceLoaded)return;this.history=[i].concat(this.history);const r=this.history.findIndex(e=>e.id===n);this.setState({hasNextMedia:this.hasNextMedia(r),hasPreviousMedia:this.hasPreviousMedia(r),totalCount:s+1})},this.getFilter=(e,t)=>{const a=ee.a.get(e,t);if(!a)return null;const n=a.content;if(!n)return null;switch(n["@type"]){case"messageChatChangePhoto":return{"@type":"searchMessagesFilterChatPhoto"};case"messagePhoto":case"messageVideo":return{"@type":"searchMessagesFilterPhotoAndVideo"};default:return null}},this.loadHistory=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.getFilter(n,i),o={"@type":"messages",messages:[],total_count:0},!r){e.next=7;break}return e.next=6,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:i,offset:-u.v,limit:2*u.v,filter:r});case 6:o=e.sent;case 7:if(Object(tt.f)(o,t.history),ee.a.setItems(o.messages),t.history=o.messages,t.firstSliceLoaded=0===o.messages.length,l=t.state.currentMessageId,c=t.history.findIndex(e=>e.id===l),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c)}),-1!==c){e.next=19;break}t.history=[ee.a.get(n,l)],Object(W.M)(0,t.history),e.next=39;break;case 19:if(Object(W.M)(c,t.history),r=t.getFilter(n,i)){e.next=23;break}return e.abrupt("return");case 23:d=1500,h=0;case 25:if(t.firstSliceLoaded||!(h<d)){e.next=39;break}return e.next=28,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:t.history.length>0?t.history[0].id:0,offset:-99,limit:100,filter:r});case 28:o=e.sent,h+=o.messages.length,Object(tt.f)(o,t.history),ee.a.setItems(o.messages),t.history=o.messages.concat(t.history),t.firstSliceLoaded=0===o.messages.length,l=t.state.currentMessageId,c=t.history.findIndex(e=>e.id===l),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c),firstSliceLoaded:t.firstSliceLoaded,totalCount:o.total_count}),e.next=25;break;case 39:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(Q.u)(null);const e=this.state.currentMessageId,t=this.history.findIndex(t=>t.id===e);-1!==t&&Object(W.b)(t,this.history)},this.handleSave=()=>{const e=this.props.chatId,t=this.state.currentMessageId,a=ee.a.get(e,t);if(!a)return;const n=a.content;if(!n)return;let s=null;switch(n["@type"]){case"messageAnimation":s=n.animation;break;case"messageChatChangePhoto":s=n.photo;break;case"messageDocument":s=n.document;break;case"messagePhoto":s=n.photo;break;case"messageText":{const e=n.web_page;if(!e)return;const t=e.animation,a=e.document,i=e.photo,r=e.video;if(t){s=t;break}if(a){s=a;break}if(i){s=i;break}if(r){s=r;break}break}case"messageVideo":s=n.video;break}Object(W.P)(s,a)},this.handleForward=()=>{const e=this.props.chatId,t=this.state.currentMessageId;Object(Q.h)(e,[t])},this.handleDelete=()=>{this.handleDialogOpen()},this.hasPreviousMedia=e=>{if(-1===e)return!1;return e+1<this.history.length},this.handlePrevious=e=>{e&&e.stopPropagation();const t=this.state.currentMessageId,a=this.history.findIndex(e=>e.id===t)+1;return this.loadMedia(a,()=>{a===this.history.length-1&&this.loadPrevious()})},this.loadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.state.currentMessageId,o=t.getFilter(n,i),l={"@type":"messages",messages:[],total_count:0},!o){e.next=8;break}return e.next=7,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:r,offset:0,limit:u.v,filter:o});case 7:l=e.sent;case 8:Object(tt.f)(l,t.history),ee.a.setItems(l.messages),t.history=t.history.concat(l.messages),c=t.history.findIndex(e=>e.id===r),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c),totalCount:l.total_count});case 13:case"end":return e.stop()}}),e)}))),this.hasNextMedia=e=>{if(-1===e)return!1;return e-1>=0},this.handleNext=e=>{e&&e.stopPropagation();const t=this.state.currentMessageId,a=this.history.findIndex(e=>e.id===t)-1;return this.loadMedia(a,()=>{0===a&&this.loadNext()})},this.loadNext=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.state.currentMessageId,o=t.getFilter(n,i),l={"@type":"messages",messages:[],total_count:0},!o){e.next=8;break}return e.next=7,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:r,offset:-u.v,limit:u.v+1,filter:o});case 7:l=e.sent;case 8:Object(tt.f)(l,t.history),ee.a.setItems(l.messages),t.firstSliceLoaded=0===l.messages.length,t.history=l.messages.concat(t.history),c=t.history.findIndex(e=>e.id===r),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c),firstSliceLoaded:t.firstSliceLoaded,totalCount:l.total_count});case 14:case"end":return e.stop()}}),e)}))),this.loadMedia=(e,t)=>!(e<0)&&(!(e>=this.history.length)&&(this.setState({currentMessageId:this.history[e].id,hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e)},t),Object(W.M)(e,this.history),!0)),this.moveToNextMedia=(e,t)=>{const a=this.state.currentMessageId,n=e.findIndex(e=>e.id===a);let s=0;for(let r=n-1;r>=0;r--)if(t&&!t.has(e[r].id)){s=e[r].id;break}if(!s)for(let r=n+1;r<e.length;r++)if(t&&!t.has(e[r].id)){s=e[r].id;break}if(!s)return;const i=this.history.findIndex(e=>e.id===s);return this.loadMedia(i,()=>{0===i?this.loadNext():i===this.history.length-1&&this.loadPrevious()})},this.handleDialogOpen=()=>{this.setState({deleteConfirmationOpened:!0})},this.handleDialogClose=()=>{this.setState({deleteConfirmationOpened:!1})},this.handleDone=()=>{this.setState({deleteConfirmationOpened:!1});const e=this.props.chatId,t=this.state,a=t.currentMessageId,n=t.deleteForAll,s=ee.a.get(e,a);if(!s)return;const i=s.can_be_deleted_only_for_self,r=s.can_be_deleted_for_all_users;(i||r)&&x.a.send({"@type":"deleteMessages",chat_id:e,message_ids:[a],revoke:r&&n})},this.handleChangeDeleteForAll=e=>{this.setState({deleteForAll:e.target.checked})},this.handleInvertColors=()=>{let e="media-viewer-default";switch(this.state.background){case"media-viewer-default":e="media-viewer-dark";break;case"media-viewer-dark":e="media-viewer-light";break;case"media-viewer-light":e="media-viewer-default"}this.setState({background:e})},this.canBeForwarded=(e,t)=>{const a=ee.a.get(e,t);if(!a)return!1;const n=a.can_be_forwarded,s=a.content;if(!s)return!1;switch(s["@type"]){case"messageChatChangePhoto":return!0;default:return n}},this.handleWrapperMouseDown=e=>{this.mouseDownTarget=e.currentTarget},this.handleWrapperClick=e=>{const t=this.mouseDownTarget;this.mouseDownTarget=null,e.currentTarget===t&&this.handleClose()},this.keyboardHandler=new I.a(this.onKeyDown),this.history=[];const a=this.props,n=a.chatId,r=a.messageId;this.state={background:"media-viewer-default",prevChatId:n,prevMessageId:r,currentMessageId:r,hasNextMedia:!1,hasPreviousMedia:!1,deleteConfirmationOpened:!1,deleteForAll:!0}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId,i=this.state,r=i.background,o=i.currentMessageId,l=i.deleteConfirmationOpened,c=i.firstSliceLoaded,d=i.hasNextMedia,h=i.hasPreviousMedia,p=i.totalCount;return t.background!==r||(e.chatId!==n||(e.messageId!==s||(t.currentMessageId!==o||(t.hasPrevousMedia!==h||(t.hasNextMedia!==d||(t.firstSliceLoaded!==c||(t.totalCount!==p||t.deleteConfirmationOpened!==l)))))))}componentDidMount(){this.loadHistory(),I.b.add(this.keyboardHandler),ee.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.on("updateNewMessage",this.onUpdateNewMessage),ee.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){I.b.remove(this.keyboardHandler),ee.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),ee.a.off("updateNewMessage",this.onUpdateNewMessage),ee.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){const e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.background,i=n.currentMessageId,r=n.deleteConfirmationOpened,l=n.deleteForAll,d=n.firstSliceLoaded,h=n.hasNextMedia,p=n.hasPreviousMedia,m=n.totalCount;let g=-1;m&&d&&(g=this.history.findIndex(e=>e.id===i));const C=Math.max(this.history.length,m),b=ee.a.get(t,i).can_be_deleted_for_all_users,v=Object(tt.b)(t,i),E=this.canBeForwarded(t,i);let S="";S=Object(tt.S)(t,i)?a("AreYouSureDeleteVideo"):Object(tt.H)(t,i)?a("AreYouSureDeleteGIF"):a("AreYouSureDeletePhoto");const y=r?o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:r,onClose:this.handleDialogClose,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},a("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,S),b&&o.a.createElement(Ts.a,{label:a("DeleteForAll"),control:o.a.createElement(je.a,{color:"primary",value:"deleteAll",onChange:this.handleChangeDeleteForAll}),checked:l})),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:this.handleDialogClose,color:"primary"},a("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},a("Ok")))):null,M=Object(W.i)(t,i,u.G),I=Object(L.a)(M,4),U=(I[0],I[1],I[2]),k=(I[3],U?U.id:0);let x=a("AttachPhoto");return Object(tt.K)(t,i)?x="":Object(tt.S)(t,i)?x=a("AttachVideo"):Object(tt.H)(t,i)&&(x=a("AttachGif")),o.a.createElement("div",{className:c()("media-viewer",s)},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(fd,{chatId:t,messageId:i}),o.a.createElement(id,{title:x,subtitle:C>1&&g>=0?an.a.formatString("Of",C-g,C):null}),o.a.createElement(cd,{title:a("Save"),fileId:k,disabled:Object(tt.K)(t,i),onClick:this.handleSave}),o.a.createElement(od,{title:a("Forward"),disabled:!E,onClick:this.handleForward},o.a.createElement(Ye,null)),o.a.createElement(od,{title:a("Delete"),disabled:!v,onClick:this.handleDelete},o.a.createElement(Ke,null)),o.a.createElement(od,{title:a("Close"),onClick:this.handleClose},o.a.createElement(f.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onMouseDown:this.handleWrapperMouseDown,onClick:this.handleWrapperClick},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(nd,{disabled:!p,grow:!0,onClick:this.handlePrevious},o.a.createElement(Jc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(bd,{chatId:t,messageId:i,size:u.G,onClick:this.handlePrevious})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(nd,{disabled:!h,grow:!0,onClick:this.handleNext},o.a.createElement(Jc,{style:{transform:"rotate(180deg)"}})))),o.a.createElement("div",{className:"media-viewer-footer"}),y)}}var Ed=Object(_.a)()(vd);a(449);class Sd extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatBlob=e=>{const t=this.props,a=t.chatId,n=t.photo;if(a===e.chatId&&n.big.id===e.fileId){const t=U.a.get(e.fileId)||this.state.file;this.setState({file:t})}},this.onClientUpdateUserBlob=e=>{const t=this.props,a=t.chatId,n=t.photo;if(Object(F.B)(a)===e.userId&&n.big.id===e.fileId){const t=U.a.get(e.fileId)||this.state.file;this.setState({file:t})}},this.handleContentClick=e=>{e&&e.stopPropagation();const t=this.props.onClose;t&&t(e)},this.handlePhotoClick=e=>{e&&e.stopPropagation();const t=this.props.onPrevious;t&&t(e)};const t=this.props,a=t.chatId,n=t.photo;let s=n.big;s=U.a.get(s.id)||s,this.state={prevChatId:a,prevPhoto:n,width:u.vb,height:u.vb,file:s}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.photo;return a!==t.prevChatId||n!==t.prevPhoto?{prevChatId:a,prevPhoto:n,width:u.vb,height:u.vb,file:n.big}:null}componentDidMount(){U.a.on("clientUpdateChatBlob",this.onClientUpdateChatBlob),U.a.on("clientUpdateUserBlob",this.onClientUpdateUserBlob)}componentWillUnmount(){U.a.off("clientUpdateChatBlob",this.onClientUpdateChatBlob),U.a.off("clientUpdateUserBlob",this.onClientUpdateUserBlob)}render(){const e=this.state.file;if(!e)return null;const t=U.a.getBlob(e.id)||e.blob,a=U.a.getBlobUrl(t);return o.a.createElement("div",{className:"media-viewer-content",onClick:this.handleContentClick},o.a.createElement("img",{className:"media-viewer-content-image",src:a,alt:"",onClick:this.handlePhotoClick}),o.a.createElement(xs.a,{file:e}))}}var yd=Sd;class Md extends o.a.Component{render(){const e=this.props,t=e.chatId,a=e.date,n=e.style;return o.a.createElement("div",{className:"media-info",style:n},o.a.createElement("div",{className:"media-info-wrapper"},o.a.createElement(D.a,{chatId:t,showSavedMessages:!1}),o.a.createElement("div",{className:"media-info-content"},o.a.createElement("div",{className:"media-info-row"},o.a.createElement(pt.a,{sender:{"@type":"messageSenderChat",chat_id:t}})),a&&o.a.createElement("div",{className:"media-info-row meta"},o.a.createElement("span",null,a)))))}}var Id=Md;class Ud extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleKeyDown=e=>{if(!($.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":return this.handleClose(),e.preventDefault(),void e.stopPropagation();case"ArrowLeft":return this.handleNext(),e.stopPropagation(),void e.preventDefault();case"ArrowRight":return this.handlePrevious(),e.stopPropagation(),void e.preventDefault()}},this.loadHistory=Object(i.a)(s.a.mark((function e(){var a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,Object(F.hb)(a)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,x.a.send({"@type":"getUserProfilePhotos",user_id:Object(F.B)(a),offset:0,limit:100});case 5:n=e.sent,t.history=n.photos,t.firstSliceLoaded=0===n.photos.length,0,t.setState({currentIndex:0,hasNextMedia:t.hasNextMedia(0),hasPreviousMedia:t.hasPreviousMedia(0),totalCount:n.total_count}),Object(W.N)(a,0,t.history);case 11:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(Q.v)(null)},this.handleSave=()=>{const e=this.props.chatId,t=this.state,a=t.currentIndex,n=t.totalCount,s=Se.a.get(e);if(!s)return;let i=-1;n&&(i=a);const r=i>0&&i<this.history.length?Object(Et.a)(this.history[i]):Object(F.L)(e);if(!r)return;if(!r.big)return;const o=U.a.get(r.big.id)||r.big;o&&Object(W.Q)(o,o.id+".jpg",s,()=>U.a.updateChatPhotoBlob(e,o.id))},this.handleForward=()=>{const e=this.props.chatId,t=this.state,a=t.currentIndex;let n=-1;t.totalCount&&(n=a);let s=null;if(this.history&&n>=0&&n<this.history.length){const e=Object(Et.a)(this.history[n]);if(!e)return;let t=e.big;if(!t)return;s={"@type":"inputFileId",id:t.id}}else{const t=Object(F.L)(e);if(!t)return;const a=t.big;if(!a)return;const n=U.a.getBlob(a.id);if(!n)return;s={"@type":"inputFileBlob",data:n,name:""}}if(!s)return;const i={"@type":"inputMessagePhoto",photo:s,thumbnail:null,added_sticker_file_ids:[],width:u.vb,height:u.vb,caption:{"@type":"formattedText",text:"",entities:null},ttl:0};Object(Q.g)(i)},this.handleDelete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,d,h,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state,i=n.currentIndex,r=n.totalCount,o=n.hasNextMedia,l=n.hasPreviousMedia,c=-1,r&&(c=i),d=c>0&&c<t.history.length?Object(Et.a)(t.history[c]):Object(F.L)(a)){e.next=7;break}return e.abrupt("return");case 7:if(h=d.id){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,x.a.send({"@type":"deleteProfilePhoto",profile_photo_id:h});case 12:if(t.history.splice(c,1),t.history.length){e.next=16;break}return t.handleClose(),e.abrupt("return");case 16:if(t.setState({totalCount:r-1}),!o){e.next=20;break}return p=i-1,e.abrupt("return",t.loadMedia(p,{totalCount:r-1},()=>{0===p&&t.loadNext()}));case 20:if(!l){e.next=23;break}return p=i,e.abrupt("return",t.loadMedia(p,{totalCount:r-1},()=>{p===t.history.length-1&&t.loadPrevious()}));case 23:case"end":return e.stop()}}),e)}))),this.hasPreviousMedia=e=>{if(-1===e)return!1;return e+1<this.history.length},this.handlePrevious=e=>{e&&e.stopPropagation();const t=this.state.currentIndex+1;return this.loadMedia(t,{},()=>{t===this.history.length-1&&this.loadPrevious()})},this.loadPrevious=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),this.hasNextMedia=e=>{if(-1===e)return!1;return e-1>=0},this.handleNext=e=>{e&&e.stopPropagation();const t=this.state.currentIndex-1;return this.loadMedia(t,{},()=>{0===t&&this.loadNext()})},this.loadNext=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),this.loadMedia=(e,t,a)=>{if(e<0)return!1;if(e>=this.history.length)return!1;this.setState(Object(Ve.a)(Object(Ve.a)({currentIndex:e},t),{},{hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e)}),a);const n=this.props.chatId;return Object(W.N)(n,e,this.history),!0},this.history=[],this.keyboardHandler=new I.a(this.handleKeyDown);const a=this.props,n=a.chatId,r=a.fileId;this.state={prevChatId:n,prevFileId:r,currentIndex:0,hasNextMedia:!1,hasPreviousMedia:!1,deleteConfirmationOpened:!1}}shouldComponentUpdate(e,t){const a=this.props,n=a.chatId,s=a.messageId,i=this.state,r=i.currentFileId,o=i.hasPreviousMedia,l=i.hasNextMedia,c=i.firstSliceLoaded,d=i.totalCount,h=i.deleteConfirmationOpened;return e.chatId!==n||(e.messageId!==s||(t.currentFileId!==r||(t.hasPrevousMedia!==o||(t.hasNextMedia!==l||(t.firstSliceLoaded!==c||(t.totalCount!==d||t.deleteConfirmationOpened!==h))))))}componentDidMount(){const e=this.props.chatId,t=Object(F.L)(e);Object(W.C)(e,[t]),this.loadHistory(t),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}render(){const e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.currentIndex,i=n.hasNextMedia,r=n.hasPreviousMedia,l=n.totalCount;let d=-1;l&&(d=s);const h=d>=0&&d<this.history.length,p=h?Object(Et.a)(this.history[d]):null,u=p?p.big:null,m=(u?u.blob||U.a.getBlob(u.id):null)?p:Object(F.L)(t),g=h?this.history[d]:null,C=m.big,b=Object(F.gb)(t);return o.a.createElement("div",{className:c()("media-viewer","media-viewer-default")},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(Id,{chatId:t,date:Object(Et.b)(g)}),o.a.createElement(id,{title:a("AttachPhoto"),subtitle:l>1&&d>=0?an.a.formatString("Of",d+1,l):null}),o.a.createElement("div",{style:{width:64}}),o.a.createElement(cd,{title:a("Save"),fileId:C.id,onClick:this.handleSave}),o.a.createElement(cd,{title:a("Forward"),fileId:C.id,onClick:this.handleForward},o.a.createElement(Ye,null)),b&&o.a.createElement(od,{title:a("Delete"),onClick:this.handleDelete},o.a.createElement(Ke,null)),o.a.createElement(od,{title:a("Close"),onClick:this.handleClose},o.a.createElement(f.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onClick:this.handlePrevious},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(nd,{disabled:!i,grow:!0,onClick:this.handleNext},o.a.createElement(Jc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(yd,{chatId:t,photo:m,onClose:this.handleClose,onPrevious:this.handlePrevious})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(nd,{disabled:!r,grow:!0,onClick:this.handlePrevious},o.a.createElement(Jc,{style:{transform:"rotate(180deg)"}})))))}}var kd=Object(_.a)()(Ud);a(261),a(622);class xd extends o.a.Component{constructor(...e){super(...e),this.handleClose=e=>{const t=this.props.onClose;t&&t(!1)}}render(){const e=this.props,t=e.params,a=e.t;if(!t)return null;let n=t.title,s=t.message,i=t.ok,r=t.cancel;return"formattedText"===s["@type"]&&(s=Object(tt.o)(s,a,{})),o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:this.handleClose,classes:{paper:"alert-dialog"}},o.a.createElement(R.a,null,n),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,s)),o.a.createElement(T.a,null,r&&o.a.createElement(N.a,{onClick:()=>this.handleClose(!1),color:"primary"},r),i&&o.a.createElement(N.a,{onClick:()=>this.handleClose(!0),color:"primary"},i)))}}var wd=Object(_.a)()(xd);a(623);class Od extends o.a.Component{constructor(...e){super(...e),this.state={reportSpam:!0,deleteChat:!0},this.handleReportSpamChange=()=>{const e=this.state.reportSpam;this.setState({reportSpam:!e})},this.handleDeleteChatChange=()=>{const e=this.state.deleteChat;this.setState({deleteChat:!e})}}render(){const e=this.props,t=e.sender,a=e.onClose,n=e.t;if(!t)return null;const s=this.state,i=s.reportSpam,r=s.deleteChat;let l=null,c=null;const d=[];let h=null;switch(t["@type"]){case"messageSenderUser":{const e=t.user_id;l=an.a.formatString("BlockUserTitle",Object(Et.e)(e,n)),c=an.a.formatString("BlockUserAlert",Object(Et.e)(e,n)),c=Object(tt.x)(c,d),h=an.a.getString("BlockContact");break}case"messageSenderChat":{const e=t.chat_id,a=Object(F.p)(e);a?(l=an.a.getString("ReportUnrelatedGroup"),a.address?(c=an.a.formatString("ReportUnrelatedGroupText",a.address),c=Object(tt.x)(c,d)):c=an.a.getString("ReportUnrelatedGroupTextNoAddress")):(l=an.a.getString("ReportSpamTitle"),c=Object(F.V)(e)?an.a.getString("ReportSpamAlertChannel"):an.a.getString("ReportSpamAlertGroup")),h=an.a.getString("ReportChat");break}}return o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:()=>a(!1,null),"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},l),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,Object(tt.o)({"@type":"formattedText",text:c,entities:d})),"messageSenderUser"===t["@type"]&&o.a.createElement("div",{className:"block-sender-params"},o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{checked:i,onChange:this.handleReportSpamChange,color:"primary"}),label:n("DeleteReportSpam")}),o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{checked:r,onChange:this.handleDeleteChatChange,color:"primary"}),label:n("DeleteThisChat")}))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>a(!1,null),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0,t&&"messageSenderUser"===t["@type"]?{reportSpam:i,deleteChat:r}:null),color:"secondary"},h)))}}var Ld=Object(_.a)()(Od);class _d extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleRevokeChange=()=>{const e=this.state.revoke;this.setState({revoke:!e})}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=t.prevChatId,s=Se.a.get(a).can_be_deleted_for_all_users;return n!==a?{prevChatId:a,canBeDeletedForAllUsers:s,revoke:s}:null}render(){const e=this.props,t=e.chatId,a=e.onClose,n=e.t,s=this.state,i=s.canBeDeletedForAllUsers,r=s.revoke;return o.a.createElement(P.a,{manager:$.a,open:!0,transitionDuration:0,onClose:()=>a(!1,r),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},Object(F.u)(t,!1,n)),o.a.createElement(Ln.a,null,o.a.createElement("div",{className:"delete-dialog-content"},o.a.createElement(D.a,{chatId:t}),o.a.createElement("div",null,o.a.createElement(_n.a,{id:"delete-dialog-description"},"Are you sure you want clear history?"),i&&o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{checked:r,onChange:this.handleRevokeChange,color:"primary"}),label:Object(F.hb)(t)?"Also delete for ".concat(Object(F.u)(t,!1,n)):"Delete for all members",style:{marginLeft:0}})))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>a(!1,r),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0,r),color:"primary"},n("Ok"))))}}var Nd=Object(_.a)()(_d);class jd extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleRevokeChange=()=>{const e=this.state.revoke;this.setState({revoke:!e})}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.messageIds,s=t.prevChatId,i=t.prevMessageIds;let r=!0;var o,l=Object(ss.a)(n);try{for(l.s();!(o=l.n()).done;){let e=o.value;const t=ee.a.get(a,e);if(!t){r=!1;break}if(!t.can_be_deleted_for_all_users){r=!1;break}}}catch(c){l.e(c)}finally{l.f()}return s!==a&&i!==n?{prevChatId:a,prevMessageIds:n,canBeDeletedForAllUsers:r,revoke:r}:null}render(){const e=this.props,t=e.chatId,a=e.messageIds,n=e.onClose,s=e.t,i=this.state,r=i.canBeDeletedForAllUsers,l=i.revoke,c=a?a.length:0;let d=s(1===c?"AreYouSureDeleteSingleMessage":"AreYouSureDeleteFewMessages");return Object(F.ib)(t)&&!Object(F.V)(t)&&(d=s(1===c?"AreYouSureDeleteSingleMessageMega":"AreYouSureDeleteFewMessagesMega")),o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:()=>n(!1,l),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},an.a.formatString("DeleteMessagesTitle",an.a.formatPluralString("messages",c))),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,d),!Object(F.ib)(t)&&r&&o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{checked:l,onChange:this.handleRevokeChange,color:"primary"}),label:Object(F.hb)(t)?Z(s,"DeleteForUser",Object(F.u)(t,!1,s)):s("DeleteForAll")})),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>n(!1,l),color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:()=>n(!0,l),color:"primary"},s("Ok"))))}}var Pd=Object(_.a)()(jd),Td=a(414),Rd=a(411),Dd=a(416),Fd=a(413),Ad=a(221),Bd=a.n(Ad);a(624);class Hd extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleChange=e=>{this.password=e.target.value},this.handleClickShowPassword=()=>{const e=this.state.showPassword;this.setState({showPassword:!e})},this.getErrorMessage=e=>{const t=this.props.t;if(!e)return null;if("PASSWORD_HASH_INVALID"===e.message)return t("InvalidPassword");if(e.message.startsWith("Too Many Requests: retry after ")){const t=e.message.replace("Too Many Requests: retry after ","");try{const e=parseInt(t),a=e<60?an.a.formatPluralString("Seconds",e):an.a.formatPluralString("Minutes",Math.floor(e/60));return an.a.formatString("FloodWaitTime",a)}catch(a){return e.message}}return e.message}}render(){const e=this.props,t=e.state,a=e.error,n=e.onClose,s=e.t;if(!t)return null;const i=this.state,r=i.showPassword,l=i.loading,c=t.password_hint,d=this.getErrorMessage(a);return o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:()=>n(!1),classes:{paper:"alert-dialog"}},o.a.createElement(R.a,null,s("TwoStepVerificationTitle")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,s("PleaseEnterCurrentPasswordTransfer")),o.a.createElement(Rs.a,{className:"auth-input",fullWidth:!0},o.a.createElement(Fd.a,{htmlFor:"adornment-password",error:Boolean(a)},s("LoginPassword")),o.a.createElement(Rd.a,{fullWidth:!0,autoFocus:!0,autoComplete:"off",id:"adornment-password",type:r?"text":"password",disabled:l,error:Boolean(a),onChange:this.handleChange,endAdornment:o.a.createElement(Dd.a,{position:"end"},o.a.createElement(j.a,{"aria-label":"Toggle password visibility",onClick:this.handleClickShowPassword,edge:"end"},r?o.a.createElement(wl.a,null):o.a.createElement(Bd.a,null)))}),c&&o.a.createElement(Td.a,{id:"password-hint-text"},c),o.a.createElement(Td.a,{id:"password-error-text",error:!0},d||" "))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>n(!1),color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:()=>n(!0,this.password),color:"primary"},s("OK"))))}}var Vd=Object(_.a)()(Hd);class zd extends o.a.Component{constructor(...e){super(...e),this.getDeleteDialogText=(e,t)=>{const a=Se.a.get(e);if(!a)return null;if(!a.type)return null;switch(a.type["@type"]){case"chatTypeBasicGroup":return"Are you sure you want to leave group ".concat(a.title,"?");case"chatTypeSupergroup":{const e=Ue.a.get(a.type.supergroup_id);return e?e.is_channel?"Are you sure you want to leave channel ".concat(a.title,"?"):"Are you sure you want to leave group ".concat(a.title,"?"):null}case"chatTypePrivate":case"chatTypeSecret":return"Are you sure you want to delete chat with ".concat(Object(F.u)(e,!1,t),"?")}return null}}render(){const e=this.props,t=e.chatId,a=e.onClose,n=e.t;return o.a.createElement(P.a,{manager:$.a,open:!0,transitionDuration:0,onClose:()=>a(!1),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},Object(F.u)(t,!1,n)),o.a.createElement(Ln.a,null,o.a.createElement("div",{className:"delete-dialog-content"},o.a.createElement(D.a,{chatId:t}),o.a.createElement(_n.a,{id:"delete-dialog-description"},this.getDeleteDialogText(t,n)))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>a(!1),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0),color:"primary",autoFocus:!0},n("Ok"))))}}var Wd=Object(_.a)()(zd);a(625);class Gd extends o.a.Component{render(){const e=this.props,t=e.game,a=e.params,n=e.onClose,s=e.t;if(!t)return null;const i=a.userId;return o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:e=>n(e,!1),classes:{paper:"alert-dialog"}},o.a.createElement(R.a,null,s("AppName")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,an.a.formatString("BotPermissionGameAlert",Object(Et.c)(i)))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:e=>n(e,!1),color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:e=>n(e,!0),color:"primary"},s("OK"))))}}var Zd=Object(_.a)()(Gd);a(626);class qd extends o.a.Component{render(){const e=this.props,t=e.url,a=e.onClose,n=e.t;return t?o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:e=>a(e,!1),classes:{paper:"alert-dialog"}},o.a.createElement(R.a,null,n("OpenUrlTitle")),o.a.createElement(Ln.a,{style:{overflowWrap:"break-word"}},o.a.createElement(_n.a,null,an.a.formatString("OpenUrlAlert2",t))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:e=>a(e,!1),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:e=>a(e,!0),color:"primary"},n("Open")))):null}}var Kd=Object(_.a)()(qd);a(627);class Yd extends o.a.Component{constructor(...e){super(...e),this.state={value1:!0,value2:!0},this.handleValue1Change=()=>{const e=this.state.value1;this.setState({value1:!e})},this.handleValue2Change=()=>{const e=this.state.value2;this.setState({value2:!e})}}render(){const e=this.props,t=e.url,a=e.params,n=e.onClose,s=e.t;if(!t)return null;const i=this.state,r=i.value1,l=i.value2,c=a.result;if(!c)return null;const d=c.domain,h=c.bot_user_id,p=c.request_write_access;let u=an.a.formatString("OpenUrlOption1",d,Object(Et.c)(te.a.getMyId()));const m=[];u=Object(tt.x)(u,m);const g=o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{color:"primary",checked:r,onChange:this.handleValue1Change}),label:Object(tt.o)({"@type":"formattedText",text:u,entities:m},s)});let f=null;if(p){let e=an.a.formatString("OpenUrlOption2",Object(Et.e)(h,s));const t=[];e=Object(tt.x)(e,t),f=o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{color:"primary",checked:l,onChange:this.handleValue2Change}),label:Object(tt.o)({"@type":"formattedText",text:e,entities:t},s)})}return o.a.createElement(P.a,{open:!0,manager:$.a,transitionDuration:0,onClose:e=>n(e,!1),classes:{paper:"alert-dialog"}},o.a.createElement(R.a,null,s("OpenUrlTitle")),o.a.createElement(Ln.a,{style:{display:"flex",flexDirection:"column",overflowWrap:"break-word"}},o.a.createElement(_n.a,null,an.a.formatString("OpenUrlAlert2",t)),g,f),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:e=>n(e,!1),color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:e=>n(e,!0,{value1:r,value2:l}),color:"primary"},s("Open"))))}}var Jd=Object(_.a)()(Yd);a(628);class Xd extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleRevokeChange=()=>{const e=this.state.revoke;this.setState({revoke:!e})}}static getDerivedStateFromProps(e,t){const a=e.chatId,n=e.messageId,s=t.prevChatId,i=t.prevMessageId;return s!==a&&i!==n?{prevChatId:a,prevMessageIds:n,revoke:!Object(F.hb)(a)}:null}render(){const e=this.props,t=e.chatId,a=e.onClose,n=e.t,s=this.state.revoke,i=Se.a.get(t);if(!i)return null;let r="";switch(i.type["@type"]){case"chatTypePrivate":case"chatTypeSecret":r=n("PinMessageAlertChat");break;case"chatTypeBasicGroup":r=n("PinMessageAlert");break;case"chatTypeSupergroup":r=Object(F.V)(t)?n("PinMessageAlertChannel"):n("PinMessageAlert")}return o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:()=>a(!1,s),"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},n("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,r),o.a.createElement(o.a.Fragment,null,Object(F.hb)(t)&&o.a.createElement(Ts.a,{control:o.a.createElement(je.a,{checked:s,onChange:this.handleRevokeChange,color:"primary"}),label:"Also pin for ".concat(Object(F.u)(t,!1,n))}))),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>a(!1,s),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0,s),color:"primary"},n("Ok"))))}}var Qd=Object(_.a)()(Xd),$d=a(246);a(629);class eh extends o.a.Component{constructor(e){super(e),this.handleTimer=()=>{const e=new Date,t=this.expire-e,a=100-t/this.props.timeout*100;if(this.setState({seconds:t>0?t:0,value:a>100?100:a}),e>=this.expire&&this.timerId){clearInterval(this.timerId),this.timerId=null;const e=this.props.onTimeout;e&&e()}},this.state={seconds:this.props.timeout/1e3,value:0}}componentDidMount(){this.startTime=new Date,this.expire=this.startTime,this.expire.setMilliseconds(this.expire.getMilliseconds()+this.props.timeout),this.timerId=setInterval(this.handleTimer,100)}componentWillUnmount(){this.timerId&&(clearInterval(this.timerId),this.timerId=null)}render(){const e=this.state,t=e.value,a=e.seconds;return o.a.createElement("div",{className:"notification-timer"},o.a.createElement("div",{className:"notification-timer-text"},o.a.createElement(or.a,{color:"inherit"},(a/1e3).toFixed())),o.a.createElement("div",{className:"notification-timer-progress"},o.a.createElement($d.a,{size:32,value:100-t,variant:"static"})))}}var th=eh;a(630);class ah extends o.a.Component{render(){const e=this.props,t=e.messageId,a=e.onClose,n=e.t,s=n(t?"UnpinMessageAlert":"UnpinAllMessagesAlert");return o.a.createElement(P.a,{manager:$.a,transitionDuration:0,open:!0,onClose:()=>a(!1),"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},n("Confirm")),o.a.createElement(Ln.a,null,o.a.createElement(_n.a,null,s)),o.a.createElement(T.a,null,o.a.createElement(N.a,{onClick:()=>a(!1),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0),color:"primary"},n("Ok"))))}}var nh=Object(_.a)()(ah);class sh extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={leaveChat:null,clearHistory:null,deleteMessages:null,pinMessage:null,unpinMessage:null,alert:null,openUrlAlert:null,openGameAlert:null,requestUrlAlert:null,inputPasswordAlert:null,requestBlockSenderAlert:null},this.onClientUpdateBlockSender=e=>{const t=e.sender;this.setState({requestBlockSenderAlert:{sender:t}})},this.onClientUpdateInputPasswordAlert=e=>{const t=e.state,a=e.onPassword;this.setState({inputPasswordAlert:{state:t,onPassword:a}})},this.onClientUpdateOpenGameAlert=e=>{const t=e.game,a=e.params;a&&a.isVerified?(this.openGameAlert={game:t,params:a},this.handleOpenGameContinue(null,!0)):this.setState({openGameAlert:{game:t,params:a}})},this.onClientUpdateOpenUrlAlert=e=>{const t=e.url,a=e.params;a&&!a.ask?(this.openUrlAlert={url:t,params:a},this.handleOpenUrlContinue(null,!0)):this.setState({openUrlAlert:{url:t,params:a}})},this.onClientUpdateRequestUrlAlert=e=>{const t=e.url,a=e.params;this.setState({requestUrlAlert:{url:t,params:a}})},this.onClientUpdateSnackbar=e=>{const t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=e.message,i=e.action;a(s,{autoHideDuration:u.C,preventDuplicate:!0,action:i(n)})},this.onClientUpdateAlert=e=>{const t=e.params;this.setState({alert:{params:t}})},this.onClientUpdateUnpinMessage=e=>{const t=e.chatId,a=e.messageId;Object(F.gb)(t)?(this.unpinMessage={chatId:t,messageId:a},this.handleUnpinMessageContinue(!0,!1)):this.setState({unpinMessage:{chatId:t,messageId:a}})},this.onClientUpdatePinMessage=e=>{const t=e.chatId,a=e.messageId;Object(F.gb)(t)?(this.pinMessage={chatId:t,messageId:a},this.handlePinMessageContinue(!0,!1)):this.setState({pinMessage:{chatId:t,messageId:a}})},this.onClientUpdateDeleteMessages=e=>{const t=e.chatId,a=e.messageIds;this.setState({deleteMessages:{chatId:t,messageIds:a}})},this.onClientUpdateLeaveChat=e=>{const t=e.chatId;this.setState({leaveChat:{chatId:t}})},this.onClientUpdateClearHistory=e=>{const t=e.chatId;this.setState({clearHistory:{chatId:t}})},this.handleClearHistoryContinue=(e,t)=>{const a=this.props.t;if(!this.state.clearHistory)return;if(this.setState({clearHistory:null}),!e)return;const n=ae.a.getChatId(),s=a("HistoryClearedUndo"),i={"@type":"deleteChatHistory",chat_id:n,remove_from_chat_list:!1,revoke:t};this.handleScheduledAction(n,"clientUpdateClearHistory",s,[i])},this.handleLeaveContinue=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.state||t,r=i.leaveChat){e.next=3;break}return e.abrupt("return");case 3:if(o=r.chatId,l=Se.a.get(o)){e.next=7;break}return e.abrupt("return");case 7:if(t.leaveChat=null,t.setState({leaveChat:null}),a){e.next=11;break}return e.abrupt("return");case 11:switch(c=t.getLeaveChatNotification(o),d=[],l.type["@type"]){case"chatTypeBasicGroup":Object(F.X)(o)&&d.push({"@type":"leaveChat",chat_id:o}),d.push({"@type":"deleteChatHistory",chat_id:o,remove_from_chat_list:!0});case"chatTypeSupergroup":Object(F.db)(o)?d.push({"@type":"setChatMemberStatus",chat_id:o,user_id:te.a.getMyId(),status:{"@type":"chatMemberStatusCreator",is_member:!1}}):Object(F.X)(o)&&d.push({"@type":"leaveChat",chat_id:o});case"chatTypePrivate":case"chatTypeSecret":d.push({"@type":"deleteChatHistory",chat_id:o,remove_from_chat_list:!0})}if(!n){e.next=18;break}t.handleScheduledAction(o,"clientUpdateLeaveChat",c,d),e.next=28;break;case 18:e.prev=18,h=0;case 20:if(!(h<d.length)){e.next=26;break}return e.next=23,x.a.send(d[h]);case 23:h++,e.next=20;break;case 26:return e.prev=26,e.finish(26);case 28:case"end":return e.stop()}}),e,null,[[18,,26,28]])})));return function(t){return e.apply(this,arguments)}}(),this.handleDeleteMessagesContinue=(e,t)=>{const a=this.state.deleteMessages;if(!a)return;const n=a.chatId,s=a.messageIds;Object(Q.b)(),this.setState({deleteMessages:null}),e&&x.a.send({"@type":"deleteMessages",chat_id:n,message_ids:s,revoke:t})},this.getLeaveChatNotification=e=>{const t=this.props.t,a=Se.a.get(e);if(!a)return t("ChatDeletedUndo");if(!a.type)return t("ChatDeletedUndo");switch(a.type["@type"]){case"chatTypeBasicGroup":return t("ChatDeletedUndo");case"chatTypeSupergroup":{const e=Ue.a.get(a.type.supergroup_id);return e?e.is_channel?"Left channel":"Left group":t("ChatDeletedUndo")}case"chatTypePrivate":case"chatTypeSecret":return t("ChatDeletedUndo")}return t("ChatDeletedUndo")},this.handleScheduledAction=(e,t,a,n)=>{const r=this.props,l=r.t,c=r.enqueueSnackbar,d=r.closeSnackbar;if(!t)return;const h="".concat(t," chatId=").concat(e),p=function(){var a=Object(i.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,i=0;case 2:if(!(i<n.length)){a.next=8;break}return a.next=5,x.a.send(n[i]);case 5:i++,a.next=2;break;case 8:return a.prev=8,d(g),x.a.clientUpdate({"@type":t,chatId:e,inProgress:!1}),a.finish(8);case 12:case"end":return a.stop()}}),a,null,[[0,,8,12]])})));return function(){return a.apply(this,arguments)}}(),m=()=>{d(g),x.a.clientUpdate({"@type":t,chatId:e,inProgress:!1})};ae.a.addScheduledAction(h,Number.MAX_VALUE,p,m),x.a.clientUpdate({"@type":t,chatId:e,inProgress:!0});const g=c(a,{persist:!0,key:h,preventDuplicate:!0,action:[o.a.createElement(j.a,{key:"progress",color:"inherit",className:"progress-button"},o.a.createElement(th,{timeout:u.C,onTimeout:()=>{p(),ae.a.removeScheduledAction(h)}})),o.a.createElement(N.a,{key:"undo",color:"primary",size:"small",onClick:()=>{m(),ae.a.removeScheduledAction(h)}},l("Undo"))]})},this.handlePinMessageContinue=(e,t)=>{let a=this.state.pinMessage;if(a=a||this.pinMessage,!a)return;const n=a,s=n.chatId,i=n.messageId;Object(Q.b)(),this.setState({pinMessage:null}),this.pinMessage=null,e&&Object(ka.d)(s,i,!1,!t)},this.handleUnpinMessageContinue=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(n=t.state.unpinMessage)||t.unpinMessage){e.next=4;break}return e.abrupt("return");case 4:if(r=(i=n).chatId,o=i.messageId,Object(Q.b)(),t.setState({unpinMessage:null}),t.unpinMessage=null,a){e.next=10;break}return e.abrupt("return");case 10:if(!Object(F.d)(r)){e.next=21;break}if(!o){e.next=16;break}return e.next=14,Object(ka.k)(r,o);case 14:e.next=19;break;case 16:return Object(Q.d)(),e.next=19,Object(ka.j)(r);case 19:e.next=25;break;case 21:return Object(Q.d)(),l=Se.a.getClientData(r),e.next=25,x.a.clientUpdate({"@type":"clientUpdateSetChatClientData",chatId:r,clientData:Object(Ve.a)(Object(Ve.a)({},l),{unpinned:!0})});case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleAlertContinue=e=>{this.setState({alert:null})},this.handleOpenUrlContinue=(e,t)=>{const a=this.state.openUrlAlert||this.openUrlAlert;if(this.setState({openUrlAlert:null}),this.openUrlAlert=null,!t)return;const n=a.url,s=a.onClick;if(n)if(s)s(e);else{const e=window.open();e.opener=null,e.location=n}},this.handleOpenGameContinue=(e,t)=>{const a=this.state.openGameAlert||this.openGameAlert;if(this.setState({openGameAlert:null}),this.openGameAlert=null,!t)return;const n=a.game,s=a.params;if(!n)return;if(!s)return;const i=s.url,r=s.message;i&&r&&function(e,t){let a={};try{a=JSON.parse(localStorage.getItem("botshare"))||{}}catch(l){}const n=a[""+t.id];let s=n||"",i="tgShareScoreUrl="+encodeURIComponent("tg://share_game_score?hash=");if(!n){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=new Uint8Array(1);for(let t=0;t<20;t++)window.crypto.getRandomValues(n),s+=e[n[0]%e.length];a[""+t.id]=s,localStorage.setItem("botshare",JSON.stringify(a))}i+=s;const r=e.indexOf("#");if(r<0)e+="#"+i;else{const t=e.substring(0,r+1);t.indexOf("=")>=0||t.indexOf("?")>=0?e+="&"+i:t.length>0?e+="?"+i:e+=i}const o=window.open();o.opener=null,o.location=e}(i,r)},this.handleRequestUrlContinue=function(){var e=Object(i.a)(s.a.mark((function e(a,n,i){var r,o,l,c,d,h,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state.requestUrlAlert,t.setState({requestUrlAlert:null}),n){e.next=4;break}return e.abrupt("return");case 4:if(o=r.params){e.next=7;break}return e.abrupt("return");case 7:if(l=o.result,c=o.chatId,d=o.messageId,h=o.buttonId,l){e.next=10;break}return e.abrupt("return");case 10:if(i.value1){e.next=15;break}t.openUrlAlert={url:l.url},t.handleOpenUrlContinue(a,n),e.next=20;break;case 15:return e.next=17,x.a.send({"@type":"getLoginUrl",chat_id:c,message_id:d,button_id:h,allow_write_access:l.request_write_access&&i.value2});case 17:p=e.sent,t.openUrlAlert={url:p.url},t.handleOpenUrlContinue(a,n);case 20:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleInputPasswordContinue=(e,t)=>{const a=this.state.inputPasswordAlert,n=()=>this.setState({inputPasswordAlert:null});if(!e)return void n();const s=a.onPassword;s&&s(t,n,e=>this.setState({inputPasswordAlert:Object(Ve.a)(Object(Ve.a)({},a),{},{error:e})}))},this.handleBlockSenderContinue=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.state.requestBlockSenderAlert,t.setState({requestBlockSenderAlert:null}),a){e.next=4;break}return e.abrupt("return");case 4:if(r=i.sender){e.next=7;break}return e.abrupt("return");case 7:o=null,e.t0=r["@type"],e.next="messageSenderUser"===e.t0?11:"messageSenderChat"===e.t0?16:18;break;case 11:return Object(ka.a)(r),e.next=14,x.a.send({"@type":"createPrivateChat",user_id:r.user_id});case 14:return o=e.sent,e.abrupt("break",18);case 16:return o=r.chat_id,e.abrupt("break",18);case 18:if(n&&!n.reportSpam||(l=Object(F.p)(o)?{"@type":"chatReportReasonUnrelatedLocation"}:{"@type":"chatReportReasonSpam"},Object(Pe.h)(o,l)),n&&!n.deleteChat){e.next=25;break}if(Object(F.c)(o)){e.next=23;break}return e.abrupt("return");case 23:t.leaveChat={chatId:o},t.handleLeaveContinue(!0,!1);case 25:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}componentDidMount(){ae.a.on("clientUpdateRequestBlockSender",this.onClientUpdateBlockSender),ae.a.on("clientUpdateRequestLeaveChat",this.onClientUpdateLeaveChat),ae.a.on("clientUpdateRequestClearHistory",this.onClientUpdateClearHistory),ae.a.on("clientUpdateDeleteMessages",this.onClientUpdateDeleteMessages),ae.a.on("clientUpdatePinMessage",this.onClientUpdatePinMessage),ae.a.on("clientUpdateUnpinMessage",this.onClientUpdateUnpinMessage),ae.a.on("clientUpdateAlert",this.onClientUpdateAlert),ae.a.on("clientUpdateInputPasswordAlert",this.onClientUpdateInputPasswordAlert),ae.a.on("clientUpdateSnackbar",this.onClientUpdateSnackbar),ae.a.on("clientUpdateOpenUrlAlert",this.onClientUpdateOpenUrlAlert),ae.a.on("clientUpdateOpenGameAlert",this.onClientUpdateOpenGameAlert),ae.a.on("clientUpdateRequestUrlAlert",this.onClientUpdateRequestUrlAlert)}componentWillUnmount(){ae.a.off("clientUpdateRequestBlockSender",this.onClientUpdateBlockSender),ae.a.off("clientUpdateRequestLeaveChat",this.onClientUpdateLeaveChat),ae.a.off("clientUpdateRequestClearHistory",this.onClientUpdateClearHistory),ae.a.off("clientUpdateDeleteMessages",this.onClientUpdateDeleteMessages),ae.a.off("clientUpdatePinMessage",this.onClientUpdatePinMessage),ae.a.off("clientUpdateUnpinMessage",this.onClientUpdateUnpinMessage),ae.a.off("clientUpdateAlert",this.onClientUpdateAlert),ae.a.off("clientUpdateInputPasswordAlert",this.onClientUpdateInputPasswordAlert),ae.a.off("clientUpdateSnackbar",this.onClientUpdateSnackbar),ae.a.off("clientUpdateOpenUrlAlert",this.onClientUpdateOpenUrlAlert),ae.a.off("clientUpdateOpenGameAlert",this.onClientUpdateOpenGameAlert),ae.a.off("clientUpdateRequestUrlAlert",this.onClientUpdateRequestUrlAlert)}render(){const e=this.state,t=e.leaveChat,a=e.clearHistory,n=e.deleteMessages,s=e.pinMessage,i=e.unpinMessage,r=e.alert,l=e.openUrlAlert,c=e.openGameAlert,d=e.requestUrlAlert,h=e.inputPasswordAlert,p=e.requestBlockSenderAlert;if(t){const e=t.chatId;return o.a.createElement(Wd,{chatId:e,onClose:this.handleLeaveContinue})}if(a){const e=a.chatId;return o.a.createElement(Nd,{chatId:e,onClose:this.handleClearHistoryContinue})}if(n){const e=n.chatId,t=n.messageIds;return o.a.createElement(Pd,{chatId:e,messageIds:t,onClose:this.handleDeleteMessagesContinue})}if(s){const e=s.chatId,t=s.messageId;return o.a.createElement(Qd,{chatId:e,messageId:t,onClose:this.handlePinMessageContinue})}if(i){const e=i.chatId,t=i.messageId;return o.a.createElement(nh,{chatId:e,messageId:t,onClose:this.handleUnpinMessageContinue})}if(r){const e=r.params;return o.a.createElement(wd,{params:e,onClose:this.handleAlertContinue})}if(l){const e=l.url,t=l.params;return o.a.createElement(Kd,{url:e,params:t,onClose:this.handleOpenUrlContinue})}if(c){const e=c.game,t=c.params;return o.a.createElement(Zd,{game:e,params:t,onClose:this.handleOpenGameContinue})}if(d){const e=d.url,t=d.params;return o.a.createElement(Jd,{url:e,params:t,onClose:this.handleRequestUrlContinue})}if(h){const e=h.state,t=h.error;return o.a.createElement(Vd,{state:e,error:t,onClose:this.handleInputPasswordContinue})}if(p){const e=p.sender;return o.a.createElement(Ld,{sender:e,onClose:this.handleBlockSenderContinue})}return null}}var ih=Object(d.a)(p.b,Object(_.a)())(sh);class rh extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePictureInPicture=e=>{const t=e.videoInfo;this.setState({videoInfo:t})},this.onClientUpdatePageWidth=e=>{const t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onClientUpdateInstantViewContent=e=>{const t=e.content;this.setState({instantViewContent:t})},this.onClientUpdateOpenChat=e=>{const t=e.chatId,a=e.messageId,n=e.popup,s=e.options;this.handleSelectChat(t,a,n,s||ae.a.chatSelectOptions)},this.onClientUpdateOpenUser=e=>{const t=e.userId,a=e.popup;this.handleSelectUser(t,a)},this.onClientUpdateChatDetailsVisibility=e=>{const t=ae.a.isChatDetailsVisible;this.setState({isChatDetailsVisible:t})},this.onClientUpdateMediaViewerContent=e=>{const t=ae.a.mediaViewerContent;this.setState({mediaViewerContent:t})},this.onClientUpdateProfileMediaViewerContent=e=>{const t=ae.a.profileMediaViewerContent;this.setState({profileMediaViewerContent:t})},this.onClientUpdateForward=e=>{const t=e.info;this.setState({forwardInfo:t})},this.handleSelectChat=(e,t=null,a=!1,n={})=>{const s=ae.a.getChatId(),i=ae.a.dialogChatId,r=ae.a.getMessageId();a?i!==e&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:e}):s===e&&t&&r===t&&!n?(this.dialogDetailsRef.current.scrollToMessage(),t&&Object(Q.i)(e,t)):s!==e||t||n?x.a.setChatId(e,t,n):this.dialogDetailsRef.current.scrollToStart()},this.handleSelectUser=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"createPrivateChat",user_id:a,force:!0});case 4:i=e.sent,t.handleSelectChat(i.id,null,n);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.dialogDetailsRef=o.a.createRef();const a=ae.a.isChatDetailsVisible,n=ae.a.mediaViewerContent,r=ae.a.profileMediaViewerContent,l=ae.a.isSmallWidth;this.state={isChatDetailsVisible:a,mediaViewerContent:n,profileMediaViewerContent:r,isSmallWidth:l,forwardInfo:null,instantViewContent:null,videoInfo:null}}componentDidMount(){te.a.on("clientUpdateOpenUser",this.onClientUpdateOpenUser),Se.a.on("clientUpdateOpenChat",this.onClientUpdateOpenChat),ae.a.on("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),ae.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),ae.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),ae.a.on("clientUpdateProfileMediaViewerContent",this.onClientUpdateProfileMediaViewerContent),ae.a.on("clientUpdateForward",this.onClientUpdateForward),pd.a.on("clientUpdateInstantViewContent",this.onClientUpdateInstantViewContent),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){te.a.off("clientUpdateOpenUser",this.onClientUpdateOpenUser),Se.a.off("clientUpdateOpenChat",this.onClientUpdateOpenChat),ae.a.off("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),ae.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),ae.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),ae.a.off("clientUpdateProfileMediaViewerContent",this.onClientUpdateProfileMediaViewerContent),ae.a.off("clientUpdateForward",this.onClientUpdateForward),pd.a.off("clientUpdateInstantViewContent",this.onClientUpdateInstantViewContent),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}render(){const e=this.state,t=e.instantViewContent,a=e.isChatDetailsVisible,n=e.mediaViewerContent,s=e.profileMediaViewerContent,i=e.forwardInfo,r=e.videoInfo,l=e.isSmallWidth;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:c()("page",{"page-small":l,"page-third-column":a})},o.a.createElement(Wi,null),o.a.createElement(Gc,{ref:this.dialogDetailsRef}),a&&o.a.createElement(ta,null)),o.a.createElement(ih,null),t&&o.a.createElement(md,t),n&&o.a.createElement(Ed,n),s&&o.a.createElement(kd,s),i&&o.a.createElement(se,i),r&&o.a.createElement(O,r))}}const oh=Object(d.a)(h.a,m);t.default=oh(rh)}])]);
//# sourceMappingURL=3.8b564064.chunk.js.map